{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"AI Tools Stack","text":"<p>Welcome to the unified documentation for the AI Tools Stack. This site brings all tool libraries together in one place and shows how they compose into a progressive-disclosure MCP surface.</p> <p></p>"},{"location":"#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"#what-this-stack-provides","title":"What this stack provides","text":"<ul> <li>Canonical tool schemas (toolmodel)</li> <li>Registry and discovery (toolindex)</li> <li>Docs and examples (tooldocs)</li> <li>Execution and chaining (toolrun)</li> <li>Code-mode orchestration (toolcode)</li> <li>Sandbox/runtime backends (toolruntime)</li> <li>Search strategies (toolsearch)</li> <li>MCP server wiring (metatools-mcp)</li> </ul>"},{"location":"#design-notes-and-user-journeys","title":"Design Notes and User Journeys","text":"<p>For deeper context, see the aggregated indexes:</p> <ul> <li>Design Notes Index \u2014 per\u2011repo tradeoffs and error semantics</li> <li>User Journeys Index \u2014 end\u2011to\u2011end agent workflows</li> </ul>"},{"location":"#high-level-flow","title":"High-level flow","text":""},{"location":"#quickstart","title":"Quickstart","text":"<ol> <li>Start with <code>toolmodel</code> for your canonical schemas.</li> <li>Register tools in <code>toolindex</code> for discovery.</li> <li>Add docs/examples in <code>tooldocs</code>.</li> <li>Execute tools via <code>toolrun</code>.</li> <li>Expose the MCP surface using <code>metatools-mcp</code>.</li> </ol> <p>See the Components section for per-library examples and diagrams.</p>"},{"location":"#docs-from-each-repo","title":"Docs from each repo","text":"<p>Under Library Docs (from repos) you will find the docs imported directly from each repository at build time.</p>"},{"location":"architecture/design-notes/","title":"Design Notes Index","text":"<p>This page aggregates the per\u2011repo Design Notes pages that document tradeoffs and error semantics for each component. Use these when you want to understand why a design decision was made or how to handle specific failure modes.</p>"},{"location":"architecture/design-notes/#perrepo-design-notes","title":"Per\u2011repo Design Notes","text":"<ul> <li>toolmodel \u2014 <code>library-docs-from-repos/toolmodel/design-notes.md</code></li> <li>toolindex \u2014 <code>library-docs-from-repos/toolindex/design-notes.md</code></li> <li>tooldocs \u2014 <code>library-docs-from-repos/tooldocs/design-notes.md</code></li> <li>toolrun \u2014 <code>library-docs-from-repos/toolrun/design-notes.md</code></li> <li>toolcode \u2014 <code>library-docs-from-repos/toolcode/design-notes.md</code></li> <li>toolruntime \u2014 <code>library-docs-from-repos/toolruntime/design-notes.md</code></li> <li>toolsearch \u2014 <code>library-docs-from-repos/toolsearch/design-notes.md</code></li> <li>metatools\u2011mcp \u2014 <code>library-docs-from-repos/metatools-mcp/design-notes.md</code></li> </ul>"},{"location":"architecture/design-notes/#when-to-read-these","title":"When to read these","text":"<ul> <li>You\u2019re debugging failure modes or error propagation.</li> <li>You want to compare tradeoffs (latency vs safety, flexibility vs simplicity).</li> <li>You\u2019re deciding where to plug in a custom implementation.</li> </ul>"},{"location":"architecture/overview/","title":"Stack Architecture","text":"<p>This stack is built around progressive disclosure and a clean separation of schema, discovery, docs, execution, and transport.</p>"},{"location":"architecture/overview/#layering-model","title":"Layering model","text":""},{"location":"architecture/overview/#progressive-disclosure-pipeline","title":"Progressive disclosure pipeline","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Run as toolrun\n\n  Agent-&gt;&gt;MCP: search_tools(query)\n  MCP-&gt;&gt;Index: Search(query)\n  Index--&gt;&gt;MCP: summaries\n  MCP--&gt;&gt;Agent: summaries\n\n  Agent-&gt;&gt;MCP: describe_tool(id, schema)\n  MCP-&gt;&gt;Docs: DescribeTool(id, schema)\n  Docs--&gt;&gt;MCP: tool schema\n  MCP--&gt;&gt;Agent: schema\n\n  Agent-&gt;&gt;MCP: run_tool(id, args)\n  MCP-&gt;&gt;Run: Run(id, args)\n  Run--&gt;&gt;MCP: result\n  MCP--&gt;&gt;Agent: result</code></pre>"},{"location":"architecture/overview/#tool-execution-and-runtime-isolation","title":"Tool execution and runtime isolation","text":""},{"location":"architecture/overview/#search-strategy-layering","title":"Search strategy layering","text":""},{"location":"architecture/pluggable-architecture/","title":"Pluggable Architecture","text":"<p>The stack is designed so each layer is replaceable without changing the others. This keeps the core stable while allowing experimentation and integration.</p>"},{"location":"architecture/pluggable-architecture/#extension-points","title":"Extension points","text":""},{"location":"architecture/pluggable-architecture/#what-you-can-plug-in","title":"What you can plug in","text":"<ul> <li>Search: swap lexical for BM25 or semantic ranking</li> <li>Execution: add MCP servers, local handlers, or provider adapters</li> <li>Code execution: change engines or language runtimes</li> <li>Runtime isolation: choose the sandbox backend per environment</li> </ul>"},{"location":"architecture/pluggable-architecture/#design-goal","title":"Design goal","text":"<p>The default implementations are intentionally simple and safe. Advanced capabilities are injected rather than baked into the core.</p>"},{"location":"architecture/progressive-disclosure/","title":"Progressive Disclosure","text":"<p>Progressive disclosure is the core usability strategy of this stack. It lets agents discover just enough information to choose the right tool, then retrieve deeper details only when needed.</p>"},{"location":"architecture/progressive-disclosure/#why-it-matters","title":"Why it matters","text":"<ul> <li>Lower token cost: most tools are never fully expanded</li> <li>Faster decisions: summary-level signals are enough to pick candidates</li> <li>Safer execution: schema and examples are fetched only after a tool is chosen</li> </ul>"},{"location":"architecture/progressive-disclosure/#flow","title":"Flow","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Run as toolrun\n\n  Agent-&gt;&gt;MCP: search_tools(\"repo metadata\")\n  MCP-&gt;&gt;Index: Search\n  Index--&gt;&gt;MCP: summaries\n  MCP--&gt;&gt;Agent: summaries\n\n  Agent-&gt;&gt;MCP: describe_tool(id, schema)\n  MCP-&gt;&gt;Docs: DescribeTool\n  Docs--&gt;&gt;MCP: tool schema\n  MCP--&gt;&gt;Agent: schema\n\n  Agent-&gt;&gt;MCP: run_tool(id, args)\n  MCP-&gt;&gt;Run: Run\n  Run--&gt;&gt;MCP: result\n  MCP--&gt;&gt;Agent: result</code></pre>"},{"location":"architecture/progressive-disclosure/#component-roles","title":"Component roles","text":"<ul> <li><code>toolindex</code>: fast, summary-only discovery</li> <li><code>tooldocs</code>: structured detail (schema/full/examples)</li> <li><code>toolrun</code>: execution with validation + consistent errors</li> <li><code>toolcode</code>: optional code-mode orchestration</li> </ul>"},{"location":"architecture/user-journeys/","title":"User Journeys Index","text":"<p>This page aggregates the per\u2011repo User Journey pages that describe full end\u2011to\u2011end workflows. These are ideal for onboarding and for validating that the progressive\u2011disclosure flow is coherent across layers.</p>"},{"location":"architecture/user-journeys/#perrepo-user-journeys","title":"Per\u2011repo User Journeys","text":"<ul> <li>toolmodel \u2014 <code>library-docs-from-repos/toolmodel/user-journey.md</code></li> <li>toolindex \u2014 <code>library-docs-from-repos/toolindex/user-journey.md</code></li> <li>tooldocs \u2014 <code>library-docs-from-repos/tooldocs/user-journey.md</code></li> <li>toolrun \u2014 <code>library-docs-from-repos/toolrun/user-journey.md</code></li> <li>toolcode \u2014 <code>library-docs-from-repos/toolcode/user-journey.md</code></li> <li>toolruntime \u2014 <code>library-docs-from-repos/toolruntime/user-journey.md</code></li> <li>toolsearch \u2014 <code>library-docs-from-repos/toolsearch/user-journey.md</code></li> <li>metatools\u2011mcp \u2014 <code>library-docs-from-repos/metatools-mcp/user-journey.md</code></li> </ul>"},{"location":"architecture/user-journeys/#when-to-read-these","title":"When to read these","text":"<ul> <li>You want to understand how an agent discovers, inspects, and runs tools.</li> <li>You\u2019re validating the progressive disclosure path across components.</li> <li>You want examples that show how the pieces fit together end\u2011to\u2011end.</li> </ul>"},{"location":"architecture/why-go/","title":"Why Go","text":"<p>Go is a strong fit for this stack because it pairs high performance with a simple concurrency model and a clean interface story.</p>"},{"location":"architecture/why-go/#advantages-for-this-stack","title":"Advantages for this stack","text":""},{"location":"architecture/why-go/#compiled-fast-startup","title":"Compiled + fast startup","text":"<ul> <li>Small binaries and quick startup times are ideal for MCP servers</li> <li>Predictable performance for low-latency tool calls</li> </ul>"},{"location":"architecture/why-go/#concurrency-without-complexity","title":"Concurrency without complexity","text":"<ul> <li>Goroutines and channels make async tool execution straightforward</li> <li><code>context.Context</code> enables timeouts and cancellation across the stack</li> </ul>"},{"location":"architecture/why-go/#interface-first-extensibility","title":"Interface-first extensibility","text":"<ul> <li>Each layer (<code>Searcher</code>, <code>Runner</code>, <code>Engine</code>, <code>Backend</code>) is interface-driven</li> <li>You can plug in new languages, providers, or runtimes without redesigning</li> </ul>"},{"location":"architecture/why-go/#operational-simplicity","title":"Operational simplicity","text":"<ul> <li>Static binaries simplify deployment</li> <li>Works equally well in containers, VMs, or bare metal</li> </ul>"},{"location":"architecture/why-go/#summary","title":"Summary","text":"<p>Go lets you build a composable system that is fast, concurrent, and easy to extend. That is exactly what this stack needs.</p>"},{"location":"components/metatools-mcp/","title":"metatools-mcp","text":"<p>MCP server that exposes the tool stack via standardized MCP tools with a progressive-disclosure flow.</p>"},{"location":"components/metatools-mcp/#motivation","title":"Motivation","text":"<ul> <li>Provide a minimal, consistent MCP surface</li> <li>Keep discovery cheap and execution safe</li> <li>Enable pluggable search and optional code execution</li> </ul>"},{"location":"components/metatools-mcp/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Expose <code>search_tools</code>, <code>list_namespaces</code></li> <li>Expose <code>describe_tool</code>, <code>list_tool_examples</code></li> <li>Expose <code>run_tool</code>, <code>run_chain</code></li> <li>Optionally expose <code>execute_code</code></li> <li>Use the official MCP Go SDK</li> </ul>"},{"location":"components/metatools-mcp/#example","title":"Example","text":"<pre><code>srv, _ := server.New(cfg)\n_ = srv.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"components/metatools-mcp/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[metatools-mcp] --&gt; B[toolindex]\n  A --&gt; C[tooldocs]\n  A --&gt; D[toolrun]\n  A --&gt; E[toolcode]\n  E --&gt; F[toolruntime]</code></pre>"},{"location":"components/metatools-mcp/#usability-notes","title":"Usability notes","text":"<ul> <li>Small tool surface reduces prompt complexity</li> <li>Schemas and examples are fetched on demand</li> </ul>"},{"location":"components/toolcode/","title":"toolcode","text":"<p>Code-mode orchestration layer that wraps search, docs, and execution into a single programmable surface.</p>"},{"location":"components/toolcode/#motivation","title":"Motivation","text":"<ul> <li>Enable conditional logic and multi-step orchestration</li> <li>Keep tool orchestration explicit and testable</li> <li>Provide call traces for debugging</li> </ul>"},{"location":"components/toolcode/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Execute short orchestration snippets</li> <li>Provide a minimal in-sandbox API (SearchTools, DescribeTool, RunTool)</li> <li>Enforce timeouts and limits</li> </ul>"},{"location":"components/toolcode/#example","title":"Example","text":"<pre><code>executor := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n\nres, _ := executor.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"components/toolcode/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolcode] --&gt; B[toolindex]\n  A --&gt; C[tooldocs]\n  A --&gt; D[toolrun]\n  A --&gt; E[toolruntime]</code></pre>"},{"location":"components/toolcode/#usability-notes","title":"Usability notes","text":"<ul> <li><code>ExecuteResult</code> includes tool call traces</li> <li>Limits are enforced consistently across engines</li> </ul>"},{"location":"components/tooldocs/","title":"tooldocs","text":"<p>Progressive, structured documentation and examples for tools. Designed for schema-first usage and token-efficient guidance.</p>"},{"location":"components/tooldocs/#motivation","title":"Motivation","text":"<ul> <li>Pull full schemas only when needed</li> <li>Reduce tool call errors with examples</li> <li>Keep long docs out of the critical path</li> </ul>"},{"location":"components/tooldocs/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Detail tiers: summary \u2192 schema \u2192 full</li> <li>Short usage examples with caps</li> <li>Notes and external references</li> </ul>"},{"location":"components/tooldocs/#example","title":"Example","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:get_repo\", tooldocs.DocEntry{\n  Summary: \"Fetch repository metadata\",\n  Notes:   \"Requires authentication.\",\n})\n\nschema, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nexamples, _ := store.ListExamples(\"github:get_repo\", 2)\n</code></pre>"},{"location":"components/tooldocs/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[tooldocs] --&gt; B[summary]\n  A --&gt; C[schema]\n  A --&gt; D[full]\n  A --&gt; E[metatools-mcp]</code></pre>"},{"location":"components/tooldocs/#usability-notes","title":"Usability notes","text":"<ul> <li>Example caps protect token budgets</li> <li>Summary tier is safe for discovery</li> <li>Schema tier is designed for tool invocation</li> </ul>"},{"location":"components/toolindex/","title":"toolindex","text":"<p>Global registry and search layer for tools. Provides progressive discovery and canonical lookup by tool ID.</p>"},{"location":"components/toolindex/#motivation","title":"Motivation","text":"<ul> <li>Keep discovery fast and cheap</li> <li>Decouple search quality from core registry</li> <li>Provide a single source of truth for tool IDs and backends</li> </ul>"},{"location":"components/toolindex/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Register tools + backends</li> <li>Search by name/namespace/description/tags</li> <li>List namespaces</li> <li>Resolve tools by canonical ID</li> </ul>"},{"location":"components/toolindex/#example","title":"Example","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n_ = idx.RegisterTool(tool, backend)\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"components/toolindex/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolindex] --&gt; B[Searcher]\n  B --&gt; C[lexical]\n  B --&gt; D[toolsearch BM25]\n  A --&gt; E[tooldocs]\n  A --&gt; F[toolrun]</code></pre>"},{"location":"components/toolindex/#usability-notes","title":"Usability notes","text":"<ul> <li>Summaries are token-cheap</li> <li>Namespace listing enables simple filtering</li> <li>Backends are swappable without changing IDs</li> </ul>"},{"location":"components/toolmodel/","title":"toolmodel","text":"<p>Canonical schema definitions for all tools. This is the source of truth for IDs, schemas, tags, and backend bindings.</p>"},{"location":"components/toolmodel/#motivation","title":"Motivation","text":"<ul> <li>Standardize tool definitions across the stack</li> <li>Align directly with MCP via the official Go SDK</li> <li>Keep schemas portable and validation deterministic</li> </ul>"},{"location":"components/toolmodel/#core-types","title":"Core types","text":"<ul> <li><code>Tool</code> (embeds MCP <code>mcp.Tool</code>, adds <code>Namespace</code>, <code>Version</code>, <code>Tags</code>)</li> <li><code>ToolBackend</code> (execution binding: mcp, provider, local)</li> <li><code>SchemaValidator</code> (input/output validation)</li> </ul>"},{"location":"components/toolmodel/#example","title":"Example","text":"<pre><code>import (\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntool := toolmodel.Tool{\n  Namespace: \"github\",\n  Tool: mcp.Tool{\n    Name:        \"get_repo\",\n    Description: \"Fetch repository metadata\",\n    InputSchema: map[string]any{\n      \"type\": \"object\",\n      \"properties\": map[string]any{\n        \"owner\": {\"type\": \"string\"},\n        \"repo\":  {\"type\": \"string\"},\n      },\n      \"required\": []string{\"owner\", \"repo\"},\n    },\n  },\n  Tags: toolmodel.NormalizeTags([]string{\"GitHub\", \"repos\"}),\n}\n\n_ = tool.Validate()\n</code></pre>"},{"location":"components/toolmodel/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolmodel.Tool] --&gt; B[toolindex]\n  A --&gt; C[tooldocs]\n  A --&gt; D[toolrun]</code></pre>"},{"location":"components/toolmodel/#usability-notes","title":"Usability notes","text":"<ul> <li>Schemas accept maps or JSON bytes</li> <li>Tags are normalized for fast search</li> <li>IDs are stable and human\u2011readable</li> </ul>"},{"location":"components/toolrun/","title":"toolrun","text":"<p>Execution layer for tools and chains. Backend-agnostic and aligned to MCP <code>run_tool</code> and <code>run_chain</code> semantics.</p>"},{"location":"components/toolrun/#motivation","title":"Motivation","text":"<ul> <li>Provide consistent execution semantics across backends</li> <li>Validate inputs/outputs for safety</li> <li>Offer deterministic chain behavior</li> </ul>"},{"location":"components/toolrun/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Resolve tools and backends</li> <li>Validate inputs/outputs with toolmodel schemas</li> <li>Dispatch to MCP, provider, or local backends</li> <li>Execute chains with <code>previous</code> injection</li> </ul>"},{"location":"components/toolrun/#example","title":"Example","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n\nresult, _ := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"octo\",\n  \"repo\":  \"hello\",\n})\n</code></pre>"},{"location":"components/toolrun/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolrun] --&gt; B[Resolve + Validate]\n  B --&gt; C[Dispatch]\n  C --&gt; D[MCP]\n  C --&gt; E[Provider]\n  C --&gt; F[Local]</code></pre>"},{"location":"components/toolrun/#usability-notes","title":"Usability notes","text":"<ul> <li>Streaming is optional; non-streaming backends return <code>ErrStreamNotSupported</code></li> <li>Backend selection is deterministic by default</li> </ul>"},{"location":"components/toolruntime/","title":"toolruntime","text":"<p>Sandbox/runtime abstraction for executing code securely. Provides multiple backends with a single interface.</p>"},{"location":"components/toolruntime/#motivation","title":"Motivation","text":"<ul> <li>Create an explicit trust boundary for code execution</li> <li>Swap isolation backends without changing APIs</li> <li>Apply security profiles consistently</li> </ul>"},{"location":"components/toolruntime/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Runtime interface + default implementation</li> <li>Backends (unsafe host, docker, kubernetes, gvisor, firecracker, wasm)</li> <li>Security profiles and execution limits</li> </ul>"},{"location":"components/toolruntime/#example","title":"Example","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"components/toolruntime/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolruntime] --&gt; B[unsafe]\n  A --&gt; C[docker]\n  A --&gt; D[kubernetes]\n  A --&gt; E[firecracker]\n  A --&gt; F[gvisor]\n  A --&gt; G[wasm]</code></pre>"},{"location":"components/toolruntime/#usability-notes","title":"Usability notes","text":"<ul> <li>Profiles separate policy from implementation</li> <li>Backends are swappable per environment</li> </ul>"},{"location":"components/toolsearch/","title":"toolsearch","text":"<p>Search strategy library that plugs into toolindex. Currently provides BM25 with room for semantic/hybrid search.</p>"},{"location":"components/toolsearch/#motivation","title":"Motivation","text":"<ul> <li>Keep <code>toolindex</code> minimal</li> <li>Allow search experimentation without destabilizing the core</li> <li>Improve relevance without changing IDs or schemas</li> </ul>"},{"location":"components/toolsearch/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Provide BM25 ranking</li> <li>Keep search logic decoupled from the index</li> <li>Support pluggable scoring</li> </ul>"},{"location":"components/toolsearch/#example","title":"Example","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{K1: 1.5, B: 0.75})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"components/toolsearch/#diagram","title":"Diagram","text":"<pre><code>flowchart LR\n  A[toolindex] --&gt; B[toolsearch]\n  B --&gt; C[BM25]\n  B --&gt; D[semantic]</code></pre>"},{"location":"components/toolsearch/#usability-notes","title":"Usability notes","text":"<ul> <li>Deterministic ranking avoids jitter</li> <li>BM25 is opt-in and isolated by design</li> </ul>"},{"location":"operations/ci-and-versioning/","title":"CI and Versioning","text":""},{"location":"operations/ci-and-versioning/#ci-checks","title":"CI checks","text":"<p>Each repo runs CI for:</p> <ul> <li>go vet</li> <li>go test</li> <li>lint + security (golangci-lint + gosec)</li> </ul>"},{"location":"operations/ci-and-versioning/#version-alignment","title":"Version alignment","text":"<ul> <li><code>ai-tools-stack/go.mod</code> is the source of truth.</li> <li><code>VERSIONS.md</code> is generated in each repo and updated via:</li> </ul> <pre><code>scripts/update-version-matrix.sh --apply\n</code></pre>"},{"location":"operations/ci-and-versioning/#dependency-bumping","title":"Dependency bumping","text":"<p>Use the DAG-aware bump tool:</p> <pre><code>scripts/bump-dep.sh --dep toolruntime --latest --apply\n</code></pre> <p>This updates all downstream repos and ai-tools-stack in order.</p>"},{"location":"operations/ci-and-versioning/#docs-automation","title":"Docs automation","text":"<p>The unified docs site is built from this repo using MkDocs + the multirepo plugin. GitHub Actions runs on push to main and nightly (scheduled) to pull fresh docs from the tool repos.</p> <p>Versioned docs are published with <code>mike</code>:</p> <ul> <li><code>latest</code> alias is deployed from <code>main</code></li> <li>tag builds deploy versioned docs (for example, <code>v0.1.8</code>) and set <code>stable</code></li> </ul> <p>Local preview:</p> <pre><code>pip install -r requirements.txt\n./scripts/prepare-mkdocs-multirepo.sh\nmkdocs serve\n</code></pre> <p>Versioned preview:</p> <pre><code>pip install -r requirements.txt\n./scripts/prepare-mkdocs-multirepo.sh\nmike serve\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/","title":"toolmodel","text":"<p><code>toolmodel</code> is the canonical, MCP-aligned data model for tools across the stack. It embeds the official MCP Go SDK <code>mcp.Tool</code>, adds namespace + tags, and provides schema validation helpers.</p> <p></p>"},{"location":"library-docs-from-repos/toolmodel/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#motivation","title":"Motivation","text":"<ul> <li>Single source of truth for tool schemas and IDs</li> <li>Protocol alignment by embedding the official MCP SDK type</li> <li>Safe validation with deterministic, dependency-light JSON Schema checks</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#key-apis","title":"Key APIs","text":"<ul> <li><code>Tool</code> (embeds <code>mcp.Tool</code>, adds <code>Namespace</code>, <code>Version</code>, <code>Tags</code>)</li> <li><code>ToolBackend</code> (mcp/provider/local binding)</li> <li><code>SchemaValidator</code> + <code>NewDefaultValidator()</code></li> <li><code>NormalizeTags</code>, <code>ToolID</code>, <code>ParseToolID</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#quickstart","title":"Quickstart","text":"<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\nfunc main() {\n  tool := toolmodel.Tool{\n    Namespace: \"github\",\n    Tool: mcp.Tool{\n      Name:        \"get_repo\",\n      Description: \"Fetch repository metadata\",\n      InputSchema: map[string]any{\n        \"type\": \"object\",\n        \"properties\": map[string]any{\n          \"owner\": {\"type\": \"string\"},\n          \"repo\":  {\"type\": \"string\"},\n        },\n        \"required\": []string{\"owner\", \"repo\"},\n      },\n    },\n    Tags: toolmodel.NormalizeTags([]string{\"GitHub\", \"repos\"}),\n  }\n\n  if err := tool.Validate(); err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Println(tool.ToolID()) // github:get_repo\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/#usability-notes","title":"Usability notes","text":"<ul> <li><code>InputSchema</code>/<code>OutputSchema</code> accept <code>map[string]any</code> or JSON bytes</li> <li>Tags are normalized for search (<code>toolindex</code> + <code>toolsearch</code>)</li> <li>Canonical IDs are stable and human-friendly</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#next","title":"Next","text":"<ul> <li>Architecture and placement in the stack: <code>architecture.md</code></li> <li>Usage patterns and validation: <code>usage.md</code></li> <li>Additional examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/","title":"API Reference","text":"<p>This is a concise map of the public types and interfaces. See code for details.</p>"},{"location":"library-docs-from-repos/toolmodel/api/#tool","title":"Tool","text":"<p><code>toolmodel.Tool</code> embeds <code>mcp.Tool</code> and adds:</p> <ul> <li><code>Namespace string</code></li> <li><code>Version string</code></li> <li><code>Tags []string</code></li> </ul> <p>Common fields from <code>mcp.Tool</code> used in this stack:</p> <ul> <li><code>Name string</code></li> <li><code>Title string</code></li> <li><code>Description string</code></li> <li><code>InputSchema any</code></li> <li><code>OutputSchema any</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/#ids","title":"IDs","text":"<ul> <li><code>Tool.ToolID() string</code></li> <li><code>ParseToolID(id string) (namespace, name string, err error)</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/#backends","title":"Backends","text":"<pre><code>type BackendKind string\nconst (\n  BackendKindMCP      BackendKind = \"mcp\"\n  BackendKindProvider BackendKind = \"provider\"\n  BackendKindLocal    BackendKind = \"local\"\n)\n\ntype ToolBackend struct {\n  Kind     BackendKind\n  MCP      *MCPBackend\n  Provider *ProviderBackend\n  Local    *LocalBackend\n}\n\ntype MCPBackend struct {\n  ServerName string\n}\n\ntype ProviderBackend struct {\n  ProviderID string\n  ToolID     string\n}\n\ntype LocalBackend struct {\n  Name string\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/api/#validation","title":"Validation","text":"<pre><code>type SchemaValidator interface {\n  Validate(schema any, instance any) error\n  ValidateInput(tool *Tool, args any) error\n  ValidateOutput(tool *Tool, result any) error\n}\n\nfunc NewDefaultValidator() *DefaultValidator\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/api/#utilities","title":"Utilities","text":"<ul> <li><code>NormalizeTags([]string) []string</code></li> <li><code>Tool.Validate() error</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/architecture/","title":"Architecture","text":"<p><code>toolmodel</code> sits at the bottom of the stack. Everything else consumes its types and uses it as the canonical source of truth.</p>"},{"location":"library-docs-from-repos/toolmodel/architecture/#component-view","title":"Component view","text":"<pre><code>flowchart LR\n  A[toolmodel.Tool] --&gt; B[toolindex]\n  A --&gt; C[tooldocs]\n  A --&gt; D[toolrun]\n  A --&gt; E[metatools-mcp]\n\n  subgraph Binding\n    F[ToolBackend]\n  end\n\n  F --&gt; D</code></pre>"},{"location":"library-docs-from-repos/toolmodel/architecture/#data-model-view","title":"Data model view","text":"<pre><code>classDiagram\n  class Tool {\n    +string Namespace\n    +string Name\n    +string Version\n    +[]string Tags\n    +ToolID() string\n  }\n\n  class ToolBackend {\n    +BackendKind Kind\n  }\n\n  class MCPBackend {\n    +string ServerName\n  }\n\n  class ProviderBackend {\n    +string ProviderID\n    +string ToolID\n  }\n\n  class LocalBackend {\n    +string Name\n  }\n\n  ToolBackend --&gt; MCPBackend\n  ToolBackend --&gt; ProviderBackend\n  ToolBackend --&gt; LocalBackend</code></pre>"},{"location":"library-docs-from-repos/toolmodel/architecture/#validation-pipeline","title":"Validation pipeline","text":"<pre><code>flowchart LR\n  A[Tool.InputSchema] --&gt; B[DefaultValidator]\n  B --&gt; C[Resolve schema]\n  C --&gt; D[Validate instance]\n  D --&gt; E[Error or success]</code></pre>"},{"location":"library-docs-from-repos/toolmodel/architecture/#design-notes","title":"Design notes","text":"<ul> <li>Embeds <code>mcp.Tool</code> to stay aligned with the official MCP SDK.</li> <li>Adds <code>Namespace</code>, <code>Version</code>, and <code>Tags</code> without altering MCP semantics.</li> <li>Keeps validation dependency-light and deterministic.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/","title":"Design Notes","text":"<p>This page captures the tradeoffs and error semantics that guided <code>toolmodel</code>.</p>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Spec alignment over custom types. <code>Tool</code> embeds the official MCP Go SDK <code>mcp.Tool</code> to stay 1:1 with the spec and JSON tags. This minimizes drift but means <code>InputSchema</code>/<code>OutputSchema</code> are <code>any</code>, so validation must be handled explicitly.</li> <li>Minimal extensions. <code>Namespace</code>, <code>Version</code>, and <code>Tags</code> are the only additions to the MCP shape. These are intentionally kept small to preserve transport compatibility and keep higher layers in control of semantics.</li> <li>Explicit tool IDs. Canonical IDs are <code>namespace:name</code> (or just <code>name</code>), computed by <code>ToolID()</code>. This keeps IDs stable across backends while remaining human-readable.</li> <li>Validation boundary. <code>Tool.Validate()</code> enforces naming and required fields only. JSON Schema validation is delegated to <code>SchemaValidator</code> to keep <code>Tool</code> lightweight and reusable.</li> <li>Safe schema validation. The default validator blocks external <code>$ref</code> resolution to avoid network access and non-determinism. This trades off remote schema reuse for safety and predictability.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolmodel</code> uses sentinel errors so callers can reliably classify failures:</p> <ul> <li><code>ErrInvalidToolID</code> \u2013 malformed tool IDs (empty, extra <code>:</code> separators, missing parts).</li> <li><code>ErrInvalidTool</code> \u2013 invalid tool definition (missing name, invalid characters, missing input schema).</li> <li><code>ErrInvalidSchema</code> \u2013 schema is not valid JSON Schema or cannot be parsed.</li> <li><code>ErrUnsupportedSchema</code> \u2013 schema dialect is not supported (only 2020-12 and draft-07 are accepted).</li> <li><code>ErrExternalRef</code> \u2013 external <code>$ref</code> resolution attempted (blocked by default).</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#validation-behavior","title":"Validation behavior","text":"<ul> <li><code>Tool.Validate()</code> enforces name format and <code>InputSchema != nil</code>.</li> <li><code>DefaultValidator.ValidateInput</code> and <code>ValidateOutput</code> return <code>ErrInvalidSchema</code> or <code>ErrUnsupportedSchema</code> when schema parsing or dialect checks fail.</li> <li>Output validation is optional by design; <code>OutputSchema</code> can be absent.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom schema validation: implement <code>SchemaValidator</code> if you need different dialects, format checking, or external reference resolution.</li> <li>Tag strategies: <code>NormalizeTags</code> can be replaced at higher layers (e.g., for hierarchical tags or full-text indexing).</li> <li>Tool ingestion: higher layers can deserialize MCP tool JSON via <code>FromMCPJSON</code> and then enrich with <code>Namespace</code> and <code>Tags</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep <code>Namespace</code> stable even if backend endpoints change.</li> <li>Use short, searchable <code>Tags</code>; <code>NormalizeTags</code> caps to 20 items and 64 chars each.</li> <li>Prefer JSON Schema 2020-12 with explicit <code>type</code> and <code>required</code> fields for best downstream schema derivation.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolmodel/examples/#tag-normalization","title":"Tag normalization","text":"<pre><code>normalized := toolmodel.NormalizeTags([]string{\n  \"  GitHub Repos \",\n  \"GITHUB  repos\",\n  \"  ci/cd  \",\n})\n// =&gt; [\"github-repos\", \"ci-cd\"]\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/examples/#validate-output","title":"Validate output","text":"<pre><code>result := map[string]any{\n  \"full_name\": \"octo/hello\",\n}\n\nif err := validator.ValidateOutput(&amp;tool, result); err != nil {\n  // handle schema mismatch\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/examples/#canonical-id-parsing","title":"Canonical ID parsing","text":"<pre><code>ns, name, err := toolmodel.ParseToolID(\"github:get_repo\")\n// ns = \"github\", name = \"get_repo\"\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolmodel/usage/#define-a-tool","title":"Define a tool","text":"<pre><code>import (\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntool := toolmodel.Tool{\n  Namespace: \"tickets\",\n  Tool: mcp.Tool{\n    Name:        \"create\",\n    Description: \"Create a support ticket\",\n    InputSchema: map[string]any{\n      \"type\": \"object\",\n      \"properties\": map[string]any{\n        \"title\":    {\"type\": \"string\"},\n        \"priority\": {\"type\": \"string\", \"enum\": []string{\"low\", \"high\"}},\n      },\n      \"required\": []string{\"title\"},\n    },\n  },\n  Tags: toolmodel.NormalizeTags([]string{\"Support\", \"Tickets\"}),\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#tool-ids","title":"Tool IDs","text":"<pre><code>id := tool.ToolID()                 // tickets:create\nns, name, _ := toolmodel.ParseToolID(id)\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#backends","title":"Backends","text":"<p><code>toolmodel</code> does not execute anything. It only describes how a tool can be executed. These backends are consumed by <code>toolrun</code>.</p> <pre><code>mcpBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindMCP,\n  MCP:  &amp;toolmodel.MCPBackend{ServerName: \"github\"},\n}\n\nproviderBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindProvider,\n  Provider: &amp;toolmodel.ProviderBackend{\n    ProviderID: \"internal-api\",\n    ToolID:     \"tickets.create\",\n  },\n}\n\nlocalBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"create_ticket\"},\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#validation","title":"Validation","text":"<pre><code>validator := toolmodel.NewDefaultValidator()\n\nif err := validator.ValidateInput(&amp;tool, map[string]any{\"title\": \"Help\"}); err != nil {\n  // handle validation error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#dialects-and-safety","title":"Dialects and safety","text":"<ul> <li>JSON Schema 2020-12 is assumed when <code>$schema</code> is missing.</li> <li>draft-07 is accepted (normalized internally).</li> <li>External <code>$ref</code> is blocked (no network resolution).</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/","title":"User Journey","text":"<p>This journey shows how a tool definition flows from authoring to execution across the stack, with <code>toolmodel</code> as the source of truth.</p>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Author\n  participant ToolModel as toolmodel\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Runner as toolrun\n  participant MCP as metatools-mcp\n  participant Agent\n\n  Author-&gt;&gt;ToolModel: Define Tool (name, schema, namespace, tags)\n  ToolModel-&gt;&gt;Index: Register Tool + Backend\n  Agent-&gt;&gt;MCP: search_tools(query)\n  MCP-&gt;&gt;Index: Search\n  Agent-&gt;&gt;MCP: describe_tool(tool_id, schema)\n  MCP-&gt;&gt;Docs: DescribeTool\n  Agent-&gt;&gt;MCP: run_tool(tool_id, args)\n  MCP-&gt;&gt;Runner: Run</code></pre>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Author defines a tool using <code>toolmodel.Tool</code> with an MCP-compatible schema.</li> <li>Tool is validated (<code>Tool.Validate()</code> + optional schema validation).</li> <li>Tool is registered into <code>toolindex</code> with a backend binding.</li> <li>Agent discovers tools via <code>search_tools</code> (powered by <code>toolindex</code>).</li> <li>Agent inspects schema/docs via <code>describe_tool</code> (powered by <code>tooldocs</code>).</li> <li>Agent executes the tool via <code>run_tool</code> (powered by <code>toolrun</code>).</li> </ol>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#example-define-a-tool","title":"Example: define a tool","text":"<pre><code>import (\n  \"encoding/json\"\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ninputSchema := json.RawMessage(`{\n  \"type\": \"object\",\n  \"properties\": {\n    \"owner\": {\"type\": \"string\"},\n    \"repo\": {\"type\": \"string\"}\n  },\n  \"required\": [\"owner\", \"repo\"]\n}`)\n\nrepoTool := toolmodel.Tool{\n  Tool: mcp.Tool{\n    Name:        \"get_repo\",\n    Title:       \"Get repo details\",\n    Description: \"Fetch repository metadata.\",\n    InputSchema: inputSchema,\n  },\n  Namespace: \"github\",\n  Tags:      []string{\"repo\", \"git\", \"metadata\"},\n}\n\nif err := repoTool.Validate(); err != nil {\n  // handle invalid tool\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>A stable tool ID (<code>github:get_repo</code>) that downstream components can resolve.</li> <li>Schema-driven validation for inputs and outputs (via <code>SchemaValidator</code>).</li> <li>Token-efficient discovery by pushing only summaries into search results.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Invalid tool ID: <code>ErrInvalidToolID</code> when parsing malformed IDs.</li> <li>Invalid tool fields: <code>ErrInvalidTool</code> when name is missing/invalid or input schema is nil.</li> <li>Unsupported schema dialect: <code>ErrUnsupportedSchema</code> for non-2020-12/draft-07 schemas.</li> <li>External refs blocked: <code>ErrExternalRef</code> if the schema attempts external <code>$ref</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#why-this-matters","title":"Why this matters","text":"<p><code>toolmodel</code> keeps the entire stack aligned with the official MCP tool shape while still providing namespaces, versions, and tags needed for real-world registries.</p>"},{"location":"library-docs-from-repos/toolindex/","title":"toolindex","text":"<p><code>toolindex</code> is the global registry and progressive discovery layer for tools. It stores <code>toolmodel.Tool</code> + <code>toolmodel.ToolBackend</code>, provides search, and returns token-cheap summaries.</p> <p></p>"},{"location":"library-docs-from-repos/toolindex/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/#motivation","title":"Motivation","text":"<ul> <li>Progressive disclosure: search returns summaries, not schemas</li> <li>Deterministic lookup: canonical tool IDs resolve to stable backends</li> <li>Pluggable search: swap lexical search for BM25 or semantic ranking</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#key-apis","title":"Key APIs","text":"<ul> <li><code>Index</code> interface</li> <li><code>InMemoryIndex</code> implementation</li> <li><code>Search</code> + <code>ListNamespaces</code></li> <li><code>RegisterTool(s)</code> + <code>GetTool</code></li> <li><code>Searcher</code> interface for pluggable ranking</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#quickstart","title":"Quickstart","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n_ = idx.RegisterTool(tool, backend)\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/#usability-notes","title":"Usability notes","text":"<ul> <li>Summaries are token-cheap and safe to display in discovery</li> <li>Namespaces group tools for easy filtering</li> <li>Backends can be replaced without changing the tool ID</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#next","title":"Next","text":"<ul> <li>Architecture and data flow: <code>architecture.md</code></li> <li>Usage patterns and options: <code>usage.md</code></li> <li>Searcher examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolindex/api/#index-interface","title":"Index interface","text":"<pre><code>type Index interface {\n  RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) error\n  RegisterTools(regs []ToolRegistration) error\n  RegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) error\n\n  UnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) error\n\n  GetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)\n  GetAllBackends(id string) ([]toolmodel.ToolBackend, error)\n\n  Search(query string, limit int) ([]Summary, error)\n  ListNamespaces() ([]string, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#summary","title":"Summary","text":"<pre><code>type Summary struct {\n  ID               string\n  Name             string\n  Namespace        string\n  ShortDescription string\n  Tags             []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#registration","title":"Registration","text":"<pre><code>type ToolRegistration struct {\n  Tool    toolmodel.Tool\n  Backend toolmodel.ToolBackend\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#searcher","title":"Searcher","text":"<pre><code>type Searcher interface {\n  Search(query string, limit int, docs []SearchDoc) ([]Summary, error)\n}\n\ntype SearchDoc struct {\n  ID      string\n  DocText string\n  Summary Summary\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#options","title":"Options","text":"<pre><code>type IndexOptions struct {\n  BackendSelector BackendSelector\n  Searcher        Searcher\n}\n\ntype BackendSelector func([]toolmodel.ToolBackend) toolmodel.ToolBackend\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#errors","title":"Errors","text":"<ul> <li><code>ErrNotFound</code></li> <li><code>ErrInvalidTool</code></li> <li><code>ErrInvalidBackend</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/architecture/","title":"Architecture","text":"<p><code>toolindex</code> maintains a canonical map of tools and a cached search document set. It is optimized for frequent reads and infrequent writes.</p>"},{"location":"library-docs-from-repos/toolindex/architecture/#registration-search-flow","title":"Registration + search flow","text":"<pre><code>flowchart LR\n  A[RegisterTool(s)] --&gt; B[toolRecord map]\n  B --&gt; C[SearchDoc cache]\n  C --&gt; D[Searcher]\n  D --&gt; E[Summary list]\n\n  B --&gt; F[GetTool]\n  B --&gt; G[ListNamespaces]</code></pre>"},{"location":"library-docs-from-repos/toolindex/architecture/#search-sequence","title":"Search sequence","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant Index\n  participant Searcher\n\n  Client-&gt;&gt;Index: Search(query, limit)\n  Index-&gt;&gt;Index: Build docs (if dirty)\n  Index-&gt;&gt;Searcher: Search(query, docs)\n  Searcher--&gt;&gt;Index: summaries\n  Index--&gt;&gt;Client: summaries</code></pre>"},{"location":"library-docs-from-repos/toolindex/architecture/#progressive-disclosure-contract","title":"Progressive disclosure contract","text":"<ul> <li><code>Search</code> returns summaries only</li> <li>Schema and examples are retrieved later via <code>tooldocs</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/architecture/#default-backend-policy","title":"Default backend policy","text":"<p>The default backend selector prefers:</p> <ol> <li>local</li> <li>provider</li> <li>mcp</li> </ol> <p>Exported as <code>toolindex.DefaultBackendSelector</code>.</p>"},{"location":"library-docs-from-repos/toolindex/design-notes/","title":"Design Notes","text":"<p>This page captures the tradeoffs and error semantics behind <code>toolindex</code>.</p>"},{"location":"library-docs-from-repos/toolindex/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>In-memory first. <code>InMemoryIndex</code> favors low latency and zero dependencies. It trades persistence for speed and simplicity (persistence can be added later behind the same <code>Index</code> interface).</li> <li>Progressive disclosure. Search returns summaries only; full schemas stay out of the discovery path to keep token costs low.</li> <li>Deterministic behavior. Search docs are cached and sorted by tool ID to keep results reproducible across runs.</li> <li>Protocol-agnostic backends. Backends are stored as metadata only; the index does not execute tools or depend on transport details.</li> <li>MCP-field consistency check. If multiple backends register the same tool ID, the MCP tool fields must match. This prevents silent divergence across backends.</li> <li>Pluggable search. <code>Searcher</code> allows swapping lexical search with BM25 or semantic search without changing the index API.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolindex</code> exposes sentinel errors for predictable failure handling:</p> <ul> <li><code>ErrNotFound</code> \u2013 tool or backend not present.</li> <li><code>ErrInvalidTool</code> \u2013 tool validation failed (delegates to <code>toolmodel.Tool.Validate</code>).</li> <li><code>ErrInvalidBackend</code> \u2013 backend is missing required fields for its kind.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#registration-failures","title":"Registration failures","text":"<ul> <li>If a tool with the same ID is registered and its MCP fields differ, registration fails with <code>ErrInvalidTool</code>.</li> <li>Invalid backend structures return <code>ErrInvalidBackend</code> with a descriptive message.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#lookup-failures","title":"Lookup failures","text":"<ul> <li><code>GetTool</code> / <code>GetAllBackends</code> return <code>ErrNotFound</code> when the tool ID is missing.</li> <li><code>UnregisterBackend</code> returns <code>ErrNotFound</code> if the tool or backend is not present.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#search-behavior","title":"Search behavior","text":"<ul> <li>Lexical default: substring matching with scoring (name &gt; namespace &gt; description/tags).</li> <li>Empty queries: return the first N tools (deterministic order).</li> <li>Tags: normalized via <code>toolmodel.NormalizeTags</code> and included in the search corpus.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backend selector: inject a policy (e.g., \u201cprefer MCP over local\u201d).</li> <li>Custom searcher: replace lexical search with <code>toolsearch</code> BM25 or a semantic engine.</li> <li>External indexing: implement <code>Index</code> with a DB-backed or remote store in the future.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Prefer <code>RegisterToolsFromMCP</code> for ingesting MCP server tools.</li> <li>Normalize tags at ingestion to keep search results consistent.</li> <li>Keep namespaces stable so tool IDs remain durable across deployments.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolindex/examples/#custom-backend-selection","title":"Custom backend selection","text":"<pre><code>selector := func(backends []toolmodel.ToolBackend) toolmodel.ToolBackend {\n  // Prefer MCP for this app\n  for _, b := range backends {\n    if b.Kind == toolmodel.BackendKindMCP {\n      return b\n    }\n  }\n  return toolindex.DefaultBackendSelector(backends)\n}\n\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{BackendSelector: selector})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/examples/#inject-bm25-searcher","title":"Inject BM25 searcher","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{K1: 1.4, B: 0.75})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/examples/#multiple-backends","title":"Multiple backends","text":"<pre><code>_ = idx.RegisterTool(tool, toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindMCP,\n  MCP:  &amp;toolmodel.MCPBackend{ServerName: \"github\"},\n})\n\n_ = idx.RegisterTool(tool, toolmodel.ToolBackend{\n  Kind:  toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"get_repo\"},\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolindex/usage/#register-tools","title":"Register tools","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\nreg := toolindex.ToolRegistration{Tool: tool, Backend: backend}\nif err := idx.RegisterTools([]toolindex.ToolRegistration{reg}); err != nil {\n  // handle error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#search","title":"Search","text":"<pre><code>summaries, err := idx.Search(\"repo metadata\", 5)\nif err != nil {\n  // handle error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#lookup-and-backends","title":"Lookup and backends","text":"<pre><code>t, defaultBackend, err := idx.GetTool(\"github:get_repo\")\nif err != nil {\n  // handle not found\n}\n\nallBackends, _ := idx.GetAllBackends(t.ToolID())\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#register-from-mcp","title":"Register from MCP","text":"<pre><code>_ = idx.RegisterToolsFromMCP(\"github\", []toolmodel.Tool{toolA, toolB})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#options","title":"Options","text":"<pre><code>idx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{\n  BackendSelector: mySelector,\n  Searcher:        mySearcher,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolindex</code> supports end-to-end agent workflows by powering discovery and canonical lookup.</p>"},{"location":"library-docs-from-repos/toolindex/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Loader as Tool Loader\n  participant Index as toolindex\n  participant MCP as metatools-mcp\n  participant Agent\n  participant Docs as tooldocs\n  participant Runner as toolrun\n\n  Loader-&gt;&gt;Index: RegisterTool(s)\n  Agent-&gt;&gt;MCP: search_tools(query)\n  MCP-&gt;&gt;Index: Search\n  Agent-&gt;&gt;MCP: describe_tool(tool_id)\n  MCP-&gt;&gt;Docs: DescribeTool\n  Agent-&gt;&gt;MCP: run_tool(tool_id, args)\n  MCP-&gt;&gt;Runner: Run</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Ingest tools from MCP servers or local registries:</li> <li><code>RegisterToolsFromMCP(serverName, tools)</code></li> <li><code>RegisterTool(tool, backend)</code> for local/provider tools</li> <li>Agent discovers tools via <code>search_tools</code> (summary only).</li> <li>Agent selects a tool ID and requests schema/docs (<code>describe_tool</code>).</li> <li>Agent executes via <code>run_tool</code> or <code>run_chain</code>.</li> </ol>"},{"location":"library-docs-from-repos/toolindex/user-journey/#example-register-and-search","title":"Example: register and search","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n// MCP-backed tools\n_ = idx.RegisterToolsFromMCP(\"github\", []toolmodel.Tool{repoTool})\n\n// Local tool\n_ = idx.RegisterTool(localTool, toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"local_handler\"},\n})\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Fast, deterministic search results.</li> <li>Stable tool IDs across backends.</li> <li>Safe summaries for progressive disclosure.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrInvalidTool</code> when tool validation fails.</li> <li><code>ErrInvalidBackend</code> when backend metadata is incomplete.</li> <li><code>ErrNotFound</code> for missing tool IDs or backends.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/user-journey/#why-this-matters","title":"Why this matters","text":"<p><code>toolindex</code> is the \u201cfront door\u201d for tool discovery. It keeps discovery cheap and consistent while letting execution and documentation happen elsewhere.</p>"},{"location":"library-docs-from-repos/tooldocs/","title":"tooldocs","text":"<p><code>tooldocs</code> provides progressive documentation and examples for tools defined in <code>toolmodel</code> and discovered via <code>toolindex</code>.</p> <p></p>"},{"location":"library-docs-from-repos/tooldocs/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#motivation","title":"Motivation","text":"<ul> <li>Token efficiency: fetch details only when needed</li> <li>Better tool usage: schema + examples reduce call errors</li> <li>Usability: humans and agents see consistent, structured guidance</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#key-apis","title":"Key APIs","text":"<ul> <li><code>Store</code> interface</li> <li><code>InMemoryStore</code> implementation</li> <li><code>DescribeTool</code> (summary/schema/full)</li> <li><code>ListExamples</code></li> <li><code>DocEntry</code> + <code>ToolExample</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#quickstart","title":"Quickstart","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:get_repo\", tooldocs.DocEntry{\n  Summary: \"Fetch repository metadata\",\n  Notes:   \"Requires authentication.\",\n})\n\ndoc, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nexamples, _ := store.ListExamples(\"github:get_repo\", 2)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/#usability-notes","title":"Usability notes","text":"<ul> <li>Summary and schema are safe defaults for discovery</li> <li>Examples are capped to prevent token blowups</li> <li>Notes and external refs are optional but highly recommended</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#next","title":"Next","text":"<ul> <li>Detail tiers and resolution: <code>architecture.md</code></li> <li>Registration and caps: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/tooldocs/api/#store-interface","title":"Store interface","text":"<pre><code>type Store interface {\n  DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n  ListExamples(id string, maxExamples int) ([]ToolExample, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#detail-levels","title":"Detail levels","text":"<pre><code>const (\n  DetailSummary DetailLevel = \"summary\"\n  DetailSchema  DetailLevel = \"schema\"\n  DetailFull    DetailLevel = \"full\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#tooldoc","title":"ToolDoc","text":"<pre><code>type ToolDoc struct {\n  Tool         *toolmodel.Tool\n  Summary      string\n  SchemaInfo   *SchemaInfo\n  Notes        string\n  Examples     []ToolExample\n  ExternalRefs []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#toolexample","title":"ToolExample","text":"<pre><code>type ToolExample struct {\n  ID          string\n  Title       string\n  Description string\n  Args        map[string]any\n  ResultHint  string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#schemainfo","title":"SchemaInfo","text":"<pre><code>type SchemaInfo struct {\n  Required []string\n  Defaults map[string]any\n  Types    map[string][]string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#storeoptions","title":"StoreOptions","text":"<pre><code>type StoreOptions struct {\n  Index        toolindex.Index\n  ToolResolver func(id string) (*toolmodel.Tool, error)\n  MaxExamples  int\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#inmemorystore","title":"InMemoryStore","text":"<pre><code>func NewInMemoryStore(opts StoreOptions) *InMemoryStore\nfunc (s *InMemoryStore) RegisterDoc(id string, entry DocEntry) error\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#errors","title":"Errors","text":"<ul> <li><code>ErrNotFound</code></li> <li><code>ErrInvalidDetail</code></li> <li><code>ErrNoTool</code></li> <li><code>ErrArgsTooLarge</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/architecture/","title":"Architecture","text":"<p><code>tooldocs</code> adds a documentation layer on top of <code>toolmodel</code>. It does not change schemas; it augments them with guidance and examples.</p>"},{"location":"library-docs-from-repos/tooldocs/architecture/#tiered-disclosure","title":"Tiered disclosure","text":"<pre><code>flowchart LR\n  A[DescribeTool] --&gt; B[summary]\n  A --&gt; C[schema]\n  A --&gt; D[full]\n  D --&gt; E[examples]</code></pre>"},{"location":"library-docs-from-repos/tooldocs/architecture/#resolution-sequence","title":"Resolution sequence","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant Docs as tooldocs\n  participant Index as toolindex\n\n  Client-&gt;&gt;Docs: DescribeTool(id, schema)\n  Docs-&gt;&gt;Index: GetTool(id)\n  Index--&gt;&gt;Docs: tool\n  Docs--&gt;&gt;Client: ToolDoc (schema)</code></pre>"},{"location":"library-docs-from-repos/tooldocs/architecture/#progressive-disclosure-contract","title":"Progressive disclosure contract","text":"<ul> <li><code>DetailSummary</code>: short text only</li> <li><code>DetailSchema</code>: full tool + derived schema info</li> <li><code>DetailFull</code>: schema + notes + examples</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/architecture/#resolution-modes","title":"Resolution modes","text":"<ul> <li>via <code>toolindex.Index</code> (preferred)</li> <li>via a custom <code>ToolResolver</code> function</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/","title":"Design Notes","text":"<p>This page explains the design choices and error semantics for <code>tooldocs</code>.</p>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Progressive detail tiers. <code>DetailSummary</code>, <code>DetailSchema</code>, and <code>DetailFull</code> keep large docs out of the default path while still allowing rich guidance on demand.</li> <li>Schema-first truth. <code>ToolDoc.Tool</code> (from <code>toolmodel</code>) remains the canonical schema source; docs only augment, they do not override.</li> <li>Token safety caps. Examples, summaries, notes, and args are capped to prevent context bloat in downstream LLM usage.</li> <li>Best-effort schema derivation. <code>SchemaInfo</code> is derived from JSON Schema when possible; missing or complex schema features simply result in empty fields.</li> <li>Mutable-safety. Args are deep-copied and normalized to MCP-native shapes on registration and retrieval to avoid mutation bugs.</li> <li>Flexible resolution. Docs can be served from the index or a custom resolver, enabling file-backed or remote sources without changing the interface.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>tooldocs</code> exposes sentinel errors for predictable handling:</p> <ul> <li><code>ErrNotFound</code> \u2013 no docs and no tool found for the given ID.</li> <li><code>ErrInvalidDetail</code> \u2013 unknown detail level requested.</li> <li><code>ErrNoTool</code> \u2013 schema/full requested but tool is not resolvable.</li> <li><code>ErrArgsTooLarge</code> \u2013 example args exceed depth/size caps.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#behavior-by-level","title":"Behavior by level","text":"<ul> <li>Summary: works when either docs or tool exist; returns <code>ErrNotFound</code> only if both are missing.</li> <li>Schema/Full: requires <code>toolmodel.Tool</code> (from <code>toolindex</code> or <code>ToolResolver</code>), otherwise returns <code>ErrNoTool</code>.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom resolvers: provide <code>ToolResolver</code> when tools are not in <code>toolindex</code>.</li> <li>Alternative stores: implement <code>Store</code> for file-backed or remote doc sources.</li> <li>Docs generation: generate <code>DocEntry</code> from code comments or external sources and register at startup.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep examples short and bounded; the caps (<code>MaxArgsDepth</code>, <code>MaxArgsKeys</code>, etc.) are enforced at registration time.</li> <li>Prefer a small number of high-quality examples over many low-signal ones.</li> <li>Use <code>SchemaInfo</code> only for UI hints and human guidance; use actual schemas for validation.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/tooldocs/examples/#schema-level-detail","title":"Schema-level detail","text":"<pre><code>doc, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nfmt.Println(doc.Tool.InputSchema)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/examples/#full-detail-with-examples","title":"Full detail with examples","text":"<pre><code>full, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailFull)\nfor _, ex := range full.Examples {\n  fmt.Println(ex.Title, ex.Args)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/examples/#resolver-only-usage-no-toolindex","title":"Resolver-only usage (no toolindex)","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{\n  ToolResolver: func(id string) (*toolmodel.Tool, error) {\n    if id != \"tickets:create\" {\n      return nil, fmt.Errorf(\"unknown: %s\", id)\n    }\n    t := toolmodel.Tool{Namespace: \"tickets\"}\n    t.Name = \"create\"\n    t.Description = \"Create a support ticket\"\n    t.InputSchema = map[string]any{\"type\": \"object\"}\n    return &amp;t, nil\n  },\n})\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/tooldocs/usage/#register-docs","title":"Register docs","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{\n  Index:       idx,\n  MaxExamples: 3,\n})\n\nerr := store.RegisterDoc(\"tickets:create\", tooldocs.DocEntry{\n  Summary: \"Create a support ticket\",\n  Notes:   \"Requires authentication. Supports idempotency via request_id.\",\n  Examples: []tooldocs.ToolExample{\n    {\n      Title:       \"Minimal\",\n      Description: \"Create a low-priority ticket\",\n      Args:        map[string]any{\"title\": \"Login broken\"},\n      ResultHint:  \"Ticket object with id and status\",\n    },\n  },\n})\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#describe-tools","title":"Describe tools","text":"<pre><code>doc, _ := store.DescribeTool(\"tickets:create\", tooldocs.DetailSchema)\nfull, _ := store.DescribeTool(\"tickets:create\", tooldocs.DetailFull)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#list-examples","title":"List examples","text":"<pre><code>examples, _ := store.ListExamples(\"tickets:create\", 2)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#size-caps","title":"Size caps","text":"<p>Examples are validated at registration time:</p> <ul> <li><code>MaxArgsDepth = 5</code></li> <li><code>MaxArgsKeys = 50</code></li> <li><code>MaxDescriptionLen = 300</code></li> <li><code>MaxResultHintLen = 200</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>tooldocs</code> provides progressive disclosure in an end-to-end agent workflow.</p>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Runner as toolrun\n\n  Agent-&gt;&gt;MCP: search_tools(\"create issue\")\n  MCP-&gt;&gt;Index: Search\n  Agent-&gt;&gt;MCP: describe_tool(tool_id, schema)\n  MCP-&gt;&gt;Docs: DescribeTool(schema)\n  Agent-&gt;&gt;MCP: describe_tool(tool_id, full)\n  MCP-&gt;&gt;Docs: DescribeTool(full)\n  Agent-&gt;&gt;MCP: run_tool(tool_id, args)\n  MCP-&gt;&gt;Runner: Run</code></pre>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Discovery: agent finds candidate tools via <code>search_tools</code>.</li> <li>Schema retrieval: agent requests <code>detail_level=\"schema\"</code> to see required parameters.</li> <li>Full guidance: agent requests <code>detail_level=\"full\"</code> or <code>list_tool_examples</code> when extra guidance is needed.</li> <li>Execution: agent calls the tool using <code>toolrun</code> with validated args.</li> </ol>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#example-register-docs-and-fetch","title":"Example: register docs and fetch","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:create_issue\", tooldocs.DocEntry{\n  Summary: \"Create a GitHub issue.\",\n  Notes:   \"Use labels sparingly; title is required.\",\n  Examples: []tooldocs.ToolExample{\n    {\n      Title:       \"Create a bug issue\",\n      Description: \"Create a bug ticket with a label.\",\n      Args: map[string]any{\n        \"owner\": \"acme\",\n        \"repo\": \"app\",\n        \"title\": \"Crash on login\",\n        \"labels\": []any{\"bug\"},\n      },\n      ResultHint: \"Returns the issue number and URL.\",\n    },\n  },\n})\n\ndoc, _ := store.DescribeTool(\"github:create_issue\", tooldocs.DetailFull)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Clear, compact guidance without shipping the full schema by default.</li> <li>Predictable errors when docs are missing or a tool cannot be resolved.</li> <li>Examples that are safe to include in LLM context.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrNoTool</code> when requesting schema/full without tool registration.</li> <li><code>ErrArgsTooLarge</code> when example payloads exceed caps.</li> <li><code>ErrInvalidDetail</code> for invalid detail levels.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/","title":"toolrun","text":"<p><code>toolrun</code> executes tools and chains. It resolves tools/backends, validates inputs/outputs against JSON Schema, dispatches to the correct executor, and normalizes results.</p> <p></p>"},{"location":"library-docs-from-repos/toolrun/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/#motivation","title":"Motivation","text":"<ul> <li>Consistent execution across MCP, provider, and local tools</li> <li>Safety via schema validation and normalized results</li> <li>Usability with clear error wrapping and chain semantics</li> </ul>"},{"location":"library-docs-from-repos/toolrun/#key-apis","title":"Key APIs","text":"<ul> <li><code>Runner</code> interface</li> <li><code>DefaultRunner</code> (via <code>NewRunner</code>)</li> <li><code>Run</code>, <code>RunStream</code>, <code>RunChain</code></li> <li><code>ChainStep</code>, <code>RunResult</code>, <code>StreamEvent</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/#quickstart","title":"Quickstart","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n\nres, _ := runner.Run(ctx, \"github:get_repo\", map[string]any{\"owner\": \"o\", \"repo\": \"r\"})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/#usability-notes","title":"Usability notes","text":"<ul> <li>Backend selection is deterministic by default</li> <li>Chain steps can inject <code>previous</code> results</li> <li>Streaming is optional; non-streaming backends return <code>ErrStreamNotSupported</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/#next","title":"Next","text":"<ul> <li>Execution pipeline: <code>architecture.md</code></li> <li>Configuration and options: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolrun/api/#runner-interface","title":"Runner interface","text":"<pre><code>type Runner interface {\n  Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n  RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n  RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index           toolindex.Index\n  ToolResolver    func(id string) (*toolmodel.Tool, error)\n  BackendsResolver func(id string) ([]toolmodel.ToolBackend, error)\n  BackendSelector toolindex.BackendSelector\n  Validator       toolmodel.SchemaValidator\n  ValidateInput   bool\n  ValidateOutput  bool\n  MCP      MCPExecutor\n  Provider ProviderExecutor\n  Local    LocalRegistry\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#executors","title":"Executors","text":"<pre><code>type MCPExecutor interface {\n  CallTool(ctx context.Context, serverName string, params *mcp.CallToolParams) (*mcp.CallToolResult, error)\n  CallToolStream(ctx context.Context, serverName string, params *mcp.CallToolParams) (&lt;-chan StreamEvent, error)\n}\n\ntype ProviderExecutor interface {\n  CallTool(ctx context.Context, providerID, toolID string, args map[string]any) (any, error)\n  CallToolStream(ctx context.Context, providerID, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\ntype LocalRegistry interface {\n  Get(name string) (LocalHandler, bool)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#results","title":"Results","text":"<pre><code>type ChainStep struct {\n  ToolID      string\n  Args        map[string]any\n  UsePrevious bool\n}\n\ntype RunResult struct {\n  Tool       toolmodel.Tool\n  Backend    toolmodel.ToolBackend\n  Structured any\n  MCPResult  *mcp.CallToolResult\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#streaming","title":"Streaming","text":"<pre><code>type StreamEvent struct {\n  Kind  StreamEventKind\n  ToolID string\n  Data  any\n  Err   error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#errors","title":"Errors","text":"<ul> <li><code>ErrNotFound</code></li> <li><code>ErrNoBackends</code></li> <li><code>ErrValidation</code></li> <li><code>ErrOutputValidation</code></li> <li><code>ErrExecution</code></li> <li><code>ErrStreamNotSupported</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/architecture/","title":"Architecture","text":"<p><code>toolrun</code> implements a consistent execution pipeline with validation and backend dispatch. It is transport-agnostic and depends on <code>toolmodel</code> types.</p>"},{"location":"library-docs-from-repos/toolrun/architecture/#single-tool-execution","title":"Single-tool execution","text":"<pre><code>flowchart LR\n  A[Run] --&gt; B[Resolve tool + backends]\n  B --&gt; C[Select backend]\n  C --&gt; D[Validate input]\n  D --&gt; E[Dispatch]\n  E --&gt; F[Normalize result]\n  F --&gt; G[Validate output]\n\n  subgraph Dispatch\n    M[MCP executor]\n    P[Provider executor]\n    L[Local registry]\n  end\n  E --&gt; M\n  E --&gt; P\n  E --&gt; L</code></pre>"},{"location":"library-docs-from-repos/toolrun/architecture/#chain-execution","title":"Chain execution","text":"<pre><code>sequenceDiagram\n  participant R as Runner\n  participant T1 as Tool 1\n  participant T2 as Tool 2\n\n  R-&gt;&gt;T1: Run(step1)\n  T1--&gt;&gt;R: Result\n  R-&gt;&gt;T2: Run(step2, previous)\n  T2--&gt;&gt;R: Result</code></pre>"},{"location":"library-docs-from-repos/toolrun/design-notes/","title":"Design Notes","text":"<p>This page documents the key tradeoffs and error semantics behind <code>toolrun</code>.</p>"},{"location":"library-docs-from-repos/toolrun/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Backend-agnostic execution. The runner dispatches to MCP, provider, or local backends through narrow executor interfaces. This keeps tool execution pluggable without embedding transport details.</li> <li>Index-first resolution. When configured, <code>toolindex</code> is the primary source for tool definitions and backends. Optional resolvers allow ad-hoc tools or dynamic backends without an index.</li> <li>Validation on by default. Input and output validation is enabled by default to catch schema errors early. This trades a small amount of latency for correctness and safety.</li> <li>Strict chaining policy. Chains stop on the first error (v1) and inject previous results at <code>args[\"previous\"]</code> when requested. This is deterministic and easy to reason about, but not a branching workflow engine.</li> <li>Structured-first results. For MCP backends, <code>StructuredContent</code> is preferred; otherwise text content is best-effort parsed as JSON. This avoids losing structure while preserving fallback behavior.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolrun</code> uses sentinel errors and wrapped context via <code>ToolError</code>:</p> <ul> <li><code>ErrToolNotFound</code> \u2013 no tool definition could be resolved.</li> <li><code>ErrNoBackends</code> \u2013 tool exists but no backend is available.</li> <li><code>ErrValidation</code> \u2013 input validation failed.</li> <li><code>ErrExecution</code> \u2013 backend execution failed.</li> <li><code>ErrOutputValidation</code> \u2013 output validation failed.</li> <li><code>ErrStreamNotSupported</code> \u2013 streaming is not supported by the selected backend.</li> </ul> <p><code>ToolError</code> wraps these with <code>ToolID</code>, <code>Backend</code>, and <code>Op</code> (e.g., <code>resolve</code>, <code>execute</code>, <code>validate_input</code>).</p>"},{"location":"library-docs-from-repos/toolrun/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backend selection: provide <code>BackendSelector</code> to prioritize specific backends.</li> <li>Custom validation: plug in a different <code>SchemaValidator</code> implementation.</li> <li>Custom executors: implement <code>MCPExecutor</code>, <code>ProviderExecutor</code>, or <code>LocalRegistry</code> for your runtime.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Prefer registering tools in <code>toolindex</code> for consistent resolution and backends.</li> <li>Enable output validation in production to catch schema drift early.</li> <li>Use streaming only when your backend supports it; otherwise expect <code>ErrStreamNotSupported</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolrun/examples/#local-tool-execution","title":"Local tool execution","text":"<pre><code>registry := toolrun.NewLocalRegistry()\nregistry.Register(\"ping\", func(ctx context.Context, args map[string]any) (any, error) {\n  return map[string]any{\"ok\": true}, nil\n})\n\nrunner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithLocalRegistry(registry),\n)\n\nres, _ := runner.Run(ctx, \"local:ping\", map[string]any{})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/examples/#streaming","title":"Streaming","text":"<pre><code>ch, err := runner.RunStream(ctx, \"logs:stream\", map[string]any{\"tail\": 100})\nif err != nil {\n  // handle ErrStreamNotSupported\n}\nfor ev := range ch {\n  fmt.Println(ev.Data)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/examples/#backend-resolution-fallback","title":"Backend resolution fallback","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithToolResolver(func(id string) (*toolmodel.Tool, error) {\n    // resolve from external store\n    return &amp;tool, nil\n  }),\n  toolrun.WithBackendsResolver(func(id string) ([]toolmodel.ToolBackend, error) {\n    return []toolmodel.ToolBackend{backend}, nil\n  }),\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolrun/usage/#configure-a-runner","title":"Configure a runner","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n  toolrun.WithProviderExecutor(providerExec),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#validation-control","title":"Validation control","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithValidation(true, false), // validate input, skip output\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#run-a-tool","title":"Run a tool","text":"<pre><code>res, err := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"octo\",\n  \"repo\":  \"hello\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#run-a-chain","title":"Run a chain","text":"<pre><code>steps := []toolrun.ChainStep{\n  {ToolID: \"user:get\", Args: map[string]any{\"user_id\": \"123\"}},\n  {ToolID: \"orders:list\", UsePrevious: true},\n}\n\nfinal, all, err := runner.RunChain(ctx, steps)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolrun</code> executes tools and chains in a full end-to-end agent flow.</p>"},{"location":"library-docs-from-repos/toolrun/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Runner as toolrun\n  participant Backend as MCP Server\n\n  Agent-&gt;&gt;MCP: run_tool(tool_id, args)\n  MCP-&gt;&gt;Runner: Run\n  Runner-&gt;&gt;Index: Resolve tool + backend\n  Runner-&gt;&gt;Backend: Call tool\n  Backend--&gt;&gt;Runner: Result\n  Runner--&gt;&gt;MCP: Structured result\n  MCP--&gt;&gt;Agent: Tool output</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Resolve the tool and its backends (via <code>toolindex</code> or resolver callbacks).</li> <li>Select the backend (default priority: local &gt; provider &gt; MCP).</li> <li>Validate input against JSON Schema.</li> <li>Dispatch to the selected backend.</li> <li>Normalize output (structured content preferred).</li> <li>Validate output (optional).</li> </ol>"},{"location":"library-docs-from-repos/toolrun/user-journey/#example-run-a-tool","title":"Example: run a tool","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n)\n\nres, err := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"acme\",\n  \"repo\":  \"app\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#example-chain-two-tools","title":"Example: chain two tools","text":"<pre><code>steps := []toolrun.ChainStep{\n  {ToolID: \"github:get_repo\", Args: map[string]any{\"owner\": \"acme\", \"repo\": \"app\"}},\n  {ToolID: \"github:list_issues\", UsePrevious: true},\n}\n\nfinal, stepsOut, err := runner.RunChain(ctx, steps)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Consistent execution across backends.</li> <li>Structured results suitable for chaining.</li> <li>Explicit error classification with <code>ToolError</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrToolNotFound</code> if the tool is missing.</li> <li><code>ErrValidation</code> for schema violations.</li> <li><code>ErrExecution</code> for backend errors.</li> <li><code>ErrStreamNotSupported</code> when streaming is requested but unsupported.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/","title":"toolcode","text":"<p><code>toolcode</code> executes short orchestration snippets over the tool stack. It exposes Search/Describe/Run helpers to code, enforces timeouts and limits, and records tool calls for observability.</p> <p></p>"},{"location":"library-docs-from-repos/toolcode/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolcode/#motivation","title":"Motivation","text":"<ul> <li>Programmable orchestration: loops, conditionals, fallbacks</li> <li>Uniform tool surface: same helpers regardless of backend</li> <li>Traceability: tool call records for debugging and audits</li> </ul>"},{"location":"library-docs-from-repos/toolcode/#key-apis","title":"Key APIs","text":"<ul> <li><code>Executor</code> interface (<code>ExecuteCode</code>)</li> <li><code>DefaultExecutor</code> implementation</li> <li><code>Engine</code> interface (pluggable runtime)</li> <li><code>ExecuteParams</code>, <code>ExecuteResult</code>, <code>ToolCallRecord</code></li> </ul>"},{"location":"library-docs-from-repos/toolcode/#quickstart","title":"Quickstart","text":"<pre><code>exec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n\nres, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/#usability-notes","title":"Usability notes","text":"<ul> <li><code>ExecuteParams</code> supports per-call timeouts</li> <li>Tool calls are capped via config and params</li> <li><code>ExecuteResult</code> includes tool call traces</li> </ul>"},{"location":"library-docs-from-repos/toolcode/#next","title":"Next","text":"<ul> <li>Execution pipeline: <code>architecture.md</code></li> <li>Config, limits, and params: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolcode/api/#executor","title":"Executor","text":"<pre><code>type Executor interface {\n  ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#engine","title":"Engine","text":"<pre><code>type Engine interface {\n  Execute(ctx context.Context, params ExecuteParams, tools Tools) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#tools-surface","title":"Tools surface","text":"<pre><code>type Tools interface {\n  SearchTools(query string, limit int) ([]toolindex.Summary, error)\n  ListNamespaces() ([]string, error)\n  DescribeTool(id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n  ListToolExamples(id string, maxExamples int) ([]tooldocs.ToolExample, error)\n  RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n  RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n  Println(args ...any)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#params-results","title":"Params + results","text":"<pre><code>type ExecuteParams struct {\n  Language     string\n  Code         string\n  Timeout      time.Duration\n  MaxToolCalls int\n}\n\ntype ExecuteResult struct {\n  Value      any\n  Stdout     string\n  Stderr     string\n  ToolCalls  []ToolCallRecord\n  DurationMs int64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#toolcallrecord","title":"ToolCallRecord","text":"<pre><code>type ToolCallRecord struct {\n  ToolID     string\n  Args       map[string]any\n  Structured any\n  BackendKind string\n  Error      string\n  ErrorOp    string\n  DurationMs int64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index          toolindex.Index\n  Docs           tooldocs.Store\n  Run            toolrun.Runner\n  Engine         Engine\n  DefaultTimeout time.Duration\n  DefaultLanguage string\n  MaxToolCalls   int\n  MaxChainSteps  int\n  Logger         Logger\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/architecture/","title":"Architecture","text":"<p><code>toolcode</code> wraps tool discovery, docs, and execution into a single programmable surface. The actual code execution is delegated to an injected <code>Engine</code>.</p>"},{"location":"library-docs-from-repos/toolcode/architecture/#execution-flow","title":"Execution flow","text":"<pre><code>flowchart LR\n  A[Executor] --&gt; B[Engine]\n  A --&gt; C[toolindex]\n  A --&gt; D[tooldocs]\n  A --&gt; E[toolrun]\n\n  B --&gt; F[toolruntime (optional)]</code></pre>"},{"location":"library-docs-from-repos/toolcode/architecture/#snippet-lifecycle","title":"Snippet lifecycle","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant Exec as toolcode\n  participant Eng as Engine\n  participant Run as toolrun\n\n  Client-&gt;&gt;Exec: ExecuteCode(params)\n  Exec-&gt;&gt;Eng: Execute(params, Tools)\n  Eng-&gt;&gt;Run: RunTool(...) / RunChain(...)\n  Run--&gt;&gt;Eng: results\n  Eng--&gt;&gt;Exec: ExecuteResult\n  Exec--&gt;&gt;Client: ExecuteResult</code></pre>"},{"location":"library-docs-from-repos/toolcode/architecture/#control-points","title":"Control points","text":"<ul> <li><code>Config</code> controls limits and defaults</li> <li><code>Engine</code> controls the execution sandbox</li> <li><code>Tools</code> surface mediates tool calls and captures traces</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/","title":"Design Notes","text":"<p>This page explains the tradeoffs and error semantics behind <code>toolcode</code>.</p>"},{"location":"library-docs-from-repos/toolcode/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Engine abstraction. <code>toolcode</code> does not execute code directly. It delegates to a pluggable <code>Engine</code> so you can swap in different interpreters or sandboxes without changing the API.</li> <li>Narrow tools surface. Code snippets only see a constrained <code>Tools</code> interface (SearchTools, DescribeTool, RunTool, RunChain, Println). This limits what code can do and keeps behavior consistent.</li> <li>Limits-first design. Max tool calls and chain steps are enforced in the tools environment. Timeouts are enforced at the executor level.</li> <li>Structured observability. Every tool call is recorded with duration, backend kind, and error op for auditability.</li> <li>Default language. If not specified, <code>DefaultLanguage</code> is used (\"go\" by default), but the engine decides how that language is implemented.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolcode</code> uses sentinel errors for predictable handling:</p> <ul> <li><code>ErrCodeExecution</code> \u2013 syntax/runtime errors in the snippet.</li> <li><code>ErrConfiguration</code> \u2013 missing required config (Index, Docs, Run, Engine).</li> <li><code>ErrLimitExceeded</code> \u2013 timeouts, max tool calls, or max chain steps exceeded.</li> </ul> <p><code>CodeError</code> wraps engine errors with optional line/column info.</p>"},{"location":"library-docs-from-repos/toolcode/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom engines: implement <code>Engine</code> for a sandboxed interpreter, WASM runtime, or remote execution service.</li> <li>Custom logging: provide a <code>Logger</code> to track tool calls and execution duration.</li> <li>Runtime integration: use <code>toolruntime/toolcodeengine</code> to run <code>toolcode</code> on top of secure runtime backends.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep snippets short and deterministic; <code>ExecuteParams</code> is intended for orchestration, not full applications.</li> <li>Use <code>MaxToolCalls</code> to prevent runaway tool usage in long snippets.</li> <li>Treat <code>Stdout</code> as diagnostic output only; use <code>Value</code> for structured results.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolcode/examples/#minimal-snippet","title":"Minimal snippet","text":"<pre><code>res, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/examples/#tool-selection-execution","title":"Tool selection + execution","text":"<pre><code>code := `\n  tools := SearchTools(\"get repo\", 3)\n  if len(tools) == 0 {\n    __out = \"no tools\"\n  } else {\n    __out = RunTool(tools[0].ID, map[string]any{\"owner\":\"octo\",\"repo\":\"hello\"})\n  }\n`\n\nres, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{Language: \"go\", Code: code})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/examples/#chain-helper","title":"Chain helper","text":"<pre><code>steps := []ChainStep{\n  {ToolID: \"user:get\", Args: map[string]any{\"user_id\": \"123\"}},\n  {ToolID: \"orders:list\", UsePrevious: true},\n}\n\ncode := `__out = RunChain(steps)`\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolcode/usage/#configure-an-executor","title":"Configure an executor","text":"<pre><code>exec, err := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:          idx,\n  Docs:           docs,\n  Run:            runner,\n  Engine:         engine,\n  DefaultTimeout: 5 * time.Second,\n  MaxToolCalls:   32,\n  MaxChainSteps:  8,\n})\nif err != nil {\n  // handle config error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/#execute-a-snippet","title":"Execute a snippet","text":"<pre><code>res, err := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code: `\n    tools := SearchTools(\"repo\", 3)\n    repo := RunTool(tools[0].ID, map[string]any{\"owner\":\"o\",\"repo\":\"r\"})\n    __out = repo\n  `,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/#limits","title":"Limits","text":"<ul> <li><code>MaxToolCalls</code> caps tool invocations per execution</li> <li><code>MaxChainSteps</code> caps chain length</li> <li><code>DefaultTimeout</code> applies when params omit a timeout</li> </ul>"},{"location":"library-docs-from-repos/toolcode/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolcode</code> enables end-to-end orchestration using code snippets.</p>"},{"location":"library-docs-from-repos/toolcode/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Code as toolcode\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Runner as toolrun\n\n  Agent-&gt;&gt;MCP: execute_code(code)\n  MCP-&gt;&gt;Code: ExecuteCode\n  Code-&gt;&gt;Index: SearchTools\n  Code-&gt;&gt;Docs: DescribeTool\n  Code-&gt;&gt;Runner: RunTool / RunChain\n  Runner--&gt;&gt;Code: Results\n  Code--&gt;&gt;MCP: ExecuteResult\n  MCP--&gt;&gt;Agent: Value + stdout</code></pre>"},{"location":"library-docs-from-repos/toolcode/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Agent submits a snippet to <code>execute_code</code>.</li> <li>Executor sets limits (timeout, tool call caps).</li> <li>Engine runs the snippet with a <code>Tools</code> environment.</li> <li>Snippet orchestrates tools via Search/Describe/Run APIs.</li> <li>Result is returned as <code>ExecuteResult</code> (Value + ToolCalls + Stdout).</li> </ol>"},{"location":"library-docs-from-repos/toolcode/user-journey/#example-pick-a-tool-and-run-it","title":"Example: pick a tool and run it","text":"<pre><code>code := `\nresults, _ := SearchTools(\"create issue\", 5)\nchoice := results[0]\n\nschema, _ := DescribeTool(choice.ID, \"schema\")\n_ = schema // use schema in real code\n\nres, _ := RunTool(choice.ID, map[string]any{\"title\": \"Bug\", \"body\": \"...\"})\n__out = res.Structured\n`\n\nexec, _ := toolcode.NewDefaultExecutor(cfg)\nresult, err := exec.ExecuteCode(ctx, toolcode.ExecuteParams{Code: code})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>A deterministic orchestration surface with strong limits.</li> <li>Tool call traces for audit/debugging.</li> <li>Easy integration with secure runtimes via <code>toolruntime</code> adapters.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrConfiguration</code> if required dependencies are missing.</li> <li><code>ErrLimitExceeded</code> if timeouts or tool call caps are hit.</li> <li><code>ErrCodeExecution</code> if the engine rejects the snippet.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/","title":"toolruntime","text":"<p><code>toolruntime</code> defines the runtime and trust boundary for executing code in <code>toolcode</code>. It routes execution to backends with configurable security profiles.</p> <p></p>"},{"location":"library-docs-from-repos/toolruntime/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#motivation","title":"Motivation","text":"<ul> <li>Isolation for untrusted or semi-trusted code</li> <li>Portability across environments (host, containers, VMs)</li> <li>Policy via explicit security profiles</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#key-apis","title":"Key APIs","text":"<ul> <li><code>Runtime</code> interface</li> <li><code>DefaultRuntime</code> implementation</li> <li><code>Backend</code> interface</li> <li><code>SecurityProfile</code> (dev/standard/hardened)</li> <li><code>ExecuteRequest</code> / <code>ExecuteResult</code></li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#quickstart-dev","title":"Quickstart (dev)","text":"<pre><code>backend := unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess})\n\nrt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: backend,\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/#usability-notes","title":"Usability notes","text":"<ul> <li>Profiles keep policy separate from implementation</li> <li>Backends are swappable without changing the executor API</li> <li>Tool calls are mediated via the gateway interface</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#next","title":"Next","text":"<ul> <li>Runtime pipeline and profiles: <code>architecture.md</code></li> <li>Backend configuration: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolruntime/api/#runtime","title":"Runtime","text":"<pre><code>type Runtime interface {\n  Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#backend","title":"Backend","text":"<pre><code>type Backend interface {\n  Kind() BackendKind\n  Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#securityprofile","title":"SecurityProfile","text":"<pre><code>type SecurityProfile string\nconst (\n  ProfileDev      SecurityProfile = \"dev\"\n  ProfileStandard SecurityProfile = \"standard\"\n  ProfileHardened SecurityProfile = \"hardened\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#executerequest-executeresult","title":"ExecuteRequest / ExecuteResult","text":"<pre><code>type ExecuteRequest struct {\n  Language string\n  Code     string\n  Args     map[string]any\n  Profile  SecurityProfile\n  Gateway  ToolGateway\n  Timeout  time.Duration\n}\n\ntype ExecuteResult struct {\n  Value      any\n  Stdout     string\n  Stderr     string\n  ToolCalls  []ToolCallRecord\n  Duration   time.Duration\n  Backend    BackendInfo\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#toolgateway","title":"ToolGateway","text":"<pre><code>type ToolGateway interface {\n  SearchTools(query string, limit int) ([]toolindex.Summary, error)\n  DescribeTool(id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n  RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n  RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#runtimeconfig","title":"RuntimeConfig","text":"<pre><code>type RuntimeConfig struct {\n  Backends           map[SecurityProfile]Backend\n  DenyUnsafeProfiles []SecurityProfile\n  DefaultProfile     SecurityProfile\n  Logger             Logger\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/architecture/","title":"Architecture","text":"<p><code>toolruntime</code> is the execution boundary underneath <code>toolcode</code>. It chooses a backend based on the requested security profile.</p>"},{"location":"library-docs-from-repos/toolruntime/architecture/#runtime-selection","title":"Runtime selection","text":"<pre><code>flowchart LR\n  A[ExecuteRequest] --&gt; B[DefaultRuntime]\n  B --&gt; C[Profile selection]\n  C --&gt; D[Backend]\n\n  subgraph Backends\n    U[unsafe host]\n    Dk[docker]\n    K8s[kubernetes]\n    Gv[gvisor]\n    Fc[firecracker]\n    W[wasm]\n  end</code></pre>"},{"location":"library-docs-from-repos/toolruntime/architecture/#execution-sequence","title":"Execution sequence","text":"<pre><code>sequenceDiagram\n  participant Client\n  participant RT as Runtime\n  participant BE as Backend\n  participant GW as ToolGateway\n\n  Client-&gt;&gt;RT: Execute(req)\n  RT-&gt;&gt;BE: Execute(req)\n  BE-&gt;&gt;GW: tool calls\n  GW--&gt;&gt;BE: tool results\n  BE--&gt;&gt;RT: ExecuteResult\n  RT--&gt;&gt;Client: ExecuteResult</code></pre>"},{"location":"library-docs-from-repos/toolruntime/architecture/#profiles","title":"Profiles","text":"<ul> <li><code>dev</code>: convenience, unsafe host allowed</li> <li><code>standard</code>: safer defaults, may deny unsafe backend</li> <li><code>hardened</code>: expected to require strong isolation</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>toolruntime</code>.</p>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Runtime as router. <code>toolruntime</code> does not execute code itself; it routes requests to backends based on a security profile. This keeps policy separate from execution.</li> <li>Explicit security profiles. <code>dev</code>, <code>standard</code>, and <code>hardened</code> provide predictable isolation tiers. This trades flexibility for clarity and safer defaults.</li> <li>Gateway boundary. Executed code never talks to toolindex/tooldocs/toolrun directly. Instead it receives a <code>ToolGateway</code>, which preserves the trust boundary.</li> <li>Backend diversity. Backends represent different isolation levels (host, containers, microVMs, WASM, remote). This lets deployments match security and performance needs.</li> <li>Limits are declarative. <code>Limits</code> are requested by the caller, and backends report which limits were actually enforced.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolruntime</code> uses sentinel errors for classification:</p> <ul> <li><code>ErrRuntimeUnavailable</code> \u2013 no backend exists for the requested profile.</li> <li><code>ErrBackendDenied</code> \u2013 policy denies the backend (e.g., unsafe host for hardened profile).</li> <li><code>ErrSandboxViolation</code> \u2013 sandbox policy was violated.</li> <li><code>ErrTimeout</code> \u2013 execution exceeded timeout.</li> <li><code>ErrResourceLimit</code> \u2013 resource limits exceeded.</li> <li><code>ErrMissingGateway</code> / <code>ErrMissingCode</code> \u2013 invalid <code>ExecuteRequest</code>.</li> <li><code>ErrInvalidLimits</code> \u2013 limits validation failed.</li> </ul> <p><code>RuntimeError</code> wraps backend failures with <code>BackendKind</code>, <code>Op</code>, and <code>Retryable</code>.</p>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backends: implement <code>Backend</code> to integrate Docker, containerd, Kubernetes, gVisor, WASM, or a remote execution service.</li> <li>Custom gateways: use <code>gateway/direct</code> for in-process execution or <code>gateway/proxy</code> for RPC-mediated execution.</li> <li>Toolcode integration: <code>toolcodeengine</code> adapts <code>toolruntime</code> into a <code>toolcode.Engine</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Use <code>ProfileStandard</code> by default; reserve <code>ProfileDev</code> for trusted environments.</li> <li>Enforce <code>DenyUnsafeProfiles</code> to prevent accidental unsafe execution.</li> <li>Report <code>LimitsEnforced</code> accurately so callers can detect degraded enforcement.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolruntime/examples/#toolcode-integration","title":"Toolcode integration","text":"<pre><code>engine := toolcodeengine.New(toolcodeengine.Config{\n  Runtime: rt,\n  Profile: toolruntime.ProfileDev,\n})\n\nexec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/examples/#inspect-tool-calls","title":"Inspect tool calls","text":"<pre><code>res, _ := rt.Execute(ctx, toolruntime.ExecuteRequest{\n  Language: \"go\",\n  Code:     \"__out = 1\",\n  Profile:  toolruntime.ProfileDev,\n  Gateway:  gw,\n})\n\nfor _, call := range res.ToolCalls {\n  fmt.Println(call.ToolID, call.Duration)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolruntime/usage/#create-a-runtime","title":"Create a runtime","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/#execute-code","title":"Execute code","text":"<pre><code>res, err := rt.Execute(ctx, toolruntime.ExecuteRequest{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n  Profile:  toolruntime.ProfileDev,\n  Gateway:  gw,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/#deny-unsafe-backend","title":"Deny unsafe backend","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DenyUnsafeProfiles: []toolruntime.SecurityProfile{toolruntime.ProfileStandard},\n  DefaultProfile:     toolruntime.ProfileStandard,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolruntime</code> powers secure code execution in the broader stack.</p>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Code as toolcode\n  participant Runtime as toolruntime\n  participant Backend as Sandbox Backend\n  participant Gateway as ToolGateway\n  participant Runner as toolrun\n\n  Agent-&gt;&gt;MCP: execute_code\n  MCP-&gt;&gt;Code: ExecuteCode\n  Code-&gt;&gt;Runtime: Execute(profile, code)\n  Runtime-&gt;&gt;Backend: Execute\n  Backend-&gt;&gt;Gateway: RunTool/RunChain\n  Gateway-&gt;&gt;Runner: Run\n  Runner--&gt;&gt;Backend: Result\n  Backend--&gt;&gt;Runtime: ExecuteResult\n  Runtime--&gt;&gt;Code: ExecuteResult\n  Code--&gt;&gt;MCP: Output</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Configure runtime with backends keyed by security profile.</li> <li>Wrap tool access using a <code>ToolGateway</code> (direct or proxy).</li> <li>Execute request is routed to the backend based on profile.</li> <li>Backend runs code with controlled access to tools via the gateway.</li> <li>Result and tool calls are returned, with <code>LimitsEnforced</code> indicating actual enforcement.</li> </ol>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#example-wire-runtime-to-toolcode","title":"Example: wire runtime to toolcode","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileStandard: mySandboxBackend,\n  },\n  DefaultProfile: toolruntime.ProfileStandard,\n})\n\nengine := toolcodeengine.New(toolcodeengine.Config{\n  Runtime: rt,\n  Profile: toolruntime.ProfileStandard,\n})\n\nexec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index: idx,\n  Docs:  docs,\n  Run:   runner,\n  Engine: engine,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Clear security posture by profile.</li> <li>Consistent tool access via a gateway boundary.</li> <li>Transparent limit enforcement reporting.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrRuntimeUnavailable</code> if no backend is registered for the profile.</li> <li><code>ErrBackendDenied</code> when policy blocks unsafe backends.</li> <li><code>ErrTimeout</code> / <code>ErrResourceLimit</code> on enforced limits.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/","title":"toolsearch","text":"<p><code>toolsearch</code> provides higher-quality search strategies for <code>toolindex</code> while keeping heavy dependencies out of the core registry. Today it ships a BM25 searcher backed by Bleve.</p> <p></p>"},{"location":"library-docs-from-repos/toolsearch/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#motivation","title":"Motivation","text":"<ul> <li>Keep toolindex small while enabling stronger ranking</li> <li>Experiment safely with search without changing core behavior</li> <li>Deterministic results for stable agent behavior</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#key-apis","title":"Key APIs","text":"<ul> <li><code>BM25Searcher</code> (implements <code>toolindex.Searcher</code>)</li> <li><code>BM25Config</code> for ranking and safety caps</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#quickstart","title":"Quickstart","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/#usability-notes","title":"Usability notes","text":"<ul> <li>Deterministic ordering avoids jitter in tool selection</li> <li>Index fingerprinting avoids rebuilds on no-op updates</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#next","title":"Next","text":"<ul> <li>Ranking pipeline: <code>architecture.md</code></li> <li>Configuration and caps: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/toolsearch/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolsearch/api/#bm25config","title":"BM25Config","text":"<pre><code>type BM25Config struct {\n  NameBoost      int\n  NamespaceBoost int\n  TagsBoost      int\n  MaxDocs        int\n  MaxDocTextLen  int\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/api/#bm25searcher","title":"BM25Searcher","text":"<pre><code>type BM25Searcher struct {}\n\nfunc NewBM25Searcher(cfg BM25Config) *BM25Searcher\n\n// implements toolindex.Searcher\nfunc (s *BM25Searcher) Search(query string, limit int, docs []toolindex.SearchDoc) ([]toolindex.Summary, error)\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/architecture/","title":"Architecture","text":"<p><code>toolsearch</code> is a pluggable search strategy for <code>toolindex</code>.</p>"},{"location":"library-docs-from-repos/toolsearch/architecture/#indexing-flow","title":"Indexing flow","text":"<pre><code>flowchart LR\n  A[Search docs] --&gt; B[Fingerprint]\n  B --&gt; C[BM25 index]\n  C --&gt; D[Ranked summaries]</code></pre>"},{"location":"library-docs-from-repos/toolsearch/architecture/#search-sequence","title":"Search sequence","text":"<pre><code>sequenceDiagram\n  participant Index\n  participant Searcher\n  participant Bleve\n\n  Index-&gt;&gt;Searcher: Search(query, docs)\n  Searcher-&gt;&gt;Searcher: Build index if fingerprint changed\n  Searcher-&gt;&gt;Bleve: Query\n  Bleve--&gt;&gt;Searcher: Hits\n  Searcher--&gt;&gt;Index: Summaries</code></pre>"},{"location":"library-docs-from-repos/toolsearch/architecture/#determinism","title":"Determinism","text":"<ul> <li>Docs are sorted by ID before indexing</li> <li>Tie-breaking uses score DESC, then ID ASC</li> <li>Fingerprints ensure stable caching</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>toolsearch</code>.</p>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>BM25 via Bleve. <code>toolsearch</code> uses Bleve's BM25 implementation for a strong lexical baseline without bringing in a full search stack.</li> <li>Field weighting by duplication. Instead of multi-field indexing, the searcher builds a single weighted document by duplicating name/namespace/tag tokens. This keeps the index schema simple and predictable.</li> <li>Deterministic ordering. Documents are sorted by tool ID before indexing. Ties are broken by tool ID to avoid nondeterministic results.</li> <li>In-memory index. Uses Bleve's in-memory index for speed and simplicity; this trades persistence for low overhead.</li> <li>Fingerprint-based rebuild. Index rebuilds only when the tool set changes (based on a fingerprint), reducing overhead for repeated searches.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#error-semantics","title":"Error semantics","text":"<ul> <li>BM25 search returns standard <code>error</code> values from Bleve.</li> <li><code>Search</code> returns empty slices on empty queries or no docs; it does not treat these as errors.</li> <li><code>Close</code> frees index resources; callers should treat errors from <code>Close</code> as operational warnings.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom weights: configure <code>NameBoost</code>, <code>NamespaceBoost</code>, and <code>TagsBoost</code>.</li> <li>Safety caps: limit search surface with <code>MaxDocs</code> or <code>MaxDocTextLen</code>.</li> <li>Alternative engines: implement <code>toolindex.Searcher</code> to swap BM25 out for semantic search later.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Start with BM25 if lexical search quality matters; switch to semantic only if needed.</li> <li>Keep <code>MaxDocTextLen</code> modest to avoid oversized indices from long descriptions.</li> <li>Use deterministic doc ordering to keep search results stable across deploys.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolsearch/examples/#deterministic-ranking","title":"Deterministic ranking","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n\nresults, _ := idx.Search(\"repo\", 10)\n// results are deterministic across runs\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/examples/#custom-boosts","title":"Custom boosts","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{\n  NameBoost:      5,\n  NamespaceBoost: 3,\n  TagsBoost:      1,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolsearch/usage/#configure-bm25","title":"Configure BM25","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{\n  NameBoost:      3,\n  NamespaceBoost: 2,\n  TagsBoost:      2,\n  MaxDocs:        5000,\n  MaxDocTextLen:  2000,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/#inject-into-toolindex","title":"Inject into toolindex","text":"<pre><code>idx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/#safety-controls","title":"Safety controls","text":"<ul> <li><code>MaxDocs</code>: cap indexed documents</li> <li><code>MaxDocTextLen</code>: truncate long descriptions</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolsearch</code> slots into the end-to-end workflow as a pluggable search engine.</p>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Search as toolsearch (BM25)\n\n  Agent-&gt;&gt;MCP: search_tools(query)\n  MCP-&gt;&gt;Index: Search\n  Index-&gt;&gt;Search: Search(query, docs)\n  Search--&gt;&gt;Index: ranked summaries\n  Index--&gt;&gt;MCP: summaries\n  MCP--&gt;&gt;Agent: tools</code></pre>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Enable BM25 in <code>metatools-mcp</code> using the <code>toolsearch</code> build tag.</li> <li>Set env vars (e.g., <code>METATOOLS_SEARCH_STRATEGY=bm25</code>).</li> <li>Search requests now flow through the BM25 searcher.</li> </ol>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#example-configure-bm25-via-env","title":"Example: configure BM25 via env","text":"<pre><code># build with toolsearch support\nGOFLAGS=\"-tags=toolsearch\" go build ./cmd/metatools\n\n# choose BM25 strategy at runtime\nexport METATOOLS_SEARCH_STRATEGY=bm25\nexport METATOOLS_SEARCH_BM25_NAME_BOOST=4\nexport METATOOLS_SEARCH_BM25_TAGS_BOOST=2\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Higher-quality lexical ranking for tool discovery.</li> <li>Deterministic ordering and tie-breaking.</li> <li>No API changes required in <code>toolindex</code> or <code>metatools-mcp</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Build without the <code>toolsearch</code> tag and request <code>bm25</code> strategy (fails fast).</li> <li>Oversized tool descriptions if <code>MaxDocTextLen</code> is not capped.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/","title":"metatools-mcp","text":"<p><code>metatools-mcp</code> is the MCP server that exposes the tool stack via a small, progressive-disclosure tool surface. It composes toolmodel, toolindex, tooldocs, toolrun, and optionally toolcode/toolruntime.</p> <p></p>"},{"location":"library-docs-from-repos/metatools-mcp/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#motivation","title":"Motivation","text":"<ul> <li>One MCP surface for discovery, docs, and execution</li> <li>Progressive disclosure to keep tool context small</li> <li>Pluggable design for search, runtimes, and engines</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#mcp-tools-exposed","title":"MCP tools exposed","text":"<ul> <li><code>search_tools</code></li> <li><code>list_namespaces</code></li> <li><code>describe_tool</code></li> <li><code>list_tool_examples</code></li> <li><code>run_tool</code></li> <li><code>run_chain</code></li> <li><code>execute_code</code> (optional)</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#quickstart","title":"Quickstart","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\ndocs := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\nrunner := toolrun.NewRunner(toolrun.WithIndex(idx))\n\ncfg := adapters.NewConfig(idx, docs, runner, nil)\nserver, _ := server.New(cfg)\n\n_ = server.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/#usability-notes","title":"Usability notes","text":"<ul> <li>Fewer MCP tools means simpler agent prompts</li> <li>Outputs are structured and aligned to MCP schemas</li> <li>Search and execution behaviors are deterministic by default</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#next","title":"Next","text":"<ul> <li>Server architecture: <code>architecture.md</code></li> <li>Configuration and env vars: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: <code>design-notes.md</code></li> <li>User Journey: <code>user-journey.md</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#proposals","title":"Proposals","text":"<ul> <li>Pluggable Architecture - Extensible, modular design</li> <li>Implementation Phases - Phased rollout plan</li> <li>Component Library Analysis - Tool* library ecosystem</li> <li>Multi-Tenancy Extension - Tenant isolation patterns</li> <li>Architecture Evaluation - Championship-level comparison</li> <li>Protocol-Agnostic Tools - Composable toolsets and protocol adapters</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/metatools-mcp/api/#server","title":"Server","text":"<pre><code>func New(cfg config.Config) (*Server, error)\nfunc (s *Server) Run(ctx context.Context, transport mcp.Transport) error\nfunc (s *Server) MCPServer() *mcp.Server\nfunc (s *Server) ListTools() []*mcp.Tool\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index    toolindex.Index\n  Docs     tooldocs.Store\n  Runner   toolrun.Runner\n  Executor toolcode.Executor // optional\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#mcp-tool-io-types","title":"MCP tool I/O types","text":"<p>These are exported in <code>pkg/metatools</code>:</p> <ul> <li><code>SearchToolsInput</code> / <code>SearchToolsOutput</code></li> <li><code>ListNamespacesInput</code> / <code>ListNamespacesOutput</code></li> <li><code>DescribeToolInput</code> / <code>DescribeToolOutput</code></li> <li><code>ListToolExamplesInput</code> / <code>ListToolExamplesOutput</code></li> <li><code>RunToolInput</code> / <code>RunToolOutput</code></li> <li><code>RunChainInput</code> / <code>RunChainOutput</code></li> <li><code>ExecuteCodeInput</code> / <code>ExecuteCodeOutput</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/api/#error-codes","title":"Error codes","text":"<p>Metatools surfaces standardized error codes (strings), including:</p> <ul> <li><code>tool_not_found</code></li> <li><code>no_backends</code></li> <li><code>validation_input</code></li> <li><code>validation_output</code></li> <li><code>execution_failed</code></li> <li><code>stream_not_supported</code></li> <li><code>chain_step_failed</code></li> <li><code>internal</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/","title":"Architecture","text":"<p><code>metatools-mcp</code> composes the core libraries and exposes a small MCP tool surface.</p>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#component-wiring","title":"Component wiring","text":"<pre><code>flowchart LR\n  A[metatools-mcp] --&gt; B[toolindex]\n  A --&gt; C[tooldocs]\n  A --&gt; D[toolrun]\n  A --&gt; E[toolcode]\n  E --&gt; F[toolruntime]\n\n  B --&gt; G[toolsearch]</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#progressive-disclosure-flow","title":"Progressive disclosure flow","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Run as toolrun\n\n  Agent-&gt;&gt;MCP: search_tools\n  MCP-&gt;&gt;Index: Search\n  Index--&gt;&gt;MCP: summaries\n  MCP--&gt;&gt;Agent: summaries\n\n  Agent-&gt;&gt;MCP: describe_tool (schema)\n  MCP-&gt;&gt;Docs: DescribeTool\n  Docs--&gt;&gt;MCP: tool schema\n  MCP--&gt;&gt;Agent: schema\n\n  Agent-&gt;&gt;MCP: run_tool\n  MCP-&gt;&gt;Run: Run\n  Run--&gt;&gt;MCP: result\n  MCP--&gt;&gt;Agent: result</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#mcp-tool-mapping","title":"MCP tool mapping","text":"<pre><code>flowchart LR\n  search_tools --&gt; toolindex\n  list_namespaces --&gt; toolindex\n  describe_tool --&gt; tooldocs\n  list_tool_examples --&gt; tooldocs\n  run_tool --&gt; toolrun\n  run_chain --&gt; toolrun\n  execute_code --&gt; toolcode</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>metatools-mcp</code>.</p>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>MCP-native surface. All metatools (search, describe, run, chain, execute_code) are exposed via the official MCP Go SDK types to keep wire compatibility.</li> <li>Adapters, not re-implementation. The server delegates to toolindex/tooldocs/toolrun/toolcode via thin adapters so the libraries remain the source of truth.</li> <li>Structured error objects. Tool-level errors are returned in a consistent <code>ErrorObject</code> shape rather than raw Go errors, preserving the MCP tool contract.</li> <li>Explicit limits. Inputs such as <code>limit</code> and <code>max</code> are capped for safe defaults (e.g., search limit cap 100, examples cap 5).</li> <li>Pluggable search. BM25 is optional via build tags (<code>toolsearch</code>) and runtime config via env vars.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>metatools-mcp</code> distinguishes protocol errors from tool errors:</p> <ul> <li>Protocol errors (invalid input) return a non-nil error from handlers.</li> <li>Tool errors are wrapped into <code>ErrorObject</code> and returned with <code>isError = true</code> so MCP clients treat them as tool failures.</li> </ul> <p>Key error behaviors:</p> <ul> <li><code>run_tool</code> rejects <code>stream=true</code> and <code>backend_override</code> in the default handler (not supported yet).</li> <li><code>run_chain</code> stops on first error and returns partial results with an <code>ErrorObject</code>.</li> <li><code>describe_tool</code>/<code>list_tool_examples</code> return validation errors when required fields are missing.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Search strategy: enable BM25 via the <code>toolsearch</code> build tag and env vars.</li> <li>Tool execution: swap <code>toolrun</code> runner implementation or configure different backends.</li> <li>Code execution: plug in a different <code>toolcode.Engine</code> (e.g., toolruntime-backed).</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Use environment variables to configure search strategy:</li> <li><code>METATOOLS_SEARCH_STRATEGY=lexical|bm25</code></li> <li><code>METATOOLS_SEARCH_BM25_*</code> for weighting and caps</li> <li>Keep tool schemas in <code>toolmodel</code> to preserve MCP compatibility end-to-end.</li> <li>Treat metatools as the stable surface; update libraries behind it as needed.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/metatools-mcp/examples/#register-a-local-tool-expose-mcp-server","title":"Register a local tool + expose MCP server","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\nlocal := toolrun.NewLocalRegistry()\nlocal.Register(\"ping\", func(ctx context.Context, args map[string]any) (any, error) {\n  return map[string]any{\"ok\": true}, nil\n})\n\n_ = idx.RegisterTool(toolmodel.Tool{\n  Namespace: \"local\",\n  Tool: mcp.Tool{\n    Name:        \"ping\",\n    Description: \"Simple health check\",\n    InputSchema: map[string]any{\"type\": \"object\"},\n  },\n}, toolmodel.ToolBackend{\n  Kind:  toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"ping\"},\n})\n\nrunner := toolrun.NewRunner(toolrun.WithIndex(idx), toolrun.WithLocalRegistry(local))\n\ncfg := adapters.NewConfig(idx, tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx}), runner, nil)\nserver, _ := server.New(cfg)\n_ = server.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/examples/#tool-search-and-execution","title":"Tool search and execution","text":"<pre><code>summaries, _ := idx.Search(\"ping\", 3)\n\nres, _ := runner.Run(ctx, summaries[0].ID, map[string]any{})\nfmt.Println(res.Structured)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/metatools-mcp/usage/#build-and-run-stdio","title":"Build and run (stdio)","text":"<pre><code>go run ./cmd/metatools\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#enable-bm25-search-build-tag-env","title":"Enable BM25 search (build tag + env)","text":"<pre><code>go build -tags toolsearch ./cmd/metatools\nMETATOOLS_SEARCH_STRATEGY=bm25 ./metatools\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#environment-variables","title":"Environment variables","text":"Variable Default Description <code>METATOOLS_SEARCH_STRATEGY</code> <code>lexical</code> <code>lexical</code> or <code>bm25</code> <code>METATOOLS_SEARCH_BM25_NAME_BOOST</code> <code>3</code> BM25 name field boost <code>METATOOLS_SEARCH_BM25_NAMESPACE_BOOST</code> <code>2</code> BM25 namespace field boost <code>METATOOLS_SEARCH_BM25_TAGS_BOOST</code> <code>2</code> BM25 tags field boost <code>METATOOLS_SEARCH_BM25_MAX_DOCS</code> <code>0</code> Max docs to index (0=unlimited) <code>METATOOLS_SEARCH_BM25_MAX_DOCTEXT_LEN</code> <code>0</code> Max doc text length (0=unlimited)"},{"location":"library-docs-from-repos/metatools-mcp/usage/#optional-toolruntime-support","title":"Optional toolruntime support","text":"<pre><code>go run -tags toolruntime ./cmd/metatools\n</code></pre> <p>This enables <code>execute_code</code> backed by a <code>toolruntime</code> engine.</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/","title":"User Journey","text":"<p>This journey shows the full end-to-end agent workflow via MCP metatools.</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#end-to-end-flow-agent-view","title":"End-to-end flow (agent view)","text":"<pre><code>sequenceDiagram\n  participant Agent\n  participant MCP as metatools-mcp\n  participant Index as toolindex\n  participant Docs as tooldocs\n  participant Runner as toolrun\n  participant Code as toolcode\n\n  Agent-&gt;&gt;MCP: search_tools(\"create ticket\")\n  MCP-&gt;&gt;Index: Search\n  MCP--&gt;&gt;Agent: tool summaries\n\n  Agent-&gt;&gt;MCP: describe_tool(tool_id, schema)\n  MCP-&gt;&gt;Docs: DescribeTool(schema)\n  MCP--&gt;&gt;Agent: tool schema\n\n  Agent-&gt;&gt;MCP: run_tool(tool_id, args)\n  MCP-&gt;&gt;Runner: Run\n  MCP--&gt;&gt;Agent: structured result\n\n  Agent-&gt;&gt;MCP: execute_code(code)\n  MCP-&gt;&gt;Code: ExecuteCode\n  Code-&gt;&gt;Index: SearchTools\n  Code-&gt;&gt;Docs: DescribeTool\n  Code-&gt;&gt;Runner: RunTool/RunChain\n  Code--&gt;&gt;MCP: ExecuteResult</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Discover tools with <code>search_tools</code> (summary-only results).</li> <li>Inspect schema using <code>describe_tool</code> (schema or full detail).</li> <li>Execute a single tool with <code>run_tool</code> or a sequence with <code>run_chain</code>.</li> <li>Orchestrate complex flows using <code>execute_code</code> (optional).</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#example-full-agent-workflow","title":"Example: full agent workflow","text":"<pre><code>1) search_tools(\"create issue\", limit=5)\n2) describe_tool(\"github:create_issue\", detail_level=\"schema\")\n3) run_tool(\"github:create_issue\", args={...})\n4) run_chain([{tool_id:\"github:get_issue\"}, {tool_id:\"github:add_label\", use_previous:true}])\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Stable MCP-compatible APIs for discovery, documentation, and execution.</li> <li>Consistent error objects for tool failures.</li> <li>Progressive disclosure to minimize token costs.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Invalid input payloads (handler validation errors).</li> <li>Tool-level errors returned in <code>ErrorObject</code> with <code>code</code> and <code>op</code> fields.</li> <li>Unsupported options (e.g., <code>stream=true</code> for <code>run_tool</code>).</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/","title":"Architecture Evaluation: Championship-Level Analysis","text":"<p>Status: Draft Date: 2026-01-28 Related: Pluggable Architecture Proposal, Component Library Analysis</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#executive-summary","title":"Executive Summary","text":"<p>This document evaluates the metatools ecosystem against championship-level implementations and industry best practices. The analysis reveals that your architecture is already at 85-90% of championship-level in core areas, with specific opportunities for advancement in emerging patterns.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Research Methodology</li> <li>Championship Implementations Analyzed</li> <li>Pattern Comparison Matrix</li> <li>What You Already Have (Championship Features)</li> <li>Gaps and Opportunities</li> <li>Recommended Extensions</li> <li>New Libraries to Consider</li> <li>Protocol Evolution (A2A + MCP)</li> <li>Implementation Roadmap</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#research-methodology","title":"Research Methodology","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#sources-analyzed","title":"Sources Analyzed","text":"Source Type Examples Key Insights Production Go Projects Tencent WeKnora (12.5k stars), go-kratos/blades (700 stars) Multi-tenant, agent orchestration patterns MCP Ecosystem Official Go SDK, fastmcp (22k stars), mcp-agent (8k stars) Protocol implementation patterns Industry Standards MCP Spec 2025-11-25, A2A Protocol, Google ADK Protocol interoperability Academic/Industry Research Anthropic context engineering, LangChain patterns Progressive disclosure, semantic discovery"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#key-references","title":"Key References","text":"<ul> <li>MCP Best Practices - Single-purpose servers, transport options</li> <li>Effective Context Engineering - Progressive disclosure</li> <li>A2A Protocol - Agent-to-agent communication</li> <li>Google ADK for Go - Multi-agent patterns</li> <li>Semantic Tool Discovery - Vector-based tool selection</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#championship-implementations-analyzed","title":"Championship Implementations Analyzed","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-tencent-weknora-12566-stars","title":"1. Tencent WeKnora (12,566 stars)","text":"<p>What it is: LLM-powered RAG framework with multi-tenant support</p> <p>Architecture Highlights: <pre><code>internal/\n\u251c\u2500\u2500 agent/          # Agent orchestration\n\u2502   \u2514\u2500\u2500 tools/      # Agent-specific tools\n\u251c\u2500\u2500 application/    # Business logic\n\u2502   \u251c\u2500\u2500 repository/ # Data access\n\u2502   \u2514\u2500\u2500 service/    # Service layer\n\u251c\u2500\u2500 handler/        # HTTP handlers\n\u251c\u2500\u2500 middleware/     # Cross-cutting concerns\n\u251c\u2500\u2500 models/         # LLM integrations\n\u2502   \u251c\u2500\u2500 chat/\n\u2502   \u251c\u2500\u2500 embedding/\n\u2502   \u2514\u2500\u2500 rerank/\n\u251c\u2500\u2500 runtime/        # Execution environment\n\u2514\u2500\u2500 types/\n    \u2514\u2500\u2500 interfaces/ # Contract definitions\n</code></pre></p> <p>Key Patterns: - Clean layered architecture (handler \u2192 service \u2192 repository) - Multi-tenant via middleware - Model provider abstraction (chat, embedding, rerank) - Event-driven architecture with adapters</p> <p>Comparison to metatools: | Feature | WeKnora | metatools | Gap | |---------|---------|-----------|-----| | Layered architecture | \u2705 | \u2705 | None | | Multi-tenant | \u2705 Built-in | \ud83d\udccb Proposed | Implement | | Embedding models | \u2705 | \u274c | Extension opportunity | | Reranking | \u2705 | \u274c | Extension opportunity |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-go-kratosblades-700-stars","title":"2. go-kratos/blades (700 stars)","text":"<p>What it is: Multi-agent AI framework from the Kratos team</p> <p>Architecture Highlights: <pre><code>// Tool interface - remarkably similar to toolmodel.Tool\ntype Tool interface {\n    Name() string\n    Description() string\n    InputSchema() *jsonschema.Schema\n    OutputSchema() *jsonschema.Schema\n    Handler\n}\n\n// Middleware chain - identical pattern to your proposal\ntype Handler interface {\n    Handle(context.Context, *Invocation) Generator[*Message, error]\n}\ntype Middleware func(Handler) Handler\n\nfunc ChainMiddlewares(mws ...Middleware) Middleware {\n    return func(next Handler) Handler {\n        h := next\n        for i := len(mws) - 1; i &gt;= 0; i-- {\n            h = mws[i](h)\n        }\n        return h\n    }\n}\n</code></pre></p> <p>Key Patterns: - Generic tool creation with type inference (<code>NewFunc[I, O any]</code>) - Middleware chain (confirm, conversation, retry) - Agent-as-tool pattern (agents can be tools for other agents) - Streaming via Go iterators</p> <p>Comparison to metatools: | Feature | blades | metatools | Gap | |---------|--------|-----------|-----| | Tool interface | \u2705 | \u2705 toolmodel.Tool | None | | Middleware chain | \u2705 | \ud83d\udccb Proposed | Implement | | Generic tool creation | \u2705 | \u274c | Enhancement | | Agent-as-tool | \u2705 | \u274c | Extension | | Streaming | \u2705 Iterators | \u2705 Channels | Different approach |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-official-mcp-go-sdk-modelcontextprotocolgo-sdk","title":"3. Official MCP Go SDK (modelcontextprotocol/go-sdk)","text":"<p>What it is: Reference implementation for MCP in Go</p> <p>Architecture Highlights: <pre><code>type Server struct {\n    impl    *Implementation\n    opts    ServerOptions\n    prompts *featureSet[*serverPrompt]\n    tools   *featureSet[*serverTool]\n    resources *featureSet[*serverResource]\n    sessions []*ServerSession\n    // ...\n}\n\ntype ServerOptions struct {\n    Instructions string\n    Logger *slog.Logger\n    InitializedHandler func(context.Context, *InitializedRequest)\n    PageSize int\n    KeepAlive time.Duration\n    // ...\n}\n</code></pre></p> <p>Key Patterns: - Feature sets for prompts, tools, resources - Session management - Handler-based configuration (functional options) - Built-in SSE support</p> <p>Comparison to metatools: | Feature | MCP SDK | metatools | Gap | |---------|---------|-----------|-----| | Tools registration | \u2705 | \u2705 toolindex | None | | Resources | \u2705 | \u274c | Extension | | Prompts | \u2705 | \u274c | Extension | | SSE transport | \u2705 | \ud83d\udccb Proposed | Implement | | Session management | \u2705 | \u274c | Enhancement |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-fastmcp-22398-stars-python","title":"4. fastmcp (22,398 stars - Python)","text":"<p>What it is: Fastest way to build MCP servers</p> <p>Key Insight: Despite being Python, the architecture patterns are transferable: - Decorator-based tool registration - Context manager patterns for resources - Progressive tool loading for large toolsets</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#5-google-adk-for-go","title":"5. Google ADK for Go","text":"<p>What it is: Agent Development Kit with A2A support</p> <p>Key Features: - MCP integration out of the box - A2A protocol support for multi-agent systems - 30+ database connectors via MCP Toolbox - Built-in observability</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#pattern-comparison-matrix","title":"Pattern Comparison Matrix","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#core-architecture-patterns","title":"Core Architecture Patterns","text":"Pattern Industry Best metatools Status Priority Progressive Disclosure 3-tier (index/details/full) \u2705 tooldocs (summary/schema/full) Done Interface-Based Pluggability All components as interfaces \u2705 13 extension points Done Multi-Backend Per Tool Runtime backend selection \u2705 toolindex BackendSelector Done Middleware Chain Decorator pattern \ud83d\udccb Proposed High Security Profiles dev/standard/hardened \u2705 toolruntime Done Contract Testing Interface compliance tests \u2705 toolruntime Gateway tests Done"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#advanced-patterns","title":"Advanced Patterns","text":"Pattern Industry Best metatools Status Priority Semantic Tool Discovery Vector embeddings + BM25 \u26a0\ufe0f BM25 only (toolsearch) Medium A2A Protocol Agent-to-agent communication \u274c Not implemented Low MCP Resources File/data exposure to LLMs \u274c Not implemented Medium MCP Prompts Reusable prompt templates \u274c Not implemented Low Observability OpenTelemetry tracing \u274c Not implemented High Hot Reload Dynamic tool registration \u26a0\ufe0f Partial (UnregisterBackend) Medium"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#what-you-already-have-championship-features","title":"What You Already Have (Championship Features)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-progressive-disclosure-tooldocs","title":"1. Progressive Disclosure (tooldocs)","text":"<p>Your 3-tier documentation system matches industry best practice exactly:</p> <pre><code>// Your implementation matches Anthropic's recommendation\ntype DetailLevel string\nconst (\n    DetailLevelSummary DetailLevel = \"summary\"  // Layer 1: Metadata\n    DetailLevelSchema  DetailLevel = \"schema\"   // Layer 2: Structure\n    DetailLevelFull    DetailLevel = \"full\"     // Layer 3: Complete\n)\n</code></pre> <p>Industry validation: Anthropic's context engineering guide recommends exactly this pattern for token optimization.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-multi-backend-tool-registry-toolindex","title":"2. Multi-Backend Tool Registry (toolindex)","text":"<p>Your architecture supports what few frameworks do - multiple backends for the same tool:</p> <pre><code>// Tools can have MCP, Provider, AND Local backends simultaneously\ntype ToolBackend struct {\n    Kind     BackendKind      // mcp, provider, local\n    MCP      *MCPBackend\n    Provider *ProviderBackend\n    Local    *LocalBackend\n}\n\n// Runtime selection via pluggable BackendSelector\ntype BackendSelector func(tool Tool, backends []ToolBackend) ToolBackend\n</code></pre> <p>Industry validation: This matches Google ADK's multi-source pattern.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-10-sandbox-backends-toolruntime","title":"3. 10 Sandbox Backends (toolruntime)","text":"<p>Your runtime isolation options exceed most frameworks:</p> Backend Use Case Isolation Level unsafe Development None docker Standard production Container containerd Kubernetes environments Container kubernetes Multi-tenant production Pod + Namespace firecracker High security microVM kata Strong isolation VM gvisor Kernel isolation Sandboxed kernel wasm Portable execution Sandbox temporal Workflow orchestration Durable execution remote Distributed execution Network <p>Industry validation: No other open-source MCP framework offers this breadth.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-interface-based-extension-13-points","title":"4. Interface-Based Extension (13 Points)","text":"<p>Your 13 extension points match the Go best practice of interface-based composition:</p> # Interface Purpose 1 SchemaValidator JSON Schema validation 2 Searcher Tool search (BM25, semantic) 3 BackendSelector Multi-backend selection 4 Store Documentation storage 5 ToolResolver Tool resolution 6 Runner Execution orchestration 7 MCPExecutor MCP backend calls 8 ProviderExecutor Provider backend calls 9 LocalRegistry Local handler lookup 10 Backend Sandbox isolation 11 ToolGateway Sandboxed tool access 12 Logger Execution logging 13 Engine Code execution <p>Industry validation: Matches go-kratos/blades interface design philosophy.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#gaps-and-opportunities","title":"Gaps and Opportunities","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#high-priority","title":"High Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-observability-tracing-metrics","title":"1. Observability (Tracing + Metrics)","text":"<p>Gap: No built-in OpenTelemetry integration.</p> <p>Why it matters: Production deployments need distributed tracing and metrics.</p> <p>Solution: <pre><code>// New package: toolobserve\ntype Tracer interface {\n    StartSpan(ctx context.Context, name string) (context.Context, Span)\n}\n\ntype MetricsRecorder interface {\n    RecordToolCall(toolID string, duration time.Duration, err error)\n    RecordSearchLatency(query string, duration time.Duration)\n}\n\n// Integration via middleware\nfunc TracingMiddleware(tracer Tracer) toolrun.ExecutionHook {\n    return &amp;tracingHook{tracer: tracer}\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-mcp-gateway-auth-analytics","title":"2. MCP Gateway (Auth + Analytics)","text":"<p>Gap: No proxy layer for authentication, rate limiting, analytics.</p> <p>Why it matters: Enterprise deployments need centralized auth and monitoring.</p> <p>Reference: hyprmcp/jetski - OAuth2.1, DCR, real-time logs</p> <p>Solution: <pre><code>// New package: toolgateway\ntype Gateway struct {\n    Auth       AuthProvider\n    RateLimit  RateLimiter\n    Analytics  AnalyticsRecorder\n    Upstream   MCPServer\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#medium-priority","title":"Medium Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-semantic-tool-discovery","title":"3. Semantic Tool Discovery","text":"<p>Gap: Only BM25 lexical search, no vector/embedding search.</p> <p>Why it matters: With 50+ tools, semantic search dramatically improves accuracy.</p> <p>Reference: Semantic Tool Discovery</p> <p>Solution: <pre><code>// New package: toolsemantic (implements toolindex.Searcher)\ntype SemanticSearcher struct {\n    embedder   Embedder\n    vectorDB   VectorStore\n    bm25       toolsearch.BM25Searcher // Hybrid: semantic + lexical\n}\n\ntype Embedder interface {\n    Embed(ctx context.Context, text string) ([]float32, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-mcp-resources-support","title":"4. MCP Resources Support","text":"<p>Gap: No file/data resource exposure to LLMs.</p> <p>Why it matters: MCP Resources allow LLMs to read files, databases, APIs.</p> <p>Solution: <pre><code>// New extension to toolindex or new package: toolresource\ntype Resource struct {\n    URI         string\n    Name        string\n    Description string\n    MimeType    string\n}\n\ntype ResourceProvider interface {\n    List(ctx context.Context) ([]Resource, error)\n    Read(ctx context.Context, uri string) (io.Reader, error)\n    Subscribe(ctx context.Context, uri string) (&lt;-chan ResourceUpdate, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#low-priority-future","title":"Low Priority (Future)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#5-a2a-protocol-support","title":"5. A2A Protocol Support","text":"<p>Gap: No agent-to-agent communication.</p> <p>Why it matters: Multi-agent systems need standardized communication.</p> <p>Reference: A2A Protocol</p> <p>Solution: <pre><code>// New package: toola2a\ntype AgentCard struct {\n    Name         string\n    Description  string\n    Capabilities []Capability\n    Endpoint     string\n}\n\ntype A2AClient interface {\n    Discover(ctx context.Context, endpoint string) (*AgentCard, error)\n    Invoke(ctx context.Context, agent string, task *Task) (*TaskResult, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#6-mcp-prompts-support","title":"6. MCP Prompts Support","text":"<p>Gap: No reusable prompt template system.</p> <p>Why it matters: Prompts are a core MCP feature for standardized interactions.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#recommended-extensions","title":"Recommended Extensions","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#new-libraries-to-consider","title":"New Libraries to Consider","text":"<p>Based on the analysis, here are potential new libraries that could enhance the ecosystem:</p> Library Purpose Priority Effort toolobserve OpenTelemetry tracing + metrics High 2 weeks toolsemantic Vector-based semantic search Medium 3 weeks toolresource MCP Resources support Medium 2 weeks toolgateway Auth, rate limit, analytics proxy Medium 3 weeks toola2a A2A protocol support Low 4 weeks toolprompt MCP Prompts support Low 1 week"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#updated-dependency-graph","title":"Updated Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     EXPANDED METATOOLS ECOSYSTEM                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502                           \u2502  metatools-mcp  \u2502                               \u2502\n\u2502                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                               \u2502\n\u2502                                    \u2502                                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2534\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502    \u2502                              \u2502 \u2502                              \u2502         \u2502\n\u2502    \u25bc                              \u25bc \u25bc                              \u25bc         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502 \u2502toolgateway\u2502 NEW          \u2502 toolcode \u2502                    \u2502toolobserve\u2502 NEW\u2502\n\u2502 \u2502(auth/proxy)\u2502             \u2502          \u2502                    \u2502(tracing)  \u2502    \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                 \u2502                                            \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502         \u2502                       \u2502                           \u2502               \u2502\n\u2502         \u25bc                       \u25bc                           \u25bc               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  toolrun    \u2502         \u2502  tooldocs   \u2502            \u2502toolresource \u2502 NEW    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502(MCP Resources)\u2502       \u2502\n\u2502         \u2502                       \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502         \u2502    \u2502                  \u2502                        \u2502                  \u2502\n\u2502         \u25bc    \u25bc                  \u25bc                        \u25bc                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 toolruntime \u2502         \u2502  toolindex  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502toolsemantic \u2502 NEW       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502(vector search)\u2502          \u2502\n\u2502         \u2502                       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502         \u2502                       \u2502                        \u25b2                  \u2502\n\u2502         \u2502                       \u25bc                        \u2502                  \u2502\n\u2502         \u2502                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  toolmodel  \u2502          \u2502 toolsearch  \u2502           \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502 (BM25)      \u2502           \u2502\n\u2502                                 \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                 \u25bc                                           \u2502\n\u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502                   \u2502 modelcontextprotocol/   \u2502                              \u2502\n\u2502                   \u2502       go-sdk            \u2502                              \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                                                              \u2502\n\u2502    Future:  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502             \u2502 toola2a  \u2502    \u2502toolprompt\u2502                                   \u2502\n\u2502             \u2502(A2A proto)\u2502   \u2502(MCP prompts)\u2502                                 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#protocol-evolution","title":"Protocol Evolution","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#mcp-a2a-complementary-protocols","title":"MCP + A2A Complementary Protocols","text":"<p>The industry is converging on two complementary protocols:</p> Protocol Purpose Direction Your Status MCP Agent-to-tool Vertical (depth) \u2705 Implemented A2A Agent-to-agent Horizontal (breadth) \u274c Future <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PROTOCOL LANDSCAPE                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                         \u2502  User   \u2502                             \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                         \u2502  Host   \u2502                             \u2502\n\u2502                         \u2502  Agent  \u2502                             \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                              \u2502                                   \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502         \u2502                    \u2502                    \u2502             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502 Remote  \u2502\u25c4\u2500\u2500 A2A \u2500\u2500\u25b6\u2502 Remote \u2502\u25c4\u2500\u2500 A2A \u2500\u2500\u25b6\u2502 Remote \u2502       \u2502\n\u2502    \u2502 Agent 1 \u2502           \u2502 Agent 2\u2502           \u2502 Agent 3\u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518       \u2502\n\u2502         \u2502                     \u2502                    \u2502            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502  MCP    \u2502           \u2502  MCP   \u2502           \u2502  MCP   \u2502       \u2502\n\u2502    \u2502 Server  \u2502           \u2502 Server \u2502           \u2502 Server \u2502       \u2502\n\u2502    \u2502 (tools) \u2502           \u2502 (tools)\u2502           \u2502 (tools)\u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                                  \u2502\n\u2502    Legend: A2A = Agent-to-Agent (horizontal)                    \u2502\n\u2502            MCP = Agent-to-Tool (vertical)                       \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#scaling-recommendation-from-anthropic-nov-2025","title":"Scaling Recommendation (from Anthropic Nov 2025)","text":"<p>For 50+ tools, present MCP servers as code APIs instead of direct tool calls:</p> <p>\"This pattern becomes essential when scaling to many tools. You're essentially giving agents a programming environment rather than a function-calling interface.\"</p> <p>Your <code>toolcode</code> package already enables this pattern!</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#updated-timeline-with-extensions","title":"Updated Timeline with Extensions","text":"Phase Focus Duration Libraries Phase 1 CLI + Config 2 weeks metatools-mcp Phase 2 Transport + Observability 2 weeks metatools-mcp, toolobserve (new) Phase 3 Public APIs 1 week All existing Phase 4 Backend Integration 2 weeks toolruntime Phase 5 Semantic Search 2 weeks toolsemantic (new) Phase 6 MCP Resources 2 weeks toolresource (new) Phase 7 Gateway/Proxy 2 weeks toolgateway (new) Total 13 weeks 4 new libraries"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#mvp-phases-1-4-7-weeks","title":"MVP (Phases 1-4): 7 weeks","text":"<p>Core pluggable architecture with observability.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#extended-phases-5-7-6-weeks","title":"Extended (Phases 5-7): +6 weeks","text":"<p>Advanced features for enterprise/production deployments.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#summary-your-position","title":"Summary: Your Position","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#championship-scorecard","title":"Championship Scorecard","text":"Category Score Notes Core Architecture 95% Excellent layering, interfaces, patterns Pluggability 90% 13 extension points, multi-backend Security 95% 10 isolation backends, 3 security profiles Documentation 85% Progressive disclosure implemented Observability 40% Gap - needs OpenTelemetry Semantic Search 60% BM25 good, vectors needed Protocol Coverage 70% MCP tools, missing resources/prompts Overall 85% Championship-adjacent"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#key-takeaway","title":"Key Takeaway","text":"<p>Your architecture is not a framework to be built\u2014it's a mature ecosystem to be exposed and extended. The 7 tool* libraries represent years of thoughtful design that matches or exceeds most open-source alternatives.</p> <p>The path to championship level requires: 1. Exposure (CLI + config) - 2 weeks 2. Observability (toolobserve) - 2 weeks 3. Semantic search (toolsemantic) - 2 weeks 4. MCP completeness (toolresource) - 2 weeks</p> <p>Total to championship: ~8 weeks of focused work.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial comprehensive architecture evaluation 2026-01-28 Analyzed 5 championship-level implementations 2026-01-28 Identified 4 new potential libraries 2026-01-28 Created extended implementation roadmap"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/","title":"Component Library Analysis for Pluggable Architecture","text":"<p>Status: Draft Date: 2026-01-27 Related: Pluggable Architecture Proposal, Implementation Phases</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#overview","title":"Overview","text":"<p>This document analyzes the metatools component library ecosystem and identifies changes needed to support the pluggable architecture. The analysis follows Go Architect principles: layered architecture, clean interfaces, dependency injection, and proper error handling.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#component-library-ecosystem","title":"Component Library Ecosystem","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#dependency-graph","title":"Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS COMPONENT ECOSYSTEM                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                \u2502\n\u2502                           \u2502  metatools-mcp  \u2502                                \u2502\n\u2502                           \u2502    (v0.1.x)     \u2502                                \u2502\n\u2502                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502\n\u2502                                    \u2502                                          \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502         \u2502                          \u2502                          \u2502              \u2502\n\u2502         \u25bc                          \u25bc                          \u25bc              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  toolcode   \u2502           \u2502  tooldocs   \u2502           \u2502  toolrun    \u2502        \u2502\n\u2502  \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.9)   \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502         \u2502                         \u2502                         \u2502                \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502         \u2502    \u2502                    \u2502                                          \u2502\n\u2502         \u25bc    \u25bc                    \u25bc                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502  \u2502 toolruntime \u2502           \u2502  toolindex  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.8)   \u2502                          \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502         \u2502                         \u2502                          \u2502 toolsearch \u2502 \u2502\n\u2502         \u2502                         \u2502                          \u2502  (v0.1.9)  \u2502 \u2502\n\u2502         \u2502                         \u25bc                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502         \u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  toolmodel  \u2502                                  \u2502\n\u2502                            \u2502  (v0.1.2)   \u2502                                  \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2502\n\u2502                                   \u2502                                          \u2502\n\u2502                                   \u25bc                                          \u2502\n\u2502                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                     \u2502 modelcontextprotocol/   \u2502                             \u2502\n\u2502                     \u2502       go-sdk            \u2502                             \u2502\n\u2502                     \u2502       (v1.2.0)          \u2502                             \u2502\n\u2502                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#library-summary-matrix","title":"Library Summary Matrix","text":"Library Version Purpose Key Interfaces Dependencies toolmodel v0.1.2 Core data models <code>Tool</code>, <code>ToolBackend</code>, <code>SchemaValidator</code> mcp go-sdk toolindex v0.1.8 Tool registry <code>Index</code>, <code>Searcher</code>, <code>BackendSelector</code> toolmodel tooldocs v0.1.10 Documentation <code>Store</code>, <code>DetailLevel</code> toolindex, toolmodel toolrun v0.1.9 Execution <code>Runner</code>, <code>MCPExecutor</code>, <code>ProviderExecutor</code>, <code>LocalRegistry</code> toolindex, toolmodel toolcode v0.1.10 Code execution <code>Executor</code>, <code>Engine</code>, <code>Tools</code> toolrun, tooldocs, toolindex toolsearch v0.1.9 BM25 search <code>BM25Searcher</code> (implements <code>Searcher</code>) toolindex, bleve toolruntime v0.1.10 Sandbox runtime <code>Runtime</code>, <code>Backend</code>, <code>ToolGateway</code> toolcode, toolrun, tooldocs"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-1-toolmodel-foundation","title":"Layer 1: toolmodel (Foundation)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state","title":"Current State","text":"<p>The foundational library defining what a \"tool\" is. Zero networking dependencies, safe for embedding.</p> <p>Exported Types: - <code>Tool</code> - Embeds <code>mcp.Tool</code> with extensions (Namespace, Version, Tags) - <code>ToolBackend</code> - Backend binding (Kind, MCP/Provider/Local configs) - <code>BackendKind</code> - Enum: <code>mcp</code>, <code>provider</code>, <code>local</code> - <code>MCPBackend</code>, <code>ProviderBackend</code>, <code>LocalBackend</code> - Backend configs - <code>SchemaValidator</code> - Interface for JSON Schema validation - <code>DefaultValidator</code> - Default implementation using jsonschema-go</p> <p>Key Functions: - <code>Tool.ToolID()</code> - Returns canonical ID (<code>namespace:name</code>) - <code>ParseToolID()</code> - Parses ID string into components - <code>Tool.Validate()</code> - Validates tool invariants - <code>NormalizeTags()</code> - Tag normalization for indexing</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-stable","title":"Priority: LOW (mostly stable)","text":"Change Rationale Impact Add <code>ToolMetadata</code> field Support arbitrary metadata for middleware/backends Minor - additive Add <code>BackendKindHTTP</code> Support HTTP backend type for remote APIs Minor - additive Add <code>BackendKindGRPC</code> Support gRPC backend type Minor - additive Add <code>HTTPBackend</code> struct Config for HTTP backends Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions","title":"Proposed Additions","text":"<pre><code>// New backend kinds for multi-backend architecture\nconst (\n    BackendKindMCP      BackendKind = \"mcp\"\n    BackendKindProvider BackendKind = \"provider\"\n    BackendKindLocal    BackendKind = \"local\"\n    BackendKindHTTP     BackendKind = \"http\"      // NEW\n    BackendKindGRPC     BackendKind = \"grpc\"      // NEW\n)\n\n// HTTPBackend metadata for HTTP API backends\ntype HTTPBackend struct {\n    BaseURL   string            `json:\"baseUrl\"`\n    AuthType  string            `json:\"authType,omitempty\"`  // bearer, oauth2, apikey\n    Headers   map[string]string `json:\"headers,omitempty\"`\n    Timeout   time.Duration     `json:\"timeout,omitempty\"`\n}\n\n// GRPCBackend metadata for gRPC backends\ntype GRPCBackend struct {\n    Address   string `json:\"address\"`\n    TLS       bool   `json:\"tls,omitempty\"`\n    CACert    string `json:\"caCert,omitempty\"`\n}\n\n// ToolBackend - add HTTP and GRPC fields\ntype ToolBackend struct {\n    Kind     BackendKind      `json:\"kind\"`\n    MCP      *MCPBackend      `json:\"mcp,omitempty\"`\n    Provider *ProviderBackend `json:\"provider,omitempty\"`\n    Local    *LocalBackend    `json:\"local,omitempty\"`\n    HTTP     *HTTPBackend     `json:\"http,omitempty\"`      // NEW\n    GRPC     *GRPCBackend     `json:\"grpc,omitempty\"`      // NEW\n}\n\n// Tool - add metadata field\ntype Tool struct {\n    mcp.Tool\n    Namespace string         `json:\"namespace,omitempty\"`\n    Version   string         `json:\"version,omitempty\"`\n    Tags      []string       `json:\"tags,omitempty\"`\n    Metadata  map[string]any `json:\"metadata,omitempty\"`   // NEW\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-2-toolindex-registry","title":"Layer 2: toolindex (Registry)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_1","title":"Current State","text":"<p>Global registry and discovery layer for tools. Thread-safe, supports pluggable search.</p> <p>Exported Types: - <code>Index</code> - Interface for tool registry - <code>InMemoryIndex</code> - Default implementation - <code>Summary</code> - Lightweight search result - <code>SearchDoc</code> - Document for search indexing - <code>Searcher</code> - Interface for search implementations - <code>BackendSelector</code> - Function type for backend selection - <code>ToolRegistration</code> - Tool + Backend pair</p> <p>Key Methods: - <code>RegisterTool()</code>, <code>RegisterTools()</code>, <code>RegisterToolsFromMCP()</code> - <code>GetTool()</code>, <code>GetAllBackends()</code> - <code>Search()</code>, <code>ListNamespaces()</code> - <code>UnregisterBackend()</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_1","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-medium","title":"Priority: MEDIUM","text":"Change Rationale Impact Add <code>ListTools()</code> method Backend aggregation needs full tool list Minor - additive Add <code>BackendSource</code> tracking Track which backend registered a tool Medium - structural Add <code>Refresh()</code> capability Support hot-reload from config changes Medium - additive Add <code>OnChange</code> callback Notify listeners of registry changes Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-interface-extensions","title":"Proposed Interface Extensions","text":"<pre><code>// Index interface additions\ntype Index interface {\n    // Existing methods...\n    RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) error\n    RegisterTools(regs []ToolRegistration) error\n    RegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) error\n    UnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) error\n    GetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)\n    GetAllBackends(id string) ([]toolmodel.ToolBackend, error)\n    Search(query string, limit int) ([]Summary, error)\n    ListNamespaces() ([]string, error)\n\n    // NEW: Support for multi-backend architecture\n    ListTools() ([]toolmodel.Tool, error)                    // List all registered tools\n    ListToolsFromBackend(backendName string) ([]Summary, error) // Filter by source\n\n    // NEW: Support for dynamic updates\n    OnChange(callback func(event RegistryEvent)) func()      // Subscribe to changes\n    Refresh() error                                          // Trigger refresh from sources\n}\n\n// RegistryEvent for change notifications\ntype RegistryEvent struct {\n    Type    RegistryEventType  // added, updated, removed\n    ToolID  string\n    Backend *toolmodel.ToolBackend\n}\n\ntype RegistryEventType string\n\nconst (\n    RegistryEventAdded   RegistryEventType = \"added\"\n    RegistryEventUpdated RegistryEventType = \"updated\"\n    RegistryEventRemoved RegistryEventType = \"removed\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#backendselector-enhancement","title":"BackendSelector Enhancement","text":"<pre><code>// Enhanced backend selection with context\ntype BackendSelectorFunc func(\n    tool toolmodel.Tool,\n    backends []toolmodel.ToolBackend,\n    hints *SelectionHints,\n) toolmodel.ToolBackend\n\n// SelectionHints provides context for backend selection\ntype SelectionHints struct {\n    PreferredKind    toolmodel.BackendKind // Caller preference\n    PreferredBackend string                 // Specific backend name\n    LatencyBudget    time.Duration          // Latency requirement\n    CostSensitive    bool                   // Prefer cheaper backends\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-3-tooldocs-documentation","title":"Layer 3: tooldocs (Documentation)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_2","title":"Current State","text":"<p>Progressive disclosure documentation layer. Three detail levels: summary, schema, full.</p> <p>Exported Types: - <code>Store</code> - Interface for documentation storage - <code>InMemoryStore</code> - Default implementation - <code>DetailLevel</code> - Enum: summary, schema, full - <code>ToolDoc</code> - Documentation at various levels - <code>ToolExample</code> - Usage example - <code>SchemaInfo</code> - Derived schema information - <code>DocEntry</code> - Input for registration</p> <p>Key Methods: - <code>DescribeTool(id, level)</code> - Get documentation at level - <code>ListExamples(id, max)</code> - Get examples - <code>RegisterDoc()</code>, <code>RegisterExamples()</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_2","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-minimal-changes-needed","title":"Priority: LOW (minimal changes needed)","text":"Change Rationale Impact Add <code>BulkRegister()</code> method Backend aggregation may load many docs Minor - additive Add source tracking Track which backend provided docs Minor - structural"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions_1","title":"Proposed Additions","text":"<pre><code>// Store interface additions\ntype Store interface {\n    // Existing methods...\n    DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n    ListExamples(id string, maxExamples int) ([]ToolExample, error)\n\n    // NEW: Bulk operations for backend aggregation\n    BulkRegisterDocs(entries map[string]DocEntry) error\n\n    // NEW: Source tracking\n    GetDocSource(id string) (string, error)  // Returns backend name\n}\n\n// DocEntry - add source field\ntype DocEntry struct {\n    Summary      string\n    Notes        string\n    Examples     []ToolExample\n    ExternalRefs []string\n    Source       string  // NEW: Backend that provided this doc\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-4-toolrun-execution","title":"Layer 4: toolrun (Execution)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_3","title":"Current State","text":"<p>Tool execution layer supporting MCP, Provider, and Local backends.</p> <p>Exported Types: - <code>Runner</code> - Interface for tool execution - <code>DefaultRunner</code> - Default implementation - <code>MCPExecutor</code> - Interface for MCP backend calls - <code>ProviderExecutor</code> - Interface for provider backend calls - <code>LocalRegistry</code> - Interface for local handler lookup - <code>RunResult</code>, <code>StepResult</code>, <code>ChainStep</code> - Execution results - <code>StreamEvent</code> - Streaming event type - <code>ToolError</code> - Contextual error wrapper</p> <p>Key Methods: - <code>Run()</code> - Execute single tool - <code>RunStream()</code> - Execute with streaming - <code>RunChain()</code> - Execute tool sequence</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_3","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-high-core-execution-layer","title":"Priority: HIGH (core execution layer)","text":"Change Rationale Impact Add <code>HTTPExecutor</code> interface Support HTTP backend execution Medium - additive Add <code>GRPCExecutor</code> interface Support gRPC backend execution Medium - additive Add <code>ExecutorRegistry</code> Dynamic executor registration Medium - structural Add execution hooks Middleware integration point Medium - additive Add <code>BackendRouter</code> Route execution to correct executor Medium - structural"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-interface-additions","title":"Proposed Interface Additions","text":"<pre><code>// HTTPExecutor for HTTP backend execution\ntype HTTPExecutor interface {\n    CallTool(ctx context.Context, baseURL string, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, baseURL string, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// GRPCExecutor for gRPC backend execution\ntype GRPCExecutor interface {\n    CallTool(ctx context.Context, address string, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, address string, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// ExecutorRegistry manages execution backends\ntype ExecutorRegistry interface {\n    Register(kind toolmodel.BackendKind, executor any) error\n    Get(kind toolmodel.BackendKind) (any, bool)\n    List() []toolmodel.BackendKind\n}\n\n// ExecutionHook for middleware integration\ntype ExecutionHook interface {\n    BeforeExecution(ctx context.Context, toolID string, args map[string]any) (context.Context, error)\n    AfterExecution(ctx context.Context, toolID string, result RunResult, err error) error\n}\n\n// Config additions\ntype Config struct {\n    // Existing fields...\n    Index            toolindex.Index\n    ToolResolver     func(id string) (*toolmodel.Tool, error)\n    BackendsResolver func(id string) ([]toolmodel.ToolBackend, error)\n    BackendSelector  toolindex.BackendSelector\n    Validator        toolmodel.SchemaValidator\n    ValidateInput    bool\n    ValidateOutput   bool\n    MCP              MCPExecutor\n    Provider         ProviderExecutor\n    Local            LocalRegistry\n\n    // NEW: Additional executors\n    HTTP             HTTPExecutor        // NEW\n    GRPC             GRPCExecutor        // NEW\n    ExecutorRegistry ExecutorRegistry    // NEW: Dynamic registration\n    Hooks            []ExecutionHook     // NEW: Middleware hooks\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#enhanced-runner-interface","title":"Enhanced Runner Interface","text":"<pre><code>// Runner interface with execution options\ntype Runner interface {\n    Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n\n    // NEW: Execution with options\n    RunWithOptions(ctx context.Context, toolID string, args map[string]any, opts RunOptions) (RunResult, error)\n}\n\n// RunOptions for execution customization\ntype RunOptions struct {\n    PreferredBackend string                 // Override backend selection\n    Timeout          time.Duration          // Per-call timeout\n    Metadata         map[string]any         // Pass-through metadata\n    SkipValidation   bool                   // Skip input/output validation\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-5-toolcode-code-execution","title":"Layer 5: toolcode (Code Execution)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_4","title":"Current State","text":"<p>Code execution orchestration layer with pluggable engines.</p> <p>Exported Types: - <code>Executor</code> - Interface for code execution - <code>DefaultExecutor</code> - Default implementation - <code>Engine</code> - Interface for language-specific execution - <code>Tools</code> - Metatool environment exposed to code - <code>Config</code>, <code>ExecuteParams</code>, <code>ExecuteResult</code> - <code>ToolCallRecord</code>, <code>CodeError</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_4","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-stable_1","title":"Priority: LOW (mostly stable)","text":"Change Rationale Impact Add engine registry Support multiple language engines Minor - structural Add execution context Pass middleware context through Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions_2","title":"Proposed Additions","text":"<pre><code>// EngineRegistry for multiple language support\ntype EngineRegistry interface {\n    Register(language string, engine Engine) error\n    Get(language string) (Engine, bool)\n    List() []string\n}\n\n// Config additions\ntype Config struct {\n    // Existing fields...\n    Index           toolindex.Index\n    Docs            tooldocs.Store\n    Run             toolrun.Runner\n    Engine          Engine\n    DefaultTimeout  time.Duration\n    DefaultLanguage string\n    MaxToolCalls    int\n    MaxChainSteps   int\n    Logger          Logger\n\n    // NEW: Multiple engine support\n    EngineRegistry  EngineRegistry  // NEW\n}\n\n// ExecuteParams additions\ntype ExecuteParams struct {\n    Language     string\n    Code         string\n    Timeout      time.Duration\n    MaxToolCalls int\n\n    // NEW: Execution context\n    Metadata     map[string]any  // NEW: Pass-through metadata\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-6-toolsearch-bm25-search","title":"Layer 6: toolsearch (BM25 Search)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_5","title":"Current State","text":"<p>BM25 search implementation using Bleve. Implements <code>toolindex.Searcher</code>.</p> <p>Exported Types: - <code>BM25Config</code> - Configuration (boosts, limits) - <code>BM25Searcher</code> - Searcher implementation</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_5","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-none-stable-well-designed","title":"Priority: NONE (stable, well-designed)","text":"<p>The library already implements the pluggable pattern correctly via <code>toolindex.Searcher</code> interface. No changes needed for the pluggable architecture.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-7-toolruntime-sandbox","title":"Layer 7: toolruntime (Sandbox)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_6","title":"Current State","text":"<p>Runtime and trust boundary layer with multiple isolation backends.</p> <p>Exported Types: - <code>Runtime</code> - Interface for code execution runtime - <code>DefaultRuntime</code> - Default implementation - <code>Backend</code> - Interface for isolation backends - <code>ToolGateway</code> - Tool access interface for sandboxed code - <code>SecurityProfile</code> - dev, standard, hardened - <code>BackendKind</code> - Isolation mechanism (Docker, K8s, gVisor, etc.) - <code>ExecuteRequest</code>, <code>ExecuteResult</code>, <code>Limits</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_6","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-independent","title":"Priority: LOW (mostly independent)","text":"Change Rationale Impact Add security profile config Configure profiles via YAML Minor - additive Add backend discovery Auto-discover available backends Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#cross-cutting-concerns","title":"Cross-Cutting Concerns","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#error-handling-improvements","title":"Error Handling Improvements","text":"<p>All libraries should adopt a consistent error taxonomy:</p> <pre><code>// Proposed: pkg/errors/errors.go (new shared package)\n\n// ToolError is the base error type for all tool operations\ntype ToolError struct {\n    Code       ErrorCode\n    Message    string\n    ToolID     string\n    Backend    string\n    Op         string\n    Cause      error\n    Retryable  bool\n    Metadata   map[string]any\n}\n\ntype ErrorCode string\n\nconst (\n    ErrCodeNotFound       ErrorCode = \"not_found\"\n    ErrCodeValidation     ErrorCode = \"validation\"\n    ErrCodeExecution      ErrorCode = \"execution\"\n    ErrCodeTimeout        ErrorCode = \"timeout\"\n    ErrCodeBackendFailure ErrorCode = \"backend_failure\"\n    ErrCodeRateLimit      ErrorCode = \"rate_limit\"\n    ErrCodeAuth           ErrorCode = \"auth\"\n)\n\nfunc (e *ToolError) Error() string\nfunc (e *ToolError) Unwrap() error\nfunc (e *ToolError) Is(target error) bool\nfunc (e *ToolError) IsRetryable() bool\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#context-propagation","title":"Context Propagation","text":"<p>All libraries should propagate context consistently:</p> <pre><code>// Proposed: Context keys for cross-cutting concerns\ntype contextKey string\n\nconst (\n    ContextKeyRequestID  contextKey = \"request_id\"\n    ContextKeyUserID     contextKey = \"user_id\"\n    ContextKeyTraceID    contextKey = \"trace_id\"\n    ContextKeyBackend    contextKey = \"backend\"\n    ContextKeyMetadata   contextKey = \"metadata\"\n)\n\n// Helper functions\nfunc WithRequestID(ctx context.Context, id string) context.Context\nfunc RequestIDFromContext(ctx context.Context) string\n// ... etc\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#implementation-priority","title":"Implementation Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-1-foundation-with-metatools-mcp-phase-1","title":"Phase 1: Foundation (with metatools-mcp Phase 1)","text":"<ol> <li>toolmodel: Add HTTP/GRPC backend kinds (1 day)</li> <li>toolrun: Add HTTPExecutor, GRPCExecutor interfaces (2 days)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-2-registry-enhancements-with-metatools-mcp-phase-4","title":"Phase 2: Registry Enhancements (with metatools-mcp Phase 4)","text":"<ol> <li>toolindex: Add ListTools, OnChange, source tracking (2 days)</li> <li>toolrun: Add ExecutorRegistry, BackendRouter (2 days)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-3-middleware-integration-with-metatools-mcp-phase-5","title":"Phase 3: Middleware Integration (with metatools-mcp Phase 5)","text":"<ol> <li>toolrun: Add ExecutionHook interface (1 day)</li> <li>All libraries: Consistent error taxonomy (2 days)</li> <li>All libraries: Context propagation (1 day)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#version-compatibility-matrix","title":"Version Compatibility Matrix","text":"<p>Current ecosystem versions:</p> Library Current After Phase 1 After Phase 2 After Phase 3 toolmodel v0.1.2 v0.2.0 v0.2.0 v0.2.0 toolindex v0.1.8 v0.1.8 v0.2.0 v0.2.0 tooldocs v0.1.10 v0.1.10 v0.1.11 v0.1.11 toolrun v0.1.9 v0.2.0 v0.2.0 v0.3.0 toolcode v0.1.10 v0.1.10 v0.1.10 v0.1.11 toolsearch v0.1.9 v0.1.9 v0.1.9 v0.1.9 toolruntime v0.1.10 v0.1.10 v0.1.10 v0.1.11"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#summary-required-library-changes","title":"Summary: Required Library Changes","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#breaking-changes-none","title":"Breaking Changes: NONE","text":"<p>All proposed changes are additive and backward-compatible.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#high-priority-changes","title":"High Priority Changes","text":"Library Change Files Affected toolmodel Add BackendKindHTTP, BackendKindGRPC types.go toolmodel Add HTTPBackend, GRPCBackend structs types.go toolrun Add HTTPExecutor interface executor.go (new) toolrun Add GRPCExecutor interface executor.go (new) toolrun Add ExecutorRegistry registry.go (new)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#medium-priority-changes","title":"Medium Priority Changes","text":"Library Change Files Affected toolindex Add ListTools method index.go toolindex Add OnChange callback index.go toolrun Add ExecutionHook interface hooks.go (new) toolrun Add RunOptions, RunWithOptions runner.go"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#low-priority-changes","title":"Low Priority Changes","text":"Library Change Files Affected tooldocs Add BulkRegisterDocs store.go toolcode Add EngineRegistry engine.go (new) All Consistent error taxonomy errors.go (new per lib)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#key-discovery-architecture-already-pluggable","title":"Key Discovery: Architecture Already Pluggable","text":"<p>Comprehensive analysis of all 8 component libraries (40+ source files, 12,000+ lines) revealed:</p> <p>The metatools ecosystem is NOT a monolith to be refactored. It is a mature, layered, pluggable architecture with 13 extension points already implemented as Go interfaces.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#13-extension-points-catalogued","title":"13 Extension Points Catalogued","text":"# Interface Library Status 1 <code>SchemaValidator</code> toolmodel \u2705 Interface-based 2 <code>Searcher</code> toolindex \u2705 Interface-based 3 <code>BackendSelector</code> toolindex \u2705 Function-based 4 <code>Store</code> tooldocs \u2705 Interface-based 5 <code>ToolResolver</code> tooldocs \u2705 Function-based 6 <code>Runner</code> toolrun \u2705 Interface-based 7 <code>MCPExecutor</code> toolrun \u2705 Interface-based 8 <code>ProviderExecutor</code> toolrun \u2705 Interface-based 9 <code>LocalRegistry</code> toolrun \u2705 Interface-based 10 <code>Backend</code> toolruntime \u2705 Interface-based (10 implementations!) 11 <code>ToolGateway</code> toolruntime \u2705 Interface-based 12 <code>Logger</code> toolcode \u2705 Interface-based 13 <code>Engine</code> toolcode \u2705 Interface-based"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#implications-for-implementation","title":"Implications for Implementation","text":"<p>The \"pluggable architecture\" work is primarily: 1. Exposure - Make internal extension points accessible via configuration 2. Configuration - Add CLI + config layer (Cobra + Koanf) 3. Documentation - Catalog the 13 extension points with examples</p> <p>This reduces the implementation timeline from 9 weeks to 6-7 weeks (25% reduction).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial analysis of all 7 component libraries 2026-01-28 Added Key Discovery section documenting 13 existing extension points 2026-01-28 Updated analysis to reflect that architecture is already pluggable"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/","title":"Pluggable Architecture Implementation Phases","text":"<p>Status: Draft (Revised) Date: 2026-01-28 Related: Pluggable Architecture Proposal, Component Library Analysis</p> <p>Revised Timeline: Architecture discovery revealed that 13 extension points already exist as Go interfaces. The work is primarily configuration and exposure, not architecture redesign. Timeline reduced from 9 weeks to 6-7 weeks (25% reduction).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#overview","title":"Overview","text":"<p>This document breaks the pluggable architecture proposal into manageable implementation phases, following Go best practices and layered architecture principles. Each phase is designed to be:</p> <ul> <li>Independently deliverable - Can be merged and deployed after completion</li> <li>Backward compatible - Existing functionality continues to work</li> <li>Testable - Includes clear verification criteria</li> <li>Incremental - Builds on previous phases</li> </ul> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    REVISED IMPLEMENTATION ROADMAP (6-7 weeks)               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Phase 1 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 2 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 3 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 4          \u2502\n\u2502   CLI + Config       Transport          Public APIs        Backend           \u2502\n\u2502   (Expose 13 pts)    Abstraction        &amp; Documentation    Integration       \u2502\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502   2 weeks    \u2502   \u2502  1-2 weeks   \u2502   \u2502   1 week     \u2502   \u2502   2 weeks    \u2502 \u2502\n\u2502   \u2502              \u2502   \u2502              \u2502   \u2502              \u2502   \u2502              \u2502 \u2502\n\u2502   \u2502 Cobra CLI    \u2502   \u2502 Transport    \u2502   \u2502 Export       \u2502   \u2502 Docker/WASM  \u2502 \u2502\n\u2502   \u2502 Koanf config \u2502   \u2502 Interface    \u2502   \u2502 internal pkg \u2502   \u2502 integration  \u2502 \u2502\n\u2502   \u2502 13 ext points\u2502   \u2502 Stdio + SSE  \u2502   \u2502 13 ext docs  \u2502   \u2502 Backend reg  \u2502 \u2502\n\u2502   \u2502 config schema\u2502   \u2502              \u2502   \u2502 Examples     \u2502   \u2502 config       \u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502   MVP \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502                                    \u2502\n\u2502   (Phases 1-2: ~3-4 weeks)              \u2502                                    \u2502\n\u2502                                                                               \u2502\n\u2502   Note: Original Phase 5 (Middleware) deferred - 13 extension points        \u2502\n\u2502         already provide middleware integration via ExecutionHook             \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-1-cli-framework-configuration-foundation","title":"Phase 1: CLI Framework &amp; Configuration (Foundation)","text":"<p>Duration: ~2 weeks Priority: Critical (foundation for all other phases) Risk: Low (additive changes, no breaking changes)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective","title":"Objective","text":"<p>Introduce Cobra CLI framework and Koanf configuration library while maintaining backward compatibility with current environment variable configuration.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes","title":"Directory Structure Changes","text":"<pre><code>cmd/metatools/\n\u251c\u2500\u2500 main.go              # Entry point (simplified)\n\u251c\u2500\u2500 root.go              # Root command\n\u251c\u2500\u2500 stdio.go             # `metatools stdio` (current behavior)\n\u251c\u2500\u2500 serve.go             # `metatools serve` (HTTP/SSE) - placeholder\n\u251c\u2500\u2500 version.go           # `metatools version`\n\u251c\u2500\u2500 validate.go          # `metatools validate` (config validation)\n\u251c\u2500\u2500 executor_toolruntime.go  # (unchanged)\n\u2514\u2500\u2500 executor_stub.go         # (unchanged)\n\ninternal/\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 env.go           # (unchanged - backward compat)\n\u2502   \u251c\u2500\u2500 loader.go        # NEW: Koanf-based config loader\n\u2502   \u251c\u2500\u2500 schema.go        # NEW: Config struct definitions\n\u2502   \u2514\u2500\u2500 defaults.go      # NEW: Default values\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#11-add-dependencies","title":"1.1 Add Dependencies","text":"<pre><code>// go.mod additions\nrequire (\n    github.com/spf13/cobra v1.8.1\n    github.com/knadh/koanf/v2 v2.1.2\n    github.com/knadh/koanf/parsers/yaml v0.1.0\n    github.com/knadh/koanf/providers/env v1.0.0\n    github.com/knadh/koanf/providers/file v1.1.0\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#12-configuration-schema-internalconfigschemago","title":"1.2 Configuration Schema (<code>internal/config/schema.go</code>)","text":"<pre><code>package config\n\n// ServerConfig is the root configuration structure\ntype ServerConfig struct {\n    Server    ServerSettings    `koanf:\"server\"`\n    Transport TransportConfig   `koanf:\"transport\"`\n    Search    SearchConfig      `koanf:\"search\"`\n    Execution ExecutionConfig   `koanf:\"execution\"`\n    Providers ProvidersConfig   `koanf:\"providers\"`\n    Backends  BackendsConfig    `koanf:\"backends\"`\n    Middleware MiddlewareConfig `koanf:\"middleware\"`\n}\n\ntype ServerSettings struct {\n    Name    string `koanf:\"name\"`\n    Version string `koanf:\"version\"`\n}\n\ntype TransportConfig struct {\n    Type string       `koanf:\"type\"` // stdio, sse, http\n    HTTP HTTPConfig   `koanf:\"http\"`\n}\n\ntype HTTPConfig struct {\n    Host     string        `koanf:\"host\"`\n    Port     int           `koanf:\"port\"`\n    TLS      TLSConfig     `koanf:\"tls\"`\n    Timeouts TimeoutConfig `koanf:\"timeouts\"`\n    CORS     CORSConfig    `koanf:\"cors\"`\n    Health   HealthConfig  `koanf:\"health\"`\n}\n\n// SearchConfig matches current EnvConfig.SearchConfig\ntype SearchConfig struct {\n    Strategy       string `koanf:\"strategy\"`\n    NameBoost      int    `koanf:\"name_boost\"`\n    NamespaceBoost int    `koanf:\"namespace_boost\"`\n    TagsBoost      int    `koanf:\"tags_boost\"`\n    MaxDocs        int    `koanf:\"max_docs\"`\n    MaxDocTextLen  int    `koanf:\"max_doctext_len\"`\n}\n\n// ... (additional config types)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#13-configuration-loader-internalconfigloadergo","title":"1.3 Configuration Loader (<code>internal/config/loader.go</code>)","text":"<pre><code>package config\n\nimport (\n    \"github.com/knadh/koanf/v2\"\n    \"github.com/knadh/koanf/parsers/yaml\"\n    \"github.com/knadh/koanf/providers/env\"\n    \"github.com/knadh/koanf/providers/file\"\n)\n\ntype Loader struct {\n    k *koanf.Koanf\n}\n\n// Load loads configuration with precedence:\n// CLI flags &gt; Environment variables &gt; Config file &gt; Defaults\nfunc (l *Loader) Load(configPath string) (*ServerConfig, error) {\n    l.k = koanf.New(\".\")\n\n    // 1. Load defaults\n    if err := l.loadDefaults(); err != nil {\n        return nil, err\n    }\n\n    // 2. Load config file (if exists)\n    if configPath != \"\" {\n        if err := l.k.Load(file.Provider(configPath), yaml.Parser()); err != nil {\n            return nil, fmt.Errorf(\"loading config file: %w\", err)\n        }\n    }\n\n    // 3. Load environment variables (METATOOLS_ prefix)\n    if err := l.k.Load(env.Provider(\"METATOOLS_\", \".\", func(s string) string {\n        return strings.Replace(strings.ToLower(\n            strings.TrimPrefix(s, \"METATOOLS_\")), \"_\", \".\", -1)\n    }), nil); err != nil {\n        return nil, fmt.Errorf(\"loading env vars: %w\", err)\n    }\n\n    var cfg ServerConfig\n    if err := l.k.Unmarshal(\"\", &amp;cfg); err != nil {\n        return nil, fmt.Errorf(\"unmarshaling config: %w\", err)\n    }\n\n    return &amp;cfg, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#14-cli-root-command-cmdmetatoolsrootgo","title":"1.4 CLI Root Command (<code>cmd/metatools/root.go</code>)","text":"<pre><code>package main\n\nimport (\n    \"os\"\n\n    \"github.com/spf13/cobra\"\n)\n\nvar (\n    cfgFile string\n    verbose bool\n)\n\nvar rootCmd = &amp;cobra.Command{\n    Use:   \"metatools\",\n    Short: \"MCP server for tool discovery and execution\",\n    Long: `metatools-mcp is a Model Context Protocol server that provides\nunified tool discovery, documentation, and execution capabilities.`,\n}\n\nfunc init() {\n    rootCmd.PersistentFlags().StringVarP(&amp;cfgFile, \"config\", \"c\", \"\",\n        \"config file (default: metatools.yaml)\")\n    rootCmd.PersistentFlags().BoolVarP(&amp;verbose, \"verbose\", \"v\", false,\n        \"verbose output\")\n\n    rootCmd.AddCommand(stdioCmd)\n    rootCmd.AddCommand(serveCmd)\n    rootCmd.AddCommand(versionCmd)\n    rootCmd.AddCommand(validateCmd)\n}\n\nfunc Execute() {\n    if err := rootCmd.Execute(); err != nil {\n        os.Exit(1)\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#15-stdio-command-cmdmetatoolsstdiogo","title":"1.5 Stdio Command (<code>cmd/metatools/stdio.go</code>)","text":"<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"os/signal\"\n    \"syscall\"\n\n    \"github.com/spf13/cobra\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\nvar stdioCmd = &amp;cobra.Command{\n    Use:   \"stdio\",\n    Short: \"Run as stdio MCP server (default mode)\",\n    Long:  `Runs the MCP server using stdin/stdout transport for MCP clients like Claude Desktop.`,\n    RunE:  runStdio,\n}\n\nfunc init() {\n    // Set as default command when no subcommand provided\n    rootCmd.Run = stdioCmd.Run\n}\n\nfunc runStdio(cmd *cobra.Command, args []string) error {\n    ctx, cancel := signal.NotifyContext(context.Background(), syscall.SIGINT, syscall.SIGTERM)\n    defer cancel()\n\n    srv, err := createServer()\n    if err != nil {\n        return fmt.Errorf(\"failed to create server: %w\", err)\n    }\n\n    tools := srv.ListTools()\n    log.Printf(\"metatools-mcp server starting with %d tools\", len(tools))\n\n    transport := &amp;mcp.StdioTransport{}\n    if err := srv.Run(ctx, transport); err != nil &amp;&amp; ctx.Err() == nil {\n        return fmt.Errorf(\"server error: %w\", err)\n    }\n\n    log.Println(\"Server stopped\")\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria","title":"Verification Criteria","text":"<ul> <li>[ ] <code>metatools stdio</code> works identically to current behavior</li> <li>[ ] <code>metatools version</code> prints version info</li> <li>[ ] <code>metatools validate -c config.yaml</code> validates configuration files</li> <li>[ ] Existing environment variables (<code>METATOOLS_SEARCH_*</code>) continue to work</li> <li>[ ] New YAML config file loading works</li> <li>[ ] Config precedence: CLI &gt; Env &gt; File &gt; Defaults</li> <li>[ ] All existing tests pass</li> <li>[ ] New unit tests for config loader (&gt;80% coverage)</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#migration-notes","title":"Migration Notes","text":"<ul> <li>No breaking changes</li> <li><code>metatools</code> (no args) defaults to <code>metatools stdio</code></li> <li>Environment variable prefix remains <code>METATOOLS_</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-2-transport-layer-abstraction","title":"Phase 2: Transport Layer Abstraction","text":"<p>Duration: ~2 weeks Priority: High (enables multi-modal deployment) Risk: Medium (touches core server logic) Depends on: Phase 1</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_1","title":"Objective","text":"<p>Abstract the transport layer so the same server logic can run over stdio, SSE, or HTTP.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_1","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 transport/\n\u2502   \u251c\u2500\u2500 transport.go     # NEW: Transport interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Transport registry\n\u2502   \u251c\u2500\u2500 stdio.go         # NEW: Stdio transport wrapper\n\u2502   \u251c\u2500\u2500 sse.go           # NEW: SSE transport\n\u2502   \u2514\u2500\u2500 http.go          # NEW: HTTP transport (optional)\n\u251c\u2500\u2500 server/\n\u2502   \u251c\u2500\u2500 server.go        # MODIFIED: Use Transport interface\n\u2502   \u2514\u2500\u2500 handler.go       # NEW: Shared request handler\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_1","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#21-transport-interface-internaltransporttransportgo","title":"2.1 Transport Interface (<code>internal/transport/transport.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n)\n\n// Transport defines how MCP clients connect to the server\ntype Transport interface {\n    // Name returns the transport identifier\n    Name() string\n\n    // Serve starts the transport and blocks until ctx is cancelled\n    Serve(ctx context.Context, handler RequestHandler) error\n\n    // Close gracefully shuts down the transport\n    Close() error\n\n    // Info returns runtime information about the transport\n    Info() Info\n}\n\n// RequestHandler processes incoming MCP requests\ntype RequestHandler interface {\n    HandleRequest(ctx context.Context, req *Request) (*Response, error)\n}\n\n// Info provides runtime details about a transport\ntype Info struct {\n    Name      string\n    Listening bool\n    Address   string\n    Metadata  map[string]string\n}\n\n// Config holds transport-specific configuration\ntype Config struct {\n    Type      string\n    HTTP      HTTPConfig\n    WebSocket WebSocketConfig\n    GRPC      GRPCConfig\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#22-transport-registry-internaltransportregistrygo","title":"2.2 Transport Registry (<code>internal/transport/registry.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n// Factory creates a configured transport instance\ntype Factory func(cfg Config) (Transport, error)\n\n// Registry manages available transports\ntype Registry struct {\n    mu         sync.RWMutex\n    transports map[string]Factory\n}\n\n// NewRegistry creates a new transport registry with built-in transports\nfunc NewRegistry() *Registry {\n    r := &amp;Registry{\n        transports: make(map[string]Factory),\n    }\n\n    // Register built-in transports\n    r.Register(\"stdio\", NewStdioTransport)\n    r.Register(\"sse\", NewSSETransport)\n    r.Register(\"http\", NewHTTPTransport)\n\n    return r\n}\n\n// Register adds a transport factory\nfunc (r *Registry) Register(name string, factory Factory) {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    r.transports[name] = factory\n}\n\n// Create instantiates a transport from config\nfunc (r *Registry) Create(cfg Config) (Transport, error) {\n    r.mu.RLock()\n    factory, ok := r.transports[cfg.Type]\n    r.mu.RUnlock()\n\n    if !ok {\n        return nil, fmt.Errorf(\"unknown transport type: %s\", cfg.Type)\n    }\n\n    return factory(cfg)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#23-stdio-transport-internaltransportstdiogo","title":"2.3 Stdio Transport (<code>internal/transport/stdio.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// StdioTransport wraps the MCP SDK's stdio transport\ntype StdioTransport struct {\n    sdk *mcp.StdioTransport\n}\n\n// NewStdioTransport creates a stdio transport\nfunc NewStdioTransport(cfg Config) (Transport, error) {\n    return &amp;StdioTransport{\n        sdk: &amp;mcp.StdioTransport{},\n    }, nil\n}\n\nfunc (t *StdioTransport) Name() string { return \"stdio\" }\n\nfunc (t *StdioTransport) Serve(ctx context.Context, handler RequestHandler) error {\n    // Adapt to MCP SDK's transport interface\n    return t.sdk.Run(ctx, adaptHandler(handler))\n}\n\nfunc (t *StdioTransport) Close() error { return nil }\n\nfunc (t *StdioTransport) Info() Info {\n    return Info{\n        Name:      \"stdio\",\n        Listening: true,\n        Address:   \"stdin/stdout\",\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#24-sse-transport-internaltransportssego","title":"2.4 SSE Transport (<code>internal/transport/sse.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// SSETransport implements Server-Sent Events transport\ntype SSETransport struct {\n    cfg      HTTPConfig\n    server   *http.Server\n    handler  RequestHandler\n    mu       sync.RWMutex\n    clients  map[string]chan []byte\n}\n\n// NewSSETransport creates an SSE transport\nfunc NewSSETransport(cfg Config) (Transport, error) {\n    return &amp;SSETransport{\n        cfg:     cfg.HTTP,\n        clients: make(map[string]chan []byte),\n    }, nil\n}\n\nfunc (t *SSETransport) Name() string { return \"sse\" }\n\nfunc (t *SSETransport) Serve(ctx context.Context, handler RequestHandler) error {\n    t.handler = handler\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/mcp\", t.handleMCP)\n    mux.HandleFunc(\"/health\", t.handleHealth)\n    mux.HandleFunc(\"/ready\", t.handleReady)\n\n    addr := fmt.Sprintf(\"%s:%d\", t.cfg.Host, t.cfg.Port)\n    t.server = &amp;http.Server{\n        Addr:         addr,\n        Handler:      t.applyCORS(mux),\n        ReadTimeout:  t.cfg.Timeouts.Read,\n        WriteTimeout: t.cfg.Timeouts.Write,\n        IdleTimeout:  t.cfg.Timeouts.Idle,\n    }\n\n    // Start server in goroutine\n    errCh := make(chan error, 1)\n    go func() {\n        if t.cfg.TLS.Enabled {\n            errCh &lt;- t.server.ListenAndServeTLS(t.cfg.TLS.Cert, t.cfg.TLS.Key)\n        } else {\n            errCh &lt;- t.server.ListenAndServe()\n        }\n    }()\n\n    // Wait for context cancellation or error\n    select {\n    case &lt;-ctx.Done():\n        shutdownCtx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n        defer cancel()\n        return t.server.Shutdown(shutdownCtx)\n    case err := &lt;-errCh:\n        return err\n    }\n}\n\nfunc (t *SSETransport) handleMCP(w http.ResponseWriter, r *http.Request) {\n    if r.Method != http.MethodPost {\n        http.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n        return\n    }\n\n    // Set SSE headers\n    w.Header().Set(\"Content-Type\", \"text/event-stream\")\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    w.Header().Set(\"Connection\", \"keep-alive\")\n\n    // Parse request\n    var req Request\n    if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n        t.sendError(w, \"Invalid request\", http.StatusBadRequest)\n        return\n    }\n\n    // Handle request\n    resp, err := t.handler.HandleRequest(r.Context(), &amp;req)\n    if err != nil {\n        t.sendError(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // Send response as SSE event\n    t.sendEvent(w, \"message\", resp)\n    t.sendEvent(w, \"done\", struct{}{})\n}\n\nfunc (t *SSETransport) sendEvent(w http.ResponseWriter, event string, data any) {\n    jsonData, _ := json.Marshal(data)\n    fmt.Fprintf(w, \"event: %s\\ndata: %s\\n\\n\", event, jsonData)\n    if f, ok := w.(http.Flusher); ok {\n        f.Flush()\n    }\n}\n\n// ... additional helper methods\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#25-server-modifications-internalserverservergo","title":"2.5 Server Modifications (<code>internal/server/server.go</code>)","text":"<pre><code>// Run now accepts our Transport interface\nfunc (s *Server) Run(ctx context.Context, t transport.Transport) error {\n    log.Printf(\"Starting server with %s transport\", t.Name())\n    return t.Serve(ctx, s)\n}\n\n// HandleRequest implements transport.RequestHandler\nfunc (s *Server) HandleRequest(ctx context.Context, req *transport.Request) (*transport.Response, error) {\n    // Delegate to MCP SDK's request handling\n    return s.mcp.HandleRequest(ctx, req)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_1","title":"Verification Criteria","text":"<ul> <li>[ ] <code>metatools stdio</code> works identically to Phase 1</li> <li>[ ] <code>metatools serve --port 8080</code> starts SSE server</li> <li>[ ] SSE endpoint accepts POST requests at <code>/mcp</code></li> <li>[ ] Health check endpoints work (<code>/health</code>, <code>/ready</code>)</li> <li>[ ] CORS headers applied correctly</li> <li>[ ] Graceful shutdown on SIGTERM</li> <li>[ ] TLS works when configured</li> <li>[ ] Integration tests for SSE transport</li> <li>[ ] Load test: 100 concurrent SSE connections</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#cli-changes","title":"CLI Changes","text":"<pre><code># New serve command\nmetatools serve [flags]\n\nFlags:\n  --port int          HTTP port (default 8080)\n  --host string       Bind address (default \"0.0.0.0\")\n  --tls               Enable TLS\n  --cert string       TLS certificate path\n  --key string        TLS key path\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-3-tool-provider-registry","title":"Phase 3: Tool Provider Registry","text":"<p>Duration: ~1 week Priority: High (enables plug-and-play tools) Risk: Medium (refactors core registration logic) Depends on: Phase 1</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_2","title":"Objective","text":"<p>Replace hardcoded tool registration with a registry pattern that allows dynamic tool registration.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_2","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 provider/\n\u2502   \u251c\u2500\u2500 provider.go      # NEW: ToolProvider interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Tool registry\n\u2502   \u251c\u2500\u2500 search.go        # NEW: search_tools provider\n\u2502   \u251c\u2500\u2500 describe.go      # NEW: describe_tool provider\n\u2502   \u251c\u2500\u2500 run.go           # NEW: run_tool provider\n\u2502   \u251c\u2500\u2500 chain.go         # NEW: run_chain provider\n\u2502   \u251c\u2500\u2500 namespaces.go    # NEW: list_namespaces provider\n\u2502   \u251c\u2500\u2500 examples.go      # NEW: list_tool_examples provider\n\u2502   \u2514\u2500\u2500 code.go          # NEW: execute_code provider (optional)\n\u251c\u2500\u2500 server/\n\u2502   \u2514\u2500\u2500 server.go        # MODIFIED: Use provider registry\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_2","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#31-tool-provider-interface-internalproviderprovidergo","title":"3.1 Tool Provider Interface (<code>internal/provider/provider.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"context\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// ToolProvider defines a pluggable MCP tool\ntype ToolProvider interface {\n    // Name returns the tool name (e.g., \"search_tools\")\n    Name() string\n\n    // Tool returns the MCP tool definition with JSON schema\n    Tool() *mcp.Tool\n\n    // Handle executes the tool with the given input\n    Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error)\n}\n\n// Option configures a tool provider\ntype Option func(ToolProvider)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#32-tool-registry-internalproviderregistrygo","title":"3.2 Tool Registry (<code>internal/provider/registry.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// Registry manages registered tool providers\ntype Registry struct {\n    mu        sync.RWMutex\n    providers map[string]ToolProvider\n    order     []string // Maintains registration order\n}\n\n// NewRegistry creates a new tool provider registry\nfunc NewRegistry() *Registry {\n    return &amp;Registry{\n        providers: make(map[string]ToolProvider),\n        order:     make([]string, 0),\n    }\n}\n\n// Register adds a tool provider\nfunc (r *Registry) Register(p ToolProvider) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    name := p.Name()\n    if _, exists := r.providers[name]; exists {\n        return fmt.Errorf(\"provider already registered: %s\", name)\n    }\n\n    r.providers[name] = p\n    r.order = append(r.order, name)\n    return nil\n}\n\n// Get retrieves a provider by name\nfunc (r *Registry) Get(name string) (ToolProvider, bool) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n    p, ok := r.providers[name]\n    return p, ok\n}\n\n// All returns all registered providers in registration order\nfunc (r *Registry) All() []ToolProvider {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    result := make([]ToolProvider, 0, len(r.order))\n    for _, name := range r.order {\n        result = append(result, r.providers[name])\n    }\n    return result\n}\n\n// Tools returns MCP tool definitions for all providers\nfunc (r *Registry) Tools() []*mcp.Tool {\n    providers := r.All()\n    tools := make([]*mcp.Tool, 0, len(providers))\n    for _, p := range providers {\n        tools = append(tools, p.Tool())\n    }\n    return tools\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#33-example-provider-internalprovidersearchgo","title":"3.3 Example Provider (<code>internal/provider/search.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/handlers\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// SearchProvider implements the search_tools tool\ntype SearchProvider struct {\n    handler *handlers.SearchHandler\n}\n\n// NewSearchProvider creates a search_tools provider\nfunc NewSearchProvider(h *handlers.SearchHandler) *SearchProvider {\n    return &amp;SearchProvider{handler: h}\n}\n\nfunc (p *SearchProvider) Name() string { return \"search_tools\" }\n\nfunc (p *SearchProvider) Tool() *mcp.Tool {\n    return &amp;mcp.Tool{\n        Name:        \"search_tools\",\n        Description: \"Search for tools by query string. Returns ranked list of matching tools.\",\n        InputSchema: mcp.ToolInputSchema{\n            Type: \"object\",\n            Properties: map[string]any{\n                \"query\": map[string]any{\n                    \"type\":        \"string\",\n                    \"description\": \"Search query to find relevant tools\",\n                },\n                \"limit\": map[string]any{\n                    \"type\":        \"integer\",\n                    \"description\": \"Maximum number of results (default 10)\",\n                    \"default\":     10,\n                },\n            },\n            Required: []string{\"query\"},\n        },\n    }\n}\n\nfunc (p *SearchProvider) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    query, _ := input[\"query\"].(string)\n    limit := 10\n    if l, ok := input[\"limit\"].(float64); ok {\n        limit = int(l)\n    }\n\n    return p.handler.Handle(ctx, query, limit)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#34-server-integration","title":"3.4 Server Integration","text":"<pre><code>// internal/server/server.go\n\nfunc New(cfg config.Config, registry *provider.Registry) (*Server, error) {\n    // ... existing validation\n\n    mcpServer := mcp.NewServer(&amp;mcp.Implementation{\n        Name:    implementationName,\n        Version: implementationVersion,\n    }, &amp;mcp.ServerOptions{\n        PageSize: defaultPageSize,\n    })\n\n    srv := &amp;Server{\n        config:   cfg,\n        mcp:      mcpServer,\n        registry: registry,\n    }\n\n    // Register tools from provider registry\n    for _, p := range registry.All() {\n        srv.registerProvider(p)\n    }\n\n    return srv, nil\n}\n\nfunc (s *Server) registerProvider(p provider.ToolProvider) {\n    tool := p.Tool()\n    s.tools = append(s.tools, tool)\n\n    s.mcp.AddTool(tool, func(ctx context.Context, req *mcp.CallToolRequest) (*mcp.CallToolResult, error) {\n        return p.Handle(ctx, req.Params.Arguments)\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_2","title":"Verification Criteria","text":"<ul> <li>[ ] All existing tools work via provider registry</li> <li>[ ] Provider registration order matches tool list order</li> <li>[ ] Custom providers can be registered programmatically</li> <li>[ ] Unit tests for registry (&gt;90% coverage)</li> <li>[ ] Benchmark: Registration of 100 providers &lt; 1ms</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-4-backend-registry","title":"Phase 4: Backend Registry","text":"<p>Duration: ~2 weeks Priority: Medium (enables multi-source tool aggregation) Risk: Medium (new subsystem) Depends on: Phase 3</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_3","title":"Objective","text":"<p>Implement a backend registry that aggregates tools from multiple sources (local, MCP servers, HTTP APIs).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_3","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 backend/\n\u2502   \u251c\u2500\u2500 backend.go       # NEW: Backend interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Backend registry\n\u2502   \u251c\u2500\u2500 local.go         # NEW: Local file backend\n\u2502   \u251c\u2500\u2500 mcp.go           # NEW: MCP subprocess backend\n\u2502   \u251c\u2500\u2500 http.go          # NEW: HTTP API backend\n\u2502   \u251c\u2500\u2500 aggregator.go    # NEW: Tool aggregation logic\n\u2502   \u2514\u2500\u2500 errors.go        # NEW: Backend-specific errors\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_3","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#41-backend-interface-internalbackendbackendgo","title":"4.1 Backend Interface (<code>internal/backend/backend.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/toolmodel\"\n)\n\n// Backend defines a source of tools\ntype Backend interface {\n    // Identity\n    Kind() string  // e.g., \"local\", \"mcp\", \"http\"\n    Name() string  // Instance name\n\n    // Lifecycle\n    Start(ctx context.Context) error\n    Stop() error\n\n    // Discovery\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n\n    // Execution\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Configurable backends support dynamic configuration\ntype Configurable interface {\n    Configure(raw []byte) error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#42-backend-registry-internalbackendregistrygo","title":"4.2 Backend Registry (<code>internal/backend/registry.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"sync\"\n)\n\n// Registry manages backend instances\ntype Registry struct {\n    mu       sync.RWMutex\n    backends map[string]Backend\n    order    []string\n}\n\n// NewRegistry creates a backend registry\nfunc NewRegistry() *Registry {\n    return &amp;Registry{\n        backends: make(map[string]Backend),\n        order:    make([]string, 0),\n    }\n}\n\n// Register adds a backend\nfunc (r *Registry) Register(name string, b Backend) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    if _, exists := r.backends[name]; exists {\n        return fmt.Errorf(\"backend already registered: %s\", name)\n    }\n\n    r.backends[name] = b\n    r.order = append(r.order, name)\n    return nil\n}\n\n// StartAll starts all registered backends\nfunc (r *Registry) StartAll(ctx context.Context) error {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    for name, b := range r.backends {\n        if err := b.Start(ctx); err != nil {\n            return fmt.Errorf(\"starting backend %s: %w\", name, err)\n        }\n    }\n    return nil\n}\n\n// StopAll stops all registered backends\nfunc (r *Registry) StopAll() error {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    var errs []error\n    for name, b := range r.backends {\n        if err := b.Stop(); err != nil {\n            errs = append(errs, fmt.Errorf(\"stopping backend %s: %w\", name, err))\n        }\n    }\n\n    if len(errs) &gt; 0 {\n        return fmt.Errorf(\"errors stopping backends: %v\", errs)\n    }\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#43-mcp-backend-internalbackendmcpgo","title":"4.3 MCP Backend (<code>internal/backend/mcp.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n    \"os/exec\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// MCPBackend connects to an MCP subprocess\ntype MCPBackend struct {\n    name    string\n    command string\n    args    []string\n    env     map[string]string\n\n    cmd    *exec.Cmd\n    client *mcp.Client\n}\n\n// NewMCPBackend creates an MCP subprocess backend\nfunc NewMCPBackend(name, command string, args []string, env map[string]string) *MCPBackend {\n    return &amp;MCPBackend{\n        name:    name,\n        command: command,\n        args:    args,\n        env:     env,\n    }\n}\n\nfunc (b *MCPBackend) Kind() string { return \"mcp\" }\nfunc (b *MCPBackend) Name() string { return b.name }\n\nfunc (b *MCPBackend) Start(ctx context.Context) error {\n    // Start subprocess and establish MCP connection\n    // ... implementation\n}\n\nfunc (b *MCPBackend) ListTools(ctx context.Context) ([]toolmodel.Tool, error) {\n    resp, err := b.client.ListTools(ctx)\n    if err != nil {\n        return nil, err\n    }\n\n    // Convert MCP tools to toolmodel.Tool\n    tools := make([]toolmodel.Tool, 0, len(resp.Tools))\n    for _, t := range resp.Tools {\n        tools = append(tools, convertMCPTool(t, b.name))\n    }\n    return tools, nil\n}\n\nfunc (b *MCPBackend) Execute(ctx context.Context, tool string, args map[string]any) (any, error) {\n    return b.client.CallTool(ctx, tool, args)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_3","title":"Verification Criteria","text":"<ul> <li>[ ] Local backend loads tools from file paths</li> <li>[ ] MCP backend spawns subprocess and communicates via stdio</li> <li>[ ] HTTP backend calls remote API endpoints</li> <li>[ ] Tool aggregation merges tools from all backends</li> <li>[ ] Backend failures don't crash the server (graceful degradation)</li> <li>[ ] Integration tests for each backend type</li> <li>[ ] E2E test: GitHub MCP server integration</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-5-middleware-chain","title":"Phase 5: Middleware Chain","text":"<p>Duration: ~2 weeks Priority: Low (nice-to-have for MVP) Risk: Low (additive feature) Depends on: Phase 3</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_4","title":"Objective","text":"<p>Implement a middleware chain for cross-cutting concerns (logging, auth, rate limiting, metrics).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_4","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 middleware/\n\u2502   \u251c\u2500\u2500 middleware.go    # NEW: Middleware interface\n\u2502   \u251c\u2500\u2500 chain.go         # NEW: Middleware chain builder\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Middleware registry\n\u2502   \u251c\u2500\u2500 logging.go       # NEW: Logging middleware\n\u2502   \u251c\u2500\u2500 auth.go          # NEW: Auth middleware\n\u2502   \u251c\u2500\u2500 ratelimit.go     # NEW: Rate limiting middleware\n\u2502   \u251c\u2500\u2500 metrics.go       # NEW: Metrics middleware\n\u2502   \u251c\u2500\u2500 cache.go         # NEW: Caching middleware\n\u2502   \u2514\u2500\u2500 validation.go    # NEW: Input validation middleware\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_4","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#51-middleware-interface-internalmiddlewaremiddlewarego","title":"5.1 Middleware Interface (<code>internal/middleware/middleware.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n)\n\n// Middleware wraps a ToolProvider with additional behavior\ntype Middleware func(provider.ToolProvider) provider.ToolProvider\n\n// Factory creates a configured middleware instance\ntype Factory func(cfg Config) (Middleware, error)\n\n// Config holds middleware-specific configuration\ntype Config struct {\n    Name    string\n    Enabled bool\n    Raw     map[string]any\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#52-middleware-chain-internalmiddlewarechaingo","title":"5.2 Middleware Chain (<code>internal/middleware/chain.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n)\n\n// Chain applies middleware to providers in order\nfunc Chain(middlewares []Middleware, p provider.ToolProvider) provider.ToolProvider {\n    if len(middlewares) == 0 {\n        return p\n    }\n\n    // Apply in reverse order so first middleware wraps outermost\n    wrapped := p\n    for i := len(middlewares) - 1; i &gt;= 0; i-- {\n        wrapped = middlewares[i](wrapped)\n    }\n    return wrapped\n}\n\n// ApplyToRegistry wraps all providers in a registry with middleware\nfunc ApplyToRegistry(registry *provider.Registry, middlewares []Middleware) {\n    for _, p := range registry.All() {\n        wrapped := Chain(middlewares, p)\n        // Replace in registry\n        // ...\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#53-logging-middleware-internalmiddlewarelogginggo","title":"5.3 Logging Middleware (<code>internal/middleware/logging.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"context\"\n    \"log/slog\"\n    \"time\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntype loggingMiddleware struct {\n    next   provider.ToolProvider\n    logger *slog.Logger\n    level  slog.Level\n}\n\n// NewLoggingMiddleware creates a logging middleware\nfunc NewLoggingMiddleware(logger *slog.Logger, level slog.Level) Middleware {\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;loggingMiddleware{\n            next:   next,\n            logger: logger,\n            level:  level,\n        }\n    }\n}\n\nfunc (m *loggingMiddleware) Name() string        { return m.next.Name() }\nfunc (m *loggingMiddleware) Tool() *mcp.Tool     { return m.next.Tool() }\n\nfunc (m *loggingMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    start := time.Now()\n\n    m.logger.Log(ctx, m.level, \"tool call started\",\n        \"tool\", m.next.Name(),\n        \"input\", input,\n    )\n\n    result, err := m.next.Handle(ctx, input)\n\n    m.logger.Log(ctx, m.level, \"tool call completed\",\n        \"tool\", m.next.Name(),\n        \"duration\", time.Since(start),\n        \"error\", err,\n    )\n\n    return result, err\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_4","title":"Verification Criteria","text":"<ul> <li>[ ] Logging middleware logs all tool calls</li> <li>[ ] Auth middleware validates tokens when configured</li> <li>[ ] Rate limiting middleware enforces limits</li> <li>[ ] Metrics middleware exposes Prometheus metrics</li> <li>[ ] Middleware chain order matches config order</li> <li>[ ] Unit tests for each middleware type</li> <li>[ ] Integration test: Full middleware chain</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#summary-implementation-priority-matrix","title":"Summary: Implementation Priority Matrix","text":"Phase Priority Risk Duration MVP? Phase 1: CLI + Config Critical Low 2 weeks \u2713 Phase 2: Transport High Medium 2 weeks \u2713 Phase 3: Tool Provider Registry High Medium 1 week \u2713 Phase 4: Backend Registry Medium Medium 2 weeks Phase 5: Middleware Chain Low Low 2 weeks <p>MVP Timeline: ~5 weeks (Phases 1-3) Full Implementation: ~9 weeks (All phases)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#appendix-architectural-decisions","title":"Appendix: Architectural Decisions","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-1-koanf-over-viper","title":"Decision 1: Koanf over Viper","text":"<p>Decision: Use Koanf for configuration loading instead of Viper.</p> <p>Rationale: - Lighter dependency footprint - Modular provider architecture - Cleaner API for layered configuration - Better suited for our use case</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-2-interface-based-transports-over-mcp-sdk-extension","title":"Decision 2: Interface-based Transports over MCP SDK Extension","text":"<p>Decision: Define our own Transport interface that wraps MCP SDK transports.</p> <p>Rationale: - Decouples from MCP SDK implementation details - Enables custom transports (Unix socket, gRPC) - Allows consistent lifecycle management - Facilitates testing with mock transports</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-3-provider-pattern-over-direct-handler-registration","title":"Decision 3: Provider Pattern over Direct Handler Registration","text":"<p>Decision: Use ToolProvider interface instead of direct MCP tool registration.</p> <p>Rationale: - Enables middleware wrapping - Supports dynamic registration - Cleaner separation of concerns - Facilitates testing</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-4-decorator-pattern-for-middleware","title":"Decision 4: Decorator Pattern for Middleware","text":"<p>Decision: Use decorator pattern (wrapping) for middleware chain.</p> <p>Rationale: - Matches go-chi's proven approach - Simple mental model - Easy to compose and test - Preserves ToolProvider interface</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial draft with 5 phases"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/","title":"Multi-Tenancy Extension for Pluggable Architecture","text":"<p>Status: Draft Date: 2026-01-28 Related: Pluggable Architecture Proposal</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#overview","title":"Overview","text":"<p>This document extends the pluggable architecture to support multi-tenancy in a flexible, pluggable way. The design allows different tenant isolation strategies without hardcoding any specific approach.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenancy-architecture","title":"Multi-Tenancy Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#design-principles","title":"Design Principles","text":"<ol> <li>Pluggable Tenant Resolution - How tenants are identified (JWT, API key, header, etc.)</li> <li>Pluggable Isolation Strategy - Level of isolation between tenants</li> <li>Tenant-Aware Middleware - All middleware can access tenant context</li> <li>Tenant-Specific Configuration - Override any config per tenant</li> <li>Backward Compatible - Single-tenant mode works without changes</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       MULTI-TENANT MCP SERVER                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Incoming Request                                                           \u2502\n\u2502         \u2502                                                                     \u2502\n\u2502         \u25bc                                                                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT RESOLUTION MIDDLEWARE                      \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502    JWT      \u2502 \u2502   API Key   \u2502 \u2502   Header    \u2502 \u2502   Custom    \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502  Resolver   \u2502 \u2502  Resolver   \u2502 \u2502  Resolver   \u2502 \u2502  Resolver   \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Output: Tenant Context injected into request context               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                             \u2502                                                \u2502\n\u2502                             \u25bc                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT-AWARE MIDDLEWARE CHAIN                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502   \u2502   \u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502 Scoped   \u2502 \u2502 Rate     \u2502 \u2502 Audit    \u2502 \u2502 Tool     \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502 Config   \u2502 \u2502 Limits   \u2502 \u2502 Logging  \u2502 \u2502 Filter   \u2502               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                             \u2502                                                \u2502\n\u2502                             \u25bc                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT-SCOPED REGISTRIES                          \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502   \u2502\n\u2502   \u2502   \u2502  Shared Registry \u2502    \u2502  Tenant Registry \u2502                      \u2502   \u2502\n\u2502   \u2502   \u2502  (all tenants)   \u2502    \u2502  (tenant-only)   \u2502                      \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Tool visibility = Shared \u222a Tenant-specific - Denied               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#core-interfaces","title":"Core Interfaces","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-model","title":"Tenant Model","text":"<pre><code>// Tenant represents a tenant in the system\ntype Tenant struct {\n    ID          string            // Unique tenant identifier\n    Name        string            // Human-readable name\n    Tier        TenantTier        // free, pro, enterprise\n    Metadata    map[string]any    // Arbitrary tenant metadata\n    CreatedAt   time.Time\n    UpdatedAt   time.Time\n}\n\n// TenantTier defines service levels\ntype TenantTier string\n\nconst (\n    TenantTierFree       TenantTier = \"free\"\n    TenantTierPro        TenantTier = \"pro\"\n    TenantTierEnterprise TenantTier = \"enterprise\"\n)\n\n// TenantContext holds runtime tenant information\ntype TenantContext struct {\n    Tenant      *Tenant\n    Permissions []string          // Resolved permissions\n    Config      *TenantConfig     // Tenant-specific config overrides\n    Quotas      *TenantQuotas     // Current quota state\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-resolver-interface","title":"Tenant Resolver Interface","text":"<pre><code>// TenantResolver identifies the tenant from a request\ntype TenantResolver interface {\n    // Resolve extracts tenant information from the request context\n    // Returns nil tenant for anonymous/default tenant\n    Resolve(ctx context.Context, req *Request) (*TenantContext, error)\n}\n\n// TenantResolverFunc is a convenience type\ntype TenantResolverFunc func(ctx context.Context, req *Request) (*TenantContext, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#built-in-resolvers","title":"Built-in Resolvers","text":"<pre><code>// JWTTenantResolver extracts tenant from JWT claims\ntype JWTTenantResolver struct {\n    ClaimKey    string                    // JWT claim containing tenant ID\n    TenantStore TenantStore               // Lookup tenant details\n    Validator   JWTValidator              // Validate JWT\n}\n\nfunc (r *JWTTenantResolver) Resolve(ctx context.Context, req *Request) (*TenantContext, error) {\n    token := extractBearerToken(req)\n    claims, err := r.Validator.Validate(token)\n    if err != nil {\n        return nil, err\n    }\n\n    tenantID, ok := claims[r.ClaimKey].(string)\n    if !ok {\n        return nil, ErrNoTenantClaim\n    }\n\n    tenant, err := r.TenantStore.Get(ctx, tenantID)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;TenantContext{\n        Tenant:      tenant,\n        Permissions: extractPermissions(claims),\n        Config:      r.TenantStore.GetConfig(ctx, tenantID),\n    }, nil\n}\n\n// APIKeyTenantResolver extracts tenant from API key\ntype APIKeyTenantResolver struct {\n    HeaderName  string       // Header containing API key\n    KeyStore    APIKeyStore  // Lookup key -&gt; tenant mapping\n}\n\n// HeaderTenantResolver extracts tenant from a header\ntype HeaderTenantResolver struct {\n    HeaderName  string\n    TenantStore TenantStore\n}\n\n// CompositeTenantResolver tries multiple resolvers in order\ntype CompositeTenantResolver struct {\n    Resolvers []TenantResolver\n}\n\nfunc (r *CompositeTenantResolver) Resolve(ctx context.Context, req *Request) (*TenantContext, error) {\n    for _, resolver := range r.Resolvers {\n        tc, err := resolver.Resolve(ctx, req)\n        if err == nil &amp;&amp; tc != nil {\n            return tc, nil\n        }\n    }\n    return nil, ErrNoTenantResolved\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-configuration","title":"Tenant Configuration","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-specific-config-overrides","title":"Tenant-Specific Config Overrides","text":"<pre><code>// TenantConfig holds per-tenant configuration overrides\ntype TenantConfig struct {\n    // Tool access control\n    AllowedTools     []string          // Whitelist (empty = all allowed)\n    DeniedTools      []string          // Blacklist (takes precedence)\n    AllowedBackends  []string          // Which backends tenant can use\n    DeniedBackends   []string          // Blacklisted backends\n\n    // Resource limits\n    RateLimits       *RateLimitConfig  // Override rate limits\n    Quotas           *QuotaConfig      // Usage quotas\n\n    // Feature flags\n    Features         map[string]bool   // Feature toggles\n\n    // Execution\n    MaxTimeout       time.Duration     // Max allowed timeout\n    MaxChainSteps    int               // Max chain steps\n    MaxToolCalls     int               // Max tool calls per request\n\n    // Custom middleware config\n    MiddlewareConfig map[string]any    // Per-middleware overrides\n}\n\n// QuotaConfig defines usage quotas\ntype QuotaConfig struct {\n    DailyRequests    int64             // Requests per day\n    DailyToolCalls   int64             // Tool calls per day\n    MonthlyRequests  int64             // Requests per month\n    MonthlyToolCalls int64             // Tool calls per month\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<pre><code># metatools.yaml - Multi-tenant configuration\n\ntenancy:\n  enabled: true\n\n  # Tenant resolution strategy\n  resolver:\n    type: composite\n    resolvers:\n      - type: jwt\n        claim_key: tenant_id\n        issuer: https://auth.example.com\n      - type: api_key\n        header: X-API-Key\n      - type: header\n        header: X-Tenant-ID\n\n  # Default tenant (anonymous requests)\n  default_tenant:\n    id: default\n    tier: free\n    config:\n      rate_limits:\n        requests_per_minute: 10\n      allowed_tools:\n        - search_tools\n        - describe_tool\n      denied_tools:\n        - execute_code\n\n  # Tier-based defaults\n  tiers:\n    free:\n      rate_limits:\n        requests_per_minute: 60\n        burst: 10\n      quotas:\n        daily_requests: 1000\n        monthly_requests: 10000\n      denied_tools:\n        - execute_code\n      max_chain_steps: 3\n\n    pro:\n      rate_limits:\n        requests_per_minute: 300\n        burst: 50\n      quotas:\n        daily_requests: 10000\n        monthly_requests: 100000\n      max_chain_steps: 10\n\n    enterprise:\n      rate_limits:\n        requests_per_minute: 1000\n        burst: 200\n      quotas:\n        daily_requests: -1  # unlimited\n        monthly_requests: -1\n      max_chain_steps: 50\n      features:\n        custom_backends: true\n        audit_logging: true\n\n# Per-tenant overrides (loaded from store or config)\ntenants:\n  acme-corp:\n    tier: enterprise\n    config:\n      allowed_backends:\n        - local\n        - github\n        - jira\n      features:\n        execute_code: true\n      middleware_config:\n        audit:\n          destination: elasticsearch\n          index: acme-audit\n\n  startup-xyz:\n    tier: pro\n    config:\n      rate_limits:\n        requests_per_minute: 500  # Override pro default\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-aware-middleware","title":"Tenant-Aware Middleware","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-context-middleware","title":"Tenant Context Middleware","text":"<pre><code>// TenantMiddleware resolves and injects tenant context\nfunc TenantMiddleware(resolver TenantResolver) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        return &amp;tenantMiddleware{\n            resolver: resolver,\n            next:     next,\n        }\n    }\n}\n\ntype tenantMiddleware struct {\n    resolver TenantResolver\n    next     ToolProvider\n}\n\nfunc (m *tenantMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    // Resolve tenant from context (set by transport layer)\n    req := RequestFromContext(ctx)\n    tc, err := m.resolver.Resolve(ctx, req)\n    if err != nil {\n        return nil, &amp;TenantError{Op: \"resolve\", Err: err}\n    }\n\n    // Inject tenant context\n    ctx = WithTenantContext(ctx, tc)\n\n    return m.next.Handle(ctx, input)\n}\n\n// Context helpers\nfunc WithTenantContext(ctx context.Context, tc *TenantContext) context.Context\nfunc TenantFromContext(ctx context.Context) *TenantContext\nfunc TenantIDFromContext(ctx context.Context) string\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-aware-rate-limiting","title":"Tenant-Aware Rate Limiting","text":"<pre><code>// TenantRateLimitMiddleware applies per-tenant rate limits\ntype TenantRateLimitMiddleware struct {\n    store    RateLimitStore\n    defaults RateLimitConfig\n    next     ToolProvider\n}\n\nfunc (m *TenantRateLimitMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n\n    // Get tenant-specific limits or tier defaults\n    limits := m.resolveLimits(tc)\n\n    // Check rate limit\n    key := fmt.Sprintf(\"tenant:%s:tool:%s\", tc.Tenant.ID, m.next.Name())\n    allowed, err := m.store.Allow(ctx, key, limits)\n    if err != nil {\n        return nil, err\n    }\n    if !allowed {\n        return nil, &amp;RateLimitError{\n            TenantID: tc.Tenant.ID,\n            Limit:    limits.RequestsPerMinute,\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-tool-filter","title":"Tenant Tool Filter","text":"<pre><code>// TenantToolFilterMiddleware filters tools based on tenant permissions\ntype TenantToolFilterMiddleware struct {\n    next ToolProvider\n}\n\nfunc (m *TenantToolFilterMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n    toolName := m.next.Name()\n\n    // Check denied tools first (takes precedence)\n    if slices.Contains(tc.Config.DeniedTools, toolName) {\n        return nil, &amp;ToolDeniedError{\n            TenantID: tc.Tenant.ID,\n            Tool:     toolName,\n            Reason:   \"tool denied for tenant\",\n        }\n    }\n\n    // Check allowed tools (if whitelist is non-empty)\n    if len(tc.Config.AllowedTools) &gt; 0 {\n        if !slices.Contains(tc.Config.AllowedTools, toolName) {\n            return nil, &amp;ToolDeniedError{\n                TenantID: tc.Tenant.ID,\n                Tool:     toolName,\n                Reason:   \"tool not in allowed list\",\n            }\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-audit-middleware","title":"Tenant Audit Middleware","text":"<pre><code>// TenantAuditMiddleware logs all actions with tenant context\ntype TenantAuditMiddleware struct {\n    logger AuditLogger\n    next   ToolProvider\n}\n\nfunc (m *TenantAuditMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n    start := time.Now()\n\n    result, err := m.next.Handle(ctx, input)\n\n    m.logger.Log(AuditEntry{\n        Timestamp:  time.Now(),\n        TenantID:   tc.Tenant.ID,\n        TenantTier: string(tc.Tenant.Tier),\n        Tool:       m.next.Name(),\n        Input:      input,\n        Success:    err == nil,\n        Duration:   time.Since(start),\n        RequestID:  RequestIDFromContext(ctx),\n        UserID:     UserIDFromContext(ctx),\n    })\n\n    return result, err\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-scoped-registries","title":"Tenant-Scoped Registries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenant-tool-registry","title":"Multi-Tenant Tool Registry","text":"<pre><code>// MultiTenantRegistry wraps a base registry with tenant scoping\ntype MultiTenantRegistry struct {\n    shared        *provider.Registry  // Shared tools (all tenants)\n    tenantTools   map[string]*provider.Registry  // Tenant-specific tools\n    tenantStore   TenantStore\n    mu            sync.RWMutex\n}\n\n// GetForTenant returns a tenant-scoped view of the registry\nfunc (r *MultiTenantRegistry) GetForTenant(tenantID string) *TenantScopedRegistry {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    tenant, _ := r.tenantStore.Get(context.Background(), tenantID)\n    tenantReg := r.tenantTools[tenantID]\n\n    return &amp;TenantScopedRegistry{\n        tenant:   tenant,\n        shared:   r.shared,\n        specific: tenantReg,\n    }\n}\n\n// TenantScopedRegistry provides a tenant's view of available tools\ntype TenantScopedRegistry struct {\n    tenant   *Tenant\n    shared   *provider.Registry\n    specific *provider.Registry\n}\n\n// All returns all tools visible to the tenant\nfunc (r *TenantScopedRegistry) All() []provider.ToolProvider {\n    var result []provider.ToolProvider\n\n    // Add shared tools (filtered by tenant config)\n    for _, p := range r.shared.All() {\n        if r.isToolAllowed(p.Name()) {\n            result = append(result, p)\n        }\n    }\n\n    // Add tenant-specific tools\n    if r.specific != nil {\n        result = append(result, r.specific.All()...)\n    }\n\n    return result\n}\n\nfunc (r *TenantScopedRegistry) isToolAllowed(name string) bool {\n    if r.tenant == nil || r.tenant.Config == nil {\n        return true\n    }\n\n    cfg := r.tenant.Config\n\n    // Check denied list first\n    if slices.Contains(cfg.DeniedTools, name) {\n        return false\n    }\n\n    // Check allowed list (if specified)\n    if len(cfg.AllowedTools) &gt; 0 {\n        return slices.Contains(cfg.AllowedTools, name)\n    }\n\n    return true\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenant-backend-registry","title":"Multi-Tenant Backend Registry","text":"<pre><code>// MultiTenantBackendRegistry manages tenant-scoped backends\ntype MultiTenantBackendRegistry struct {\n    shared        *backend.Registry\n    tenantBackends map[string]*backend.Registry\n    mu            sync.RWMutex\n}\n\n// GetForTenant returns backends available to a tenant\nfunc (r *MultiTenantBackendRegistry) GetForTenant(ctx context.Context, tenantID string) *TenantScopedBackendRegistry {\n    tc := TenantFromContext(ctx)\n\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    return &amp;TenantScopedBackendRegistry{\n        tenant:   tc,\n        shared:   r.shared,\n        specific: r.tenantBackends[tenantID],\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#isolation-strategies","title":"Isolation Strategies","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-1-shared-infrastructure-default","title":"Strategy 1: Shared Infrastructure (Default)","text":"<p>All tenants share the same server instance with logical isolation via middleware.</p> <pre><code>tenancy:\n  isolation: shared\n  # All tenants use same tool/backend registries\n  # Isolation via rate limits, tool filtering, audit logging\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    SHARED INFRASTRUCTURE                          \u2502\n\u2502                                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502   \u2502Tenant A \u2502 \u2502Tenant B \u2502 \u2502Tenant C \u2502                           \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502        \u2502           \u2502           \u2502                                 \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                 \u2502\n\u2502                    \u2502                                              \u2502\n\u2502                    \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502              SHARED MCP SERVER INSTANCE                  \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2502   Tenant Middleware \u2192 Tool Filter \u2192 Rate Limit \u2192 Audit   \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2502   Shared Tool Registry + Tenant Configs                  \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-2-namespace-isolation","title":"Strategy 2: Namespace Isolation","text":"<p>Tenants have isolated namespaces within shared infrastructure.</p> <pre><code>tenancy:\n  isolation: namespace\n  # Each tenant gets own tool namespace prefix\n  # Tenant A sees: tenant-a:*, shared:*\n  # Tenant B sees: tenant-b:*, shared:*\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    NAMESPACE ISOLATION                            \u2502\n\u2502                                                                   \u2502\n\u2502   Tenant A View:              Tenant B View:                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502   \u2502 shared:*        \u2502        \u2502 shared:*        \u2502                \u2502\n\u2502   \u2502 tenant-a:*      \u2502        \u2502 tenant-b:*      \u2502                \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                                                                   \u2502\n\u2502   Backend Routing:                                               \u2502\n\u2502   shared:* \u2192 Shared backends                                     \u2502\n\u2502   tenant-a:* \u2192 Tenant A's backends                              \u2502\n\u2502   tenant-b:* \u2192 Tenant B's backends                              \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-3-process-isolation","title":"Strategy 3: Process Isolation","text":"<p>Each tenant gets a dedicated server process.</p> <pre><code>tenancy:\n  isolation: process\n  # Tenant requests routed to dedicated processes\n  # Maximum isolation, higher resource usage\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PROCESS ISOLATION                              \u2502\n\u2502                                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502  Tenant A   \u2502        \u2502  Tenant B   \u2502        \u2502  Tenant C   \u2502 \u2502\n\u2502   \u2502   Process   \u2502        \u2502   Process   \u2502        \u2502   Process   \u2502 \u2502\n\u2502   \u2502             \u2502        \u2502             \u2502        \u2502             \u2502 \u2502\n\u2502   \u2502 Own config  \u2502        \u2502 Own config  \u2502        \u2502 Own config  \u2502 \u2502\n\u2502   \u2502 Own tools   \u2502        \u2502 Own tools   \u2502        \u2502 Own tools   \u2502 \u2502\n\u2502   \u2502 Own backends\u2502        \u2502 Own backends\u2502        \u2502 Own backends\u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502          \u2502                      \u2502                      \u2502         \u2502\n\u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                              \u2502                                    \u2502\n\u2502                              \u25bc                                    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT ROUTER                         \u2502   \u2502\n\u2502   \u2502          (Load balancer / API Gateway)                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-storage","title":"Tenant Storage","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenantstore-interface","title":"TenantStore Interface","text":"<pre><code>// TenantStore manages tenant data\ntype TenantStore interface {\n    // CRUD\n    Get(ctx context.Context, id string) (*Tenant, error)\n    Create(ctx context.Context, tenant *Tenant) error\n    Update(ctx context.Context, tenant *Tenant) error\n    Delete(ctx context.Context, id string) error\n    List(ctx context.Context, opts ListOptions) ([]*Tenant, error)\n\n    // Config\n    GetConfig(ctx context.Context, id string) (*TenantConfig, error)\n    UpdateConfig(ctx context.Context, id string, cfg *TenantConfig) error\n\n    // Quotas\n    GetQuotaUsage(ctx context.Context, id string) (*QuotaUsage, error)\n    IncrementUsage(ctx context.Context, id string, metric string, delta int64) error\n}\n\n// Built-in implementations\ntype MemoryTenantStore struct { ... }      // For testing/development\ntype RedisTenantStore struct { ... }       // For distributed deployments\ntype PostgresTenantStore struct { ... }    // For persistent storage\ntype ConfigFileTenantStore struct { ... }  // For static configuration\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#end-to-end-example","title":"End-to-End Example","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#enterprise-saas-configuration","title":"Enterprise SaaS Configuration","text":"<pre><code># metatools-saas.yaml\n\nserver:\n  name: \"metatools-saas\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    port: 8080\n\ntenancy:\n  enabled: true\n\n  resolver:\n    type: composite\n    resolvers:\n      - type: jwt\n        issuer: https://auth.saas.example.com\n        claim_key: org_id\n      - type: api_key\n        header: X-API-Key\n\n  store:\n    type: postgres\n    postgres:\n      connection_string: ${DATABASE_URL}\n\n  isolation: shared\n\n  tiers:\n    free:\n      rate_limits:\n        requests_per_minute: 30\n      quotas:\n        daily_requests: 500\n      denied_tools:\n        - execute_code\n        - run_chain\n\n    startup:\n      rate_limits:\n        requests_per_minute: 120\n      quotas:\n        daily_requests: 5000\n      max_chain_steps: 5\n\n    enterprise:\n      rate_limits:\n        requests_per_minute: 1000\n      quotas:\n        daily_requests: -1\n      features:\n        custom_backends: true\n        dedicated_support: true\n\nmiddleware:\n  chain:\n    - tenant          # Resolve tenant first\n    - tenant_config   # Load tenant-specific config\n    - tenant_filter   # Filter tools by tenant permissions\n    - tenant_rate_limit\n    - tenant_quota\n    - tenant_audit\n    - logging\n    - metrics\n\nbackends:\n  shared:\n    github:\n      enabled: true\n      kind: mcp\n      config:\n        command: npx\n        args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n\n    filesystem:\n      enabled: true\n      kind: mcp\n      config:\n        command: npx\n        args: [\"-y\", \"@modelcontextprotocol/server-filesystem\"]\n\n  # Enterprise tenants can have custom backends\n  # Loaded from tenant config in database\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#request-flow","title":"Request Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    MULTI-TENANT REQUEST FLOW                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   1. INCOMING REQUEST                                                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  POST /mcp HTTP/1.1                                                 \u2502   \u2502\n\u2502   \u2502  Authorization: Bearer eyJhbGc...                                  \u2502   \u2502\n\u2502   \u2502  X-API-Key: key_abc123 (fallback)                                  \u2502   \u2502\n\u2502   \u2502                                                                     \u2502   \u2502\n\u2502   \u2502  { \"method\": \"tools/call\", \"params\": { \"name\": \"github/...\" } }   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   2. TENANT RESOLUTION                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  JWT Resolver:                                                      \u2502   \u2502\n\u2502   \u2502  - Validate token                                                   \u2502   \u2502\n\u2502   \u2502  - Extract org_id: \"acme-corp\"                                     \u2502   \u2502\n\u2502   \u2502  - Load tenant from store                                          \u2502   \u2502\n\u2502   \u2502  - Inject TenantContext into ctx                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502   TenantContext:                     \u2502                                       \u2502\n\u2502   - ID: \"acme-corp\"                  \u2502                                       \u2502\n\u2502   - Tier: \"enterprise\"               \u2502                                       \u2502\n\u2502   - Config: { allowed_backends: [...], features: {...} }                    \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   3. TENANT TOOL FILTER                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Check: Is \"github/create_issue\" allowed for acme-corp?            \u2502   \u2502\n\u2502   \u2502  - Not in denied_tools \u2713                                           \u2502   \u2502\n\u2502   \u2502  - github backend is in allowed_backends \u2713                         \u2502   \u2502\n\u2502   \u2502  \u2192 ALLOWED                                                          \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   4. TENANT RATE LIMIT                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Key: \"tenant:acme-corp:tool:github/create_issue\"                  \u2502   \u2502\n\u2502   \u2502  Limit: 1000 req/min (enterprise tier)                             \u2502   \u2502\n\u2502   \u2502  Current: 42 \u2192 ALLOWED                                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   5. EXECUTION (with tenant context)                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Route to: github backend                                          \u2502   \u2502\n\u2502   \u2502  Execute: create_issue                                             \u2502   \u2502\n\u2502   \u2502  Tenant-scoped audit log written                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   6. RESPONSE                                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  { \"result\": { \"issue_number\": 456 }, \"id\": \"req-123\" }           \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#implementation-priority","title":"Implementation Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-1-core-multi-tenancy-2-weeks","title":"Phase 1: Core Multi-Tenancy (2 weeks)","text":"<ol> <li>Define <code>Tenant</code>, <code>TenantContext</code>, <code>TenantConfig</code> types</li> <li>Implement <code>TenantResolver</code> interface + JWT/API Key resolvers</li> <li>Implement <code>TenantMiddleware</code> for context injection</li> <li>Add <code>TenantFromContext()</code> helper</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-2-tenant-aware-middleware-1-week","title":"Phase 2: Tenant-Aware Middleware (1 week)","text":"<ol> <li>Implement <code>TenantRateLimitMiddleware</code></li> <li>Implement <code>TenantToolFilterMiddleware</code></li> <li>Implement <code>TenantAuditMiddleware</code></li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-3-tenant-storage-1-week","title":"Phase 3: Tenant Storage (1 week)","text":"<ol> <li>Define <code>TenantStore</code> interface</li> <li>Implement <code>MemoryTenantStore</code> for development</li> <li>Implement <code>PostgresTenantStore</code> for production</li> <li>Add quota tracking</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-4-advanced-features-2-weeks","title":"Phase 4: Advanced Features (2 weeks)","text":"<ol> <li>Multi-tenant tool registry</li> <li>Multi-tenant backend registry</li> <li>Namespace isolation strategy</li> <li>Process isolation strategy (optional)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#changes-to-component-libraries","title":"Changes to Component Libraries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#toolrun-changes","title":"toolrun Changes","text":"<pre><code>// Add tenant context propagation\ntype RunOptions struct {\n    // Existing...\n    TenantID string  // NEW: Tenant context for execution\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#toolindex-changes","title":"toolindex Changes","text":"<pre><code>// Add tenant-scoped search\ntype Index interface {\n    // Existing...\n    SearchForTenant(tenantID string, query string, limit int) ([]Summary, error)  // NEW\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#summary","title":"Summary","text":"<p>Multi-tenancy integrates cleanly into the pluggable architecture via:</p> <ol> <li>Pluggable TenantResolver - Any identification strategy</li> <li>Tenant-Aware Middleware - Transparent isolation via middleware chain</li> <li>Tenant-Scoped Registries - Logical isolation of tools/backends</li> <li>Configuration Hierarchy - Defaults \u2192 Tier \u2192 Tenant overrides</li> <li>Multiple Isolation Strategies - Shared, namespace, or process isolation</li> </ol> <p>All components remain pluggable and can be replaced or extended.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial multi-tenancy extension proposal"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/","title":"Pluggable Architecture Proposal","text":"<p>Status: Draft Date: 2026-01-27 Author: Jon Raymond</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#executive-summary","title":"Executive Summary","text":"<p>This proposal outlines a pluggable, modular architecture for metatools-mcp that enables: - Multiple transport protocols (stdio, HTTP/SSE, WebSocket) - Plug-and-play tool providers - Configurable search strategies - Extensible backend registries - Cross-cutting middleware</p> <p>The design leverages Go's interface-based composition, build-tag gating, and configuration-driven initialization to create a flexible framework while maintaining the clean, canonical core.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Motivation</li> <li>Current Architecture Analysis</li> <li>Proposed Architecture</li> <li>Extension Points</li> <li>Transport Layer</li> <li>Search Strategy</li> <li>Tool Provider Registry</li> <li>Backend Registry</li> <li>Middleware Chain</li> <li>Cache Layer</li> <li>Additional Cross-Cutting Concerns</li> <li>Multi-Backend Architecture</li> <li>Configuration Design</li> <li>Implementation Approach</li> <li>End-to-End Examples</li> <li>Enterprise AI Assistant</li> <li>Local Development Setup</li> <li>Multi-LLM Tool Router</li> <li>Microservices Tool Mesh</li> <li>Request Flow Diagram</li> <li>Comparative Analysis</li> <li>References</li> <li>Architecture Validation</li> <li>Implementation Phases</li> <li>Component Library Analysis</li> <li>Multi-Tenancy Extension</li> <li>Extension Point Catalog</li> <li>Revised Implementation Timeline</li> <li>Architecture Evaluation</li> <li>Protocol-Agnostic Tools</li> <li>Versioning Strategy</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#motivation","title":"Motivation","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#goals","title":"Goals","text":"<ol> <li>Multi-transport support - Run as stdio MCP server (current) or HTTP/SSE server (high availability)</li> <li>Plug-and-play extensibility - Add new tools, backends, and search strategies without modifying core</li> <li>Configuration-driven - YAML/JSON config files with environment variable overrides</li> <li>Framework potential - Enable metatools-mcp as a reusable framework for building MCP servers</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#non-goals","title":"Non-Goals","text":"<ul> <li>Runtime plugin loading (Go's plugin package has platform limitations)</li> <li>Breaking changes to existing tool* library interfaces</li> <li>Over-engineering for hypothetical future requirements</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#current-architecture-analysis","title":"Current Architecture Analysis","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#strengths-85-pluggable","title":"Strengths (85% Pluggable)","text":"<p>The existing architecture demonstrates excellent patterns:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MCP Server (SDK)                           \u2502\n\u2502           metatools-mcp/internal/server/server.go               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Adapter Layer                                 \u2502\n\u2502  - IndexAdapter (toolindex \u2192 handlers.Index)                    \u2502\n\u2502  - DocsAdapter (tooldocs \u2192 handlers.Store)                      \u2502\n\u2502  - RunnerAdapter (toolrun \u2192 handlers.Runner)                    \u2502\n\u2502  - ExecutorAdapter (toolcode \u2192 handlers.Executor)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Handlers Layer                                 \u2502\n\u2502  - SearchHandler, DescribeHandler, RunHandler, ChainHandler    \u2502\n\u2502  - CodeHandler (optional), ExamplesHandler, NamespacesHandler  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Core Tool Libraries                                 \u2502\n\u2502  toolindex, tooldocs, toolrun, toolcode, toolruntime, toolsearch\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>What works well: - Clean interface contracts (<code>handlers/interfaces.go</code>) - Adapter pattern prevents library leakage - Build-tag gating for optional features (<code>toolsearch</code>, <code>toolruntime</code>) - Configuration-driven bootstrap (<code>internal/config/env.go</code>) - Stateless handlers with dependency injection</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#gap-monolithic-tool-registration","title":"Gap: Monolithic Tool Registration","text":"<p>The primary gap is in <code>server.registerTools()</code> (~200 lines):</p> <pre><code>// Current: Hard-coded tool list\nfunc (s *Server) registerTools() {\n    s.addTool(\"search_tools\", ...)    // inline schema\n    s.addTool(\"describe_tool\", ...)   // inline schema\n    s.addTool(\"run_tool\", ...)        // inline schema\n    // ... 7 tools total\n}\n</code></pre> <p>This requires code changes to add new tools.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-architecture","title":"Proposed Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#five-layer-design","title":"Five-Layer Design","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    METATOOLS-MCP FRAMEWORK                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                 TRANSPORT LAYER                              \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502 \u2502\n\u2502  \u2502  \u2502  stdio  \u2502  \u2502  SSE    \u2502  \u2502  HTTP   \u2502  \u2502  gRPC   \u2502        \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518        \u2502 \u2502\n\u2502  \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502 \u2502\n\u2502  \u2502                        \u2193                                     \u2502 \u2502\n\u2502  \u2502               transport.Transport interface                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                  MIDDLEWARE CHAIN                            \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502 \u2502\n\u2502  \u2502  \u2502 Logging  \u2502\u2192\u2502  Auth    \u2502\u2192\u2502  Rate    \u2502\u2192\u2502  Cache   \u2502       \u2502 \u2502\n\u2502  \u2502  \u2502          \u2502 \u2502          \u2502 \u2502  Limit   \u2502 \u2502          \u2502       \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502               TOOL PROVIDER REGISTRY                         \u2502 \u2502\n\u2502  \u2502                                                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502 \u2502\n\u2502  \u2502  \u2502 search_tools \u2502 \u2502 describe_    \u2502 \u2502 run_tool     \u2502         \u2502 \u2502\n\u2502  \u2502  \u2502              \u2502 \u2502 tool         \u2502 \u2502              \u2502         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502 \u2502\n\u2502  \u2502  \u2502 run_chain    \u2502 \u2502 execute_code \u2502 \u2502 [custom...]  \u2502         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502              CORE SERVICES (Tool Libraries)                  \u2502 \u2502\n\u2502  \u2502                                                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502 \u2502\n\u2502  \u2502  \u2502   toolindex    \u2502  \u2502   tooldocs     \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2502  (Registry)    \u2502  \u2502  (Disclosure)  \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502 \u2502\n\u2502  \u2502  \u2502   toolrun      \u2502  \u2502   toolcode     \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2502  (Execution)   \u2502  \u2502 (Orchestration)\u2502                     \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502               BACKEND REGISTRY                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502 \u2502\n\u2502  \u2502  \u2502  local  \u2502  \u2502 openai  \u2502  \u2502  azure  \u2502  \u2502  mcp    \u2502        \u2502 \u2502\n\u2502  \u2502  \u2502handlers \u2502  \u2502   api   \u2502  \u2502   api   \u2502  \u2502 servers \u2502        \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#core-interfaces","title":"Core Interfaces","text":"<pre><code>// Transport abstraction (enables stdio/SSE/HTTP)\ntype Transport interface {\n    Serve(ctx context.Context, handler RequestHandler) error\n}\n\n// Tool provider (enables plug-and-play tools)\ntype ToolProvider interface {\n    Name() string\n    Tool() *mcp.Tool\n    Handle(ctx context.Context, input []byte) (any, error)\n}\n\n// Middleware (enables cross-cutting concerns)\ntype Middleware func(ToolProvider) ToolProvider\n\n// Backend registry (enables tool sources)\ntype BackendRegistry interface {\n    Register(kind string, backend Backend)\n    Get(kind string) (Backend, bool)\n    List() []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-points","title":"Extension Points","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-transport-layer","title":"1. Transport Layer","text":"<p>The transport layer abstracts how MCP clients connect to the server. This enables the same tool logic to be exposed via multiple protocols.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TRANSPORT LAYER                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                              MCP CLIENTS                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502   Claude    \u2502  \u2502   Cursor    \u2502  \u2502  Web App    \u2502  \u2502   Custom    \u2502        \u2502\n\u2502   \u2502   Desktop   \u2502  \u2502    IDE      \u2502  \u2502  Frontend   \u2502  \u2502   Client    \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502          \u2502                \u2502                \u2502                \u2502                \u2502\n\u2502          \u2502 stdio          \u2502 stdio          \u2502 HTTP/SSE       \u2502 gRPC          \u2502\n\u2502          \u2502                \u2502                \u2502                \u2502                \u2502\n\u2502          \u25bc                \u25bc                \u25bc                \u25bc                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                     TRANSPORT REGISTRY                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502   \u2502\n\u2502   \u2502   \u2502   STDIO   \u2502  \u2502    SSE    \u2502  \u2502   HTTP    \u2502  \u2502   gRPC    \u2502        \u2502   \u2502\n\u2502   \u2502   \u2502 Transport \u2502  \u2502 Transport \u2502  \u2502 Transport \u2502  \u2502 Transport \u2502        \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518        \u2502   \u2502\n\u2502   \u2502         \u2502              \u2502              \u2502              \u2502               \u2502   \u2502\n\u2502   \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502                    transport.Transport                                \u2502   \u2502\n\u2502   \u2502                       interface                                       \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                          \u2502\n\u2502                                   \u25bc                                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    MCP REQUEST HANDLER                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Unified handler processes all requests regardless of transport    \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-transport-interface","title":"The Transport Interface","text":"<pre><code>// Transport defines how MCP clients connect to the server\ntype Transport interface {\n    // Name returns the transport identifier (e.g., \"stdio\", \"sse\")\n    Name() string\n\n    // Serve starts the transport and blocks until ctx is cancelled\n    Serve(ctx context.Context, handler RequestHandler) error\n\n    // Close gracefully shuts down the transport\n    Close() error\n\n    // Info returns runtime information about the transport\n    Info() TransportInfo\n}\n\n// RequestHandler processes incoming MCP requests\ntype RequestHandler interface {\n    HandleRequest(ctx context.Context, req *mcp.Request) (*mcp.Response, error)\n}\n\n// TransportInfo provides runtime details\ntype TransportInfo struct {\n    Name      string            // Transport name\n    Listening bool              // Is it accepting connections?\n    Address   string            // Listening address (for network transports)\n    Metadata  map[string]string // Additional info\n}\n\n// TransportFactory creates configured transport instances\ntype TransportFactory func(cfg TransportConfig) (Transport, error)\n\n// TransportRegistry manages available transports\ntype TransportRegistry struct {\n    transports map[string]TransportFactory\n}\n\nfunc (r *TransportRegistry) Register(name string, factory TransportFactory) {\n    r.transports[name] = factory\n}\n\nfunc (r *TransportRegistry) Create(cfg TransportConfig) (Transport, error) {\n    factory, ok := r.transports[cfg.Type]\n    if !ok {\n        return nil, fmt.Errorf(\"unknown transport: %s\", cfg.Type)\n    }\n    return factory(cfg)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-types","title":"Transport Types","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-stdio-transport-current-default","title":"1. Stdio Transport (Current Default)","text":"<p>For MCP clients that spawn the server as a subprocess.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          STDIO TRANSPORT                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502      MCP Client       \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502   (Claude, Cursor)    \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   Spawns process \u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Started as child    \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   stdin  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Reads JSON-RPC      \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   stdout \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Writes JSON-RPC     \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Single client per process                                               \u2502\n\u2502   - Process lifecycle tied to client                                        \u2502\n\u2502   - No network configuration needed                                         \u2502\n\u2502   - Ideal for desktop MCP clients                                           \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Implementation:                                                             \u2502\n\u2502                                                                               \u2502\n\u2502  type StdioTransport struct {                                               \u2502\n\u2502      reader  io.Reader  // os.Stdin                                         \u2502\n\u2502      writer  io.Writer  // os.Stdout                                        \u2502\n\u2502      decoder *json.Decoder                                                  \u2502\n\u2502      encoder *json.Encoder                                                  \u2502\n\u2502  }                                                                           \u2502\n\u2502                                                                               \u2502\n\u2502  func (t *StdioTransport) Serve(ctx context.Context, h RequestHandler)      \u2502\n\u2502      error {                                                                \u2502\n\u2502      for {                                                                  \u2502\n\u2502          select {                                                           \u2502\n\u2502          case &lt;-ctx.Done():                                                 \u2502\n\u2502              return ctx.Err()                                               \u2502\n\u2502          default:                                                           \u2502\n\u2502              var req mcp.Request                                            \u2502\n\u2502              if err := t.decoder.Decode(&amp;req); err != nil {                 \u2502\n\u2502                  return err                                                 \u2502\n\u2502              }                                                              \u2502\n\u2502              resp, err := h.HandleRequest(ctx, &amp;req)                        \u2502\n\u2502              if err := t.encoder.Encode(resp); err != nil {                 \u2502\n\u2502                  return err                                                 \u2502\n\u2502              }                                                              \u2502\n\u2502          }                                                                  \u2502\n\u2502      }                                                                      \u2502\n\u2502  }                                                                           \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: stdio                                                            \u2502\n\u2502      # No additional config needed                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-sse-transport-server-sent-events","title":"2. SSE Transport (Server-Sent Events)","text":"<p>For web-based MCP clients using the Streamable HTTP protocol.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           SSE TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502     Web Browser       \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502    or HTTP Client     \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   POST /mcp \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Handle request      \u2502               \u2502\n\u2502   \u2502   (JSON-RPC request)  \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   SSE stream \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Stream response     \u2502               \u2502\n\u2502   \u2502   (chunked events)    \u2502         \u2502   via SSE             \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   HTTP Endpoints:                                                            \u2502\n\u2502   - POST /mcp           \u2192 Submit MCP request, receive SSE stream            \u2502\n\u2502   - GET  /mcp/sse       \u2192 Establish SSE connection for server push          \u2502\n\u2502   - GET  /health        \u2192 Health check endpoint                              \u2502\n\u2502   - GET  /ready         \u2192 Readiness probe                                   \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Multiple concurrent clients                                             \u2502\n\u2502   - Stateless (each request independent)                                    \u2502\n\u2502   - Web-friendly (works through firewalls/proxies)                          \u2502\n\u2502   - Supports streaming responses                                            \u2502\n\u2502   - Can be load balanced                                                    \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Request/Response Flow:                                                      \u2502\n\u2502                                                                               \u2502\n\u2502  Client                              Server                                  \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  POST /mcp                        \u2502                                     \u2502\n\u2502    \u2502  Content-Type: application/json   \u2502                                     \u2502\n\u2502    \u2502  Accept: text/event-stream        \u2502                                     \u2502\n\u2502    \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  HTTP/1.1 200 OK                  \u2502                                     \u2502\n\u2502    \u2502  Content-Type: text/event-stream  \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: message                   \u2502                                     \u2502\n\u2502    \u2502  data: {\"jsonrpc\":\"2.0\",...}      \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: message                   \u2502                                     \u2502\n\u2502    \u2502  data: {\"jsonrpc\":\"2.0\",...}      \u2502  (streaming)                       \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: done                      \u2502                                     \u2502\n\u2502    \u2502  data: {}                         \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: sse                                                              \u2502\n\u2502      http:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        base_path: /mcp                                                     \u2502\n\u2502        cors:                                                               \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          origins: [\"https://app.example.com\"]                             \u2502\n\u2502        tls:                                                                \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          cert: /etc/ssl/cert.pem                                          \u2502\n\u2502          key: /etc/ssl/key.pem                                            \u2502\n\u2502        timeouts:                                                           \u2502\n\u2502          read: 30s                                                         \u2502\n\u2502          write: 60s                                                        \u2502\n\u2502          idle: 120s                                                        \u2502\n\u2502        keepalive: 30s                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-http-transport-rest-style","title":"3. HTTP Transport (REST-style)","text":"<p>For simple request/response without streaming.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          HTTP TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Endpoints:                                                                 \u2502\n\u2502                                                                               \u2502\n\u2502   POST /mcp/tools/list                                                       \u2502\n\u2502   \u251c\u2500 Request:  {}                                                            \u2502\n\u2502   \u2514\u2500 Response: { \"tools\": [...] }                                           \u2502\n\u2502                                                                               \u2502\n\u2502   POST /mcp/tools/call                                                       \u2502\n\u2502   \u251c\u2500 Request:  { \"name\": \"search_tools\", \"arguments\": {...} }               \u2502\n\u2502   \u2514\u2500 Response: { \"content\": [...] }                                         \u2502\n\u2502                                                                               \u2502\n\u2502   GET /mcp/tools/:name                                                       \u2502\n\u2502   \u2514\u2500 Response: { \"name\": \"...\", \"description\": \"...\", \"inputSchema\": {...}} \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Simple request/response                                                  \u2502\n\u2502   - No streaming support                                                    \u2502\n\u2502   - Easy to debug with curl                                                 \u2502\n\u2502   - Good for simple integrations                                            \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: http                                                             \u2502\n\u2502      http:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        base_path: /mcp                                                     \u2502\n\u2502        # Same TLS/timeout options as SSE                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-websocket-transport","title":"4. WebSocket Transport","text":"<p>For bidirectional real-time communication.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        WEBSOCKET TRANSPORT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502       Client          \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   WS Connect \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Accept connection   \u2502               \u2502\n\u2502   \u2502   ws://host/mcp/ws    \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502               \u2502\n\u2502   \u2502      Bidirectional    \u2502         \u2502   Full duplex         \u2502               \u2502\n\u2502   \u2502      JSON-RPC         \u2502         \u2502   messaging           \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Full duplex communication                                               \u2502\n\u2502   - Server can push notifications                                           \u2502\n\u2502   - Lower latency than HTTP                                                 \u2502\n\u2502   - Persistent connection                                                   \u2502\n\u2502   - Good for real-time applications                                         \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: websocket                                                        \u2502\n\u2502      websocket:                                                             \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        path: /mcp/ws                                                       \u2502\n\u2502        ping_interval: 30s                                                  \u2502\n\u2502        pong_timeout: 10s                                                   \u2502\n\u2502        max_message_size: 1MB                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-grpc-transport","title":"5. gRPC Transport","text":"<p>For high-performance, strongly-typed RPC.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          gRPC TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Protocol Buffer Definition:                                                \u2502\n\u2502                                                                               \u2502\n\u2502   service MCPService {                                                       \u2502\n\u2502     rpc ListTools(ListToolsRequest) returns (ListToolsResponse);            \u2502\n\u2502     rpc CallTool(CallToolRequest) returns (CallToolResponse);               \u2502\n\u2502     rpc CallToolStream(CallToolRequest) returns (stream ToolEvent);         \u2502\n\u2502   }                                                                          \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - High performance (binary protocol)                                       \u2502\n\u2502   - Strong typing via protobuf                                              \u2502\n\u2502   - Bidirectional streaming                                                 \u2502\n\u2502   - Built-in load balancing                                                 \u2502\n\u2502   - Good for service-to-service communication                               \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: grpc                                                             \u2502\n\u2502      grpc:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 9090                                                          \u2502\n\u2502        tls:                                                                \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          cert: /etc/ssl/cert.pem                                          \u2502\n\u2502          key: /etc/ssl/key.pem                                            \u2502\n\u2502          client_ca: /etc/ssl/ca.pem  # For mTLS                           \u2502\n\u2502        reflection: true  # Enable gRPC reflection                          \u2502\n\u2502        max_recv_msg_size: 4MB                                              \u2502\n\u2502        max_send_msg_size: 4MB                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-transport-support","title":"Multi-Transport Support","text":"<p>Run multiple transports simultaneously:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MULTI-TRANSPORT ARCHITECTURE                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    METATOOLS-MCP SERVER                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502   \u2502\n\u2502   \u2502   \u2502   STDIO     \u2502 \u2502    SSE      \u2502 \u2502    gRPC     \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2502  Transport  \u2502 \u2502  Transport  \u2502 \u2502  Transport  \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2502             \u2502 \u2502  :8080      \u2502 \u2502  :9090      \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502   \u2502\n\u2502   \u2502          \u2502               \u2502               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502   \u2502\n\u2502   \u2502                          \u2502                                            \u2502   \u2502\n\u2502   \u2502                          \u25bc                                            \u2502   \u2502\n\u2502   \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502   \u2502\n\u2502   \u2502          \u2502     SHARED REQUEST HANDLER    \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502                               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   All transports share the    \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   same middleware, tools,     \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   and backend registries      \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502                               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2502   Config:                                                                    \u2502\n\u2502     transports:                                                             \u2502\n\u2502       - type: stdio                                                         \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502                                                                               \u2502\n\u2502       - type: sse                                                           \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502         http:                                                               \u2502\n\u2502           port: 8080                                                        \u2502\n\u2502                                                                               \u2502\n\u2502       - type: grpc                                                          \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502         grpc:                                                               \u2502\n\u2502           port: 9090                                                        \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementing-custom-transports","title":"Implementing Custom Transports","text":"<pre><code>// Example: Unix socket transport for local high-performance IPC\ntype UnixSocketTransport struct {\n    path     string\n    listener net.Listener\n    handler  RequestHandler\n}\n\nfunc NewUnixSocketTransport(cfg TransportConfig) (Transport, error) {\n    return &amp;UnixSocketTransport{\n        path: cfg.UnixSocket.Path,\n    }, nil\n}\n\nfunc (t *UnixSocketTransport) Name() string {\n    return \"unix\"\n}\n\nfunc (t *UnixSocketTransport) Serve(ctx context.Context, h RequestHandler) error {\n    t.handler = h\n\n    var err error\n    t.listener, err = net.Listen(\"unix\", t.path)\n    if err != nil {\n        return err\n    }\n\n    go func() {\n        &lt;-ctx.Done()\n        t.listener.Close()\n    }()\n\n    for {\n        conn, err := t.listener.Accept()\n        if err != nil {\n            if ctx.Err() != nil {\n                return nil // Graceful shutdown\n            }\n            return err\n        }\n        go t.handleConnection(ctx, conn)\n    }\n}\n\nfunc (t *UnixSocketTransport) handleConnection(ctx context.Context, conn net.Conn) {\n    defer conn.Close()\n    decoder := json.NewDecoder(conn)\n    encoder := json.NewEncoder(conn)\n\n    for {\n        var req mcp.Request\n        if err := decoder.Decode(&amp;req); err != nil {\n            return\n        }\n        resp, _ := t.handler.HandleRequest(ctx, &amp;req)\n        if err := encoder.Encode(resp); err != nil {\n            return\n        }\n    }\n}\n\nfunc (t *UnixSocketTransport) Close() error {\n    if t.listener != nil {\n        return t.listener.Close()\n    }\n    return nil\n}\n\nfunc (t *UnixSocketTransport) Info() TransportInfo {\n    return TransportInfo{\n        Name:      \"unix\",\n        Listening: t.listener != nil,\n        Address:   t.path,\n    }\n}\n\n// Register the custom transport\nfunc init() {\n    transport.Register(\"unix\", NewUnixSocketTransport)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#high-availability-configuration","title":"High Availability Configuration","text":"<p>For production deployments with HTTP/SSE transport:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    HIGH AVAILABILITY DEPLOYMENT                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                       LOAD BALANCER                                  \u2502   \u2502\n\u2502   \u2502                    (nginx, HAProxy, ALB)                             \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   - TLS termination                                                  \u2502   \u2502\n\u2502   \u2502   - Health checks                                                    \u2502   \u2502\n\u2502   \u2502   - Round-robin / least-connections                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                    \u2502                \u2502                \u2502                       \u2502\n\u2502                    \u25bc                \u25bc                \u25bc                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502   \u2502   metatools-mcp    \u2502 \u2502   metatools-mcp    \u2502 \u2502   metatools-mcp    \u2502     \u2502\n\u2502   \u2502    instance 1      \u2502 \u2502    instance 2      \u2502 \u2502    instance 3      \u2502     \u2502\n\u2502   \u2502                    \u2502 \u2502                    \u2502 \u2502                    \u2502     \u2502\n\u2502   \u2502  SSE :8080         \u2502 \u2502  SSE :8080         \u2502 \u2502  SSE :8080         \u2502     \u2502\n\u2502   \u2502  gRPC :9090        \u2502 \u2502  gRPC :9090        \u2502 \u2502  gRPC :9090        \u2502     \u2502\n\u2502   \u2502                    \u2502 \u2502                    \u2502 \u2502                    \u2502     \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502             \u2502                      \u2502                      \u2502                 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                    \u2502                                         \u2502\n\u2502                                    \u25bc                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      SHARED STATE (Optional)                         \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   - Redis for rate limiting                                          \u2502   \u2502\n\u2502   \u2502   - Redis for caching                                                \u2502   \u2502\n\u2502   \u2502   - Shared tool registry (if dynamic)                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code># Kubernetes-ready configuration\ntransport:\n  type: sse\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n\n    # Health endpoints for k8s probes\n    health:\n      enabled: true\n      liveness_path: /healthz\n      readiness_path: /ready\n\n    # Graceful shutdown\n    shutdown:\n      timeout: 30s\n      drain_connections: true\n\n    # TLS (or terminate at ingress)\n    tls:\n      enabled: false  # Terminated at ingress\n\nmiddleware:\n  rate_limit:\n    enabled: true\n    storage: redis\n    redis:\n      address: redis:6379\n\n  cache:\n    enabled: true\n    backend: redis\n    redis:\n      address: redis:6379\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cli-integration","title":"CLI Integration","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          CLI SUBCOMMANDS                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  metatools stdio                                                             \u2502\n\u2502  \u2514\u2500 Run as stdio server (default, for MCP clients)                          \u2502\n\u2502                                                                               \u2502\n\u2502  metatools serve                                                             \u2502\n\u2502  \u2514\u2500 Run as HTTP/SSE server                                                  \u2502\n\u2502  \u2514\u2500 Options:                                                                \u2502\n\u2502       --port 8080          HTTP port                                        \u2502\n\u2502       --grpc-port 9090     gRPC port (optional)                            \u2502\n\u2502       --tls                Enable TLS                                       \u2502\n\u2502       --cert FILE          TLS certificate                                  \u2502\n\u2502       --key FILE           TLS key                                          \u2502\n\u2502                                                                               \u2502\n\u2502  metatools serve --multi                                                     \u2502\n\u2502  \u2514\u2500 Run all enabled transports from config                                  \u2502\n\u2502                                                                               \u2502\n\u2502  metatools version                                                           \u2502\n\u2502  \u2514\u2500 Print version and exit                                                  \u2502\n\u2502                                                                               \u2502\n\u2502  metatools validate                                                          \u2502\n\u2502  \u2514\u2500 Validate configuration file                                             \u2502\n\u2502                                                                               \u2502\n\u2502  metatools tools list                                                        \u2502\n\u2502  \u2514\u2500 List all registered tools (from all backends)                          \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-configuration-summary","title":"Transport Configuration Summary","text":"<pre><code># Complete transport configuration example\ntransports:\n  # Stdio for MCP desktop clients\n  - type: stdio\n    enabled: true\n\n  # SSE for web clients\n  - type: sse\n    enabled: true\n    http:\n      host: \"0.0.0.0\"\n      port: 8080\n      base_path: /mcp\n      cors:\n        enabled: true\n        origins: [\"*\"]\n        methods: [\"GET\", \"POST\", \"OPTIONS\"]\n        headers: [\"Content-Type\", \"Authorization\"]\n      tls:\n        enabled: true\n        cert: /etc/ssl/certs/server.crt\n        key: /etc/ssl/private/server.key\n      timeouts:\n        read: 30s\n        write: 60s\n        idle: 120s\n      health:\n        enabled: true\n        liveness_path: /healthz\n        readiness_path: /ready\n\n  # WebSocket for real-time apps\n  - type: websocket\n    enabled: false\n    websocket:\n      host: \"0.0.0.0\"\n      port: 8081\n      path: /ws\n\n  # gRPC for service-to-service\n  - type: grpc\n    enabled: false\n    grpc:\n      host: \"0.0.0.0\"\n      port: 9090\n      reflection: true\n\n  # Unix socket for local IPC\n  - type: unix\n    enabled: false\n    unix:\n      path: /var/run/metatools.sock\n      permissions: \"0660\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-search-strategy","title":"2. Search Strategy","text":"<p>Already implemented via build tags + interface:</p> <pre><code>// toolindex.Searcher interface\ntype Searcher interface {\n    Search(query string, limit int) ([]Summary, error)\n}\n\n// Implementations:\n// - Default lexical (built into toolindex)\n// - BM25 (toolsearch package, requires build tag)\n// - Semantic/vector (future, could use embeddings)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-tool-provider-registry","title":"3. Tool Provider Registry","text":"<p>New pattern to enable plug-and-play tools:</p> <pre><code>// ToolProvider interface\ntype ToolProvider interface {\n    Name() string\n    Tool() *mcp.Tool  // MCP tool definition with schema\n    Handle(ctx context.Context, input []byte) (any, error)\n}\n\n// Registry\ntype ToolRegistry struct {\n    providers map[string]ToolProvider\n}\n\nfunc (r *ToolRegistry) Register(p ToolProvider) {\n    r.providers[p.Name()] = p\n}\n\nfunc (r *ToolRegistry) All() []ToolProvider {\n    // Returns all registered providers\n}\n</code></pre> <p>Migration path: Convert existing handlers to ToolProvider implementations.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-backend-registry","title":"4. Backend Registry","text":"<p>For tool execution sources (local, API, MCP servers):</p> <pre><code>// Backend interface (already in toolmodel conceptually)\ntype Backend interface {\n    Kind() string\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Registry with configuration\ntype BackendRegistry struct {\n    backends map[string]Backend\n}\n\nfunc (r *BackendRegistry) RegisterFromConfig(cfg BackendConfig) error {\n    switch cfg.Kind {\n    case \"local\":\n        r.backends[\"local\"] = NewLocalBackend(cfg.Local)\n    case \"openai\":\n        r.backends[\"openai\"] = NewOpenAIBackend(cfg.OpenAI)\n    // ...\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-middleware-chain","title":"5. Middleware Chain","text":"<p>The middleware layer provides pluggable cross-cutting concerns using the decorator pattern.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_1","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         MIDDLEWARE CHAIN                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Incoming Request                                                           \u2502\n\u2502         \u2502                                                                     \u2502\n\u2502         \u25bc                                                                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502   \u2502  Logging  \u2502 \u2192 \u2502   Auth    \u2502 \u2192 \u2502   Rate    \u2502 \u2192 \u2502  Caching  \u2502            \u2502\n\u2502   \u2502           \u2502   \u2502           \u2502   \u2502  Limiter  \u2502   \u2502           \u2502            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502         \u2502               \u2502               \u2502               \u2502                    \u2502\n\u2502         \u2502   on error:   \u2502   on error:   \u2502   on error:   \u2502                    \u2502\n\u2502         \u2502   log &amp; pass  \u2502   reject 401  \u2502   reject 429  \u2502                    \u2502\n\u2502         \u2502               \u2502               \u2502               \u2502                    \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                                         \u2502                                     \u2502\n\u2502                                         \u25bc                                     \u2502\n\u2502                               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502                               \u2502  Tool Handler \u2502                              \u2502\n\u2502                               \u2502   (actual)    \u2502                              \u2502\n\u2502                               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                         \u2502                                     \u2502\n\u2502                                         \u25bc                                     \u2502\n\u2502   Response flows back through chain (for metrics, logging, caching)         \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-middleware-interface","title":"The Middleware Interface","text":"<pre><code>// Middleware wraps a ToolProvider with additional behavior\ntype Middleware func(ToolProvider) ToolProvider\n\n// MiddlewareFunc is a convenience type for stateless middleware\ntype MiddlewareFunc func(ctx context.Context, input []byte, next NextFunc) (any, error)\n\ntype NextFunc func(ctx context.Context, input []byte) (any, error)\n\n// MiddlewareRegistry manages available middleware\ntype MiddlewareRegistry struct {\n    available map[string]MiddlewareFactory\n    active    []Middleware\n}\n\n// MiddlewareFactory creates configured middleware instances\ntype MiddlewareFactory func(cfg MiddlewareConfig) (Middleware, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#built-in-middleware","title":"Built-in Middleware","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        AVAILABLE MIDDLEWARE                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 LOGGING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Request/response logging                                              \u2502 \u2502\n\u2502  \u2502 - Configurable log levels (debug, info, warn, error)                   \u2502 \u2502\n\u2502  \u2502 - Structured JSON output                                                \u2502 \u2502\n\u2502  \u2502 - Request ID tracking                                                   \u2502 \u2502\n\u2502  \u2502 - Duration metrics                                                      \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 AUTHENTICATION                                                           \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Bearer token validation                                               \u2502 \u2502\n\u2502  \u2502 - API key authentication                                                \u2502 \u2502\n\u2502  \u2502 - OAuth2/OIDC integration                                               \u2502 \u2502\n\u2502  \u2502 - mTLS client certificates                                              \u2502 \u2502\n\u2502  \u2502 - Configurable bypass for specific tools                               \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 RATE LIMITING                                                            \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Per-client rate limits                                                \u2502 \u2502\n\u2502  \u2502 - Per-tool rate limits                                                  \u2502 \u2502\n\u2502  \u2502 - Token bucket algorithm                                                \u2502 \u2502\n\u2502  \u2502 - Sliding window counters                                               \u2502 \u2502\n\u2502  \u2502 - Redis-backed for distributed deployments                             \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 CACHING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Response caching for idempotent tools                                \u2502 \u2502\n\u2502  \u2502 - Configurable TTL per tool                                            \u2502 \u2502\n\u2502  \u2502 - Cache key customization                                               \u2502 \u2502\n\u2502  \u2502 - In-memory or Redis backend                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 METRICS                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Prometheus-compatible metrics                                         \u2502 \u2502\n\u2502  \u2502 - Request counts, latencies, error rates                               \u2502 \u2502\n\u2502  \u2502 - Per-tool and per-backend breakdowns                                  \u2502 \u2502\n\u2502  \u2502 - Custom metric labels                                                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 TRACING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - OpenTelemetry integration                                             \u2502 \u2502\n\u2502  \u2502 - Distributed trace propagation                                         \u2502 \u2502\n\u2502  \u2502 - Span creation for each tool call                                     \u2502 \u2502\n\u2502  \u2502 - Backend call tracing                                                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 VALIDATION                                                               \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - JSON Schema validation on inputs                                      \u2502 \u2502\n\u2502  \u2502 - Output validation                                                     \u2502 \u2502\n\u2502  \u2502 - Custom validators per tool                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementing-custom-middleware","title":"Implementing Custom Middleware","text":"<pre><code>// Example: Custom audit logging middleware\ntype AuditMiddleware struct {\n    logger AuditLogger\n    next   ToolProvider\n}\n\nfunc NewAuditMiddleware(logger AuditLogger) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        return &amp;AuditMiddleware{\n            logger: logger,\n            next:   next,\n        }\n    }\n}\n\nfunc (m *AuditMiddleware) Name() string { return m.next.Name() }\nfunc (m *AuditMiddleware) Tool() *mcp.Tool { return m.next.Tool() }\n\nfunc (m *AuditMiddleware) Handle(ctx context.Context, input []byte) (any, error) {\n    // Pre-execution: Log the request\n    requestID := uuid.New().String()\n    user := auth.UserFromContext(ctx)\n\n    m.logger.LogRequest(AuditEntry{\n        RequestID: requestID,\n        User:      user,\n        Tool:      m.next.Name(),\n        Input:     input,\n        Timestamp: time.Now(),\n    })\n\n    // Execute the actual tool\n    result, err := m.next.Handle(ctx, input)\n\n    // Post-execution: Log the result\n    m.logger.LogResponse(AuditEntry{\n        RequestID: requestID,\n        User:      user,\n        Tool:      m.next.Name(),\n        Success:   err == nil,\n        Duration:  time.Since(start),\n        Timestamp: time.Now(),\n    })\n\n    return result, err\n}\n\n// Register custom middleware\nfunc init() {\n    middleware.Register(\"audit\", func(cfg MiddlewareConfig) (Middleware, error) {\n        logger := newAuditLogger(cfg)\n        return NewAuditMiddleware(logger), nil\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-driven-middleware","title":"Configuration-Driven Middleware","text":"<pre><code># metatools.yaml\nmiddleware:\n  # Order matters - first in config = first in chain\n  chain:\n    - logging\n    - auth\n    - rate_limit\n    - metrics\n    - audit  # Custom middleware\n\n  # Per-middleware configuration\n  logging:\n    enabled: true\n    level: info\n    format: json\n    include_request_body: false\n    include_response_body: false\n\n  auth:\n    enabled: true\n    type: bearer\n    token_validation:\n      issuer: https://auth.example.com\n      audience: metatools-api\n    bypass_tools:\n      - search_tools  # Allow anonymous search\n      - list_namespaces\n\n  rate_limit:\n    enabled: true\n    default:\n      requests_per_minute: 100\n      burst: 20\n    per_tool:\n      execute_code:\n        requests_per_minute: 10\n        burst: 2\n    storage: memory  # or redis\n\n  metrics:\n    enabled: true\n    endpoint: /metrics\n    labels:\n      environment: production\n      service: metatools\n\n  cache:\n    enabled: true\n    backend: memory  # or redis\n    default_ttl: 5m\n    per_tool:\n      describe_tool:\n        ttl: 1h\n      search_tools:\n        ttl: 30s\n\n  audit:\n    enabled: true\n    destination: file\n    path: /var/log/metatools/audit.log\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-chain-construction","title":"Middleware Chain Construction","text":"<pre><code>// Chain construction from config\nfunc BuildMiddlewareChain(cfg MiddlewareConfig) ([]Middleware, error) {\n    var chain []Middleware\n\n    for _, name := range cfg.Chain {\n        mwCfg, ok := cfg.Middlewares[name]\n        if !ok || !mwCfg.Enabled {\n            continue\n        }\n\n        // Look up factory in registry\n        factory, ok := middleware.Get(name)\n        if !ok {\n            return nil, fmt.Errorf(\"unknown middleware: %s\", name)\n        }\n\n        // Create middleware instance\n        mw, err := factory(mwCfg)\n        if err != nil {\n            return nil, fmt.Errorf(\"middleware %s: %w\", name, err)\n        }\n\n        chain = append(chain, mw)\n    }\n\n    return chain, nil\n}\n\n// Apply chain to all providers\nfunc ApplyToRegistry(registry *ToolRegistry, chain []Middleware) {\n    for name, provider := range registry.providers {\n        wrapped := provider\n        for i := len(chain) - 1; i &gt;= 0; i-- {\n            wrapped = chain[i](wrapped)\n        }\n        registry.providers[name] = wrapped\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#request-flow-through-middleware","title":"Request Flow Through Middleware","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    REQUEST FLOW EXAMPLE                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client Request: run_tool(\"github/create_issue\", {...})                    \u2502\n\u2502                                                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 1. LOGGING MIDDLEWARE                                                 \u2502  \u2502\n\u2502   \u2502    - Generate request ID: \"req-abc123\"                               \u2502  \u2502\n\u2502   \u2502    - Log: \"Incoming request for github/create_issue\"                 \u2502  \u2502\n\u2502   \u2502    - Start timer                                                      \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next                                                     \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 2. AUTH MIDDLEWARE                                                    \u2502  \u2502\n\u2502   \u2502    - Extract token from Authorization header                         \u2502  \u2502\n\u2502   \u2502    - Validate JWT signature                                          \u2502  \u2502\n\u2502   \u2502    - Check claims (issuer, audience, expiry)                        \u2502  \u2502\n\u2502   \u2502    - Inject user into context                                        \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next (or reject with 401)                               \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 3. RATE LIMIT MIDDLEWARE                                              \u2502  \u2502\n\u2502   \u2502    - Identify client (by user, IP, or API key)                       \u2502  \u2502\n\u2502   \u2502    - Check token bucket for \"github/create_issue\"                    \u2502  \u2502\n\u2502   \u2502    - Consume token                                                    \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next (or reject with 429)                               \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 4. METRICS MIDDLEWARE                                                 \u2502  \u2502\n\u2502   \u2502    - Increment request counter                                        \u2502  \u2502\n\u2502   \u2502    - Start latency timer                                              \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next                                                     \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 5. ACTUAL TOOL HANDLER                                                \u2502  \u2502\n\u2502   \u2502    - Route to GitHub backend                                         \u2502  \u2502\n\u2502   \u2502    - Execute create_issue                                            \u2502  \u2502\n\u2502   \u2502    - Return result                                                    \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   Response bubbles back through chain:                                      \u2502\n\u2502   - Metrics: Record latency, success/failure                                \u2502\n\u2502   - Rate limit: (no action on response)                                     \u2502\n\u2502   - Auth: (no action on response)                                           \u2502\n\u2502   - Logging: Log response, duration, status                                 \u2502\n\u2502                                                                              \u2502\n\u2502   Final Response \u2192 Client                                                   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#registering-custom-middleware","title":"Registering Custom Middleware","text":"<pre><code>// Register at init time (compile-time pluggability)\nfunc init() {\n    middleware.Register(\"my-custom\", NewMyCustomMiddleware)\n}\n\n// Or register at runtime (config-driven)\nfunc setupMiddleware(registry *MiddlewareRegistry) {\n    // Built-in middleware (always available)\n    registry.Register(\"logging\", NewLoggingMiddleware)\n    registry.Register(\"auth\", NewAuthMiddleware)\n    registry.Register(\"rate_limit\", NewRateLimitMiddleware)\n    registry.Register(\"metrics\", NewMetricsMiddleware)\n    registry.Register(\"cache\", NewCacheMiddleware)\n\n    // Custom middleware (loaded from config or plugins)\n    registry.Register(\"audit\", NewAuditMiddleware)\n    registry.Register(\"pii-filter\", NewPIIFilterMiddleware)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-composition-patterns","title":"Middleware Composition Patterns","text":"<pre><code>// Conditional middleware (only apply to certain tools)\nfunc OnlyForTools(tools []string, mw Middleware) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        if slices.Contains(tools, next.Name()) {\n            return mw(next)\n        }\n        return next\n    }\n}\n\n// Except middleware (skip for certain tools)\nfunc ExceptForTools(tools []string, mw Middleware) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        if slices.Contains(tools, next.Name()) {\n            return next\n        }\n        return mw(next)\n    }\n}\n\n// Usage\nchain := []Middleware{\n    LoggingMiddleware,\n    ExceptForTools([]string{\"search_tools\"}, AuthMiddleware),\n    OnlyForTools([]string{\"execute_code\"}, StrictRateLimitMiddleware),\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#6-cache-layer","title":"6. Cache Layer","text":"<p>The cache layer provides pluggable caching across multiple components with support for different backends and layered caching strategies.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_2","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           CACHE LAYER                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      CACHE CONSUMERS                                     \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\u2502\n\u2502   \u2502  \u2502toolindex \u2502  \u2502tooldocs  \u2502  \u2502toolsearch\u2502  \u2502tooladapter\u2502  \u2502 toolrun  \u2502 \u2502\u2502\n\u2502   \u2502  \u2502 (lookup) \u2502  \u2502 (docs)   \u2502  \u2502 (search) \u2502  \u2502 (convert) \u2502  \u2502 (result) \u2502 \u2502\u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\u2502\n\u2502   \u2502       \u2502             \u2502             \u2502             \u2502             \u2502        \u2502\u2502\n\u2502   \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\u2502\n\u2502   \u2502                            \u2502                                            \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                \u2502                                              \u2502\n\u2502                                \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      toolcache.Cache INTERFACE                           \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   Get(ctx, key) \u2192 (value, bool, error)                                  \u2502\u2502\n\u2502   \u2502   Set(ctx, key, value, ttl) \u2192 error                                     \u2502\u2502\n\u2502   \u2502   Delete(ctx, key) \u2192 error                                               \u2502\u2502\n\u2502   \u2502   Clear(ctx, pattern) \u2192 error                                            \u2502\u2502\n\u2502   \u2502   Stats() \u2192 CacheStats                                                   \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                \u2502                                              \u2502\n\u2502                                \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      LAYERED CACHE (L1 + L2)                             \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\u2502\n\u2502   \u2502   \u2502 L1: In-Memory (hot data, microsecond access)                    \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - LRU eviction                                               \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Size-bounded                                               \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Process-local                                              \u2502   \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\u2502\n\u2502   \u2502                            \u2502 miss                                        \u2502\u2502\n\u2502   \u2502                            \u25bc                                             \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\u2502\n\u2502   \u2502   \u2502 L2: Distributed (warm data, millisecond access)                 \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Redis, Memcached, DynamoDB                                \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Shared across instances                                    \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - TTL-based expiration                                       \u2502   \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      CACHE BACKENDS                                      \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\u2502\n\u2502   \u2502   \u2502In-Memory\u2502  \u2502  Redis  \u2502  \u2502Memcached\u2502  \u2502 SQLite  \u2502  \u2502 Custom  \u2502      \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-interface","title":"Cache Interface","text":"<pre><code>// toolcache/cache.go\n\n// Cache defines the pluggable cache interface\ntype Cache interface {\n    // Get retrieves a value, returns (value, found, error)\n    Get(ctx context.Context, key string) ([]byte, bool, error)\n\n    // Set stores a value with TTL (0 = no expiration)\n    Set(ctx context.Context, key string, value []byte, ttl time.Duration) error\n\n    // Delete removes a key\n    Delete(ctx context.Context, key string) error\n\n    // Clear removes keys matching pattern (e.g., \"toolindex:*\")\n    Clear(ctx context.Context, pattern string) error\n\n    // Stats returns cache statistics\n    Stats() CacheStats\n\n    // Close releases resources\n    Close() error\n}\n\n// CacheStats provides observability\ntype CacheStats struct {\n    Hits       int64\n    Misses     int64\n    Size       int64\n    Evictions  int64\n    HitRate    float64\n}\n\n// TypedCache provides type-safe caching with serialization\ntype TypedCache[T any] interface {\n    Get(ctx context.Context, key string) (T, bool, error)\n    Set(ctx context.Context, key string, value T, ttl time.Duration) error\n    GetOrCompute(ctx context.Context, key string, compute func() (T, error), ttl time.Duration) (T, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-backends","title":"Cache Backends","text":"<pre><code>// toolcache/memory.go - In-memory LRU cache\ntype MemoryCache struct {\n    maxSize    int64\n    lru        *lru.Cache[string, []byte]\n    stats      CacheStats\n    mu         sync.RWMutex\n}\n\nfunc NewMemoryCache(opts MemoryCacheOptions) *MemoryCache {\n    return &amp;MemoryCache{\n        maxSize: opts.MaxSize,\n        lru:     lru.New[string, []byte](opts.MaxItems),\n    }\n}\n\n// toolcache/redis.go - Redis-backed cache\ntype RedisCache struct {\n    client  *redis.Client\n    prefix  string\n    stats   CacheStats\n}\n\nfunc NewRedisCache(opts RedisCacheOptions) (*RedisCache, error) {\n    client := redis.NewClient(&amp;redis.Options{\n        Addr:     opts.Addr,\n        Password: opts.Password,\n        DB:       opts.DB,\n    })\n    return &amp;RedisCache{\n        client: client,\n        prefix: opts.Prefix,\n    }, nil\n}\n\n// toolcache/sqlite.go - SQLite-backed persistent cache\ntype SQLiteCache struct {\n    db     *sql.DB\n    stats  CacheStats\n}\n\n// toolcache/layered.go - L1 + L2 layered cache\ntype LayeredCache struct {\n    l1      Cache  // Fast, local (memory)\n    l2      Cache  // Slower, shared (Redis)\n    l1TTL   time.Duration\n}\n\nfunc NewLayeredCache(l1, l2 Cache, l1TTL time.Duration) *LayeredCache {\n    return &amp;LayeredCache{l1: l1, l2: l2, l1TTL: l1TTL}\n}\n\nfunc (c *LayeredCache) Get(ctx context.Context, key string) ([]byte, bool, error) {\n    // Try L1 first\n    if val, ok, _ := c.l1.Get(ctx, key); ok {\n        return val, true, nil\n    }\n\n    // Fall back to L2\n    val, ok, err := c.l2.Get(ctx, key)\n    if err != nil || !ok {\n        return nil, false, err\n    }\n\n    // Promote to L1\n    _ = c.l1.Set(ctx, key, val, c.l1TTL)\n    return val, true, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-points-in-the-architecture","title":"Cache Points in the Architecture","text":"Component Cache Key Pattern TTL Purpose toolindex <code>index:tool:{id}</code> 1h Tool metadata lookups toolindex <code>index:namespace:{ns}</code> 30m Namespace listings tooldocs <code>docs:{id}:{level}</code> 1h Documentation at each detail level toolsearch <code>search:{hash(query)}</code> 5m Search result caching toolsearch <code>search:index</code> 10m BM25 index caching tooladapter <code>schema:{format}:{id}</code> 24h Schema conversion results toolrun <code>result:{tool}:{hash(input)}</code> varies Idempotent tool results toolsemantic <code>embed:{hash(text)}</code> 24h Vector embeddings"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#integration-with-existing-libraries","title":"Integration with Existing Libraries","text":"<pre><code>// toolindex integration\ntype CachedIndex struct {\n    inner toolindex.Index\n    cache toolcache.Cache\n    ttl   time.Duration\n}\n\nfunc (c *CachedIndex) Get(ctx context.Context, id string) (*toolmodel.Tool, error) {\n    key := fmt.Sprintf(\"index:tool:%s\", id)\n\n    // Try cache first\n    if data, ok, _ := c.cache.Get(ctx, key); ok {\n        var tool toolmodel.Tool\n        if err := json.Unmarshal(data, &amp;tool); err == nil {\n            return &amp;tool, nil\n        }\n    }\n\n    // Cache miss - fetch from index\n    tool, err := c.inner.Get(ctx, id)\n    if err != nil {\n        return nil, err\n    }\n\n    // Store in cache\n    if data, err := json.Marshal(tool); err == nil {\n        _ = c.cache.Set(ctx, key, data, c.ttl)\n    }\n\n    return tool, nil\n}\n\n// toolsearch integration\ntype CachedSearcher struct {\n    inner toolsearch.Searcher\n    cache toolcache.Cache\n    ttl   time.Duration\n}\n\nfunc (c *CachedSearcher) Search(ctx context.Context, query string, limit int) ([]toolsearch.Result, error) {\n    key := fmt.Sprintf(\"search:%x\", sha256.Sum256([]byte(query)))\n\n    // Try cache\n    if data, ok, _ := c.cache.Get(ctx, key); ok {\n        var results []toolsearch.Result\n        if err := json.Unmarshal(data, &amp;results); err == nil {\n            return results, nil\n        }\n    }\n\n    // Execute search\n    results, err := c.inner.Search(ctx, query, limit)\n    if err != nil {\n        return nil, err\n    }\n\n    // Cache results\n    if data, err := json.Marshal(results); err == nil {\n        _ = c.cache.Set(ctx, key, data, c.ttl)\n    }\n\n    return results, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-configuration","title":"Cache Configuration","text":"<pre><code># metatools.yaml\ncache:\n  # Default backend for all caches\n  backend: layered\n\n  # Backend configurations\n  backends:\n    memory:\n      max_size: 100MB\n      max_items: 10000\n\n    redis:\n      addr: localhost:6379\n      password: ${REDIS_PASSWORD}\n      db: 0\n      prefix: metatools\n\n    sqlite:\n      path: /var/cache/metatools/cache.db\n\n    layered:\n      l1: memory\n      l2: redis\n      l1_ttl: 1m\n\n  # Per-component cache settings\n  components:\n    toolindex:\n      enabled: true\n      ttl: 1h\n      backend: layered\n\n    tooldocs:\n      enabled: true\n      ttl: 1h\n      backend: memory  # Docs are static, memory is fine\n\n    toolsearch:\n      enabled: true\n      ttl: 5m\n      backend: redis  # Shared across instances\n\n    tooladapter:\n      enabled: true\n      ttl: 24h\n      backend: sqlite  # Persistent, conversions are expensive\n\n    toolrun:\n      enabled: true\n      ttl: 0  # Per-tool configuration\n      backend: redis\n      # Only cache idempotent tools\n      tools:\n        - describe_tool\n        - list_namespaces\n        - search_tools\n\n  # Cache invalidation\n  invalidation:\n    on_tool_register: true    # Clear index caches\n    on_doc_update: true       # Clear docs caches\n    webhook_endpoint: /cache/invalidate\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-invalidation-strategies","title":"Cache Invalidation Strategies","text":"<pre><code>// toolcache/invalidation.go\n\n// InvalidationStrategy defines how cache entries are invalidated\ntype InvalidationStrategy interface {\n    OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error\n    OnToolUnregistered(ctx context.Context, toolID string) error\n    OnDocUpdated(ctx context.Context, toolID string) error\n}\n\n// PatternInvalidation clears by key patterns\ntype PatternInvalidation struct {\n    cache Cache\n}\n\nfunc (p *PatternInvalidation) OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error {\n    patterns := []string{\n        fmt.Sprintf(\"index:tool:%s\", tool.ID()),\n        fmt.Sprintf(\"index:namespace:%s\", tool.Namespace),\n        \"search:*\",  // All search results potentially affected\n    }\n    for _, pattern := range patterns {\n        if err := p.cache.Clear(ctx, pattern); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n// TTLInvalidation relies on TTL expiration (simpler, eventually consistent)\ntype TTLInvalidation struct{}\n\nfunc (t *TTLInvalidation) OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error {\n    // No-op: cache will expire naturally\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-library-toolcache","title":"Proposed Library: <code>toolcache</code>","text":"<pre><code>toolcache/\n\u251c\u2500\u2500 cache.go           # Cache interface\n\u251c\u2500\u2500 memory.go          # In-memory LRU implementation\n\u251c\u2500\u2500 redis.go           # Redis implementation\n\u251c\u2500\u2500 sqlite.go          # SQLite implementation\n\u251c\u2500\u2500 layered.go         # L1+L2 layered cache\n\u251c\u2500\u2500 stats.go           # Statistics and metrics\n\u251c\u2500\u2500 invalidation.go    # Invalidation strategies\n\u251c\u2500\u2500 typed.go           # Type-safe generic wrapper\n\u251c\u2500\u2500 config.go          # Configuration parsing\n\u2514\u2500\u2500 wrappers/\n    \u251c\u2500\u2500 index.go       # toolindex.Index wrapper\n    \u251c\u2500\u2500 docs.go        # tooldocs.Store wrapper\n    \u251c\u2500\u2500 search.go      # toolsearch.Searcher wrapper\n    \u2514\u2500\u2500 adapter.go     # tooladapter.Adapter wrapper\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#7-additional-cross-cutting-concerns","title":"7. Additional Cross-Cutting Concerns","text":"<p>Beyond the core extension points, production deployments require additional pluggable concerns for resilience, security, and operations.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#71-resilience-patterns","title":"7.1 Resilience Patterns","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       RESILIENCE LAYER                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 CIRCUIT BREAKER                                                          \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 States: CLOSED \u2192 OPEN \u2192 HALF-OPEN \u2192 CLOSED                              \u2502 \u2502\n\u2502  \u2502 - Monitors failure rate per backend/tool                                 \u2502 \u2502\n\u2502  \u2502 - Opens circuit after threshold (e.g., 50% failures in 10s window)      \u2502 \u2502\n\u2502  \u2502 - Allows probe requests in half-open state                               \u2502 \u2502\n\u2502  \u2502 - Prevents cascading failures across backends                            \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 RETRY POLICY                                                             \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Exponential backoff with jitter (prevents retry storms)               \u2502 \u2502\n\u2502  \u2502 - Per-tool retry configuration (idempotent ops only)                    \u2502 \u2502\n\u2502  \u2502 - Retry budgets (max retries per time window)                           \u2502 \u2502\n\u2502  \u2502 - Non-retryable error classification                                     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 BULKHEAD                                                                 \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Isolated resource pools per backend                                    \u2502 \u2502\n\u2502  \u2502 - Semaphore-based concurrency limits                                     \u2502 \u2502\n\u2502  \u2502 - Prevents resource exhaustion from single backend                      \u2502 \u2502\n\u2502  \u2502 - Configurable queue depth and timeout                                   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 TIMEOUT MANAGEMENT                                                       \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Per-tool timeout configuration                                         \u2502 \u2502\n\u2502  \u2502 - Cascading timeouts (request \u2192 backend \u2192 tool)                         \u2502 \u2502\n\u2502  \u2502 - Context deadline propagation                                           \u2502 \u2502\n\u2502  \u2502 - Graceful timeout handling with partial results                        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>// toolresilience/circuit_breaker.go\n\ntype CircuitBreaker interface {\n    Execute(ctx context.Context, fn func() error) error\n    State() CircuitState\n    Reset()\n}\n\ntype CircuitState int\n\nconst (\n    StateClosed CircuitState = iota\n    StateOpen\n    StateHalfOpen\n)\n\ntype CircuitBreakerConfig struct {\n    FailureThreshold    int           // failures before opening\n    SuccessThreshold    int           // successes in half-open before closing\n    Timeout             time.Duration // time in open state before half-open\n    WindowSize          time.Duration // sliding window for failure counting\n}\n\n// toolresilience/retry.go\n\ntype RetryPolicy interface {\n    Execute(ctx context.Context, fn func() error) error\n    ShouldRetry(err error, attempt int) bool\n}\n\ntype RetryConfig struct {\n    MaxAttempts     int\n    InitialBackoff  time.Duration\n    MaxBackoff      time.Duration\n    BackoffFactor   float64\n    Jitter          float64       // 0-1, randomization factor\n    RetryBudget     *RetryBudget  // optional rate limiting\n    NonRetryable    []error       // errors that should not be retried\n}\n\n// toolresilience/bulkhead.go\n\ntype Bulkhead interface {\n    Acquire(ctx context.Context) error\n    Release()\n    Available() int\n}\n\ntype BulkheadConfig struct {\n    MaxConcurrent int\n    MaxWait       time.Duration\n    QueueDepth    int\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#72-health-checks","title":"7.2 Health Checks","text":"<pre><code>// toolhealth/health.go\n\ntype HealthChecker interface {\n    Check(ctx context.Context) HealthStatus\n    Name() string\n}\n\ntype HealthStatus struct {\n    Status    Status            // healthy, degraded, unhealthy\n    Details   map[string]any\n    Timestamp time.Time\n}\n\ntype Status string\n\nconst (\n    StatusHealthy   Status = \"healthy\"\n    StatusDegraded  Status = \"degraded\"\n    StatusUnhealthy Status = \"unhealthy\"\n)\n\n// Composite health aggregates multiple checkers\ntype CompositeHealth struct {\n    checkers []HealthChecker\n}\n\nfunc (c *CompositeHealth) Check(ctx context.Context) HealthStatus {\n    results := make(map[string]HealthStatus)\n    overall := StatusHealthy\n\n    for _, checker := range c.checkers {\n        status := checker.Check(ctx)\n        results[checker.Name()] = status\n\n        if status.Status == StatusUnhealthy {\n            overall = StatusUnhealthy\n        } else if status.Status == StatusDegraded &amp;&amp; overall != StatusUnhealthy {\n            overall = StatusDegraded\n        }\n    }\n\n    return HealthStatus{\n        Status:    overall,\n        Details:   map[string]any{\"components\": results},\n        Timestamp: time.Now(),\n    }\n}\n\n// Built-in health checkers\ntype BackendHealthChecker struct{ registry BackendRegistry }\ntype CacheHealthChecker struct{ cache Cache }\ntype SearchHealthChecker struct{ index Index }\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#73-secrets-management","title":"7.3 Secrets Management","text":"<pre><code>// toolsecrets/secrets.go\n\ntype SecretsManager interface {\n    Get(ctx context.Context, key string) (string, error)\n    GetWithMetadata(ctx context.Context, key string) (*Secret, error)\n    Watch(ctx context.Context, key string, callback func(*Secret)) error\n    Close() error\n}\n\ntype Secret struct {\n    Value     string\n    Version   int\n    ExpiresAt time.Time\n    Metadata  map[string]string\n}\n\n// Implementations\ntype VaultSecretsManager struct {\n    client       *vault.Client\n    secretPath   string\n    cacheTTL     time.Duration\n    rotationChan chan string\n}\n\ntype AWSSecretsManager struct {\n    client *secretsmanager.Client\n    region string\n}\n\ntype EnvSecretsManager struct {\n    prefix string  // e.g., \"METATOOLS_SECRET_\"\n}\n</code></pre> <pre><code># metatools.yaml\nsecrets:\n  provider: vault  # vault, aws, env, file\n\n  vault:\n    addr: ${VAULT_ADDR}\n    auth_method: kubernetes  # token, kubernetes, approle\n    secret_path: secret/data/metatools\n    cache_ttl: 5m\n\n  # Backend credentials resolved from secrets\n  backends:\n    openai:\n      api_key: \"{{ secrets.openai_api_key }}\"\n    github:\n      token: \"{{ secrets.github_token }}\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#74-configuration-hot-reload","title":"7.4 Configuration Hot-Reload","text":"<pre><code>// toolconfig/watcher.go\n\ntype ConfigWatcher interface {\n    Watch(ctx context.Context, path string, callback func(Config)) error\n    Stop() error\n}\n\ntype FSConfigWatcher struct {\n    watcher *fsnotify.Watcher\n    parser  ConfigParser\n}\n\nfunc (w *FSConfigWatcher) Watch(ctx context.Context, path string, callback func(Config)) error {\n    if err := w.watcher.Add(path); err != nil {\n        return err\n    }\n\n    go func() {\n        for {\n            select {\n            case event := &lt;-w.watcher.Events:\n                if event.Op&amp;fsnotify.Write == fsnotify.Write {\n                    if cfg, err := w.parser.Parse(path); err == nil {\n                        callback(cfg)\n                    }\n                }\n            case &lt;-ctx.Done():\n                return\n            }\n        }\n    }()\n\n    return nil\n}\n\n// Hot-reloadable components\ntype HotReloadable interface {\n    Reload(cfg Config) error\n}\n\n// Registry tracks reloadable components\ntype ReloadRegistry struct {\n    components map[string]HotReloadable\n}\n\nfunc (r *ReloadRegistry) ReloadAll(cfg Config) error {\n    for name, component := range r.components {\n        if err := component.Reload(cfg); err != nil {\n            return fmt.Errorf(\"reload %s: %w\", name, err)\n        }\n    }\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#75-feature-flags","title":"7.5 Feature Flags","text":"<pre><code>// toolflags/flags.go\n\ntype FeatureFlags interface {\n    IsEnabled(ctx context.Context, flag string) bool\n    GetVariant(ctx context.Context, flag string) string\n    AllFlags(ctx context.Context) map[string]bool\n}\n\n// Local file-based flags (simple deployments)\ntype LocalFeatureFlags struct {\n    flags map[string]bool\n    mu    sync.RWMutex\n}\n\n// LaunchDarkly integration (enterprise)\ntype LaunchDarklyFlags struct {\n    client *ld.LDClient\n    user   func(ctx context.Context) ld.User\n}\n\n// Use case: Gradual tool rollout\nfunc (h *Handler) RunTool(ctx context.Context, req Request) (Response, error) {\n    if h.flags.IsEnabled(ctx, \"new_execution_engine\") {\n        return h.newRunner.Run(ctx, req)\n    }\n    return h.legacyRunner.Run(ctx, req)\n}\n</code></pre> <pre><code># metatools.yaml\nfeature_flags:\n  provider: local  # local, launchdarkly, unleash\n\n  local:\n    path: /etc/metatools/flags.yaml\n    reload_interval: 30s\n\n  flags:\n    new_execution_engine: false\n    semantic_search: true\n    multi_tenant_mode: false\n    streaming_responses: true\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#76-audit-trail-event-sourcing","title":"7.6 Audit Trail / Event Sourcing","text":"<pre><code>// toolaudit/audit.go\n\ntype AuditLogger interface {\n    Log(ctx context.Context, event AuditEvent) error\n    Query(ctx context.Context, filter AuditFilter) ([]AuditEvent, error)\n}\n\ntype AuditEvent struct {\n    ID          string\n    Timestamp   time.Time\n    EventType   EventType\n    Actor       Actor\n    Resource    Resource\n    Action      string\n    Outcome     Outcome\n    Details     map[string]any\n    RequestID   string\n    SessionID   string\n}\n\ntype EventType string\n\nconst (\n    EventToolExecution   EventType = \"tool.execution\"\n    EventToolDiscovery   EventType = \"tool.discovery\"\n    EventConfigChange    EventType = \"config.change\"\n    EventAuthAttempt     EventType = \"auth.attempt\"\n    EventBackendError    EventType = \"backend.error\"\n)\n\n// Implementations\ntype FileAuditLogger struct{ path string }\ntype DatabaseAuditLogger struct{ db *sql.DB }\ntype CloudWatchAuditLogger struct{ client *cloudwatchlogs.Client }\n\n// Compliance-ready: immutable append-only log\ntype ImmutableAuditLogger struct {\n    inner  AuditLogger\n    signer crypto.Signer  // Signs each entry\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#77-backpressure-load-shedding","title":"7.7 Backpressure / Load Shedding","text":"<pre><code>// toolpressure/backpressure.go\n\ntype LoadShedder interface {\n    ShouldShed(ctx context.Context) bool\n    CurrentLoad() float64\n}\n\ntype AdaptiveLoadShedder struct {\n    targetLatency time.Duration\n    maxLoad       float64\n\n    // Metrics\n    currentLatency atomic.Value\n    activeRequests atomic.Int64\n}\n\nfunc (s *AdaptiveLoadShedder) ShouldShed(ctx context.Context) bool {\n    // Little's Law: if latency &gt; target and load &gt; threshold, shed\n    latency := s.currentLatency.Load().(time.Duration)\n    load := float64(s.activeRequests.Load()) / s.maxLoad\n\n    return latency &gt; s.targetLatency &amp;&amp; load &gt; 0.8\n}\n\n// Priority-based shedding\ntype PriorityLoadShedder struct {\n    inner      LoadShedder\n    priorities map[string]int  // tool -&gt; priority (higher = more important)\n}\n\nfunc (s *PriorityLoadShedder) ShouldShed(ctx context.Context, tool string) bool {\n    if !s.inner.ShouldShed(ctx) {\n        return false\n    }\n\n    // Don't shed high-priority tools\n    priority := s.priorities[tool]\n    return priority &lt; 5  // Only shed low-priority requests\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-for-all-concerns","title":"Configuration for All Concerns","text":"<pre><code># metatools.yaml - Cross-Cutting Concerns\nresilience:\n  circuit_breaker:\n    enabled: true\n    failure_threshold: 5\n    success_threshold: 2\n    timeout: 30s\n    window_size: 10s\n\n  retry:\n    enabled: true\n    max_attempts: 3\n    initial_backoff: 100ms\n    max_backoff: 5s\n    jitter: 0.2\n\n  bulkhead:\n    enabled: true\n    default_concurrent: 100\n    per_backend:\n      openai: 50    # Rate-limited API\n      github: 200\n      local: 500\n\n  timeout:\n    default: 30s\n    per_tool:\n      execute_code: 120s\n      search_tools: 5s\n\nhealth:\n  endpoint: /health\n  detailed_endpoint: /health/detailed\n  check_interval: 10s\n  components:\n    - backends\n    - cache\n    - search_index\n\nbackpressure:\n  enabled: true\n  target_latency: 500ms\n  max_concurrent: 1000\n  shed_priority_below: 5\n\naudit:\n  enabled: true\n  provider: file  # file, database, cloudwatch\n  path: /var/log/metatools/audit.log\n  events:\n    - tool.execution\n    - auth.attempt\n    - config.change\n  retention_days: 90\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#summary-cross-cutting-concerns-catalog","title":"Summary: Cross-Cutting Concerns Catalog","text":"Concern Purpose Priority Proposed Library Cache Response/metadata caching High <code>toolcache</code> Circuit Breaker Prevent cascading failures High <code>toolresilience</code> Retry Handle transient failures High <code>toolresilience</code> Bulkhead Resource isolation Medium <code>toolresilience</code> Health Checks Monitoring/orchestration High <code>toolhealth</code> Secrets Credential management High <code>toolsecrets</code> Config Reload Zero-downtime updates Medium <code>toolconfig</code> Feature Flags Gradual rollout Medium <code>toolflags</code> Audit Trail Compliance/debugging High <code>toolaudit</code> Backpressure Overload protection Medium <code>toolpressure</code> Timeout Deadline management High Built-in (context) Tracing Distributed observability High <code>toolobserve</code>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-backend-architecture","title":"Multi-Backend Architecture","text":"<p>The backend layer is the foundation for tool discovery and execution. It enables metatools-mcp to aggregate tools from multiple sources while presenting a unified interface to MCP clients.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_3","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           MCP CLIENT                                         \u2502\n\u2502                    (Claude, Cursor, Custom)                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502 MCP Protocol\n                                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS-MCP SERVER                                 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                      UNIFIED TOOL INTERFACE                              \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2502   search_tools    describe_tool    run_tool    run_chain    execute_code \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                    \u2502                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                       BACKEND REGISTRY                                   \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502 \u2502\n\u2502  \u2502   \u2502   LOCAL     \u2502 \u2502   OPENAI    \u2502 \u2502    MCP      \u2502 \u2502   CUSTOM    \u2502       \u2502 \u2502\n\u2502  \u2502   \u2502  Backend    \u2502 \u2502  Backend    \u2502 \u2502  Backend    \u2502 \u2502  Backend    \u2502       \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502 \u2502\n\u2502  \u2502          \u2502               \u2502               \u2502               \u2502               \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502               \u2502               \u2502               \u2502\n              \u25bc               \u25bc               \u25bc               \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502  Local   \u2502   \u2502  OpenAI  \u2502   \u2502  Other   \u2502   \u2502  Custom  \u2502\n        \u2502  Files   \u2502   \u2502   API    \u2502   \u2502   MCP    \u2502   \u2502   API    \u2502\n        \u2502          \u2502   \u2502          \u2502   \u2502 Servers  \u2502   \u2502          \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-backend-interface","title":"The Backend Interface","text":"<p>Each backend implements a common interface, allowing uniform handling regardless of the tool source:</p> <pre><code>// Backend defines a source of tools\ntype Backend interface {\n    // Identity\n    Kind() string                                    // e.g., \"local\", \"openai\", \"mcp\"\n    Name() string                                    // Instance name for disambiguation\n\n    // Configuration\n    Configure(raw []byte) error                      // Parse backend-specific config\n\n    // Discovery\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n\n    // Execution\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n\n    // Lifecycle\n    Start(ctx context.Context) error\n    Stop() error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#backend-types","title":"Backend Types","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-local-backend","title":"1. Local Backend","text":"<p>Tools defined as files on disk (YAML, JSON, or Go handlers).</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   LOCAL BACKEND                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   ~/.config/metatools/tools/                         \u2502\n\u2502   \u251c\u2500\u2500 calculator.yaml      \u2192 Tool definition         \u2502\n\u2502   \u251c\u2500\u2500 file-ops.yaml        \u2192 Tool definition         \u2502\n\u2502   \u2514\u2500\u2500 custom/                                        \u2502\n\u2502       \u2514\u2500\u2500 my-tool.yaml     \u2192 Tool definition         \u2502\n\u2502                                                       \u2502\n\u2502   /usr/share/metatools/tools/                        \u2502\n\u2502   \u2514\u2500\u2500 system-tools.yaml    \u2192 System-wide tools       \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    paths:                                            \u2502\n\u2502      - ~/.config/metatools/tools                    \u2502\n\u2502      - /usr/share/metatools/tools                   \u2502\n\u2502    watch: true  # Hot reload on changes             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-api-backends-openai-azure-anthropic","title":"2. API Backends (OpenAI, Azure, Anthropic)","text":"<p>Tools exposed via LLM provider APIs.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   OPENAI BACKEND                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502   \u2502 metatools   \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  OpenAI API         \u2502    \u2502\n\u2502   \u2502   run_tool  \u2502        \u2502  /chat/completions  \u2502    \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502  (function calling) \u2502    \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    api_key: ${OPENAI_API_KEY}                       \u2502\n\u2502    organization: ${OPENAI_ORG}                      \u2502\n\u2502    models:                                           \u2502\n\u2502      - gpt-4                                        \u2502\n\u2502      - gpt-4-turbo                                  \u2502\n\u2502    timeout: 30s                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-mcp-backend","title":"3. MCP Backend","text":"<p>Connect to other MCP servers as tool sources.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    MCP BACKEND                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   metatools-mcp                                      \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u2502 stdio                                       \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502   \u2502  GitHub     \u2502  \u2190 npx @modelcontextprotocol/     \u2502\n\u2502   \u2502  MCP Server \u2502       server-github               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   GitHub API tools:                                  \u2502\n\u2502   - create_issue                                    \u2502\n\u2502   - list_pull_requests                              \u2502\n\u2502   - search_code                                     \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    kind: mcp                                        \u2502\n\u2502    command: npx                                     \u2502\n\u2502    args:                                            \u2502\n\u2502      - \"-y\"                                         \u2502\n\u2502      - \"@modelcontextprotocol/server-github\"        \u2502\n\u2502    env:                                             \u2502\n\u2502      GITHUB_TOKEN: ${GITHUB_TOKEN}                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-http-backend","title":"4. HTTP Backend","text":"<p>Tools exposed via REST APIs.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   HTTP BACKEND                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   metatools-mcp                                      \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u2502 HTTPS                                       \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502   \u2502  Internal Tool Server   \u2502                       \u2502\n\u2502   \u2502  tools.company.internal \u2502                       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   Endpoints:                                         \u2502\n\u2502   - POST /tools/list                                \u2502\n\u2502   - POST /tools/{name}/execute                      \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    base_url: https://tools.company.internal         \u2502\n\u2502    auth:                                            \u2502\n\u2502      type: oauth2                                   \u2502\n\u2502      client_id: ${OAUTH_CLIENT_ID}                  \u2502\n\u2502      client_secret: ${OAUTH_CLIENT_SECRET}          \u2502\n\u2502    headers:                                         \u2502\n\u2502      X-Custom-Header: value                         \u2502\n\u2502    timeout: 30s                                     \u2502\n\u2502    retry:                                           \u2502\n\u2502      max_attempts: 3                                \u2502\n\u2502      backoff: exponential                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-custom-backend","title":"5. Custom Backend","text":"<p>For specialized integrations that don't fit standard patterns.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  CUSTOM BACKEND                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   Implement the Backend interface in Go:             \u2502\n\u2502                                                       \u2502\n\u2502   type MyCustomBackend struct {                     \u2502\n\u2502       // Your fields                                \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Kind() string {         \u2502\n\u2502       return \"my-custom\"                            \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Configure(raw []byte)   \u2502\n\u2502       error {                                       \u2502\n\u2502       // Parse your custom config                   \u2502\n\u2502       return yaml.Unmarshal(raw, &amp;b.config)         \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Execute(ctx, tool,      \u2502\n\u2502       args) (any, error) {                          \u2502\n\u2502       // Your execution logic                       \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config (passed as raw bytes):                      \u2502\n\u2502    kind: custom                                     \u2502\n\u2502    handler: my-custom                               \u2502\n\u2502    config:                                          \u2502\n\u2502      whatever_you_need: value                       \u2502\n\u2502      nested:                                        \u2502\n\u2502        custom: structure                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-examples","title":"Configuration Examples","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comprehensive-multi-backend-setup","title":"Comprehensive Multi-Backend Setup","text":"<pre><code># metatools.yaml\nbackends:\n  # Local file-based tools\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n      - /usr/share/metatools/tools\n    watch: true  # Hot reload\n\n  # OpenAI function calling\n  openai:\n    enabled: true\n    api_key: ${OPENAI_API_KEY}\n    organization: ${OPENAI_ORG}\n    models:\n      - gpt-4\n      - gpt-4-turbo\n    timeout: 30s\n\n  # Azure OpenAI\n  azure-openai:\n    enabled: true\n    kind: azure\n    config:\n      endpoint: https://my-resource.openai.azure.com\n      api_key: ${AZURE_OPENAI_KEY}\n      api_version: \"2024-02-15-preview\"\n      deployment: gpt-4\n\n  # GitHub MCP server\n  github:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n      env:\n        GITHUB_TOKEN: ${GITHUB_TOKEN}\n\n  # Filesystem MCP server\n  filesystem:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"/home/user/projects\"]\n\n  # Internal company tool server\n  internal-tools:\n    enabled: true\n    kind: http\n    config:\n      base_url: https://tools.internal.company.com/api/v1\n      auth:\n        type: oauth2\n        token_url: https://auth.company.com/oauth/token\n        client_id: ${INTERNAL_CLIENT_ID}\n        client_secret: ${INTERNAL_CLIENT_SECRET}\n        scopes: [\"tools:read\", \"tools:execute\"]\n      timeout: 60s\n\n  # LangChain tools\n  langchain:\n    enabled: false\n    kind: custom\n    config:\n      toolkit: serpapi\n      api_key: ${SERPAPI_KEY}\n\n  # Database tools\n  database:\n    enabled: true\n    kind: custom\n    config:\n      driver: postgres\n      connection_string: ${DATABASE_URL}\n      read_only: true\n      allowed_schemas: [\"public\", \"analytics\"]\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-aggregation-flow","title":"Tool Aggregation Flow","text":"<p>When a client searches for or executes tools, metatools-mcp aggregates across all backends:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TOOL SEARCH FLOW                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client: search_tools(\"file operations\")                                   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    BACKEND REGISTRY                                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502   \u2502\n\u2502   \u2502   \u2502  local  \u2502   \u2502 github  \u2502   \u2502  azure  \u2502   \u2502  http   \u2502            \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518            \u2502   \u2502\n\u2502   \u2502        \u2502             \u2502             \u2502             \u2502                  \u2502   \u2502\n\u2502   \u2502        \u25bc             \u25bc             \u25bc             \u25bc                  \u2502   \u2502\n\u2502   \u2502   ListTools()   ListTools()   ListTools()   ListTools()            \u2502   \u2502\n\u2502   \u2502        \u2502             \u2502             \u2502             \u2502                  \u2502   \u2502\n\u2502   \u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502   \u2502\n\u2502   \u2502                             \u2502                                        \u2502   \u2502\n\u2502   \u2502                             \u25bc                                        \u2502   \u2502\n\u2502   \u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502   \u2502\n\u2502   \u2502                    \u2502   AGGREGATOR    \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Merge tools  \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Deduplicate  \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Apply search \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502   \u2502\n\u2502   \u2502                             \u2502                                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                 \u25bc                                            \u2502\n\u2502   Results:                                                                   \u2502\n\u2502   [                                                                          \u2502\n\u2502     { id: \"local/file-read\",      backend: \"local\",    score: 0.95 },       \u2502\n\u2502     { id: \"github/get-file\",      backend: \"github\",   score: 0.87 },       \u2502\n\u2502     { id: \"filesystem/read_file\", backend: \"mcp\",      score: 0.82 },       \u2502\n\u2502   ]                                                                          \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-execution-flow","title":"Tool Execution Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        TOOL EXECUTION FLOW                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client: run_tool(\"github/create_issue\", { title: \"Bug\", body: \"...\" })   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      TOOL ROUTER                                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   1. Parse tool ID: \"github/create_issue\"                           \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 backend: \"github\"                                           \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 tool: \"create_issue\"                                        \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   2. Lookup backend in registry                                     \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 Found: GitHubMCPBackend                                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   3. Delegate execution                                              \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 backend.Execute(ctx, \"create_issue\", args)                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                   GITHUB MCP BACKEND                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   1. Forward to MCP subprocess                                      \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 npx @modelcontextprotocol/server-github                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   2. MCP call: tools/call { name: \"create_issue\", arguments: ... }  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   3. Receive result                                                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   Result:                                                                    \u2502\n\u2502   {                                                                          \u2502\n\u2502     result: { issue_number: 123, url: \"https://github.com/...\" },          \u2502\n\u2502     backend: { kind: \"mcp\", name: \"github\" },                              \u2502\n\u2502     duration_ms: 1250                                                       \u2502\n\u2502   }                                                                          \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#registration-patterns","title":"Registration Patterns","text":"<p>Backends can be registered via YAML configuration or programmatically:</p> <pre><code>// YAML-driven registration (config file)\nfunc (r *BackendRegistry) LoadFromConfig(cfg BackendsConfig) error {\n    for name, backendCfg := range cfg.Backends {\n        if !backendCfg.Enabled {\n            continue\n        }\n\n        // Create backend based on kind\n        backend, err := r.createBackend(backendCfg.Kind)\n        if err != nil {\n            return fmt.Errorf(\"backend %s: %w\", name, err)\n        }\n\n        // Configure with raw config (backend parses itself)\n        if err := backend.Configure(backendCfg.RawConfig); err != nil {\n            return fmt.Errorf(\"backend %s config: %w\", name, err)\n        }\n\n        r.backends[name] = backend\n    }\n    return nil\n}\n\n// Programmatic registration (code-driven)\nfunc main() {\n    registry := NewBackendRegistry()\n\n    // Register a custom backend programmatically\n    myBackend := &amp;MyCustomBackend{\n        // ... configuration\n    }\n    registry.Register(\"my-backend\", myBackend)\n\n    // Or use the builder pattern\n    registry.\n        WithLocal(\"~/.config/metatools/tools\").\n        WithOpenAI(os.Getenv(\"OPENAI_API_KEY\")).\n        WithMCP(\"github\", \"npx\", \"-y\", \"@modelcontextprotocol/server-github\")\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#hybrid-configuration","title":"Hybrid Configuration","text":"<p>For maximum flexibility, backends support both YAML and code:</p> <pre><code>// Backend interface with hybrid config support\ntype Backend interface {\n    Kind() string\n    Name() string\n\n    // Option 1: YAML-driven config\n    Configure(raw []byte) error\n\n    // Option 2: Programmatic config (for complex backends)\n    ConfigureWith(opts ...BackendOption) error\n\n    // Operations\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Usage: Some config in YAML, some in code\nfunc setupBackends(registry *BackendRegistry, cfg Config) error {\n    // Load standard backends from YAML\n    if err := registry.LoadFromConfig(cfg.Backends); err != nil {\n        return err\n    }\n\n    // Add a complex custom backend programmatically\n    customBackend := NewDatabaseBackend(\n        WithConnectionPool(pool),\n        WithQueryValidator(validator),\n        WithAuditLogger(auditLog),\n    )\n    registry.Register(\"database\", customBackend)\n\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#error-handling-across-backends","title":"Error Handling Across Backends","text":"<pre><code>// Backend errors include source information\ntype BackendError struct {\n    Backend   string    // Which backend failed\n    Operation string    // What operation failed\n    Tool      string    // Which tool (if applicable)\n    Cause     error     // Underlying error\n    Retryable bool      // Can this be retried?\n}\n\n// Aggregated errors for multi-backend operations\ntype AggregatedError struct {\n    Errors []BackendError\n}\n\nfunc (e *AggregatedError) Error() string {\n    // Format: \"3 backends failed: local: connection refused, openai: rate limited, ...\"\n}\n\n// Partial success handling\ntype AggregatedResult struct {\n    Tools   []toolmodel.Tool  // Successfully retrieved tools\n    Errors  []BackendError    // Backends that failed\n    Partial bool              // True if some backends failed\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#summary-what-this-enables","title":"Summary: What This Enables","text":"Capability Description Tool Aggregation Single search across all backends Unified Execution Consistent interface regardless of backend Hot Plugging Add/remove backends via config without code changes Custom Backends Write Go code for specialized integrations MCP Composition Chain multiple MCP servers together Hybrid Config YAML for standard backends, code for complex ones Graceful Degradation Continue working if some backends fail"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-design","title":"Configuration Design","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#recommended-koanf-cobra","title":"Recommended: Koanf + Cobra","text":"Component Library Rationale CLI framework Cobra Subcommands (<code>stdio</code>, <code>serve</code>, <code>version</code>) Config loading Koanf Lighter than Viper, modular providers"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-structure","title":"Configuration Structure","text":"<pre><code># metatools.yaml\nserver:\n  name: \"metatools-mcp\"\n  version: \"0.2.0\"\n\ntransport:\n  type: sse           # stdio | sse | http\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n    tls:\n      enabled: true\n      cert: /etc/ssl/cert.pem\n      key: /etc/ssl/key.pem\n    timeouts:\n      read: 30s\n      write: 30s\n      idle: 120s\n\nsearch:\n  strategy: bm25      # lexical | bm25 | semantic\n  bm25:\n    name_boost: 3\n    namespace_boost: 2\n    tags_boost: 2\n    max_docs: 0\n    max_doctext_len: 0\n\nexecution:\n  timeout: 10s\n  max_tool_calls: 64\n  max_chain_steps: 8\n\n# Tool providers (each gets own config section)\nproviders:\n  search_tools:\n    enabled: true\n  describe_tool:\n    enabled: true\n    default_level: summary\n  run_tool:\n    enabled: true\n  run_chain:\n    enabled: true\n  execute_code:\n    enabled: true      # Requires toolruntime build tag\n    sandbox: dev\n\n# Backend sources for tools\nbackends:\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n      - /usr/share/metatools/tools\n  openai:\n    enabled: false\n    api_key: ${OPENAI_API_KEY}\n  azure:\n    enabled: false\n    tenant_id: ${AZURE_TENANT_ID}\n\n# Middleware chain\nmiddleware:\n  logging:\n    enabled: true\n    level: info\n  auth:\n    enabled: false\n    type: bearer\n  rate_limit:\n    enabled: false\n    requests_per_minute: 100\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-precedence","title":"Configuration Precedence","text":"<pre><code>CLI flags &gt; Environment variables &gt; Config file &gt; Defaults\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#plugin-configuration-pattern","title":"Plugin Configuration Pattern","text":"<p>Plugins receive raw config and parse themselves:</p> <pre><code>type Plugin interface {\n    Name() string\n    Configure(raw []byte) error  // Plugin parses its own config\n    Start(ctx context.Context) error\n    Stop() error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-approach","title":"Implementation Approach","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-1-cli-framework-cobra-koanf","title":"Phase 1: CLI Framework (Cobra + Koanf)","text":"<ol> <li>Add Cobra for subcommands (<code>metatools stdio</code>, <code>metatools serve</code>)</li> <li>Add Koanf for config file loading</li> <li>Maintain backward compatibility (env vars still work)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-2-transport-abstraction","title":"Phase 2: Transport Abstraction","text":"<ol> <li>Define <code>Transport</code> interface</li> <li>Extract current stdio logic into <code>StdioTransport</code></li> <li>Add <code>SSETransport</code> for HTTP/SSE mode</li> <li>Wire transport selection to config/CLI</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-3-tool-provider-registry","title":"Phase 3: Tool Provider Registry","text":"<ol> <li>Define <code>ToolProvider</code> interface</li> <li>Convert existing handlers to providers</li> <li>Replace <code>registerTools()</code> with registry iteration</li> <li>Enable external provider registration</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-4-backend-registry","title":"Phase 4: Backend Registry","text":"<ol> <li>Define <code>BackendRegistry</code> interface</li> <li>Implement config-driven backend loading</li> <li>Support local, API, and MCP server backends</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-5-middleware-chain","title":"Phase 5: Middleware Chain","text":"<ol> <li>Define <code>Middleware</code> type</li> <li>Implement logging, auth, rate limiting</li> <li>Apply middleware via config</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#end-to-end-examples","title":"End-to-End Examples","text":"<p>This section demonstrates how the pluggable architecture works in practice with complete examples.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-1-enterprise-ai-assistant","title":"Example 1: Enterprise AI Assistant","text":"<p>An internal AI assistant that aggregates tools from multiple sources.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ENTERPRISE AI ASSISTANT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      FRONTEND / CLIENTS                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502   \u2502\n\u2502   \u2502   \u2502  Slack    \u2502  \u2502  Teams    \u2502  \u2502   Web     \u2502  \u2502  VS Code  \u2502        \u2502   \u2502\n\u2502   \u2502   \u2502   Bot     \u2502  \u2502   Bot     \u2502  \u2502   App     \u2502  \u2502 Extension \u2502        \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518        \u2502   \u2502\n\u2502   \u2502         \u2502              \u2502              \u2502              \u2502               \u2502   \u2502\n\u2502   \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                              \u2502 HTTPS/SSE                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                  \u25bc                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      METATOOLS-MCP SERVER                            \u2502   \u2502\n\u2502   \u2502                         (HA Cluster)                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Transport: SSE on :8080                                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Middleware Chain:                                                  \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502   \u2502\n\u2502   \u2502   \u2502  Log   \u2502\u2192\u2502 OAuth  \u2502\u2192\u2502 Rate   \u2502\u2192\u2502 Audit  \u2502\u2192\u2502 Cache  \u2502           \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Tool Providers:                                                    \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502   \u2502   \u2502 search_tools \u2502 \u2502 describe    \u2502 \u2502 run_tool    \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502              \u2502 \u2502 _tool       \u2502 \u2502             \u2502               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Backends:                                                          \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502\n\u2502   \u2502   \u2502  Jira    \u2502 \u2502Confluence\u2502 \u2502  GitHub  \u2502 \u2502 Internal \u2502              \u2502   \u2502\n\u2502   \u2502   \u2502   MCP    \u2502 \u2502   MCP    \u2502 \u2502   MCP    \u2502 \u2502   API    \u2502              \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502\n\u2502   \u2502        \u2502            \u2502            \u2502            \u2502                     \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502            \u25bc            \u25bc            \u25bc            \u25bc                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502    Jira      \u2502 \u2502  Confluence  \u2502 \u2502    GitHub    \u2502 \u2502   Company    \u2502       \u2502\n\u2502   \u2502    Cloud     \u2502 \u2502    Cloud     \u2502 \u2502              \u2502 \u2502     API      \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># metatools-enterprise.yaml\nserver:\n  name: \"enterprise-ai-assistant\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n    tls:\n      enabled: true\n      cert: /etc/ssl/certs/server.crt\n      key: /etc/ssl/private/server.key\n    cors:\n      enabled: true\n      origins:\n        - \"https://chat.company.com\"\n        - \"https://slack-bot.company.internal\"\n    health:\n      enabled: true\n\nmiddleware:\n  chain: [logging, auth, rate_limit, audit, cache]\n\n  logging:\n    enabled: true\n    level: info\n    format: json\n\n  auth:\n    enabled: true\n    type: oauth2\n    issuer: https://auth.company.com\n    audience: metatools-api\n    jwks_uri: https://auth.company.com/.well-known/jwks.json\n\n  rate_limit:\n    enabled: true\n    storage: redis\n    redis:\n      address: redis.company.internal:6379\n    default:\n      requests_per_minute: 60\n    per_user: true\n\n  audit:\n    enabled: true\n    destination: elasticsearch\n    elasticsearch:\n      addresses: [\"https://es.company.internal:9200\"]\n      index: metatools-audit\n\n  cache:\n    enabled: true\n    backend: redis\n    redis:\n      address: redis.company.internal:6379\n    per_tool:\n      search_tools:\n        ttl: 1m\n      describe_tool:\n        ttl: 10m\n\nbackends:\n  jira:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@anthropic/mcp-server-jira\"]\n      env:\n        JIRA_URL: https://company.atlassian.net\n        JIRA_EMAIL: ${JIRA_EMAIL}\n        JIRA_API_TOKEN: ${JIRA_API_TOKEN}\n\n  confluence:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@anthropic/mcp-server-confluence\"]\n      env:\n        CONFLUENCE_URL: https://company.atlassian.net/wiki\n        CONFLUENCE_EMAIL: ${CONFLUENCE_EMAIL}\n        CONFLUENCE_API_TOKEN: ${CONFLUENCE_API_TOKEN}\n\n  github:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n      env:\n        GITHUB_TOKEN: ${GITHUB_TOKEN}\n\n  internal-api:\n    enabled: true\n    kind: http\n    config:\n      base_url: https://api.company.internal/tools/v1\n      auth:\n        type: oauth2\n        token_url: https://auth.company.com/oauth/token\n        client_id: ${INTERNAL_CLIENT_ID}\n        client_secret: ${INTERNAL_CLIENT_SECRET}\n        scopes: [\"tools:read\", \"tools:execute\"]\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-2-local-development-setup","title":"Example 2: Local Development Setup","text":"<p>A developer workstation with file system access and code execution.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    LOCAL DEVELOPMENT SETUP                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                       DEVELOPER MACHINE                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                             \u2502   \u2502\n\u2502   \u2502   \u2502   Claude Desktop  \u2502 \u2190\u2500\u2500 stdio \u2500\u2500\u2510                               \u2502   \u2502\n\u2502   \u2502   \u2502   or Cursor IDE   \u2502             \u2502                               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502                               \u2502   \u2502\n\u2502   \u2502                                      \u2502                               \u2502   \u2502\n\u2502   \u2502                                      \u25bc                               \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502              METATOOLS-MCP (stdio mode)                      \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Build: go build -tags \"toolsearch,toolruntime\"            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Features:                                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - BM25 search (toolsearch tag)                            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Code execution (toolruntime tag)                        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Backends:                                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502   Local    \u2502 \u2502 Filesystem \u2502 \u2502   Git      \u2502              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502   Tools    \u2502 \u2502    MCP     \u2502 \u2502   MCP      \u2502              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502         \u2502              \u2502              \u2502                      \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502             \u2502              \u2502              \u2502                          \u2502   \u2502\n\u2502   \u2502             \u25bc              \u25bc              \u25bc                          \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502   \u2502\n\u2502   \u2502   \u2502 ~/.config/ \u2502   \u2502 ~/Projects \u2502   \u2502 .git repos \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2502 metatools/ \u2502   \u2502            \u2502   \u2502            \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2502 tools/     \u2502   \u2502            \u2502   \u2502            \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># ~/.config/metatools/config.yaml\nserver:\n  name: \"dev-metatools\"\n  version: \"local\"\n\ntransport:\n  type: stdio\n\nsearch:\n  strategy: bm25\n  bm25:\n    name_boost: 3\n    namespace_boost: 2\n\nexecution:\n  timeout: 30s\n  max_tool_calls: 100\n\nmiddleware:\n  chain: [logging]\n  logging:\n    enabled: true\n    level: debug\n    output: /tmp/metatools.log\n\nbackends:\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n    watch: true\n\n  filesystem:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args:\n        - \"-y\"\n        - \"@modelcontextprotocol/server-filesystem\"\n        - \"~/Projects\"\n        - \"~/Documents\"\n\n  git:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-git\"]\n</code></pre> <p>Custom Local Tool Definition:</p> <pre><code># ~/.config/metatools/tools/project-tools.yaml\ntools:\n  - name: run_tests\n    namespace: dev\n    description: Run project tests with optional coverage\n    inputSchema:\n      type: object\n      properties:\n        path:\n          type: string\n          description: Project path\n        coverage:\n          type: boolean\n          default: false\n      required: [path]\n\n    backend:\n      kind: local\n      handler: run_tests\n\n  - name: lint_code\n    namespace: dev\n    description: Run linter on project\n    inputSchema:\n      type: object\n      properties:\n        path:\n          type: string\n        fix:\n          type: boolean\n          default: false\n      required: [path]\n\n    backend:\n      kind: local\n      handler: lint_code\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-3-multi-llm-tool-router","title":"Example 3: Multi-LLM Tool Router","text":"<p>A gateway that routes tool calls to different LLM providers.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MULTI-LLM TOOL ROUTER                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502                         \u2502   Application   \u2502                                  \u2502\n\u2502                         \u2502   (Your App)    \u2502                                  \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2502\n\u2502                                  \u2502 MCP                                       \u2502\n\u2502                                  \u25bc                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      METATOOLS-MCP ROUTER                            \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502                    TOOL AGGREGATOR                           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   All tools from all backends visible as one unified set    \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   search_tools(\"weather\") \u2192                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   [                                                          \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"openai/get_weather\", backend: \"openai\" },        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"anthropic/weather_lookup\", backend: \"anthropic\" },\u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"local/weather_api\", backend: \"local\" }           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   ]                                                          \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502                    SMART ROUTER                              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Routes based on:                                           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Tool prefix (openai/*, anthropic/*, local/*)            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Cost optimization                                        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Latency requirements                                     \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Fallback on failure                                     \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502   \u2502\n\u2502   \u2502          \u2502                   \u2502                   \u2502                   \u2502   \u2502\n\u2502   \u2502          \u25bc                   \u25bc                   \u25bc                   \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502\n\u2502   \u2502   \u2502   OpenAI   \u2502     \u2502 Anthropic  \u2502     \u2502   Local    \u2502              \u2502   \u2502\n\u2502   \u2502   \u2502  Backend   \u2502     \u2502  Backend   \u2502     \u2502  Backend   \u2502              \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502\n\u2502   \u2502         \u2502                   \u2502                 \u2502                      \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502             \u2502                   \u2502                 \u2502                          \u2502\n\u2502             \u25bc                   \u25bc                 \u25bc                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502   \u2502    OpenAI API    \u2502 \u2502  Anthropic API   \u2502 \u2502   Local Tools    \u2502            \u2502\n\u2502   \u2502                  \u2502 \u2502                  \u2502 \u2502                  \u2502            \u2502\n\u2502   \u2502  - GPT-4 tools   \u2502 \u2502  - Claude tools  \u2502 \u2502  - Custom tools  \u2502            \u2502\n\u2502   \u2502  - DALL-E        \u2502 \u2502  - Computer use  \u2502 \u2502  - File ops      \u2502            \u2502\n\u2502   \u2502  - Whisper       \u2502 \u2502                  \u2502 \u2502  - Scripts       \u2502            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># multi-llm-router.yaml\nserver:\n  name: \"llm-tool-router\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    port: 8080\n\nmiddleware:\n  chain: [logging, metrics, cost_tracking]\n\n  cost_tracking:\n    enabled: true\n    storage: postgres\n    postgres:\n      connection_string: ${DATABASE_URL}\n\nbackends:\n  openai:\n    enabled: true\n    kind: openai\n    config:\n      api_key: ${OPENAI_API_KEY}\n      organization: ${OPENAI_ORG}\n      models:\n        - gpt-4\n        - gpt-4-turbo\n        - dall-e-3\n      default_model: gpt-4-turbo\n      timeout: 60s\n\n  anthropic:\n    enabled: true\n    kind: anthropic\n    config:\n      api_key: ${ANTHROPIC_API_KEY}\n      models:\n        - claude-3-opus\n        - claude-3-sonnet\n      default_model: claude-3-sonnet\n      timeout: 60s\n\n  local:\n    enabled: true\n    paths:\n      - /opt/metatools/tools\n\nrouting:\n  # Route by prefix\n  prefix_routing:\n    \"openai/*\": openai\n    \"anthropic/*\": anthropic\n    \"local/*\": local\n\n  # Fallback chain\n  fallback:\n    - openai\n    - anthropic\n    - local\n\n  # Cost optimization\n  cost_aware:\n    enabled: true\n    prefer_cheaper: true\n    budget_per_hour: 10.00\n    currency: USD\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-4-microservices-tool-mesh","title":"Example 4: Microservices Tool Mesh","text":"<p>A distributed architecture where each service exposes tools via MCP.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     MICROSERVICES TOOL MESH                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                        API GATEWAY                                   \u2502   \u2502\n\u2502   \u2502                    (Kong / Envoy / etc)                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                \u2502                                             \u2502\n\u2502                                \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                   METATOOLS-MCP AGGREGATOR                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Transport: gRPC (internal), SSE (external)                        \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Service Discovery: Kubernetes / Consul                            \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Aggregates tools from all registered MCP services                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                \u2502                                             \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502\n\u2502         \u2502                      \u2502                      \u2502                     \u2502\n\u2502         \u25bc                      \u25bc                      \u25bc                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502  Orders    \u2502        \u2502  Users     \u2502        \u2502  Inventory \u2502               \u2502\n\u2502   \u2502  Service   \u2502        \u2502  Service   \u2502        \u2502  Service   \u2502               \u2502\n\u2502   \u2502            \u2502        \u2502            \u2502        \u2502            \u2502               \u2502\n\u2502   \u2502  MCP Tools:\u2502        \u2502  MCP Tools:\u2502        \u2502  MCP Tools:\u2502               \u2502\n\u2502   \u2502  - create  \u2502        \u2502  - lookup  \u2502        \u2502  - check   \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502    _user   \u2502        \u2502    _stock  \u2502               \u2502\n\u2502   \u2502  - cancel  \u2502        \u2502  - update  \u2502        \u2502  - reserve \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502    _prefs  \u2502        \u2502    _item   \u2502               \u2502\n\u2502   \u2502  - track   \u2502        \u2502  - auth    \u2502        \u2502  - release \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502            \u2502        \u2502    _item   \u2502               \u2502\n\u2502   \u2502            \u2502        \u2502            \u2502        \u2502            \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502         \u2502                      \u2502                      \u2502                     \u2502\n\u2502         \u25bc                      \u25bc                      \u25bc                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502 Orders DB  \u2502        \u2502 Users DB   \u2502        \u2502Inventory DB\u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Aggregator Configuration:</p> <pre><code># aggregator.yaml\nserver:\n  name: \"tool-mesh-aggregator\"\n  version: \"1.0.0\"\n\ntransports:\n  - type: sse\n    enabled: true\n    http:\n      port: 8080\n      # External-facing\n\n  - type: grpc\n    enabled: true\n    grpc:\n      port: 9090\n      # Internal service mesh\n\nservice_discovery:\n  type: kubernetes\n  kubernetes:\n    namespace: production\n    label_selector: \"mcp.enabled=true\"\n    port_name: mcp-grpc\n\nbackends:\n  # Auto-discovered from Kubernetes\n  auto_discover:\n    enabled: true\n    refresh_interval: 30s\n\n  # Or explicit configuration\n  orders:\n    enabled: true\n    kind: grpc\n    config:\n      address: orders-service.production.svc:9090\n      tls:\n        enabled: true\n        ca_cert: /etc/ssl/ca.crt\n\n  users:\n    enabled: true\n    kind: grpc\n    config:\n      address: users-service.production.svc:9090\n\n  inventory:\n    enabled: true\n    kind: grpc\n    config:\n      address: inventory-service.production.svc:9090\n</code></pre> <p>Service Configuration (e.g., Orders Service):</p> <pre><code># orders-service/mcp-config.yaml\nserver:\n  name: \"orders-service-mcp\"\n  version: \"2.1.0\"\n\ntransport:\n  type: grpc\n  grpc:\n    port: 9090\n\nproviders:\n  create_order:\n    enabled: true\n  cancel_order:\n    enabled: true\n  track_order:\n    enabled: true\n\nbackends:\n  local:\n    enabled: true\n    # Orders service tools implemented in Go\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-5-request-flow-diagram","title":"Example 5: Request Flow Diagram","text":"<p>A complete request flow through all layers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    COMPLETE REQUEST FLOW                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   1. CLIENT REQUEST                                                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  POST /mcp HTTP/1.1                                                  \u2502   \u2502\n\u2502   \u2502  Content-Type: application/json                                      \u2502   \u2502\n\u2502   \u2502  Authorization: Bearer eyJhbGc...                                   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  {                                                                   \u2502   \u2502\n\u2502   \u2502    \"jsonrpc\": \"2.0\",                                                \u2502   \u2502\n\u2502   \u2502    \"method\": \"tools/call\",                                          \u2502   \u2502\n\u2502   \u2502    \"params\": {                                                      \u2502   \u2502\n\u2502   \u2502      \"name\": \"github/create_issue\",                                 \u2502   \u2502\n\u2502   \u2502      \"arguments\": {                                                 \u2502   \u2502\n\u2502   \u2502        \"repo\": \"company/project\",                                   \u2502   \u2502\n\u2502   \u2502        \"title\": \"Bug: Login fails\",                                 \u2502   \u2502\n\u2502   \u2502        \"body\": \"Steps to reproduce...\"                              \u2502   \u2502\n\u2502   \u2502      }                                                              \u2502   \u2502\n\u2502   \u2502    },                                                               \u2502   \u2502\n\u2502   \u2502    \"id\": \"req-123\"                                                  \u2502   \u2502\n\u2502   \u2502  }                                                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   2. TRANSPORT LAYER (SSE)                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Accept HTTP connection                                           \u2502   \u2502\n\u2502   \u2502  - Parse JSON-RPC request                                           \u2502   \u2502\n\u2502   \u2502  - Create context with request ID                                   \u2502   \u2502\n\u2502   \u2502  - Pass to handler chain                                            \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   3. MIDDLEWARE CHAIN                                                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 LOGGING                                                       \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Log: \"Incoming request req-123 for github/create_issue\"    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Start timer                                                 \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 AUTH                                                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Validate JWT token                                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Extract user: \"alice@company.com\"                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Inject user into context                                    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 RATE LIMIT                                                    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Check: alice@company.com has 45/60 requests remaining      \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Consume 1 token                                             \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Pass through                                                \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 AUDIT                                                         \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Log to audit trail:                                        \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502   { user: \"alice\", tool: \"github/create_issue\", time: ... }  \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   4. TOOL ROUTER                                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Parse tool ID: \"github/create_issue\"                             \u2502   \u2502\n\u2502   \u2502  - Extract backend: \"github\"                                         \u2502   \u2502\n\u2502   \u2502  - Extract tool name: \"create_issue\"                                \u2502   \u2502\n\u2502   \u2502  - Lookup backend in registry                                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   5. BACKEND (GitHub MCP)                                                    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Backend type: MCP subprocess                                      \u2502   \u2502\n\u2502   \u2502  - Command: npx @modelcontextprotocol/server-github                 \u2502   \u2502\n\u2502   \u2502  - Forward MCP call to subprocess                                    \u2502   \u2502\n\u2502   \u2502  - Wait for response                                                 \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   6. EXTERNAL SERVICE (GitHub API)                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - GitHub MCP server calls GitHub API                               \u2502   \u2502\n\u2502   \u2502  - POST https://api.github.com/repos/company/project/issues        \u2502   \u2502\n\u2502   \u2502  - Response: { \"number\": 456, \"url\": \"...\" }                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   7. RESPONSE FLOW (reverse through middleware)                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Audit: Log success                                                \u2502   \u2502\n\u2502   \u2502  - Rate limit: (no action)                                          \u2502   \u2502\n\u2502   \u2502  - Auth: (no action)                                                \u2502   \u2502\n\u2502   \u2502  - Logging: Log \"Completed req-123 in 1.2s, status: success\"        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   8. CLIENT RESPONSE                                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  HTTP/1.1 200 OK                                                     \u2502   \u2502\n\u2502   \u2502  Content-Type: text/event-stream                                    \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  event: message                                                      \u2502   \u2502\n\u2502   \u2502  data: {                                                             \u2502   \u2502\n\u2502   \u2502    \"jsonrpc\": \"2.0\",                                                \u2502   \u2502\n\u2502   \u2502    \"result\": {                                                      \u2502   \u2502\n\u2502   \u2502      \"content\": [{                                                  \u2502   \u2502\n\u2502   \u2502        \"type\": \"text\",                                              \u2502   \u2502\n\u2502   \u2502        \"text\": \"Created issue #456\"                                 \u2502   \u2502\n\u2502   \u2502      }],                                                            \u2502   \u2502\n\u2502   \u2502      \"metadata\": {                                                  \u2502   \u2502\n\u2502   \u2502        \"issue_number\": 456,                                         \u2502   \u2502\n\u2502   \u2502        \"url\": \"https://github.com/company/project/issues/456\"      \u2502   \u2502\n\u2502   \u2502      }                                                              \u2502   \u2502\n\u2502   \u2502    },                                                               \u2502   \u2502\n\u2502   \u2502    \"id\": \"req-123\"                                                  \u2502   \u2502\n\u2502   \u2502  }                                                                   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  event: done                                                         \u2502   \u2502\n\u2502   \u2502  data: {}                                                            \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comparative-analysis","title":"Comparative Analysis","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#your-tool-libraries-vs-industry-patterns","title":"Your Tool Libraries vs. Industry Patterns","text":"Your Pattern Industry Standard Alignment toolindex.Searcher interface Register-on-init pattern Excellent Build-tag gating HashiCorp conditional compilation Same approach Adapter layer Clean Architecture boundaries Textbook Progressive disclosure Apple API design principles Ahead of most"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comparison-with-other-go-mcp-servers","title":"Comparison with Other Go MCP Servers","text":"Project Transport Plugin System Your Advantage Official go-sdk stdio, SSE None Your tool* libraries mark3labs/mcp-go stdio, SSE Basic Your progressive disclosure viant/mcp stdio None Your modular architecture metatools-mcp stdio (SSE planned) Build-tag + interfaces Full stack orchestration <p>Unique value: No other Go MCP server has layered tool libraries with progressive disclosure, BM25 search, and code execution.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#references","title":"References","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#go-plugin-patterns","title":"Go Plugin Patterns","text":"<ul> <li>HashiCorp go-plugin - RPC-based plugin system</li> <li>Register-on-Init Pattern</li> <li>Interface Extension Pattern</li> <li>Clean Architecture with Plugins</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-implementations","title":"MCP Implementations","text":"<ul> <li>Official MCP Go SDK</li> <li>mark3labs/mcp-go</li> <li>viant/mcp</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-libraries","title":"Configuration Libraries","text":"<ul> <li>Koanf - Lighter Viper alternative</li> <li>Cobra - CLI framework</li> <li>Dependency Injection Patterns</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#api-design","title":"API Design","text":"<ul> <li>Progressive Disclosure</li> <li>Apple WWDC22: API Design</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-validation","title":"Architecture Validation","text":"<p>This section documents validation of the proposed architecture against industry best practices and real-world implementations, gathered from multiple research sources (Exa, Firecrawl, GitHub, Context7).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#plugin-architecture-validation","title":"Plugin Architecture Validation \u2713","text":"<p>Sources: cekrem.github.io, blog.devcoffee.me, skoredin.pro, caffeinatedcoder.medium.com, reintech.io</p> <p>Our proposed architecture aligns with established Go plugin patterns:</p> Pattern Our Implementation Industry Validation Dependency Inversion ToolProvider interface abstracts concrete implementations \"High-level modules depend only on abstractions (interfaces)\" - Clean Architecture Interface-Driven Design <code>handlers/interfaces.go</code> defines stable contracts \"Define stable, simple core interfaces\" - Go best practices Plugin Registry ToolProviderRegistry with Register/Get methods \"Central hub for registering plugins with unique names\" - Plugin Registry pattern Plugin Factories Factory functions for backend creation \"A function that returns a new instance of a plugin\" - Factory pattern Graceful Shutdown Context-based cancellation propagation \"Critical feature for supporting context cancellation\" - Production patterns <p>RPC-Based Plugin Pattern (HashiCorp): Our Backend interface supports both in-process and RPC-based plugins, aligning with the industry-recommended approach for fault tolerance.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-chain-validation","title":"Middleware Chain Validation \u2713","text":"<p>Sources: go-chi/chi (21.7k\u2b50), grpc-ecosystem/go-grpc-middleware (6.7k\u2b50)</p> <p>The chi router's <code>chain.go</code> demonstrates the exact pattern we're proposing:</p> <pre><code>// From go-chi/chi - validates our decorator pattern\nfunc chain(middlewares []func(http.Handler) http.Handler, endpoint http.Handler) http.Handler {\n    if len(middlewares) == 0 {\n        return endpoint\n    }\n    h := middlewares[len(middlewares)-1](endpoint)\n    for i := len(middlewares) - 2; i &gt;= 0; i-- {\n        h = middlewares[i](h)\n    }\n    return h\n}\n</code></pre> <p>grpc-ecosystem interceptor categories match our proposed middleware types: - <code>auth/</code> \u2192 Our Auth middleware - <code>logging/</code> \u2192 Our Logging middleware - <code>ratelimit/</code> \u2192 Our RateLimit middleware - <code>recovery/</code> \u2192 Our Recovery/error handling - <code>retry/</code> \u2192 Our Circuit breaker patterns - <code>timeout/</code> \u2192 Our Timeout middleware</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-layer-validation","title":"Transport Layer Validation \u2713","text":"<p>Sources: FreeCodeCamp, go-zero.dev, goa.design, Centrifugo</p> <p>SSE Implementation Requirements (validated): <pre><code>// Required headers for SSE - confirmed across all sources\nw.Header().Set(\"Content-Type\", \"text/event-stream\")\nw.Header().Set(\"Cache-Control\", \"no-cache\")\nw.Header().Set(\"Connection\", \"keep-alive\")\n</code></pre></p> <p>Multi-Transport Architecture Patterns: | Transport | Use Case | Our Support | |-----------|----------|-------------| | HTTP/REST | Request-response APIs | \u2713 Proposed | | SSE | Server-to-client streaming | \u2713 Proposed | | WebSocket | Bidirectional real-time | \u2713 Proposed | | gRPC | High-performance RPC | \u2713 Proposed | | stdio | Local MCP clients | \u2713 Current |</p> <p>Centrifugo WebSocket Scaling Patterns: Validates our approach of using shared state (Redis) for HA deployments with multiple transport instances.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-server-ecosystem-validation","title":"MCP Server Ecosystem Validation \u2713","text":"<p>Sources: viant/mcp, mcp-golang, go-mcp (Reddit), bytesizego.com, dev.to</p> <p>Active Go MCP implementations confirm the viability of our approach:</p> Project Stars Approach Notes viant/mcp Active Interface-based Validates our pattern mcp-golang Active Framework approach Similar extensibility goals mark3labs/mcp-go Popular Simple MCP Basic implementation <p>Key insight: No existing Go MCP server offers the combination of: - Multi-transport support (stdio + HTTP/SSE) - Pluggable tool providers - Configurable search strategies - Multi-backend aggregation - Middleware chain</p> <p>This confirms metatools-mcp's unique positioning in the ecosystem.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-library-validation","title":"Configuration Library Validation \u2713","text":"<p>Sources: Context7 library research, GitHub documentation</p> Library Reputation Code Snippets Recommendation Koanf High 23 \u2713 \"Cleaner, lighter alternative to Viper\" Cobra High 1,126+ \u2713 \"Powerful CLI with subcommands\" <p>This validates our choice of Koanf + Cobra over Viper for configuration management.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#validation-summary","title":"Validation Summary","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  ARCHITECTURE VALIDATION MATRIX                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Component              \u2502 Pattern Validated  \u2502 Source Quality    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Plugin Registry        \u2502 \u2713 Industry standard\u2502 High (multiple)   \u2502\n\u2502 Middleware Chain       \u2502 \u2713 go-chi pattern   \u2502 High (21.7k\u2b50)    \u2502\n\u2502 Transport Abstraction  \u2502 \u2713 Multi-impl refs  \u2502 High (docs + OSS) \u2502\n\u2502 SSE Implementation     \u2502 \u2713 Standard headers \u2502 High (RFC 6455)   \u2502\n\u2502 Backend Interface      \u2502 \u2713 DIP/Clean Arch   \u2502 High (canonical)  \u2502\n\u2502 Config Framework       \u2502 \u2713 Koanf + Cobra    \u2502 High (Context7)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Conclusion: The proposed architecture follows established best practices and patterns validated across multiple high-quality sources. The design is sustainable, maintainable, and aligned with the Go ecosystem's conventions.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-phases","title":"Implementation Phases","text":"<p>A detailed phased implementation plan has been created to break this proposal into manageable chunks. See implementation-phases.md for:</p> <ul> <li>Phase 1: CLI Framework &amp; Configuration (~2 weeks) - Cobra + Koanf foundation</li> <li>Phase 2: Transport Layer Abstraction (~2 weeks) - Stdio + SSE transports</li> <li>Phase 3: Tool Provider Registry (~1 week) - Plug-and-play tool registration</li> <li>Phase 4: Backend Registry (~2 weeks) - Multi-source tool aggregation</li> <li>Phase 5: Middleware Chain (~2 weeks) - Cross-cutting concerns</li> </ul> <p>MVP (Phases 1-3): ~5 weeks Full Implementation: ~9 weeks</p> <p>Each phase includes: - Detailed directory structure changes - Interface definitions with Go code - Implementation tasks with code examples - Verification criteria checklist - Migration notes for backward compatibility</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#component-library-analysis","title":"Component Library Analysis","text":"<p>A comprehensive analysis of the metatools component library ecosystem has been performed. See component-library-analysis.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#library-ecosystem-7-libraries","title":"Library Ecosystem (7 libraries)","text":"Library Version Purpose Changes Needed toolmodel v0.1.2 Core data models Add HTTP/gRPC backend kinds toolindex v0.1.8 Tool registry Add ListTools, OnChange tooldocs v0.1.10 Documentation Add BulkRegisterDocs toolrun v0.1.9 Execution Add HTTPExecutor, GRPCExecutor, ExecutionHook toolcode v0.1.10 Code execution Add EngineRegistry toolsearch v0.1.9 BM25 search No changes (already pluggable) toolruntime v0.1.10 Sandbox runtime Minor config additions"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-findings","title":"Key Findings","text":"<ol> <li>All changes are additive - No breaking changes to existing interfaces</li> <li>toolsearch is exemplary - Already implements pluggable pattern via <code>Searcher</code> interface</li> <li>toolrun needs most work - Core execution layer requires new executor interfaces</li> <li>Error taxonomy needed - Consistent error types across all libraries</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#dependency-graph","title":"Dependency Graph","text":"<pre><code>metatools-mcp\n    \u251c\u2500\u2500 toolcode \u2500\u2500\u252c\u2500\u2500 toolrun \u2500\u2500\u252c\u2500\u2500 toolindex \u2500\u2500 toolmodel \u2500\u2500 mcp-go-sdk\n    \u2502              \u2502             \u2502\n    \u2502              \u251c\u2500\u2500 tooldocs \u2500\u2524\n    \u2502              \u2502             \u2502\n    \u2514\u2500\u2500 toolruntime \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                   toolsearch (optional, implements toolindex.Searcher)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-tenancy-extension","title":"Multi-Tenancy Extension","text":"<p>A comprehensive multi-tenancy design has been created as an extension to this architecture. See multi-tenancy.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#core-concepts","title":"Core Concepts","text":"Concept Description Pluggable Tenant Resolution JWT, API Key, Header, or custom resolvers Tenant-Aware Middleware Rate limiting, tool filtering, audit per tenant Tenant-Scoped Registries Isolated tool/backend views per tenant Configuration Hierarchy Defaults \u2192 Tier \u2192 Tenant overrides Isolation Strategies Shared, Namespace, or Process isolation"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture","title":"Architecture","text":"<pre><code>Request \u2192 Tenant Resolver \u2192 Tenant Middleware Chain \u2192 Tenant-Scoped Registry \u2192 Execution\n              \u2502                     \u2502                        \u2502\n              \u25bc                     \u25bc                        \u25bc\n         TenantContext      Rate Limit + Filter     Filtered Tools/Backends\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-interfaces","title":"Key Interfaces","text":"<pre><code>// Pluggable tenant identification\ntype TenantResolver interface {\n    Resolve(ctx context.Context, req *Request) (*TenantContext, error)\n}\n\n// Tenant configuration overrides\ntype TenantConfig struct {\n    AllowedTools    []string\n    DeniedTools     []string\n    AllowedBackends []string\n    RateLimits      *RateLimitConfig\n    Quotas          *QuotaConfig\n    Features        map[string]bool\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-priority","title":"Implementation Priority","text":"Phase Focus Duration Phase 1 Core multi-tenancy (Tenant, TenantContext, resolvers) 2 weeks Phase 2 Tenant-aware middleware (rate limit, filter, audit) 1 week Phase 3 Tenant storage (memory, Postgres implementations) 1 week Phase 4 Advanced features (scoped registries, isolation strategies) 2 weeks"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-point-catalog","title":"Extension Point Catalog","text":"<p>Comprehensive architecture analysis has revealed that the metatools ecosystem is already 85%+ pluggable. The following 13 extension points exist across the component libraries, ready for configuration and exposure.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#critical-finding","title":"Critical Finding","text":"<p>The architecture is NOT a monolith to be refactored. It is a mature, layered, pluggable architecture that needs: - Exposure - Make internal extension points accessible via configuration - Configuration - Add CLI + config layer (Cobra + Koanf) - Documentation - Catalog the 13 extension points with examples - Examples - Show how to extend each interface</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-points-by-library","title":"Extension Points by Library","text":"# Interface Library Purpose Pluggability 1 <code>SchemaValidator</code> toolmodel JSON Schema validation \u2705 Interface-based 2 <code>Searcher</code> toolindex Tool search strategy \u2705 Interface-based 3 <code>BackendSelector</code> toolindex Multi-backend selection \u2705 Function-based 4 <code>Store</code> tooldocs Documentation storage \u2705 Interface-based 5 <code>ToolResolver</code> tooldocs Tool resolution for docs \u2705 Function-based 6 <code>Runner</code> toolrun Tool execution \u2705 Interface-based 7 <code>MCPExecutor</code> toolrun MCP backend executor \u2705 Interface-based 8 <code>ProviderExecutor</code> toolrun Provider backend executor \u2705 Interface-based 9 <code>LocalRegistry</code> toolrun Local handler lookup \u2705 Interface-based 10 <code>Backend</code> toolruntime Sandbox isolation backend \u2705 Interface-based 11 <code>ToolGateway</code> toolruntime Sandbox tool access \u2705 Interface-based 12 <code>Logger</code> toolcode Execution logging \u2705 Interface-based 13 <code>Engine</code> toolcode Language-specific execution \u2705 Interface-based"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#interface-definitions","title":"Interface Definitions","text":"<pre><code>// 1. SchemaValidator - JSON Schema validation strategy\ntype SchemaValidator interface {\n    ValidateSchema(schema map[string]any) error\n    ValidateInput(schema map[string]any, input map[string]any) error\n}\n\n// 2. Searcher - Tool search strategy (toolsearch.BM25Searcher implements this)\ntype Searcher interface {\n    Search(query string, limit int) ([]SearchResult, error)\n    Close() error\n}\n\n// 3. BackendSelector - Multi-backend selection policy\ntype BackendSelector func(tool Tool, backends []ToolBackend) ToolBackend\n\n// 4. Store - Documentation storage\ntype Store interface {\n    DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n    ListExamples(id string, max int) ([]ToolExample, error)\n    RegisterDoc(id string, entry DocEntry) error\n}\n\n// 5. ToolResolver - Tool resolution for documentation\ntype ToolResolver func(id string) (*toolmodel.Tool, error)\n\n// 6. Runner - Tool execution orchestration\ntype Runner interface {\n    Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n}\n\n// 7. MCPExecutor - MCP backend execution\ntype MCPExecutor interface {\n    CallTool(ctx context.Context, server, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, server, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// 8. ProviderExecutor - Provider backend execution\ntype ProviderExecutor interface {\n    CallTool(ctx context.Context, provider, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, provider, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// 9. LocalRegistry - Local handler lookup\ntype LocalRegistry interface {\n    Get(name string) (LocalHandler, bool)\n}\n\n// 10. Backend - Sandbox isolation backend (10 implementations exist)\ntype Backend interface {\n    Name() string\n    Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n    Capabilities() BackendCapabilities\n    Close() error\n}\n\n// 11. ToolGateway - Tool access from sandboxed code\ntype ToolGateway interface {\n    SearchTools(ctx context.Context, query string, limit int) ([]SearchResult, error)\n    ListNamespaces(ctx context.Context) ([]string, error)\n    DescribeTool(ctx context.Context, id string, level DetailLevel) (ToolDoc, error)\n    ListToolExamples(ctx context.Context, id string, max int) ([]ToolExample, error)\n    RunTool(ctx context.Context, toolID string, args map[string]any) (any, error)\n    RunChain(ctx context.Context, steps []ChainStep) (any, []StepResult, error)\n}\n\n// 12. Logger - Execution logging\ntype Logger interface {\n    Info(msg string, fields ...any)\n    Error(msg string, fields ...any)\n    Debug(msg string, fields ...any)\n}\n\n// 13. Engine - Language-specific code execution\ntype Engine interface {\n    Name() string\n    Execute(ctx context.Context, code string, gateway ToolGateway) (any, error)\n    Capabilities() EngineCapabilities\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#existing-implementations","title":"Existing Implementations","text":"Interface Built-in Implementations <code>SchemaValidator</code> <code>DefaultValidator</code> (jsonschema-go) <code>Searcher</code> <code>BM25Searcher</code> (toolsearch, uses Bleve) <code>BackendSelector</code> <code>DefaultBackendSelector</code> (local &gt; provider &gt; mcp) <code>Store</code> <code>InMemoryStore</code> <code>Runner</code> <code>DefaultRunner</code> <code>Backend</code> 10 implementations: unsafe, docker, containerd, kubernetes, firecracker, kata, gvisor, wasm, temporal, remote <code>ToolGateway</code> <code>toolcodeengine.WrapTools()</code> adapter <code>Engine</code> Language-specific engines (JS, Python, etc.)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-diagram","title":"Architecture Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS PLUGGABLE ARCHITECTURE                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         MCP Protocol Layer                                  \u2502 \u2502\n\u2502  \u2502              Transport: Stdio (current) | SSE | WebSocket                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                     \u2502                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         metatools-mcp Server                                \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502 \u2502\n\u2502  \u2502  \u2502  Handlers   \u2502  \u2502  Adapters   \u2502  \u2502   Config    \u2502  \u2502    Middleware       \u2502\u2502 \u2502\n\u2502  \u2502  \u2502  (MCP ops)  \u2502  \u2502  (bridge)   \u2502  \u2502  (YAML/env) \u2502  \u2502  (auth/rate/log)   \u2502\u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502            \u2502                \u2502                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    Component Library Layer                                   \u2502 \u2502\n\u2502  \u2502                                                                              \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502 \u2502\n\u2502  \u2502   \u2502  toolcode    \u2502\u2500\u2500\u2500\u25b6\u2502   toolrun    \u2502\u2500\u2500\u2500\u25b6\u2502  toolindex   \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502  [13:Engine] \u2502    \u2502  [6-9:Exec]  \u2502    \u2502  [2-3:Search]\u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502  [12:Logger] \u2502    \u2502              \u2502    \u2502              \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502 \u2502\n\u2502  \u2502          \u2502                                       \u2502                          \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502 \u2502\n\u2502  \u2502   \u2502 toolruntime  \u2502    \u2502   tooldocs   \u2502    \u2502  toolmodel   \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502 [10:Backend] \u2502    \u2502  [4-5:Store] \u2502    \u2502 [1:Validator]\u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502 [11:Gateway] \u2502    \u2502              \u2502    \u2502              \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502 \u2502\n\u2502  \u2502                                                                              \u2502 \u2502\n\u2502  \u2502              toolsearch (optional, implements Searcher #2)                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    Sandbox/Runtime Layer (10 backends)                      \u2502 \u2502\n\u2502  \u2502   unsafe | docker | containerd | k8s | firecracker | kata | gvisor | wasm  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#revised-implementation-timeline","title":"Revised Implementation Timeline","text":"<p>Based on the architecture discovery, the implementation timeline has been reduced from 9 weeks to 6-7 weeks because the core pluggable architecture already exists.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#updated-phase-summary","title":"Updated Phase Summary","text":"Phase Focus Duration Rationale Phase 1 CLI + Config 2 weeks Add Cobra CLI and Koanf configuration to expose existing extension points Phase 2 Transport Layer 1-2 weeks Transport interface exists conceptually, needs explicit abstraction Phase 3 Public APIs 1 week Export internal packages, document extension points, provide examples Phase 4 Backend Integration 2 weeks Complete Docker/WASM integration, backend registry configuration Total 6-7 weeks 25% reduction from original 9-week estimate"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-insight","title":"Key Insight","text":"<p>The original proposal assumed significant refactoring work. The architecture discovery revealed:</p> <ol> <li>13 extension points already exist as Go interfaces</li> <li>10 sandbox backends already implemented (docker, k8s, wasm, etc.)</li> <li>Multi-backend per tool already supported with <code>BackendSelector</code></li> <li>Progressive disclosure already implemented (summary/schema/full)</li> <li>Security profiles already exist (dev/standard/hardened)</li> </ol> <p>The work is primarily configuration and exposure, not architecture redesign.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-1-detailed-plan-cli-config","title":"Phase 1 Detailed Plan (CLI + Config)","text":"<p>Goal: Make the 13 extension points configurable via YAML and CLI flags.</p> <pre><code># config.yaml - Complete configuration schema\nserver:\n  transport: stdio  # stdio | sse | websocket\n  port: 8080        # For HTTP transports\n\n# Extension Point #2: Searcher\nsearch:\n  strategy: bm25    # bm25 | simple | semantic\n  config:\n    name_boost: 3.0\n    tags_boost: 2.0\n\n# Extension Point #3: BackendSelector\nbackends:\n  selector: default  # default | latency | cost | custom\n  priority: [local, provider, mcp]\n\n# Extension Point #10: Runtime Backend\nruntime:\n  backend: docker    # unsafe | docker | k8s | wasm | gvisor\n  profile: standard  # dev | standard | hardened\n\n# Extension Point #12: Logger\nlogging:\n  level: info\n  format: json\n</code></pre> <p>CLI Commands: <pre><code>metatools serve --transport=stdio                    # Default MCP mode\nmetatools serve --transport=sse --port=8080          # HTTP/SSE mode\nmetatools serve --config=/path/to/config.yaml        # Full configuration\nmetatools list-tools                                 # List registered tools\nmetatools describe &lt;tool-id&gt;                         # Show tool documentation\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-evaluation","title":"Architecture Evaluation","text":"<p>A comprehensive evaluation against championship-level implementations has been performed. See architecture-evaluation.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#championship-implementations-analyzed","title":"Championship Implementations Analyzed","text":"Project Stars Key Patterns Tencent WeKnora 12,566 Multi-tenant RAG, layered architecture go-kratos/blades 700 Tool interfaces, middleware chain Official MCP Go SDK - Reference implementation patterns Google ADK for Go - A2A protocol, multi-agent fastmcp 22,398 Rapid MCP server development"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#current-position-85-championship-level","title":"Current Position: 85% Championship Level","text":"Category Score Status Core Architecture 95% \u2705 Excellent Pluggability 90% \u2705 13 extension points Security 95% \u2705 10 backends, 3 profiles Observability 40% \u26a0\ufe0f Needs OpenTelemetry Semantic Search 60% \u26a0\ufe0f BM25 only Protocol Coverage 70% \u26a0\ufe0f Missing resources/prompts"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#recommended-new-libraries","title":"Recommended New Libraries","text":"Library Purpose Priority toolobserve OpenTelemetry tracing + metrics High toolsemantic Vector-based semantic search Medium toolresource MCP Resources support Medium toolgateway Auth, rate limit, analytics proxy Medium"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#path-to-championship","title":"Path to Championship","text":"<ol> <li>Observability (toolobserve) - 2 weeks</li> <li>Semantic search (toolsemantic) - 2 weeks</li> <li>MCP Resources (toolresource) - 2 weeks</li> <li>Gateway/Proxy (toolgateway) - 2 weeks</li> </ol> <p>Total to 95%+ championship level: ~8 weeks</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#protocol-agnostic-tools","title":"Protocol-Agnostic Tools","text":"<p>A comprehensive proposal for protocol-agnostic tool exposure and composable toolsets has been created. See protocol-agnostic-tools.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-capabilities","title":"Key Capabilities","text":"Capability Description Protocol-agnostic interface Canonical tool representation independent of source or destination protocol Bidirectional adapters Convert tools between MCP, OpenAI, Anthropic, LangChain formats Toolset composition Create curated tool collections from multiple sources Multi-transport exposure Serve toolsets via MCP, direct client interfaces, REST, or A2A"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-new-libraries","title":"Proposed New Libraries","text":"Library Purpose tooladapter Canonical tool abstraction with protocol adapters toolset Composable tool collections with access control"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#adapter-support-matrix","title":"Adapter Support Matrix","text":"Protocol Import Export Notes MCP \u2705 \u2705 Full JSON Schema support OpenAI \u2705 \u2705 Includes strict mode Anthropic \u2705 \u2705 input_schema mapping LangChain \u2705 \u2705 Zod schema conversion OpenAPI \u2705 - Operation extraction"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#toolset-composition-pattern","title":"Toolset Composition Pattern","text":"<pre><code>// Create customer-specific toolset from multiple sources\ncustomerSet, _ := toolset.NewBuilder(\"customer-acme\").\n    FromRegistry(registry).\n    WithTools(\n        \"mcp.support.create_ticket\",\n        \"mcp.docs.search\",\n        \"openai.functions.analyze\",\n    ).\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedTenants: []string{\"acme-corp\"},\n    }).\n    Build()\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-timeline","title":"Implementation Timeline","text":"<ul> <li>Phase 1: Core adapter library (2 weeks)</li> <li>Phase 2: Toolset composition (2 weeks)</li> <li>Phase 3: Multi-transport exposure (2 weeks)</li> </ul> <p>Total: ~6 weeks</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-strategy","title":"Versioning Strategy","text":"<p>Critical Finding: Tool versioning causes 60% of production agent failures. Backward compatibility is the foundation of agent ecosystem stability.</p> <p>A comprehensive versioning strategy is essential for fast rollforward, safe rollback, and multi-version coexistence.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-layers","title":"Versioning Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        VERSIONING ARCHITECTURE                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  Layer 1: MCP PROTOCOL VERSION                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Version negotiation during initialization                                \u2502 \u2502\n\u2502  \u2502 Current: 2025-11-25 | Supported: [2024-11-05, 2025-03-26, 2025-06-18]  \u2502 \u2502\n\u2502  \u2502 \u2192 Server advertises supported versions                                   \u2502 \u2502\n\u2502  \u2502 \u2192 Client selects compatible version                                      \u2502 \u2502\n\u2502  \u2502 \u2192 Single version used for session                                        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 2: TOOL SCHEMA VERSION                                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Per-tool semantic versioning (MAJOR.MINOR.PATCH)                        \u2502 \u2502\n\u2502  \u2502 \u2192 MAJOR: Breaking input/output schema changes                           \u2502 \u2502\n\u2502  \u2502 \u2192 MINOR: New optional parameters, backward-compatible                   \u2502 \u2502\n\u2502  \u2502 \u2192 PATCH: Bug fixes, documentation updates                                \u2502 \u2502\n\u2502  \u2502 Multiple versions can be active simultaneously                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 3: BACKEND VERSION                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 External API versions (OpenAI v1/v2, GitHub REST/GraphQL)               \u2502 \u2502\n\u2502  \u2502 \u2192 Version-specific adapters                                              \u2502 \u2502\n\u2502  \u2502 \u2192 Automatic version detection                                            \u2502 \u2502\n\u2502  \u2502 \u2192 Graceful degradation                                                   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 4: CONFIGURATION VERSION                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Config file schema versioning                                            \u2502 \u2502\n\u2502  \u2502 \u2192 Version field at config root                                           \u2502 \u2502\n\u2502  \u2502 \u2192 Migration scripts for version upgrades                                 \u2502 \u2502\n\u2502  \u2502 \u2192 Validation against versioned schema                                    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 5: DEPLOYMENT VERSION                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Blue/green, canary deployment support                                    \u2502 \u2502\n\u2502  \u2502 \u2192 Multiple server versions running simultaneously                       \u2502 \u2502\n\u2502  \u2502 \u2192 Traffic splitting by version                                          \u2502 \u2502\n\u2502  \u2502 \u2192 Instant rollback capability                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-protocol-version-negotiation","title":"MCP Protocol Version Negotiation","text":"<pre><code>// toolversion/protocol.go\n\n// ProtocolVersions lists supported MCP specification versions\nvar ProtocolVersions = []string{\n    \"2025-11-25\",  // Latest (default)\n    \"2025-06-18\",  // OAuth 2.1 authorization\n    \"2025-03-26\",  // Batching (later removed)\n    \"2024-11-05\",  // Initial stable release\n}\n\n// VersionNegotiator handles protocol version selection\ntype VersionNegotiator struct {\n    supported []string\n    preferred string\n}\n\nfunc (n *VersionNegotiator) Negotiate(clientVersions []string) (string, error) {\n    // Find best matching version\n    for _, preferred := range n.supported {\n        for _, client := range clientVersions {\n            if preferred == client {\n                return preferred, nil\n            }\n        }\n    }\n    return \"\", ErrNoCompatibleVersion\n}\n\n// Server initialization with version negotiation\nfunc (s *Server) Initialize(ctx context.Context, req *mcp.InitializeRequest) (*mcp.InitializeResult, error) {\n    version, err := s.negotiator.Negotiate(req.ProtocolVersions)\n    if err != nil {\n        return nil, err\n    }\n\n    s.activeVersion = version\n\n    return &amp;mcp.InitializeResult{\n        ProtocolVersion: version,\n        ServerInfo: mcp.ServerInfo{\n            Name:    \"metatools-mcp\",\n            Version: s.serverVersion,\n        },\n        Capabilities: s.capabilitiesForVersion(version),\n    }, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-schema-versioning","title":"Tool Schema Versioning","text":"<pre><code>// toolversion/tool.go\n\n// VersionedTool represents a tool with semantic versioning\ntype VersionedTool struct {\n    toolmodel.Tool\n\n    Version       semver.Version    // e.g., 2.1.0\n    MinVersion    semver.Version    // Minimum compatible version\n    Deprecated    bool\n    DeprecatedMsg string\n    Sunset        time.Time         // When this version will be removed\n}\n\n// ToolVersionRegistry manages multiple versions of tools\ntype ToolVersionRegistry struct {\n    tools map[string]map[semver.Version]*VersionedTool  // name -&gt; version -&gt; tool\n    mu    sync.RWMutex\n}\n\n// Register adds a versioned tool\nfunc (r *ToolVersionRegistry) Register(tool *VersionedTool) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    name := tool.Name()\n    if r.tools[name] == nil {\n        r.tools[name] = make(map[semver.Version]*VersionedTool)\n    }\n\n    r.tools[name][tool.Version] = tool\n    return nil\n}\n\n// Resolve finds the best matching tool version\nfunc (r *ToolVersionRegistry) Resolve(name string, constraint string) (*VersionedTool, error) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    versions, ok := r.tools[name]\n    if !ok {\n        return nil, ErrToolNotFound\n    }\n\n    // Parse constraint (e.g., \"&gt;=1.0.0 &lt;2.0.0\", \"^1.2.3\", \"~1.2.0\")\n    c, err := semver.NewConstraint(constraint)\n    if err != nil {\n        // No constraint = latest stable\n        return r.latestStable(name)\n    }\n\n    // Find best matching version\n    var best *VersionedTool\n    for ver, tool := range versions {\n        if c.Check(&amp;ver) &amp;&amp; !tool.Deprecated {\n            if best == nil || ver.GreaterThan(&amp;best.Version) {\n                best = tool\n            }\n        }\n    }\n\n    if best == nil {\n        return nil, ErrNoCompatibleVersion\n    }\n    return best, nil\n}\n\n// ListVersions returns all versions of a tool\nfunc (r *ToolVersionRegistry) ListVersions(name string) []VersionInfo {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    var versions []VersionInfo\n    for ver, tool := range r.tools[name] {\n        versions = append(versions, VersionInfo{\n            Version:    ver,\n            Deprecated: tool.Deprecated,\n            Sunset:     tool.Sunset,\n        })\n    }\n\n    sort.Slice(versions, func(i, j int) bool {\n        return versions[i].Version.GreaterThan(&amp;versions[j].Version)\n    })\n\n    return versions\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#schema-evolution-compatibility","title":"Schema Evolution &amp; Compatibility","text":"<pre><code>// toolversion/schema.go\n\n// CompatibilityMode defines schema evolution rules\ntype CompatibilityMode string\n\nconst (\n    // BACKWARD: New schema can read old data\n    CompatibilityBackward CompatibilityMode = \"BACKWARD\"\n    // FORWARD: Old schema can read new data\n    CompatibilityForward CompatibilityMode = \"FORWARD\"\n    // FULL: Both backward and forward compatible\n    CompatibilityFull CompatibilityMode = \"FULL\"\n    // NONE: No compatibility guarantees\n    CompatibilityNone CompatibilityMode = \"NONE\"\n)\n\n// SchemaEvolutionRules defines allowed changes per compatibility mode\nvar SchemaEvolutionRules = map[CompatibilityMode]EvolutionRules{\n    CompatibilityBackward: {\n        AllowAddOptionalField:    true,\n        AllowRemoveOptionalField: false,\n        AllowAddRequiredField:    false,  // Breaks old clients\n        AllowRemoveRequiredField: true,   // Old clients still work\n        AllowFieldTypeWidening:   true,   // int \u2192 long\n        AllowFieldTypeNarrowing:  false,\n    },\n    CompatibilityForward: {\n        AllowAddOptionalField:    false,  // Old readers can't handle\n        AllowRemoveOptionalField: true,\n        AllowAddRequiredField:    true,\n        AllowRemoveRequiredField: false,\n        AllowFieldTypeWidening:   false,\n        AllowFieldTypeNarrowing:  true,\n    },\n    CompatibilityFull: {\n        AllowAddOptionalField:    true,   // Only safe change\n        AllowRemoveOptionalField: false,\n        AllowAddRequiredField:    false,\n        AllowRemoveRequiredField: false,\n        AllowFieldTypeWidening:   false,\n        AllowFieldTypeNarrowing:  false,\n    },\n}\n\n// SchemaValidator checks if schema change is compatible\ntype SchemaValidator struct {\n    mode CompatibilityMode\n}\n\nfunc (v *SchemaValidator) ValidateChange(old, new *jsonschema.Schema) error {\n    rules := SchemaEvolutionRules[v.mode]\n    changes := v.detectChanges(old, new)\n\n    for _, change := range changes {\n        if !rules.IsAllowed(change) {\n            return &amp;CompatibilityError{\n                Change: change,\n                Mode:   v.mode,\n            }\n        }\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#version-aware-tool-resolution","title":"Version-Aware Tool Resolution","text":"<pre><code>// toolversion/resolver.go\n\n// VersionedToolRequest specifies version constraints\ntype VersionedToolRequest struct {\n    Name           string\n    VersionSpec    string  // Semver constraint: \"^1.0.0\", \"&gt;=2.0.0\", \"latest\"\n    PreferStable   bool\n    AllowPrerelease bool\n}\n\n// Resolver determines which tool version to use\ntype Resolver struct {\n    registry *ToolVersionRegistry\n    cache    Cache\n    metrics  VersionMetrics\n}\n\nfunc (r *Resolver) Resolve(ctx context.Context, req VersionedToolRequest) (*VersionedTool, error) {\n    // Check cache first\n    cacheKey := fmt.Sprintf(\"resolve:%s:%s\", req.Name, req.VersionSpec)\n    if cached, ok := r.cache.Get(ctx, cacheKey); ok {\n        return cached.(*VersionedTool), nil\n    }\n\n    var tool *VersionedTool\n    var err error\n\n    switch req.VersionSpec {\n    case \"\", \"latest\":\n        tool, err = r.registry.Resolve(req.Name, \"*\")\n    default:\n        tool, err = r.registry.Resolve(req.Name, req.VersionSpec)\n    }\n\n    if err != nil {\n        return nil, err\n    }\n\n    // Warn if using deprecated version\n    if tool.Deprecated {\n        r.metrics.DeprecatedToolUsage.Inc(labels{\n            \"tool\":    req.Name,\n            \"version\": tool.Version.String(),\n        })\n        log.Warn(\"Using deprecated tool version\",\n            \"tool\", req.Name,\n            \"version\", tool.Version,\n            \"message\", tool.DeprecatedMsg,\n            \"sunset\", tool.Sunset,\n        )\n    }\n\n    r.cache.Set(ctx, cacheKey, tool, 5*time.Minute)\n    return tool, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-version-deployment","title":"Multi-Version Deployment","text":"<pre><code>// toolversion/deployment.go\n\n// DeploymentVersion represents a running server version\ntype DeploymentVersion struct {\n    ServerVersion string\n    GitCommit     string\n    BuildTime     time.Time\n    Features      []string\n}\n\n// VersionRouter routes requests to appropriate server versions\ntype VersionRouter struct {\n    versions map[string]*ServerInstance\n    weights  map[string]int  // Traffic percentage\n}\n\n// Route selects server version based on routing rules\nfunc (r *VersionRouter) Route(ctx context.Context, req *Request) (*ServerInstance, error) {\n    // Check for explicit version header\n    if ver := req.Header.Get(\"X-Tool-Version\"); ver != \"\" {\n        if instance, ok := r.versions[ver]; ok {\n            return instance, nil\n        }\n    }\n\n    // Check for client-specified version preference\n    if pref := ctx.Value(versionPreferenceKey); pref != nil {\n        if instance, ok := r.versions[pref.(string)]; ok {\n            return instance, nil\n        }\n    }\n\n    // Weighted random selection (for canary deployments)\n    return r.weightedSelect(), nil\n}\n\n// DeploymentManager handles version lifecycle\ntype DeploymentManager struct {\n    router   *VersionRouter\n    registry *ToolVersionRegistry\n}\n\n// Canary starts a canary deployment\nfunc (m *DeploymentManager) Canary(newVersion string, percentage int) error {\n    m.router.weights[newVersion] = percentage\n    m.router.weights[\"stable\"] = 100 - percentage\n    return nil\n}\n\n// Promote makes a version the new stable\nfunc (m *DeploymentManager) Promote(version string) error {\n    m.router.weights = map[string]int{version: 100}\n    return nil\n}\n\n// Rollback reverts to previous stable version\nfunc (m *DeploymentManager) Rollback() error {\n    // Instant traffic shift to previous stable\n    return m.Promote(m.previousStable)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#version-configuration","title":"Version Configuration","text":"<pre><code># metatools.yaml\nversion: \"1.0.0\"  # Config schema version\n\nserver:\n  version: \"2.3.1\"\n\nprotocol:\n  supported_versions:\n    - \"2025-11-25\"\n    - \"2025-06-18\"\n    - \"2024-11-05\"\n  default_version: \"2025-11-25\"\n\ntools:\n  versioning:\n    enabled: true\n    compatibility_mode: BACKWARD  # BACKWARD, FORWARD, FULL, NONE\n\n    # Per-tool version configuration\n    versions:\n      github/create_issue:\n        - version: \"2.0.0\"\n          status: stable\n        - version: \"1.5.0\"\n          status: deprecated\n          sunset: \"2026-06-01\"\n          message: \"Use v2.0.0 - improved error handling\"\n        - version: \"1.0.0\"\n          status: sunset  # Will be removed\n\n    # Version resolution rules\n    resolution:\n      prefer_stable: true\n      allow_prerelease: false\n      default_constraint: \"^\"  # Caret = compatible with major version\n\ndeployment:\n  strategy: canary  # blue_green, canary, rolling\n\n  canary:\n    initial_percentage: 5\n    increment: 10\n    interval: 5m\n    rollback_threshold:\n      error_rate: 0.05\n      latency_p99: 2s\n\n  versions:\n    stable: \"2.3.0\"\n    canary: \"2.3.1\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-tool-registration-with-versioning","title":"MCP Tool Registration with Versioning","text":"<pre><code>// Expose versioned tools via MCP\nfunc (s *Server) listTools(ctx context.Context) ([]mcp.Tool, error) {\n    var tools []mcp.Tool\n\n    for _, vt := range s.versionRegistry.AllLatestStable() {\n        tool := vt.Tool.ToMCP()\n\n        // Add version metadata as annotations\n        tool.Annotations = map[string]any{\n            \"version\":      vt.Version.String(),\n            \"min_version\":  vt.MinVersion.String(),\n            \"deprecated\":   vt.Deprecated,\n            \"sunset\":       vt.Sunset,\n        }\n\n        // Version in description for AI visibility\n        if vt.Deprecated {\n            tool.Description = fmt.Sprintf(\"[DEPRECATED: %s] %s\",\n                vt.DeprecatedMsg, tool.Description)\n        }\n\n        tools = append(tools, tool)\n    }\n\n    return tools, nil\n}\n\n// Handle tool calls with version resolution\nfunc (s *Server) callTool(ctx context.Context, req *mcp.CallToolRequest) (*mcp.CallToolResult, error) {\n    // Extract version from request (if specified)\n    versionSpec := \"latest\"\n    if v, ok := req.Arguments[\"_version\"].(string); ok {\n        versionSpec = v\n        delete(req.Arguments, \"_version\")  // Remove meta-argument\n    }\n\n    // Resolve tool version\n    tool, err := s.resolver.Resolve(ctx, VersionedToolRequest{\n        Name:        req.Name,\n        VersionSpec: versionSpec,\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    // Execute with resolved version\n    return tool.Execute(ctx, req.Arguments)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-best-practices","title":"Versioning Best Practices","text":"Rule Rationale Never break existing function signatures Old clients must continue working Add optional parameters, never remove required ones Backward compatibility Don't delete safety rules or constraints Maintain security guarantees Deprecate before removing Give users migration time Version from day one Adding versioning later is exponentially harder Announce breaking changes in MAJOR Clear semantic meaning Maintain audit trails for version changes Compliance and debugging"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-library-toolversion","title":"Proposed Library: <code>toolversion</code>","text":"<pre><code>toolversion/\n\u251c\u2500\u2500 protocol.go        # MCP protocol version negotiation\n\u251c\u2500\u2500 semver.go          # Semantic version parsing and comparison\n\u251c\u2500\u2500 registry.go        # Multi-version tool registry\n\u251c\u2500\u2500 resolver.go        # Version constraint resolution\n\u251c\u2500\u2500 schema.go          # Schema evolution validation\n\u251c\u2500\u2500 compatibility.go   # Compatibility mode enforcement\n\u251c\u2500\u2500 deployment.go      # Blue/green, canary deployment support\n\u251c\u2500\u2500 migration.go       # Version migration helpers\n\u2514\u2500\u2500 metrics.go         # Version usage metrics\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#open-questions","title":"Open Questions","text":"<ol> <li>ToolProvider interface - Does the proposed interface feel right for plug-and-play tools?</li> <li>Middleware chain - Useful now, or defer until needed?</li> <li>Backend configuration - YAML-driven or code-only for now?</li> <li>Semantic search - Priority for vector/embedding-based search strategy?</li> <li>Multi-tenancy - Which isolation strategy (shared, namespace, process) is primary target?</li> <li>Versioning compatibility mode - Should BACKWARD be the default, or FULL for maximum safety?</li> <li>MCP protocol versions - How far back should we support? (2024-11-05 is the oldest stable)</li> <li>Tool version in tool names - Should version be part of tool name (<code>github/create_issue@2</code>) or metadata?</li> <li>Breaking change policy - What's the minimum deprecation window before sunset?</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial draft 2026-01-27 Added Multi-Backend Architecture section with diagrams 2026-01-27 Expanded Middleware Chain section with pluggable design 2026-01-27 Added comprehensive Transport Layer section with all protocols 2026-01-27 Added End-to-End Examples section with 5 real-world scenarios 2026-01-27 Added Architecture Validation section with industry pattern verification 2026-01-27 Created detailed Implementation Phases document (see implementation-phases.md) 2026-01-27 Added Component Library Analysis for all 7 tool* libraries (see component-library-analysis.md) 2026-01-28 Added Multi-Tenancy Extension for pluggable tenant isolation (see multi-tenancy.md) 2026-01-28 Added Extension Point Catalog documenting 13 existing pluggable interfaces across all component libraries 2026-01-28 Added Revised Implementation Timeline (6-7 weeks, 25% reduction from original 9-week estimate) 2026-01-28 Key finding: Architecture is already 85%+ pluggable - needs exposure and configuration, not redesign 2026-01-28 Added Architecture Evaluation comparing against 5 championship-level implementations 2026-01-28 Identified 4 potential new libraries: toolobserve, toolsemantic, toolresource, toolgateway 2026-01-28 Added Protocol-Agnostic Tools section with 2 new proposed libraries: tooladapter, toolset 2026-01-28 Created comprehensive proposal for composable toolsets and protocol adapters (see protocol-agnostic-tools.md) 2026-01-28 Added Cache Layer as extension point #6 with pluggable backends (memory, Redis, SQLite, layered) 2026-01-28 Proposed new library: <code>toolcache</code> for cross-component caching with invalidation strategies 2026-01-28 Added section 7: Additional Cross-Cutting Concerns with comprehensive enterprise patterns 2026-01-28 Documented 12 cross-cutting concerns: cache, circuit breaker, retry, bulkhead, health checks, secrets, config reload, feature flags, audit trail, backpressure, timeout, tracing 2026-01-28 Proposed 6 new libraries for cross-cutting concerns: toolresilience, toolhealth, toolsecrets, toolflags, toolaudit, toolpressure 2026-01-28 Added comprehensive Versioning Strategy section (section 19) 2026-01-28 Documented 5 versioning layers: MCP protocol, tool schema, backend, configuration, deployment 2026-01-28 Added schema evolution with BACKWARD/FORWARD/FULL compatibility modes 2026-01-28 Added blue/green and canary deployment support for multi-version coexistence 2026-01-28 Proposed new library: <code>toolversion</code> for semantic versioning and version negotiation"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/","title":"Protocol-Agnostic Tools and Composable Toolsets","text":"<p>Status: Draft Last Updated: 2026-01-28 Authors: Architecture Team</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Executive Summary</li> <li>Problem Statement</li> <li>Goals and Non-Goals</li> <li>Research Findings</li> <li>Proposed Architecture</li> <li>Tool Abstraction Layer</li> <li>Protocol Adapters</li> <li>Composable Toolsets</li> <li>Integration with Existing Libraries</li> <li>Implementation Roadmap</li> <li>Appendix: Industry Patterns</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#executive-summary","title":"Executive Summary","text":"<p>This proposal extends metatools-mcp's pluggable architecture to support protocol-agnostic tool exposure and composable toolsets. Rather than limiting tool consumption to the MCP protocol, we introduce an adaptability layer that enables tools from any source (MCP backends, custom providers, local implementations) to be exposed through multiple transport protocols and consumed by various AI agent frameworks.</p> <p>Key capabilities: - Protocol-agnostic tool interface - Canonical tool representation independent of source or destination protocol - Bidirectional adapters - Convert tools between MCP, OpenAI, Anthropic, LangChain, and other formats - Toolset composition - Create curated tool collections from multiple sources - Multi-transport exposure - Serve toolsets via MCP, direct client interfaces, REST, or A2A</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#problem-statement","title":"Problem Statement","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#current-limitations","title":"Current Limitations","text":"<ol> <li> <p>MCP-Only Exposure: metatools-mcp currently exposes tools exclusively through the MCP protocol. Organizations with mature AI environments using different tool calling conventions (OpenAI function calling, Anthropic tool use, LangChain tools) cannot directly consume metatools without MCP integration.</p> </li> <li> <p>Fixed Tool Collections: All registered tools are exposed as a single collection. There's no mechanism to create curated toolsets for different use cases (development vs production, team A vs team B, customer-specific).</p> </li> <li> <p>One-Way Conversion: Tools flow from backends \u2192 MCP \u2192 clients. There's no standardized way to import tools from external sources (OpenAPI specs, LangChain tools, OpenAI functions) into the metatools ecosystem.</p> </li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#industry-context","title":"Industry Context","text":"<p>Research reveals a fragmented landscape of tool formats:</p> Provider Format Key Differences MCP <code>Tool</code> with <code>inputSchema</code> Rich JSON Schema, supports resources/prompts OpenAI <code>function</code> with <code>parameters</code> Strict mode available, simpler schema Anthropic <code>tool</code> with <code>input_schema</code> Similar to MCP but different field names LangChain <code>StructuredTool</code> Python/JS-centric, Zod schemas A2A Agent-defined Inter-agent tool delegation <p>The Mastra framework demonstrated that proper tool format conversion reduces error rates from 15% to 3% across providers.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#goals-and-non-goals","title":"Goals and Non-Goals","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#goals","title":"Goals","text":"<ol> <li>Protocol Independence: Tools can be consumed without MCP protocol dependency</li> <li>Format Preservation: Tool semantics survive conversion without information loss</li> <li>Bidirectional Flow: Import tools from external sources, export to any format</li> <li>Composability: Create, manage, and expose custom tool collections</li> <li>Backward Compatibility: Existing MCP-based workflows remain unchanged</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#non-goals","title":"Non-Goals","text":"<ol> <li>Runtime Protocol Bridging: We're not building a universal protocol translator</li> <li>Tool Implementation: Adapters convert metadata, not execution logic</li> <li>Full A2A Implementation: Agent orchestration is out of scope</li> <li>Schema Validation Engine: We rely on existing validation libraries</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#research-findings","title":"Research Findings","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-1-unified-tool-abstraction-toolregistry-paper","title":"Pattern 1: Unified Tool Abstraction (ToolRegistry Paper)","text":"<p>The ArXiv paper \"Unified Tool Integration for LLMs\" establishes a three-layer architecture:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Layer 3: API Compatibility              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502 OpenAI  \u2502  \u2502Anthropic\u2502  \u2502LangChain\u2502  \u2502   MCP   \u2502   \u2502\n\u2502   \u2502 Format  \u2502  \u2502 Format  \u2502  \u2502 Format  \u2502  \u2502 Format  \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502            \u2502            \u2502            \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                           \u2502                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Layer 2: Protocol Adapters              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  MCP    \u2502  \u2502 OpenAPI \u2502  \u2502LangChain\u2502  \u2502 Custom  \u2502   \u2502\n\u2502   \u2502 Adapter \u2502  \u2502 Adapter \u2502  \u2502 Adapter \u2502  \u2502 Adapter \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502            \u2502            \u2502            \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                           \u2502                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Layer 1: Unified Abstraction            \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502                    \u2502 Canonical Tool\u2502                    \u2502\n\u2502                    \u2502  Abstraction  \u2502                    \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Insight: The canonical tool representation stores the superset of all schema information, enabling lossless conversion between formats.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-2-langchain-mcp-adapter","title":"Pattern 2: LangChain MCP Adapter","text":"<p>LangChain's <code>langchainjs-mcp-adapters</code> demonstrates practical conversion:</p> <pre><code>// MCP Tool \u2192 LangChain DynamicStructuredTool\nexport async function loadMcpTools(\n  serverName: string,\n  client: Client,\n): Promise&lt;StructuredToolInterface[]&gt; {\n  const toolsResponse = await client.listTools();\n  return toolsResponse.tools.map((tool: MCPTool) =&gt; {\n    return new DynamicStructuredTool({\n      name: `${serverName}_${tool.name}`,\n      description: tool.description || \"\",\n      schema: tool.inputSchema,  // Direct schema pass-through\n      func: callTool.bind(null, serverName, tool.name, client)\n    });\n  });\n}\n</code></pre> <p>Key Insight: Namespacing (<code>serverName_toolName</code>) prevents collisions when aggregating tools from multiple sources.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-3-multi-language-tool-declaration-llm-functions","title":"Pattern 3: Multi-Language Tool Declaration (llm-functions)","text":"<p>The <code>llm-functions</code> library shows format-agnostic tool declaration:</p> <pre><code># Bash: Comment annotations\n# @describe Search the web\n# @option --query! The search query\n# @option --num_results=10 Number of results\nsearch_web() { ... }\n</code></pre> <pre><code>// JavaScript: JSDoc\n/**\n * @typedef {Object} Args\n * @property {string} query - The search query\n * @property {number} [num_results=10] - Number of results\n */\n</code></pre> <pre><code># Python: Type hints + docstrings\ndef search_web(query: str, num_results: int = 10):\n    \"\"\"Search the web.\n\n    Args:\n        query: The search query\n        num_results: Number of results (default: 10)\n    \"\"\"\n</code></pre> <p>Key Insight: All three declarations compile to identical JSON Schema, proving format-agnostic tool definitions are achievable.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-4-tool-rag-for-large-registries","title":"Pattern 4: Tool RAG for Large Registries","text":"<p>For registries with 50+ tools, semantic search dramatically improves tool selection:</p> Approach Accuracy (50 tools) Accuracy (500 tools) Keyword matching 65% 23% BM25 (current) 78% 45% Vector embeddings 89% 72% Hybrid (BM25 + vector) 94% 81% <p>Anthropic's RAG-MCP implementation showed 13% \u2192 43% accuracy improvement using Tool RAG.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#proposed-architecture","title":"Proposed Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#new-library-tooladapter","title":"New Library: <code>tooladapter</code>","text":"<p>A dedicated library for protocol-agnostic tool handling:</p> <pre><code>tooladapter/\n\u251c\u2500\u2500 canonical.go      # Canonical tool representation\n\u251c\u2500\u2500 adapter.go        # Adapter interface\n\u251c\u2500\u2500 adapters/\n\u2502   \u251c\u2500\u2500 mcp.go        # MCP \u2194 Canonical\n\u2502   \u251c\u2500\u2500 openai.go     # OpenAI \u2194 Canonical\n\u2502   \u251c\u2500\u2500 anthropic.go  # Anthropic \u2194 Canonical\n\u2502   \u251c\u2500\u2500 langchain.go  # LangChain \u2194 Canonical\n\u2502   \u2514\u2500\u2500 openapi.go    # OpenAPI \u2194 Canonical\n\u251c\u2500\u2500 schema/\n\u2502   \u251c\u2500\u2500 convert.go    # JSON Schema version conversion\n\u2502   \u2514\u2500\u2500 validate.go   # Schema validation\n\u2514\u2500\u2500 registry.go       # Adapter registry\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#new-library-toolset","title":"New Library: <code>toolset</code>","text":"<p>Composable tool collections:</p> <pre><code>toolset/\n\u251c\u2500\u2500 set.go            # Toolset definition\n\u251c\u2500\u2500 builder.go        # Fluent toolset construction\n\u251c\u2500\u2500 filter.go         # Tool filtering predicates\n\u251c\u2500\u2500 policy.go         # Access control policies\n\u2514\u2500\u2500 expose.go         # Multi-protocol exposure\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        metatools-mcp Server                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502    MCP      \u2502  \u2502   Direct    \u2502  \u2502    REST     \u2502  \u2502    A2A     \u2502  \u2502\n\u2502  \u2502  Transport  \u2502  \u2502   Client    \u2502  \u2502     API     \u2502  \u2502  Protocol  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502         \u2502                \u2502                \u2502               \u2502          \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                          \u2502    toolset      \u2502                         \u2502\n\u2502                          \u2502   Composer      \u2502                         \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502         \u2502                         \u2502                         \u2502        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   Toolset   \u2502  \u2502        Toolset              \u2502  \u2502   Toolset    \u2502 \u2502\n\u2502  \u2502  \"dev-ops\"  \u2502  \u2502      \"customer-x\"           \u2502  \u2502    \"prod\"    \u2502 \u2502\n\u2502  \u2502 [A,C,E,F]   \u2502  \u2502       [B,D,F]               \u2502  \u2502   [A,B,D]    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502         \u2502                         \u2502                         \u2502        \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                          \u2502   tooladapter   \u2502                         \u2502\n\u2502                          \u2502   (Canonical)   \u2502                         \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510 \u2502\n\u2502 \u2502 MCP  \u2502    \u2502  OpenAI  \u2502   \u2502  Anthropic \u2502  \u2502LangChain \u2502  \u2502 OpenAPI\u2502 \u2502\n\u2502 \u2502Adapter\u2502   \u2502  Adapter \u2502   \u2502   Adapter  \u2502  \u2502 Adapter  \u2502  \u2502 Adapter\u2502 \u2502\n\u2502 \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2518 \u2502\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2524\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510 \u2502\n\u2502 \u2502 MCP  \u2502    \u2502 External \u2502   \u2502  External  \u2502  \u2502 External \u2502  \u2502  REST  \u2502 \u2502\n\u2502 \u2502Server\u2502    \u2502  OpenAI  \u2502   \u2502  Anthropic \u2502  \u2502LangChain \u2502  \u2502  APIs  \u2502 \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  Tools   \u2502   \u2502   Tools    \u2502  \u2502  Tools   \u2502  \u2502        \u2502 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#tool-abstraction-layer","title":"Tool Abstraction Layer","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#canonical-tool-interface","title":"Canonical Tool Interface","text":"<pre><code>// tooladapter/canonical.go\n\n// CanonicalTool is the protocol-agnostic tool representation\ntype CanonicalTool struct {\n    // Identity\n    ID          string            // Globally unique identifier\n    Namespace   string            // Source namespace (e.g., \"mcp.github\", \"openai.functions\")\n    Name        string            // Tool name within namespace\n    Version     string            // Semantic version\n\n    // Metadata\n    Description string            // Human-readable description\n    Category    string            // Tool category for grouping\n    Tags        []string          // Searchable tags\n\n    // Schema (superset of all protocol schemas)\n    InputSchema  *JSONSchema      // Full JSON Schema for inputs\n    OutputSchema *JSONSchema      // Optional output schema\n\n    // Execution\n    Handler     ToolHandler       // Execution function\n    Timeout     time.Duration     // Execution timeout\n\n    // Source tracking\n    SourceFormat string           // Original format (mcp, openai, anthropic, etc.)\n    SourceMeta   map[string]any   // Protocol-specific metadata preserved\n\n    // Access control\n    RequiredScopes []string       // OAuth scopes or permissions required\n}\n\n// JSONSchema represents a full JSON Schema with all features\ntype JSONSchema struct {\n    Type        string                 `json:\"type\"`\n    Properties  map[string]*JSONSchema `json:\"properties,omitempty\"`\n    Required    []string               `json:\"required,omitempty\"`\n    Items       *JSONSchema            `json:\"items,omitempty\"`\n    Description string                 `json:\"description,omitempty\"`\n\n    // Extended schema features (preserved during conversion)\n    Enum        []any                  `json:\"enum,omitempty\"`\n    Const       any                    `json:\"const,omitempty\"`\n    Default     any                    `json:\"default,omitempty\"`\n    Minimum     *float64               `json:\"minimum,omitempty\"`\n    Maximum     *float64               `json:\"maximum,omitempty\"`\n    MinLength   *int                   `json:\"minLength,omitempty\"`\n    MaxLength   *int                   `json:\"maxLength,omitempty\"`\n    Pattern     string                 `json:\"pattern,omitempty\"`\n    Format      string                 `json:\"format,omitempty\"`\n\n    // JSON Schema draft compatibility\n    Ref         string                 `json:\"$ref,omitempty\"`\n    Defs        map[string]*JSONSchema `json:\"$defs,omitempty\"`\n}\n\n// ToolHandler executes the tool\ntype ToolHandler func(ctx context.Context, input map[string]any) (any, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#adapter-interface","title":"Adapter Interface","text":"<pre><code>// tooladapter/adapter.go\n\n// Adapter converts between canonical and protocol-specific formats\ntype Adapter interface {\n    // Name returns the adapter identifier (e.g., \"mcp\", \"openai\")\n    Name() string\n\n    // ToCanonical converts protocol-specific tool to canonical form\n    ToCanonical(raw any) (*CanonicalTool, error)\n\n    // FromCanonical converts canonical tool to protocol-specific form\n    FromCanonical(tool *CanonicalTool) (any, error)\n\n    // SupportsFeature checks if adapter supports a schema feature\n    SupportsFeature(feature SchemaFeature) bool\n}\n\n// SchemaFeature represents JSON Schema features that may not be universally supported\ntype SchemaFeature int\n\nconst (\n    FeatureNestedObjects SchemaFeature = iota\n    FeatureArrays\n    FeatureEnums\n    FeaturePatternValidation\n    FeatureRefDefinitions\n    FeatureNullable\n    FeatureAnyOf\n    FeatureOneOf\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#protocol-adapters","title":"Protocol Adapters","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#mcp-adapter","title":"MCP Adapter","text":"<pre><code>// tooladapter/adapters/mcp.go\n\ntype MCPAdapter struct{}\n\nfunc (a *MCPAdapter) Name() string { return \"mcp\" }\n\nfunc (a *MCPAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    mcpTool, ok := raw.(*mcp.Tool)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *mcp.Tool, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"mcp.%s\", mcpTool.Name),\n        Namespace:   \"mcp\",\n        Name:        mcpTool.Name,\n        Description: mcpTool.Description,\n        InputSchema: convertMCPSchema(mcpTool.InputSchema),\n        SourceFormat: \"mcp\",\n        SourceMeta: map[string]any{\n            \"annotations\": mcpTool.Annotations,\n        },\n    }, nil\n}\n\nfunc (a *MCPAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    return &amp;mcp.Tool{\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertToMCPSchema(tool.InputSchema),\n    }, nil\n}\n\nfunc (a *MCPAdapter) SupportsFeature(f SchemaFeature) bool {\n    // MCP supports full JSON Schema\n    return true\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#openai-adapter","title":"OpenAI Adapter","text":"<pre><code>// tooladapter/adapters/openai.go\n\ntype OpenAIAdapter struct {\n    StrictMode bool // Enable OpenAI's strict schema mode\n}\n\nfunc (a *OpenAIAdapter) Name() string { return \"openai\" }\n\nfunc (a *OpenAIAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    fn, ok := raw.(*OpenAIFunction)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *OpenAIFunction, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"openai.%s\", fn.Name),\n        Namespace:   \"openai\",\n        Name:        fn.Name,\n        Description: fn.Description,\n        InputSchema: convertOpenAIParameters(fn.Parameters),\n        SourceFormat: \"openai\",\n        SourceMeta: map[string]any{\n            \"strict\": fn.Strict,\n        },\n    }, nil\n}\n\nfunc (a *OpenAIAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    params := convertToOpenAIParameters(tool.InputSchema, a.StrictMode)\n\n    return &amp;OpenAIFunction{\n        Name:        tool.Name,\n        Description: tool.Description,\n        Parameters:  params,\n        Strict:      a.StrictMode,\n    }, nil\n}\n\nfunc (a *OpenAIAdapter) SupportsFeature(f SchemaFeature) bool {\n    switch f {\n    case FeatureRefDefinitions:\n        return false // OpenAI doesn't support $ref\n    case FeaturePatternValidation:\n        return a.StrictMode // Only in strict mode\n    default:\n        return true\n    }\n}\n\n// OpenAI function format\ntype OpenAIFunction struct {\n    Name        string         `json:\"name\"`\n    Description string         `json:\"description,omitempty\"`\n    Parameters  map[string]any `json:\"parameters\"`\n    Strict      bool           `json:\"strict,omitempty\"`\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#anthropic-adapter","title":"Anthropic Adapter","text":"<pre><code>// tooladapter/adapters/anthropic.go\n\ntype AnthropicAdapter struct{}\n\nfunc (a *AnthropicAdapter) Name() string { return \"anthropic\" }\n\nfunc (a *AnthropicAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    tool, ok := raw.(*AnthropicTool)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *AnthropicTool, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"anthropic.%s\", tool.Name),\n        Namespace:   \"anthropic\",\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertAnthropicSchema(tool.InputSchema),\n        SourceFormat: \"anthropic\",\n    }, nil\n}\n\nfunc (a *AnthropicAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    return &amp;AnthropicTool{\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertToAnthropicSchema(tool.InputSchema),\n    }, nil\n}\n\n// AnthropicTool matches Anthropic's tool format\ntype AnthropicTool struct {\n    Name        string         `json:\"name\"`\n    Description string         `json:\"description,omitempty\"`\n    InputSchema map[string]any `json:\"input_schema\"`\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#schema-conversion-utilities","title":"Schema Conversion Utilities","text":"<pre><code>// tooladapter/schema/convert.go\n\n// StripUnsupportedFeatures removes schema features not supported by target\nfunc StripUnsupportedFeatures(schema *JSONSchema, adapter Adapter) *JSONSchema {\n    result := schema.DeepCopy()\n\n    if !adapter.SupportsFeature(FeatureRefDefinitions) {\n        result = resolveRefs(result)\n    }\n\n    if !adapter.SupportsFeature(FeaturePatternValidation) {\n        clearPatterns(result)\n    }\n\n    if !adapter.SupportsFeature(FeatureAnyOf) {\n        result = flattenAnyOf(result)\n    }\n\n    return result\n}\n\n// PreserveSemantics records stripped features for potential restoration\nfunc PreserveSemantics(original, stripped *JSONSchema) map[string]any {\n    return map[string]any{\n        \"original_features\": detectFeatures(original),\n        \"stripped_features\": detectStrippedFeatures(original, stripped),\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#composable-toolsets","title":"Composable Toolsets","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolset-definition","title":"Toolset Definition","text":"<pre><code>// toolset/set.go\n\n// Toolset represents a curated collection of tools\ntype Toolset struct {\n    ID          string                 // Unique identifier\n    Name        string                 // Human-readable name\n    Description string                 // Purpose description\n\n    // Tool selection\n    Tools       []*tooladapter.CanonicalTool\n\n    // Metadata\n    Tags        []string               // Searchable tags\n    Owner       string                 // Owner/tenant ID\n    CreatedAt   time.Time\n    UpdatedAt   time.Time\n\n    // Access control\n    Policy      *AccessPolicy\n}\n\n// AccessPolicy controls who can use the toolset\ntype AccessPolicy struct {\n    AllowedTenants []string           // Tenant IDs that can access\n    AllowedRoles   []string           // Role-based access\n    RateLimit      *RateLimitConfig   // Optional rate limiting\n    AuditLog       bool               // Enable audit logging\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#fluent-builder","title":"Fluent Builder","text":"<pre><code>// toolset/builder.go\n\n// Builder provides fluent toolset construction\ntype Builder struct {\n    set      *Toolset\n    registry *tooladapter.Registry\n    filters  []FilterFunc\n}\n\n// NewBuilder creates a new toolset builder\nfunc NewBuilder(name string) *Builder {\n    return &amp;Builder{\n        set: &amp;Toolset{\n            ID:   uuid.New().String(),\n            Name: name,\n        },\n    }\n}\n\n// FromRegistry loads tools from an adapter registry\nfunc (b *Builder) FromRegistry(reg *tooladapter.Registry) *Builder {\n    b.registry = reg\n    return b\n}\n\n// WithNamespace includes tools from a specific namespace\nfunc (b *Builder) WithNamespace(ns string) *Builder {\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return t.Namespace == ns\n    })\n    return b\n}\n\n// WithTags includes tools with any of the specified tags\nfunc (b *Builder) WithTags(tags ...string) *Builder {\n    tagSet := make(map[string]bool)\n    for _, t := range tags {\n        tagSet[t] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        for _, tag := range t.Tags {\n            if tagSet[tag] {\n                return true\n            }\n        }\n        return false\n    })\n    return b\n}\n\n// WithTools includes specific tools by ID\nfunc (b *Builder) WithTools(ids ...string) *Builder {\n    idSet := make(map[string]bool)\n    for _, id := range ids {\n        idSet[id] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return idSet[t.ID]\n    })\n    return b\n}\n\n// WithCategory includes tools from a category\nfunc (b *Builder) WithCategory(cat string) *Builder {\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return t.Category == cat\n    })\n    return b\n}\n\n// ExcludeTools removes specific tools by ID\nfunc (b *Builder) ExcludeTools(ids ...string) *Builder {\n    idSet := make(map[string]bool)\n    for _, id := range ids {\n        idSet[id] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return !idSet[t.ID]\n    })\n    return b\n}\n\n// WithPolicy sets access control policy\nfunc (b *Builder) WithPolicy(p *AccessPolicy) *Builder {\n    b.set.Policy = p\n    return b\n}\n\n// Build creates the toolset\nfunc (b *Builder) Build() (*Toolset, error) {\n    if b.registry == nil {\n        return nil, errors.New(\"registry required\")\n    }\n\n    allTools := b.registry.All()\n    for _, tool := range allTools {\n        include := true\n        for _, filter := range b.filters {\n            if !filter(tool) {\n                include = false\n                break\n            }\n        }\n        if include {\n            b.set.Tools = append(b.set.Tools, tool)\n        }\n    }\n\n    b.set.CreatedAt = time.Now()\n    b.set.UpdatedAt = time.Now()\n\n    return b.set, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#usage-examples","title":"Usage Examples","text":"<pre><code>// Example: Creating a DevOps toolset\ndevOpsSet, _ := toolset.NewBuilder(\"devops-tools\").\n    FromRegistry(registry).\n    WithNamespace(\"mcp.github\").\n    WithNamespace(\"mcp.kubernetes\").\n    WithTags(\"ci-cd\", \"deployment\", \"monitoring\").\n    ExcludeTools(\"mcp.github.delete_repo\"). // Too dangerous\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedRoles: []string{\"devops\", \"sre\"},\n        AuditLog:     true,\n    }).\n    Build()\n\n// Example: Customer-specific toolset\ncustomerSet, _ := toolset.NewBuilder(\"customer-acme\").\n    FromRegistry(registry).\n    WithTools(\n        \"mcp.support.create_ticket\",\n        \"mcp.docs.search\",\n        \"mcp.billing.get_invoice\",\n    ).\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedTenants: []string{\"acme-corp\"},\n        RateLimit: &amp;toolset.RateLimitConfig{\n            RequestsPerMinute: 60,\n        },\n    }).\n    Build()\n\n// Example: Production-safe toolset (no destructive operations)\nprodSet, _ := toolset.NewBuilder(\"production\").\n    FromRegistry(registry).\n    WithCategory(\"read-only\").\n    WithTags(\"safe\", \"idempotent\").\n    Build()\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#integration-with-existing-libraries","title":"Integration with Existing Libraries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolindex-integration","title":"toolindex Integration","text":"<p>The tooladapter library integrates with toolindex for tool discovery:</p> <pre><code>// tooladapter/registry.go\n\n// Registry manages tools from multiple sources\ntype Registry struct {\n    index    toolindex.Index\n    adapters map[string]Adapter\n    tools    map[string]*CanonicalTool\n}\n\n// RegisterAdapter adds a protocol adapter\nfunc (r *Registry) RegisterAdapter(adapter Adapter) {\n    r.adapters[adapter.Name()] = adapter\n}\n\n// Import loads tools from an external source\nfunc (r *Registry) Import(format string, tools []any) error {\n    adapter, ok := r.adapters[format]\n    if !ok {\n        return fmt.Errorf(\"unknown format: %s\", format)\n    }\n\n    for _, raw := range tools {\n        canonical, err := adapter.ToCanonical(raw)\n        if err != nil {\n            return err\n        }\n\n        r.tools[canonical.ID] = canonical\n\n        // Register with toolindex for discovery\n        r.index.Register(convertToIndexTool(canonical))\n    }\n\n    return nil\n}\n\n// Export converts tools to a specific format\nfunc (r *Registry) Export(format string, toolIDs []string) ([]any, error) {\n    adapter, ok := r.adapters[format]\n    if !ok {\n        return nil, fmt.Errorf(\"unknown format: %s\", format)\n    }\n\n    var result []any\n    for _, id := range toolIDs {\n        tool, ok := r.tools[id]\n        if !ok {\n            continue\n        }\n\n        exported, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, exported)\n    }\n\n    return result, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolmodel-integration","title":"toolmodel Integration","text":"<p>CanonicalTool embeds and extends toolmodel.Tool:</p> <pre><code>// tooladapter/canonical.go\n\n// CanonicalTool extends toolmodel.Tool with adapter metadata\ntype CanonicalTool struct {\n    toolmodel.Tool // Embed base tool\n\n    // Adapter-specific extensions\n    SourceFormat string\n    SourceMeta   map[string]any\n    OutputSchema *JSONSchema\n}\n\n// ToToolModel converts to base toolmodel.Tool\nfunc (c *CanonicalTool) ToToolModel() *toolmodel.Tool {\n    return &amp;c.Tool\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolrun-integration","title":"toolrun Integration","text":"<p>Toolsets can be exposed through toolrun for execution:</p> <pre><code>// toolset/expose.go\n\n// ExposeViaMCP creates an MCP-compatible tool list from a toolset\nfunc (ts *Toolset) ExposeViaMCP(adapter *adapters.MCPAdapter) ([]*mcp.Tool, error) {\n    var result []*mcp.Tool\n    for _, tool := range ts.Tools {\n        mcpTool, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, mcpTool.(*mcp.Tool))\n    }\n    return result, nil\n}\n\n// ExposeViaOpenAI creates OpenAI function definitions from a toolset\nfunc (ts *Toolset) ExposeViaOpenAI(adapter *adapters.OpenAIAdapter) ([]*OpenAIFunction, error) {\n    var result []*OpenAIFunction\n    for _, tool := range ts.Tools {\n        fn, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, fn.(*OpenAIFunction))\n    }\n    return result, nil\n}\n\n// CreateRunner creates a toolrun.Runner scoped to the toolset\nfunc (ts *Toolset) CreateRunner(baseRunner *toolrun.Runner) *toolrun.Runner {\n    // Create a filtered view of the runner that only exposes toolset tools\n    toolIDs := make(map[string]bool)\n    for _, t := range ts.Tools {\n        toolIDs[t.ID] = true\n    }\n\n    return baseRunner.WithFilter(func(tool *toolmodel.Tool) bool {\n        return toolIDs[tool.ID()]\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-1-core-adapter-library-2-weeks","title":"Phase 1: Core Adapter Library (2 weeks)","text":"<p>Week 1: Foundation - [ ] Create <code>tooladapter</code> module structure - [ ] Implement <code>CanonicalTool</code> and <code>JSONSchema</code> types - [ ] Implement <code>Adapter</code> interface - [ ] Create MCP adapter (bidirectional)</p> <p>Week 2: Additional Adapters - [ ] OpenAI adapter with strict mode support - [ ] Anthropic adapter - [ ] Schema conversion utilities - [ ] Unit tests for all adapters</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-2-toolset-composition-2-weeks","title":"Phase 2: Toolset Composition (2 weeks)","text":"<p>Week 3: Toolset Core - [ ] Create <code>toolset</code> module structure - [ ] Implement <code>Toolset</code> type with metadata - [ ] Implement fluent <code>Builder</code> pattern - [ ] Implement filter predicates</p> <p>Week 4: Integration - [ ] Integrate with <code>toolindex</code> for discovery - [ ] Integrate with <code>toolrun</code> for execution - [ ] Add access control policies - [ ] Integration tests</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-3-multi-transport-exposure-2-weeks","title":"Phase 3: Multi-Transport Exposure (2 weeks)","text":"<p>Week 5: Transport Adapters - [ ] MCP transport (existing, enhanced) - [ ] Direct client interface (Go library) - [ ] REST API transport</p> <p>Week 6: Production Readiness - [ ] Rate limiting integration - [ ] Audit logging - [ ] Documentation - [ ] Example applications</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#dependency-graph","title":"Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Phase 3: Transports                    \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502            \u2502   MCP   \u2502  REST   \u2502 Direct  \u2502                \u2502\n\u2502            \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                 \u2502         \u2502         \u2502                     \u2502\n\u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502                                \u2502                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Phase 2: Toolsets                      \u2502\n\u2502                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502                       \u2502     toolset     \u2502                 \u2502\n\u2502                       \u2502   (composer)    \u2502                 \u2502\n\u2502                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                \u2502                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Phase 1: Adapters                      \u2502\n\u2502                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502                       \u2502   tooladapter   \u2502                 \u2502\n\u2502                       \u2502   (canonical)   \u2502                 \u2502\n\u2502                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                \u2502                          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502    \u2502           \u2502               \u2502               \u2502       \u2502  \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502\n\u2502 \u2502 MCP \u2502  \u2502 OpenAI   \u2502  \u2502 Anthropic  \u2502  \u2502 OpenAPI  \u2502   \u2502  \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#appendix-industry-patterns","title":"Appendix: Industry Patterns","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#a-tool-format-comparison","title":"A. Tool Format Comparison","text":"Field MCP OpenAI Anthropic LangChain Name <code>name</code> <code>name</code> <code>name</code> <code>name</code> Description <code>description</code> <code>description</code> <code>description</code> <code>description</code> Parameters <code>inputSchema</code> <code>parameters</code> <code>input_schema</code> <code>schema</code> Schema Type JSON Schema JSON Schema JSON Schema Zod/JSON Schema Strict Mode N/A <code>strict: true</code> N/A N/A Return Type Content array String/Object Content array Any"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#b-schema-feature-support-matrix","title":"B. Schema Feature Support Matrix","text":"Feature MCP OpenAI OpenAI Strict Anthropic Nested objects \u2705 \u2705 \u2705 \u2705 Arrays \u2705 \u2705 \u2705 \u2705 Enums \u2705 \u2705 \u2705 \u2705 Pattern validation \u2705 \u26a0\ufe0f \u2705 \u2705 $ref definitions \u2705 \u274c \u274c \u274c anyOf/oneOf \u2705 \u26a0\ufe0f \u26a0\ufe0f \u2705 Nullable \u2705 \u2705 \u2705 \u2705 Default values \u2705 \u2705 \u274c \u2705"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#c-error-rate-comparison-mastra-research","title":"C. Error Rate Comparison (Mastra Research)","text":"Scenario No Adapter With Adapter Improvement Simple tools 8% 1% 87.5% Complex schemas 23% 4% 82.6% Cross-provider 31% 5% 83.9% Overall 15% 3% 80%"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#d-related-projects","title":"D. Related Projects","text":"Project Stars Approach Limitations LangChain MCP Adapters ~2k MCP \u2192 LangChain One-way, JS only llm-functions 704 Multi-language declaration No runtime registry kani 598 Python @ai_function Python only Mastra ~500 Compatibility layer TypeScript only"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial draft based on architecture research"}]}