{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"AI Tools Stack","text":"<p>Welcome to the unified documentation for the AI Tools Stack. This site brings all tool libraries together in one place and shows how they compose into a progressive-disclosure MCP surface.</p> <p>Simple and elegant at the core, extensible through modular, pluggable architecture.</p> <p></p>"},{"location":"#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes Index</li> <li>User Journeys Index</li> <li>Stack Changelog</li> </ul>"},{"location":"#what-this-stack-provides","title":"What this stack provides","text":"Layer Components Purpose Foundation toolmodel Canonical MCP tool schema, validation Discovery toolindex, tooldocs, toolsearch, toolsemantic Registry, docs, search strategies Protocol tooladapter Format conversion (MCP \u2194 OpenAI \u2194 Anthropic) Execution toolrun, toolcode, toolruntime Execution, chaining, sandboxing Composition toolset, toolskill Filtered collections, skill workflows Cross-Cutting toolobserve, toolcache Observability, caching Surface metatools-mcp MCP server wiring"},{"location":"#high-level-flow","title":"High-level Flow","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0', 'primaryTextColor': '#fff', 'lineColor': '#4a5568'}}}%%\nflowchart TB\n    subgraph client[\"Client\"]\n        Agent[\"\ud83e\udd16 AI Agent\"]\n    end\n\n    subgraph surface[\"MCP Surface\"]\n        MCP[\"\ud83d\udd37 metatools-mcp&lt;br/&gt;&lt;small&gt;JSON-RPC / SSE&lt;/small&gt;\"]\n    end\n\n    subgraph crosscut[\"Cross-Cutting\"]\n        Observe[\"\ud83d\udc41\ufe0f toolobserve\"]\n        Cache[\"\ud83d\udcbe toolcache\"]\n    end\n\n    subgraph composition[\"Composition\"]\n        Toolset[\"\ud83d\udce6 toolset\"]\n        Skill[\"\ud83c\udfaf toolskill\"]\n    end\n\n    subgraph protocol[\"Protocol\"]\n        Adapter[\"\ud83d\udd04 tooladapter\"]\n    end\n\n    subgraph execution[\"Execution\"]\n        Run[\"\u25b6\ufe0f toolrun\"]\n        Code[\"\ud83d\udcbb toolcode\"]\n        Runtime[\"\ud83c\udfc3 toolruntime\"]\n    end\n\n    subgraph discovery[\"Discovery\"]\n        Index[\"\ud83d\udcc7 toolindex\"]\n        Docs[\"\ud83d\udcda tooldocs\"]\n        Search[\"\ud83d\udd0d toolsearch\"]\n        Semantic[\"\ud83e\udde0 toolsemantic\"]\n    end\n\n    subgraph foundation[\"Foundation\"]\n        Model[\"\ud83e\uddf1 toolmodel\"]\n    end\n\n    subgraph backends[\"Backends\"]\n        Local[\"\ud83c\udfe0 Local\"]\n        Provider[\"\ud83d\udd0c Provider\"]\n        MCPBackend[\"\ud83d\udce1 MCP Server\"]\n        Docker[\"\ud83d\udc33 Docker\"]\n    end\n\n    Agent &lt;--&gt;|\"MCP Protocol\"| MCP\n\n    MCP --&gt; Observe\n    MCP --&gt; Cache\n\n    MCP --&gt; Toolset\n    MCP --&gt; Skill\n\n    Toolset --&gt; Adapter\n\n    MCP --&gt; Index\n    MCP --&gt; Docs\n    Index --&gt; Search\n    Index --&gt; Semantic\n\n    MCP --&gt; Run\n    Run --&gt; Code\n    Code --&gt; Runtime\n\n    Index --&gt; Model\n    Adapter --&gt; Model\n    Docs --&gt; Model\n    Run --&gt; Model\n\n    Run --&gt; Local\n    Run --&gt; Provider\n    Run --&gt; MCPBackend\n    Runtime --&gt; Docker\n\n    style client fill:#4a5568,stroke:#2d3748,stroke-width:2px\n    style surface fill:#2b6cb0,stroke:#2c5282,stroke-width:3px\n    style crosscut fill:#e53e3e,stroke:#c53030\n    style composition fill:#6b46c1,stroke:#553c9a\n    style protocol fill:#d69e2e,stroke:#b7791f\n    style execution fill:#38a169,stroke:#276749\n    style discovery fill:#3182ce,stroke:#2c5282\n    style foundation fill:#718096,stroke:#4a5568\n    style backends fill:#2d3748,stroke:#1a202c</code></pre>"},{"location":"#progressive-disclosure","title":"Progressive Disclosure","text":"<p>The core usability pattern: discover \u2192 describe \u2192 execute</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'actorBkg': '#2b6cb0', 'actorTextColor': '#fff'}}}%%\nsequenceDiagram\n    autonumber\n    participant Agent as \ud83e\udd16 Agent\n    participant MCP as \ud83d\udd37 metatools-mcp\n\n    rect rgb(43, 108, 176, 0.1)\n        Note over Agent,MCP: 1. Discovery (Token-Cheap)\n        Agent-&gt;&gt;MCP: search_tools(\"create issue\")\n        MCP--&gt;&gt;Agent: Summary[] (no schemas)\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Note over Agent,MCP: 2. Description (On-Demand)\n        Agent-&gt;&gt;MCP: describe_tool(id, \"schema\")\n        MCP--&gt;&gt;Agent: Full tool schema\n    end\n\n    rect rgb(56, 161, 105, 0.1)\n        Note over Agent,MCP: 3. Execution (Validated)\n        Agent-&gt;&gt;MCP: run_tool(id, args)\n        MCP--&gt;&gt;Agent: Execution result\n    end</code></pre>"},{"location":"#quickstart","title":"Quickstart","text":"<ol> <li>Start with <code>toolmodel</code> for your canonical schemas</li> <li>Register tools in <code>toolindex</code> for discovery</li> <li>Add docs/examples in <code>tooldocs</code></li> <li>Execute tools via <code>toolrun</code></li> <li>Expose the MCP surface using <code>metatools-mcp</code></li> </ol> <p>See the Components section for per-library examples and diagrams.</p>"},{"location":"#design-notes-and-user-journeys","title":"Design Notes and User Journeys","text":"<p>For deeper context, see the aggregated indexes:</p> <ul> <li>Design Notes Index \u2014 per\u2011repo tradeoffs and error semantics</li> <li>User Journeys Index \u2014 end\u2011to\u2011end agent workflows</li> </ul>"},{"location":"#docs-from-each-repo","title":"Docs from each repo","text":"<p>Under Library Docs (from repos) you will find the docs imported directly from each repository at build time.</p>"},{"location":"architecture/design-notes/","title":"Design Notes Index","text":"<p>This page aggregates the per\u2011repo Design Notes pages that document tradeoffs and error semantics for each component. Use these when you want to understand why a design decision was made or how to handle specific failure modes.</p>"},{"location":"architecture/design-notes/#perrepo-design-notes","title":"Per\u2011repo Design Notes","text":"<ul> <li>toolmodel \u2014 design-notes</li> <li>tooladapter \u2014 design-notes</li> <li>toolset \u2014 design-notes</li> <li>toolindex \u2014 design-notes</li> <li>tooldocs \u2014 design-notes</li> <li>toolrun \u2014 design-notes</li> <li>toolcode \u2014 design-notes</li> <li>toolruntime \u2014 design-notes</li> <li>toolsearch \u2014 design-notes</li> <li>toolobserve \u2014 design-notes</li> <li>toolcache \u2014 design-notes</li> <li>toolsemantic \u2014 design-notes</li> <li>toolskill \u2014 design-notes</li> <li>metatools\u2011mcp \u2014 design-notes</li> </ul>"},{"location":"architecture/design-notes/#when-to-read-these","title":"When to read these","text":"<ul> <li>You\u2019re debugging failure modes or error propagation.</li> <li>You want to compare tradeoffs (latency vs safety, flexibility vs simplicity).</li> <li>You\u2019re deciding where to plug in a custom implementation.</li> </ul>"},{"location":"architecture/overview/","title":"Stack Architecture","text":"<p>This stack is built around progressive disclosure and a clean separation of schema, discovery, docs, execution, and transport.</p>"},{"location":"architecture/overview/#system-context-c4-level-1","title":"System Context (C4 Level 1)","text":"<p>High-level view showing the ApertureStack and its external actors.</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#1a365d', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2c5282', 'lineColor': '#4a5568', 'secondaryColor': '#2d3748', 'tertiaryColor': '#e2e8f0'}}}%%\nflowchart TB\n    subgraph external[\"External Systems\"]\n        Agent[\"\ud83e\udd16 AI Agent&lt;br/&gt;&lt;small&gt;Claude, GPT, etc.&lt;/small&gt;\"]\n        ExtMCP[\"\ud83d\udce1 External MCP Servers&lt;br/&gt;&lt;small&gt;GitHub, Filesystem, etc.&lt;/small&gt;\"]\n        Backends[\"\u2699\ufe0f Execution Backends&lt;br/&gt;&lt;small&gt;Docker, K8s, WASM&lt;/small&gt;\"]\n    end\n\n    subgraph aperture[\"ApertureStack\"]\n        direction TB\n        MCP[\"\ud83d\udd37 metatools-mcp&lt;br/&gt;&lt;small&gt;MCP Server Surface&lt;/small&gt;\"]\n    end\n\n    subgraph observability[\"Observability\"]\n        OTLP[\"\ud83d\udcca OTLP Collector\"]\n        Prometheus[\"\ud83d\udcc8 Prometheus\"]\n        Jaeger[\"\ud83d\udd0d Jaeger\"]\n    end\n\n    Agent --&gt;|\"MCP Protocol&lt;br/&gt;JSON-RPC\"| MCP\n    MCP --&gt;|\"Tool Calls\"| ExtMCP\n    MCP --&gt;|\"Code Execution\"| Backends\n    MCP -.-&gt;|\"Traces\"| OTLP\n    MCP -.-&gt;|\"Metrics\"| Prometheus\n    OTLP --&gt; Jaeger\n\n    style aperture fill:#1a365d,stroke:#2c5282,stroke-width:3px\n    style external fill:#2d3748,stroke:#4a5568,stroke-width:2px\n    style observability fill:#2f855a,stroke:#276749,stroke-width:2px</code></pre>"},{"location":"architecture/overview/#layering-model-all-14-components","title":"Layering Model (All 14 Components)","text":"<p>Complete view of all stack components organized by architectural layer.</p> <p></p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0', 'primaryTextColor': '#fff', 'lineColor': '#4a5568'}}}%%\nflowchart TB\n    subgraph surface[\"MCP Surface Layer\"]\n        direction LR\n        metatools[\"\ud83d\udd37 metatools-mcp&lt;br/&gt;&lt;small&gt;v0.4.0 \u2022 MCP Server&lt;/small&gt;\"]\n    end\n\n    subgraph composition[\"Composition Layer\"]\n        direction LR\n        toolset[\"\ud83d\udce6 toolset&lt;br/&gt;&lt;small&gt;v1.0.1 \u2022 Filtered Collections&lt;/small&gt;\"]\n        toolskill[\"\ud83c\udfaf toolskill&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Skill Workflows&lt;/small&gt;\"]\n    end\n\n    subgraph protocol[\"Protocol Layer\"]\n        direction LR\n        tooladapter[\"\ud83d\udd04 tooladapter&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Format Conversion&lt;/small&gt;\"]\n    end\n\n    subgraph execution[\"Execution Layer\"]\n        direction LR\n        toolrun[\"\u25b6\ufe0f toolrun&lt;br/&gt;&lt;small&gt;v0.3.0 \u2022 Execution + Chaining&lt;/small&gt;\"]\n        toolcode[\"\ud83d\udcbb toolcode&lt;br/&gt;&lt;small&gt;v0.3.0 \u2022 Code Orchestration&lt;/small&gt;\"]\n        toolruntime[\"\ud83c\udfc3 toolruntime&lt;br/&gt;&lt;small&gt;v0.2.1 \u2022 Runtime Isolation&lt;/small&gt;\"]\n    end\n\n    subgraph discovery[\"Discovery Layer\"]\n        direction LR\n        toolindex[\"\ud83d\udcc7 toolindex&lt;br/&gt;&lt;small&gt;v0.3.0 \u2022 Registry + Search&lt;/small&gt;\"]\n        tooldocs[\"\ud83d\udcda tooldocs&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Progressive Docs&lt;/small&gt;\"]\n        toolsearch[\"\ud83d\udd0d toolsearch&lt;br/&gt;&lt;small&gt;v0.3.0 \u2022 BM25 Strategy&lt;/small&gt;\"]\n        toolsemantic[\"\ud83e\udde0 toolsemantic&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Semantic Search&lt;/small&gt;\"]\n    end\n\n    subgraph foundation[\"Foundation Layer\"]\n        direction LR\n        toolmodel[\"\ud83e\uddf1 toolmodel&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Canonical Schema&lt;/small&gt;\"]\n    end\n\n    subgraph crosscutting[\"Cross-Cutting Concerns\"]\n        direction LR\n        toolobserve[\"\ud83d\udc41\ufe0f toolobserve&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Observability&lt;/small&gt;\"]\n        toolcache[\"\ud83d\udcbe toolcache&lt;br/&gt;&lt;small&gt;v0.2.0 \u2022 Caching&lt;/small&gt;\"]\n    end\n\n    toolmodel --&gt; toolindex\n    toolmodel --&gt; tooladapter\n    toolmodel --&gt; tooldocs\n    toolmodel --&gt; toolrun\n\n    tooladapter --&gt; toolset\n    toolindex --&gt; tooldocs\n    toolindex --&gt; toolrun\n    toolsearch --&gt; toolindex\n    toolsemantic -.-&gt; toolindex\n\n    toolrun --&gt; toolcode\n    toolcode --&gt; toolruntime\n    toolset --&gt; toolrun\n    toolskill --&gt; toolrun\n    toolskill --&gt; toolset\n\n    toolindex --&gt; metatools\n    tooldocs --&gt; metatools\n    toolrun --&gt; metatools\n    toolcode --&gt; metatools\n    toolset --&gt; metatools\n    toolskill -.-&gt; metatools\n\n    toolobserve -.-&gt; toolrun\n    toolobserve -.-&gt; metatools\n    toolcache -.-&gt; toolrun\n\n    style surface fill:#2b6cb0,stroke:#2c5282,stroke-width:2px\n    style composition fill:#6b46c1,stroke:#553c9a,stroke-width:2px\n    style protocol fill:#d69e2e,stroke:#b7791f,stroke-width:2px\n    style execution fill:#38a169,stroke:#276749,stroke-width:2px\n    style discovery fill:#3182ce,stroke:#2c5282,stroke-width:2px\n    style foundation fill:#718096,stroke:#4a5568,stroke-width:2px\n    style crosscutting fill:#e53e3e,stroke:#c53030,stroke-width:2px</code></pre>"},{"location":"architecture/overview/#progressive-disclosure-pipeline","title":"Progressive Disclosure Pipeline","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'actorBkg': '#2b6cb0', 'actorTextColor': '#fff', 'actorBorder': '#2c5282'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Agent as \ud83e\udd16 AI Agent\n    participant MCP as \ud83d\udd37 metatools-mcp\n    participant Index as \ud83d\udcc7 toolindex\n    participant Search as \ud83d\udd0d toolsearch\n    participant Docs as \ud83d\udcda tooldocs\n    participant Run as \u25b6\ufe0f toolrun\n\n    rect rgb(43, 108, 176, 0.1)\n        Note over Agent,Search: Phase 1: Discovery (Token-Cheap)\n        Agent-&gt;&gt;+MCP: search_tools(\"create issue\", limit=5)\n        MCP-&gt;&gt;+Index: Search(query, limit)\n        Index-&gt;&gt;+Search: Search(docs, query, limit)\n        Search--&gt;&gt;-Index: scored results\n        Index--&gt;&gt;-MCP: Summary[] (no schemas)\n        MCP--&gt;&gt;-Agent: summaries\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Note over Agent,Docs: Phase 2: Description (On-Demand)\n        Agent-&gt;&gt;+MCP: describe_tool(\"github:create_issue\", \"schema\")\n        MCP-&gt;&gt;+Docs: DescribeTool(id, DetailSchema)\n        Docs-&gt;&gt;Index: GetTool(id)\n        Index--&gt;&gt;Docs: Tool definition\n        Docs--&gt;&gt;-MCP: ToolDoc with schema\n        MCP--&gt;&gt;-Agent: full tool schema\n    end\n\n    rect rgb(56, 161, 105, 0.1)\n        Note over Agent,Run: Phase 3: Execution (Validated)\n        Agent-&gt;&gt;+MCP: run_tool(\"github:create_issue\", args)\n        MCP-&gt;&gt;+Run: Run(ctx, id, args)\n        Run-&gt;&gt;Run: ValidateInput(args)\n        Run-&gt;&gt;Run: ResolveBackend()\n        Run-&gt;&gt;Run: Execute via backend\n        Run-&gt;&gt;Run: ValidateOutput(result)\n        Run--&gt;&gt;-MCP: RunResult\n        MCP--&gt;&gt;-Agent: execution result\n    end</code></pre>"},{"location":"architecture/overview/#tool-execution-and-runtime-isolation","title":"Tool Execution and Runtime Isolation","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#38a169'}}}%%\nflowchart LR\n    subgraph input[\"Input Phase\"]\n        A[\"\ud83d\udce5 Receive&lt;br/&gt;ToolID + Args\"]\n    end\n\n    subgraph validation1[\"Validation Phase 1\"]\n        B[\"\u2705 Validate&lt;br/&gt;Tool ID Format\"]\n        C[\"\u2705 Validate&lt;br/&gt;Input Schema\"]\n    end\n\n    subgraph resolution[\"Resolution Phase\"]\n        D[\"\ud83d\udd0d Resolve&lt;br/&gt;Tool Definition\"]\n        E[\"\ud83c\udfaf Select&lt;br/&gt;Backend\"]\n    end\n\n    subgraph execution[\"Execution Phase\"]\n        F{\"Backend&lt;br/&gt;Type?\"}\n        G[\"\ud83c\udfe0 Local&lt;br/&gt;Handler\"]\n        H[\"\ud83d\udd0c Provider&lt;br/&gt;Executor\"]\n        I[\"\ud83d\udce1 MCP&lt;br/&gt;Server Call\"]\n    end\n\n    subgraph normalization[\"Normalization Phase\"]\n        J[\"\ud83d\udce4 Normalize&lt;br/&gt;Result\"]\n    end\n\n    subgraph validation2[\"Validation Phase 2\"]\n        K[\"\u2705 Validate&lt;br/&gt;Output Schema\"]\n    end\n\n    subgraph output[\"Output Phase\"]\n        L[\"\ud83d\udce6 Return&lt;br/&gt;RunResult\"]\n    end\n\n    A --&gt; B --&gt; C --&gt; D --&gt; E --&gt; F\n    F --&gt;|local| G\n    F --&gt;|provider| H\n    F --&gt;|mcp| I\n    G --&gt; J\n    H --&gt; J\n    I --&gt; J\n    J --&gt; K --&gt; L\n\n    style input fill:#3182ce,stroke:#2c5282\n    style validation1 fill:#38a169,stroke:#276749\n    style resolution fill:#d69e2e,stroke:#b7791f\n    style execution fill:#6b46c1,stroke:#553c9a\n    style normalization fill:#e53e3e,stroke:#c53030\n    style validation2 fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"architecture/overview/#search-strategy-layering","title":"Search Strategy Layering","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#3182ce'}}}%%\nflowchart TB\n    subgraph query[\"Search Query\"]\n        Input[\"\ud83d\udd0d 'create github issue'\"]\n    end\n\n    subgraph index[\"toolindex\"]\n        Search[\"Index.Search(query, limit)\"]\n        Docs[\"SearchDoc[]&lt;br/&gt;&lt;small&gt;ID, Name, Namespace,&lt;br/&gt;Description, Tags&lt;/small&gt;\"]\n    end\n\n    subgraph strategies[\"Search Strategies\"]\n        direction TB\n\n        subgraph lexical[\"Lexical (Default)\"]\n            Simple[\"Simple substring&lt;br/&gt;matching\"]\n        end\n\n        subgraph bm25[\"BM25 (toolsearch)\"]\n            BM[\"BM25Searcher\"]\n            Boosts[\"Field Boosts:&lt;br/&gt;&lt;small&gt;name: 4x&lt;br/&gt;namespace: 2x&lt;br/&gt;tags: 1x&lt;/small&gt;\"]\n            Bleve[\"Bleve Index\"]\n        end\n\n        subgraph semantic[\"Semantic (toolsemantic)\"]\n            Embed[\"Embedder\"]\n            Vector[\"Vector Store\"]\n            Similarity[\"Cosine Similarity\"]\n        end\n    end\n\n    subgraph ranking[\"Ranking\"]\n        Score[\"\ud83d\udcca Score + Rank\"]\n        Dedup[\"\ud83d\udd04 Deduplicate\"]\n        Limit[\"\u2702\ufe0f Apply Limit\"]\n    end\n\n    subgraph output[\"Results\"]\n        Results[\"Summary[]&lt;br/&gt;&lt;small&gt;No schemas (token-cheap)&lt;/small&gt;\"]\n    end\n\n    Input --&gt; Search\n    Search --&gt; Docs\n\n    Docs --&gt; Simple\n    Docs --&gt; BM --&gt; Boosts --&gt; Bleve\n    Docs --&gt; Embed --&gt; Vector --&gt; Similarity\n\n    Simple --&gt; Score\n    Bleve --&gt; Score\n    Similarity --&gt; Score\n\n    Score --&gt; Dedup --&gt; Limit --&gt; Results\n\n    style strategies fill:#3182ce,stroke:#2c5282,stroke-width:2px\n    style bm25 fill:#38a169,stroke:#276749\n    style semantic fill:#6b46c1,stroke:#553c9a\n    style ranking fill:#d69e2e,stroke:#b7791f</code></pre>"},{"location":"architecture/overview/#component-dependency-graph","title":"Component Dependency Graph","text":"<p>Directed acyclic graph showing module dependencies and bump order.</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#4a5568'}}}%%\nflowchart TD\n    subgraph order1[\"Bump Order 1\"]\n        toolmodel[\"\ud83e\uddf1 toolmodel\"]\n    end\n\n    subgraph order2[\"Bump Order 2\"]\n        toolindex[\"\ud83d\udcc7 toolindex\"]\n        tooladapter[\"\ud83d\udd04 tooladapter\"]\n    end\n\n    subgraph order3[\"Bump Order 3\"]\n        tooldocs[\"\ud83d\udcda tooldocs\"]\n        toolrun[\"\u25b6\ufe0f toolrun\"]\n        toolset[\"\ud83d\udce6 toolset\"]\n        toolsearch[\"\ud83d\udd0d toolsearch\"]\n        toolsemantic[\"\ud83e\udde0 toolsemantic\"]\n    end\n\n    subgraph order4[\"Bump Order 4\"]\n        toolcode[\"\ud83d\udcbb toolcode\"]\n        toolskill[\"\ud83c\udfaf toolskill\"]\n        toolobserve[\"\ud83d\udc41\ufe0f toolobserve\"]\n        toolcache[\"\ud83d\udcbe toolcache\"]\n    end\n\n    subgraph order5[\"Bump Order 5\"]\n        toolruntime[\"\ud83c\udfc3 toolruntime\"]\n    end\n\n    subgraph order6[\"Bump Order 6\"]\n        metatools[\"\ud83d\udd37 metatools-mcp\"]\n    end\n\n    toolmodel --&gt; toolindex\n    toolmodel --&gt; tooladapter\n    toolindex --&gt; tooldocs\n    toolindex --&gt; toolrun\n    toolindex --&gt; toolsearch\n    toolindex --&gt; toolsemantic\n    tooladapter --&gt; toolset\n    toolset --&gt; toolrun\n    toolrun --&gt; toolcode\n    toolrun --&gt; toolskill\n    toolrun --&gt; toolobserve\n    toolrun --&gt; toolcache\n    toolcode --&gt; toolruntime\n\n    toolindex --&gt; metatools\n    tooldocs --&gt; metatools\n    toolrun --&gt; metatools\n    toolcode --&gt; metatools\n    toolset --&gt; metatools\n\n    style order1 fill:#718096,stroke:#4a5568\n    style order2 fill:#3182ce,stroke:#2c5282\n    style order3 fill:#38a169,stroke:#276749\n    style order4 fill:#d69e2e,stroke:#b7791f\n    style order5 fill:#e53e3e,stroke:#c53030\n    style order6 fill:#6b46c1,stroke:#553c9a</code></pre>"},{"location":"architecture/overview/#observability-integration","title":"Observability Integration","text":"<p>How toolobserve wraps around tool execution with traces, metrics, and logs.</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e'}}}%%\nflowchart TB\n    subgraph client[\"Client Layer\"]\n        Request[\"\ud83d\udce5 Tool Request\"]\n    end\n\n    subgraph middleware[\"toolobserve Middleware\"]\n        direction TB\n        MW[\"\ud83d\udd00 Middleware.Wrap()\"]\n\n        subgraph tracing[\"Tracing\"]\n            SpanStart[\"StartSpan&lt;br/&gt;&lt;small&gt;tool.exec.{namespace}.{name}&lt;/small&gt;\"]\n            SpanEnd[\"EndSpan\"]\n            SpanAttrs[\"Span Attributes&lt;br/&gt;&lt;small&gt;tool.id, tool.namespace, tool.name&lt;br/&gt;tool.version, tool.category, tool.tags&lt;/small&gt;\"]\n        end\n\n        subgraph metrics[\"Metrics\"]\n            Counter[\"tool.exec.total&lt;br/&gt;&lt;small&gt;{call} counter&lt;/small&gt;\"]\n            Histogram[\"tool.exec.duration&lt;br/&gt;&lt;small&gt;ms histogram&lt;/small&gt;\"]\n        end\n\n        subgraph logging[\"Structured Logging\"]\n            LogFields[\"Fields: tool.id, args (redacted)&lt;br/&gt;duration, error\"]\n        end\n    end\n\n    subgraph execution[\"Actual Execution\"]\n        Runner[\"\u25b6\ufe0f toolrun.Runner\"]\n    end\n\n    subgraph exporters[\"Exporters\"]\n        direction LR\n        OTLP[\"\ud83d\udce1 OTLP\"]\n        Jaeger[\"\ud83d\udd0d Jaeger\"]\n        Prometheus[\"\ud83d\udcca Prometheus\"]\n        Stdout[\"\ud83d\udda5\ufe0f Stdout\"]\n    end\n\n    Request --&gt; MW\n    MW --&gt; SpanStart --&gt; SpanAttrs\n    MW --&gt; Counter\n    SpanAttrs --&gt; Runner\n    Runner --&gt; SpanEnd\n    Runner --&gt; Histogram\n\n    SpanEnd --&gt; OTLP\n    SpanEnd --&gt; Jaeger\n    Histogram --&gt; Prometheus\n    Histogram --&gt; OTLP\n\n    style middleware fill:#e53e3e,stroke:#c53030,stroke-width:2px\n    style tracing fill:#6b46c1,stroke:#553c9a\n    style metrics fill:#38a169,stroke:#276749\n    style logging fill:#3182ce,stroke:#2c5282\n    style exporters fill:#d69e2e,stroke:#b7791f</code></pre>"},{"location":"architecture/pluggable-architecture/","title":"Pluggable Architecture","text":"<p>The stack is designed so each layer is replaceable without changing the others. This keeps the core stable while allowing experimentation and integration.</p>"},{"location":"architecture/pluggable-architecture/#extension-points","title":"Extension points","text":""},{"location":"architecture/pluggable-architecture/#what-you-can-plug-in","title":"What you can plug in","text":"<ul> <li>Search: swap lexical for BM25 or semantic ranking</li> <li>Execution: add MCP servers, local handlers, or provider adapters</li> <li>Code execution: change engines or language runtimes</li> <li>Runtime isolation: choose the sandbox backend per environment</li> </ul>"},{"location":"architecture/pluggable-architecture/#design-goal","title":"Design goal","text":"<p>The default implementations are intentionally simple and safe. Advanced capabilities are injected rather than baked into the core.</p>"},{"location":"architecture/progressive-disclosure/","title":"Progressive Disclosure","text":"<p>Progressive disclosure is the core usability strategy of this stack. It lets agents discover just enough information to choose the right tool, then retrieve deeper details only when needed.</p>"},{"location":"architecture/progressive-disclosure/#why-it-matters","title":"Why it matters","text":"<ul> <li>Lower token cost: most tools are never fully expanded</li> <li>Faster decisions: summary-level signals are enough to pick candidates</li> <li>Safer execution: schema and examples are fetched only after a tool is chosen</li> </ul>"},{"location":"architecture/progressive-disclosure/#flow","title":"Flow","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'actorBkg': '#2b6cb0', 'actorTextColor': '#fff', 'actorBorder': '#2c5282'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Agent as \ud83e\udd16 AI Agent\n    participant MCP as \ud83d\udd37 metatools-mcp\n    participant Index as \ud83d\udcc7 toolindex\n    participant Search as \ud83d\udd0d toolsearch\n    participant Docs as \ud83d\udcda tooldocs\n    participant Run as \u25b6\ufe0f toolrun\n    participant Cache as \ud83d\udcbe toolcache\n    participant Observe as \ud83d\udc41\ufe0f toolobserve\n\n    rect rgb(43, 108, 176, 0.1)\n        Note over Agent,Search: Phase 1: Discovery (Token-Cheap)\n        Agent-&gt;&gt;+MCP: search_tools(\"create issue\", limit=5)\n        MCP-&gt;&gt;+Index: Search(query, limit)\n        Index-&gt;&gt;+Search: Search(docs, query, limit)\n        Search--&gt;&gt;-Index: scored results\n        Index--&gt;&gt;-MCP: Summary[] (no schemas)\n        MCP--&gt;&gt;-Agent: summaries\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Note over Agent,Docs: Phase 2: Description (On-Demand)\n        Agent-&gt;&gt;+MCP: describe_tool(\"github:create_issue\", \"schema\")\n        MCP-&gt;&gt;+Docs: DescribeTool(id, DetailSchema)\n        Docs-&gt;&gt;Index: GetTool(id)\n        Index--&gt;&gt;Docs: Tool definition\n        Docs--&gt;&gt;-MCP: ToolDoc with schema\n        MCP--&gt;&gt;-Agent: full tool schema\n    end\n\n    rect rgb(56, 161, 105, 0.1)\n        Note over Agent,Observe: Phase 3: Execution (Validated)\n        Agent-&gt;&gt;+MCP: run_tool(\"github:create_issue\", args)\n        MCP-&gt;&gt;Observe: StartSpan(\"tool.exec.github.create_issue\")\n        MCP-&gt;&gt;+Cache: Get(toolID, argsHash)\n        alt Cache Hit\n            Cache--&gt;&gt;MCP: cached result\n        else Cache Miss\n            MCP-&gt;&gt;+Run: Run(ctx, id, args)\n            Run-&gt;&gt;Run: ValidateInput(args)\n            Run-&gt;&gt;Run: ResolveBackend()\n            Run-&gt;&gt;Run: Execute via backend\n            Run-&gt;&gt;Run: ValidateOutput(result)\n            Run--&gt;&gt;-MCP: RunResult\n            MCP-&gt;&gt;Cache: Set(toolID, argsHash, result)\n        end\n        Cache--&gt;&gt;-MCP: result\n        MCP-&gt;&gt;Observe: EndSpan(result)\n        MCP--&gt;&gt;-Agent: execution result\n    end</code></pre>"},{"location":"architecture/progressive-disclosure/#detail-levels","title":"Detail Levels","text":"<p>The three progressive detail levels minimize token consumption:</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#3182ce'}}}%%\nflowchart LR\n    subgraph level1[\"DetailSummary\"]\n        S1[\"\ud83d\udccb 1-2 line description\"]\n        S2[\"\ud83c\udff7\ufe0f Tags\"]\n        S3[\"\ud83d\udcc1 Namespace\"]\n    end\n\n    subgraph level2[\"DetailSchema\"]\n        SS1[\"\ud83d\udccb Full description\"]\n        SS2[\"\ud83d\udcd0 Input schema\"]\n        SS3[\"\ud83d\udce4 Output schema\"]\n    end\n\n    subgraph level3[\"DetailFull\"]\n        F1[\"\ud83d\udccb Everything from Schema\"]\n        F2[\"\ud83d\udcdd Human-authored notes\"]\n        F3[\"\ud83d\udca1 1-3 examples\"]\n        F4[\"\ud83d\udd17 External references\"]\n    end\n\n    level1 --&gt;|\"Agent selects tool\"| level2\n    level2 --&gt;|\"Needs examples\"| level3\n\n    style level1 fill:#38a169,stroke:#276749\n    style level2 fill:#d69e2e,stroke:#b7791f\n    style level3 fill:#6b46c1,stroke:#553c9a</code></pre>"},{"location":"architecture/progressive-disclosure/#component-roles","title":"Component Roles","text":"Component Role in Progressive Disclosure <code>toolindex</code> Fast, summary-only discovery <code>toolsearch</code> Pluggable ranking strategy (BM25, semantic) <code>toolsemantic</code> Vector-based intent matching <code>tooldocs</code> Structured detail (summary/schema/full/examples) <code>toolrun</code> Execution with validation + consistent errors <code>toolcode</code> Optional code-mode orchestration <code>toolcache</code> Cache results to avoid re-execution <code>toolobserve</code> Trace execution for debugging"},{"location":"architecture/progressive-disclosure/#token-economics","title":"Token Economics","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#38a169'}}}%%\npie showData\n    title Token Distribution by Phase\n    \"Discovery (Summary)\" : 15\n    \"Description (Schema)\" : 35\n    \"Execution (Args/Result)\" : 50</code></pre> <p>Most tools are never fully expanded \u2014 progressive disclosure means you only pay for the detail level you actually need.</p>"},{"location":"architecture/user-journeys/","title":"User Journeys Index","text":"<p>This page aggregates the per\u2011repo User Journey pages that describe full end\u2011to\u2011end workflows. These are ideal for onboarding and for validating that the progressive\u2011disclosure flow is coherent across layers.</p>"},{"location":"architecture/user-journeys/#perrepo-user-journeys","title":"Per\u2011repo User Journeys","text":"<ul> <li>toolmodel \u2014 user-journey</li> <li>tooladapter \u2014 user-journey</li> <li>toolset \u2014 user-journey</li> <li>toolindex \u2014 user-journey</li> <li>tooldocs \u2014 user-journey</li> <li>toolrun \u2014 user-journey</li> <li>toolcode \u2014 user-journey</li> <li>toolruntime \u2014 user-journey</li> <li>toolsearch \u2014 user-journey</li> <li>toolobserve \u2014 user-journey</li> <li>toolcache \u2014 user-journey</li> <li>toolsemantic \u2014 user-journey</li> <li>toolskill \u2014 user-journey</li> <li>metatools\u2011mcp \u2014 user-journey</li> </ul>"},{"location":"architecture/user-journeys/#when-to-read-these","title":"When to read these","text":"<ul> <li>You want to understand how an agent discovers, inspects, and runs tools.</li> <li>You\u2019re validating the progressive disclosure path across components.</li> <li>You want examples that show how the pieces fit together end\u2011to\u2011end.</li> </ul>"},{"location":"architecture/why-go/","title":"Why Go","text":"<p>Go is a strong fit for this stack because it pairs high performance with a simple concurrency model and a clean interface story.</p>"},{"location":"architecture/why-go/#advantages-for-this-stack","title":"Advantages for this stack","text":""},{"location":"architecture/why-go/#compiled-fast-startup","title":"Compiled + fast startup","text":"<ul> <li>Small binaries and quick startup times are ideal for MCP servers</li> <li>Predictable performance for low-latency tool calls</li> </ul>"},{"location":"architecture/why-go/#concurrency-without-complexity","title":"Concurrency without complexity","text":"<ul> <li>Goroutines and channels make async tool execution straightforward</li> <li><code>context.Context</code> enables timeouts and cancellation across the stack</li> </ul>"},{"location":"architecture/why-go/#interface-first-extensibility","title":"Interface-first extensibility","text":"<ul> <li>Each layer (<code>Searcher</code>, <code>Runner</code>, <code>Engine</code>, <code>Backend</code>) is interface-driven</li> <li>You can plug in new languages, providers, or runtimes without redesigning</li> </ul>"},{"location":"architecture/why-go/#operational-simplicity","title":"Operational simplicity","text":"<ul> <li>Static binaries simplify deployment</li> <li>Works equally well in containers, VMs, or bare metal</li> </ul>"},{"location":"architecture/why-go/#summary","title":"Summary","text":"<p>Go lets you build a composable system that is fast, concurrent, and easy to extend. That is exactly what this stack needs.</p>"},{"location":"components/metatools-mcp/","title":"metatools-mcp","text":"<p>MCP server that exposes the tool stack via standardized MCP tools with a progressive-disclosure flow.</p>"},{"location":"components/metatools-mcp/#motivation","title":"Motivation","text":"<ul> <li>Provide a minimal, consistent MCP surface</li> <li>Keep discovery cheap and execution safe</li> <li>Enable pluggable search and optional code execution</li> </ul>"},{"location":"components/metatools-mcp/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Expose <code>search_tools</code>, <code>list_namespaces</code></li> <li>Expose <code>describe_tool</code>, <code>list_tool_examples</code></li> <li>Expose <code>run_tool</code>, <code>run_chain</code></li> <li>Optionally expose <code>execute_code</code></li> <li>Use the official MCP Go SDK</li> </ul>"},{"location":"components/metatools-mcp/#transport-surface","title":"Transport surface","text":"<ul> <li><code>stdio</code> (default): local clients/Claude Desktop.</li> <li><code>streamable</code> (recommended HTTP): MCP spec 2025-03-26 with session management.</li> <li><code>sse</code> (deprecated): legacy web clients.</li> </ul> <p>See <code>metatools-mcp/docs/usage.md</code> for the full config/env matrix.</p>"},{"location":"components/metatools-mcp/#optional-runtime-integration","title":"Optional runtime integration","text":"<p><code>execute_code</code> is enabled with the <code>toolruntime</code> build tag and selects a runtime profile at startup:</p> <ul> <li><code>dev</code> profile (default): unsafe subprocess backend.</li> <li><code>standard</code> profile: Docker sandbox (set <code>METATOOLS_RUNTIME_PROFILE=standard</code>).</li> <li><code>METATOOLS_DOCKER_IMAGE</code> overrides the sandbox image name.</li> <li><code>METATOOLS_WASM_ENABLED=true</code> enables the WASM backend (wazero).</li> <li><code>METATOOLS_RUNTIME_BACKEND=wasm</code> selects WASM for the standard profile.</li> </ul>"},{"location":"components/metatools-mcp/#example","title":"Example","text":"<pre><code>srv, _ := server.New(cfg)\n_ = srv.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"components/metatools-mcp/#diagram","title":"Diagram","text":""},{"location":"components/metatools-mcp/#usability-notes","title":"Usability notes","text":"<ul> <li>Small tool surface reduces prompt complexity</li> <li>Schemas and examples are fetched on demand</li> </ul>"},{"location":"components/tooladapter/","title":"tooladapter","text":"<p>Protocol-agnostic tool format conversion library. Enables bidirectional transformation between MCP, OpenAI, and Anthropic tool definitions through a canonical intermediate representation.</p>"},{"location":"components/tooladapter/#position-in-the-stack","title":"Position in the Stack","text":"<p>tooladapter sits between <code>toolmodel</code> (MCP-aligned definitions) and higher-level components that need multi-provider support:</p> <pre><code>toolmodel --&gt; tooladapter --&gt; toolset --&gt; metatools-mcp\n    |              |\n    v              v\n  MCP-aligned    Protocol-agnostic\n  definitions    conversion layer\n</code></pre> <p>Dependency order (DAG):</p> <ol> <li><code>toolmodel</code> - MCP-aligned tool definitions (foundation)</li> <li><code>tooladapter</code> - Protocol conversion (depends on toolmodel for alignment)</li> <li><code>toolset</code> - Tool composition (can export via tooladapter)</li> <li><code>metatools-mcp</code> - MCP server (can optionally wire toolset)</li> </ol> <p>tooladapter does not change the MCP surface. It provides a normalization layer that other components can use to support multiple LLM providers.</p>"},{"location":"components/tooladapter/#motivation","title":"Motivation","text":"<ul> <li>Expose MCP tools to OpenAI/Anthropic clients without manual conversion</li> <li>Track feature loss during format conversion (warnings, not errors)</li> <li>Provide deterministic, pure data transforms (no I/O, no execution)</li> <li>Maintain minimal dependencies (only MCP SDK for MCP adapter)</li> </ul>"},{"location":"components/tooladapter/#core-types","title":"Core Types","text":"Type Purpose <code>CanonicalTool</code> Protocol-agnostic intermediate representation <code>JSONSchema</code> Superset of all supported schema features (2020-12 + draft-07) <code>Adapter</code> Interface for format-specific converters <code>AdapterRegistry</code> Thread-safe adapter management and conversion <code>FeatureLossWarning</code> Indicates unsupported features in target format <code>ConversionError</code> Wrapped error with adapter and direction context"},{"location":"components/tooladapter/#example","title":"Example","text":"<pre><code>import (\n  \"github.com/jonwraymond/tooladapter\"\n  \"github.com/jonwraymond/tooladapter/adapters\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// Set up registry with all adapters\nregistry := tooladapter.NewRegistry()\nregistry.Register(adapters.NewMCPAdapter())\nregistry.Register(adapters.NewOpenAIAdapter())\nregistry.Register(adapters.NewAnthropicAdapter())\n\n// Convert MCP tool to OpenAI format\nmcpTool := mcp.Tool{\n  Name:        \"get_weather\",\n  Description: \"Get weather for a location\",\n  InputSchema: map[string]any{\n    \"type\": \"object\",\n    \"properties\": map[string]any{\n      \"location\": map[string]any{\"type\": \"string\"},\n    },\n    \"required\": []any{\"location\"},\n  },\n}\n\nresult, err := registry.Convert(mcpTool, \"mcp\", \"openai\")\nif err != nil {\n  log.Fatal(err)\n}\n\n// Check for feature loss warnings\nfor _, w := range result.Warnings {\n  log.Printf(\"Warning: %s\", w)\n}\n\nopenaiFunc := result.Tool.(adapters.OpenAIFunction)\n</code></pre>"},{"location":"components/tooladapter/#feature-support","title":"Feature Support","text":"Feature MCP OpenAI Anthropic Notes <code>$ref/$defs</code> Yes No No Schema references <code>anyOf/oneOf/allOf</code> Yes No Yes Combinators <code>not</code> Yes No Yes Schema negation <code>pattern</code> Yes Yes* Yes Regex validation <code>enum/const</code> Yes Yes Yes Value constraints <code>min/max</code> constraints Yes Yes Yes Numeric/string bounds <code>additionalProperties</code> Yes Yes Yes Extra properties control <p>*OpenAI supports pattern in strict mode only.</p>"},{"location":"components/tooladapter/#diagram","title":"Diagram","text":""},{"location":"components/tooladapter/#key-design-decisions","title":"Key Design Decisions","text":"<ol> <li>Pure transforms: No I/O, no network, no tool execution</li> <li>Determinism: Same input always produces same output</li> <li>Loss visibility: Feature loss is tracked and reported as warnings</li> <li>Minimal deps: OpenAI/Anthropic adapters use self-contained types</li> <li>Go idioms: Errors support <code>Unwrap()</code>, registry is thread-safe</li> </ol>"},{"location":"components/tooladapter/#versioning-and-propagation","title":"Versioning and Propagation","text":"<p>tooladapter follows semantic versioning aligned with the stack:</p> <ul> <li>Source of truth: <code>ai-tools-stack/go.mod</code></li> <li>Version matrix: <code>VERSIONS.md</code> (auto-generated, synced to all repos)</li> <li>Propagation: <code>scripts/update-version-matrix.sh --apply</code></li> </ul> <p>Current version: See the stack version matrix in operations/stack-changelog.md.</p>"},{"location":"components/tooladapter/#usability-notes","title":"Usability Notes","text":"<ul> <li>All conversions are deterministic (enables caching, testing)</li> <li>Feature loss generates warnings, not errors</li> <li>Round-trip preserves format-specific metadata via <code>SourceMeta</code></li> <li>Thread-safe: registry operations safe under concurrent use</li> <li>Type-safe: adapters reject wrong input types with descriptive errors</li> </ul>"},{"location":"components/tooladapter/#links","title":"Links","text":"<ul> <li>Repository</li> <li>Library Docs (via multirepo import)</li> </ul>"},{"location":"components/toolcache/","title":"toolcache","text":"<p>Caching primitives for tool execution and discovery.</p>"},{"location":"components/toolcache/#motivation","title":"Motivation","text":"<ul> <li>Reduce latency for idempotent tools</li> <li>Prevent redundant registry queries</li> <li>Provide deterministic caching semantics</li> </ul>"},{"location":"components/toolcache/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Deterministic cache keying</li> <li>TTL and invalidation policies</li> <li>Read-through middleware for tool execution</li> </ul>"},{"location":"components/toolcache/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolrun/toolindex --&gt; toolcache --&gt; backends\n</code></pre>"},{"location":"components/toolcache/#diagram","title":"Diagram","text":""},{"location":"components/toolcache/#usability-notes","title":"Usability notes","text":"<ul> <li>Default policy should avoid caching unsafe tools</li> <li>Cache backends are pluggable</li> </ul>"},{"location":"components/toolcache/#links","title":"Links","text":"<ul> <li>Repository: https://github.com/jonwraymond/toolcache</li> <li>Library docs: ../library-docs-from-repos/toolcache/index.md</li> </ul>"},{"location":"components/toolcode/","title":"toolcode","text":"<p>Code-mode orchestration layer that wraps search, docs, and execution into a single programmable surface.</p>"},{"location":"components/toolcode/#motivation","title":"Motivation","text":"<ul> <li>Enable conditional logic and multi-step orchestration</li> <li>Keep tool orchestration explicit and testable</li> <li>Provide call traces for debugging</li> </ul>"},{"location":"components/toolcode/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Execute short orchestration snippets</li> <li>Provide a minimal in-sandbox API (SearchTools, DescribeTool, RunTool)</li> <li>Enforce timeouts and limits</li> </ul>"},{"location":"components/toolcode/#example","title":"Example","text":"<pre><code>executor := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n\nres, _ := executor.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"components/toolcode/#diagram","title":"Diagram","text":""},{"location":"components/toolcode/#usability-notes","title":"Usability notes","text":"<ul> <li><code>ExecuteResult</code> includes tool call traces</li> <li>Limits are enforced consistently across engines</li> </ul>"},{"location":"components/tooldocs/","title":"tooldocs","text":"<p>Progressive, structured documentation and examples for tools. Designed for schema-first usage and token-efficient guidance.</p>"},{"location":"components/tooldocs/#motivation","title":"Motivation","text":"<ul> <li>Pull full schemas only when needed</li> <li>Reduce tool call errors with examples</li> <li>Keep long docs out of the critical path</li> </ul>"},{"location":"components/tooldocs/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Detail tiers: summary \u2192 schema \u2192 full</li> <li>Short usage examples with caps</li> <li>Notes and external references</li> </ul>"},{"location":"components/tooldocs/#example","title":"Example","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:get_repo\", tooldocs.DocEntry{\n  Summary: \"Fetch repository metadata\",\n  Notes:   \"Requires authentication.\",\n})\n\nschema, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nexamples, _ := store.ListExamples(\"github:get_repo\", 2)\n</code></pre>"},{"location":"components/tooldocs/#diagram","title":"Diagram","text":""},{"location":"components/tooldocs/#usability-notes","title":"Usability notes","text":"<ul> <li>Example caps protect token budgets</li> <li>Summary tier is safe for discovery</li> <li>Schema tier is designed for tool invocation</li> </ul>"},{"location":"components/toolindex/","title":"toolindex","text":"<p>Global registry and search layer for tools. Provides progressive discovery and canonical lookup by tool ID.</p>"},{"location":"components/toolindex/#motivation","title":"Motivation","text":"<ul> <li>Keep discovery fast and cheap</li> <li>Decouple search quality from core registry</li> <li>Provide a single source of truth for tool IDs and backends</li> </ul>"},{"location":"components/toolindex/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Register tools + backends</li> <li>Search by name/namespace/description/tags</li> <li>List namespaces</li> <li>Resolve tools by canonical ID</li> </ul>"},{"location":"components/toolindex/#example","title":"Example","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n_ = idx.RegisterTool(tool, backend)\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"components/toolindex/#diagram","title":"Diagram","text":""},{"location":"components/toolindex/#usability-notes","title":"Usability notes","text":"<ul> <li>Summaries are token-cheap</li> <li>Namespace listing enables simple filtering</li> <li>Backends are swappable without changing IDs</li> </ul>"},{"location":"components/toolmodel/","title":"toolmodel","text":"<p>Canonical schema definitions for all tools. This is the source of truth for IDs, schemas, tags, and backend bindings.</p>"},{"location":"components/toolmodel/#motivation","title":"Motivation","text":"<ul> <li>Standardize tool definitions across the stack</li> <li>Align directly with MCP via the official Go SDK</li> <li>Keep schemas portable and validation deterministic</li> </ul>"},{"location":"components/toolmodel/#core-types","title":"Core types","text":"<ul> <li><code>Tool</code> (embeds MCP <code>mcp.Tool</code>, adds <code>Namespace</code>, <code>Version</code>, <code>Tags</code>)</li> <li><code>ToolBackend</code> (execution binding: mcp, provider, local)</li> <li><code>SchemaValidator</code> (input/output validation)</li> </ul>"},{"location":"components/toolmodel/#json-schema-validation","title":"JSON Schema Validation","text":"<p>toolmodel uses <code>github.com/google/jsonschema-go</code> (draft 2020-12) for schema validation. The default validator accepts MCP-style schema maps and enforces input/output validation for tool calls.</p> <ul> <li>InputSchema/OutputSchema: validated via <code>SchemaValidator</code>.</li> <li>Dialects: 2020-12 with draft-07 compatibility where possible.</li> <li>External refs: blocked by default to avoid network lookups.</li> </ul>"},{"location":"components/toolmodel/#example","title":"Example","text":"<pre><code>import (\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntool := toolmodel.Tool{\n  Namespace: \"github\",\n  Tool: mcp.Tool{\n    Name:        \"get_repo\",\n    Description: \"Fetch repository metadata\",\n    InputSchema: map[string]any{\n      \"type\": \"object\",\n      \"properties\": map[string]any{\n        \"owner\": {\"type\": \"string\"},\n        \"repo\":  {\"type\": \"string\"},\n      },\n      \"required\": []string{\"owner\", \"repo\"},\n    },\n  },\n  Tags: toolmodel.NormalizeTags([]string{\"GitHub\", \"repos\"}),\n}\n\n_ = tool.Validate()\n</code></pre>"},{"location":"components/toolmodel/#diagram","title":"Diagram","text":""},{"location":"components/toolmodel/#usability-notes","title":"Usability notes","text":"<ul> <li>Schemas accept maps or JSON bytes</li> <li>Tags are normalized for fast search</li> <li>IDs are stable and human\u2011readable</li> </ul>"},{"location":"components/toolobserve/","title":"toolobserve","text":"<p>Observability library for tool execution: tracing, metrics, and structured logs.</p>"},{"location":"components/toolobserve/#motivation","title":"Motivation","text":"<ul> <li>Provide consistent telemetry across the stack</li> <li>Avoid instrumentation duplication in each repo</li> <li>Keep observability opt-in and backend-agnostic</li> </ul>"},{"location":"components/toolobserve/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Create spans around tool execution</li> <li>Record metrics (counts, latency, errors)</li> <li>Emit structured logs with tool context</li> </ul>"},{"location":"components/toolobserve/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolrun/toolruntime --&gt; toolobserve --&gt; exporters\n</code></pre>"},{"location":"components/toolobserve/#diagram","title":"Diagram","text":""},{"location":"components/toolobserve/#usability-notes","title":"Usability notes","text":"<ul> <li>Pure instrumentation (no execution/transport)</li> <li>Context propagation is required in all call paths</li> <li>Exporters are configured by the caller</li> </ul>"},{"location":"components/toolobserve/#links","title":"Links","text":"<ul> <li>Repository: https://github.com/jonwraymond/toolobserve</li> <li>Library docs: ../library-docs-from-repos/toolobserve/index.md</li> </ul>"},{"location":"components/toolrun/","title":"toolrun","text":"<p>Execution layer for tools and chains. Backend-agnostic and aligned to MCP <code>run_tool</code> and <code>run_chain</code> semantics.</p>"},{"location":"components/toolrun/#motivation","title":"Motivation","text":"<ul> <li>Provide consistent execution semantics across backends</li> <li>Validate inputs/outputs for safety</li> <li>Offer deterministic chain behavior</li> </ul>"},{"location":"components/toolrun/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Resolve tools and backends</li> <li>Validate inputs/outputs with toolmodel schemas</li> <li>Dispatch to MCP, provider, or local backends</li> <li>Execute chains with <code>previous</code> injection</li> </ul>"},{"location":"components/toolrun/#example","title":"Example","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n\nresult, _ := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"octo\",\n  \"repo\":  \"hello\",\n})\n</code></pre>"},{"location":"components/toolrun/#diagram","title":"Diagram","text":""},{"location":"components/toolrun/#usability-notes","title":"Usability notes","text":"<ul> <li>Streaming is optional; non-streaming backends return <code>ErrStreamNotSupported</code></li> <li>Backend selection is deterministic by default</li> </ul>"},{"location":"components/toolruntime/","title":"toolruntime","text":"<p>Sandbox/runtime abstraction for executing code securely. Provides multiple backends with a single interface.</p>"},{"location":"components/toolruntime/#motivation","title":"Motivation","text":"<ul> <li>Create an explicit trust boundary for code execution</li> <li>Swap isolation backends without changing APIs</li> <li>Apply security profiles consistently</li> </ul>"},{"location":"components/toolruntime/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Runtime interface + default implementation</li> <li>Backends (unsafe host, docker, kubernetes, gvisor, firecracker, wasm)</li> <li>Security profiles and execution limits</li> </ul>"},{"location":"components/toolruntime/#wasm-backend","title":"WASM backend","text":"<p><code>toolruntime</code> defines the WASM contracts in <code>backend/wasm</code> (Runner, ModuleLoader, HealthChecker, StreamRunner). The <code>metatools-mcp</code> server provides a wazero-based implementation and wires it into <code>execute_code</code> when the <code>toolruntime</code> build tag is enabled.</p>"},{"location":"components/toolruntime/#example","title":"Example","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"components/toolruntime/#diagram","title":"Diagram","text":""},{"location":"components/toolruntime/#usability-notes","title":"Usability notes","text":"<ul> <li>Profiles separate policy from implementation</li> <li>Backends are swappable per environment</li> </ul>"},{"location":"components/toolsearch/","title":"toolsearch","text":"<p>Search strategy library that plugs into toolindex. Currently provides BM25 with room for semantic/hybrid search.</p>"},{"location":"components/toolsearch/#motivation","title":"Motivation","text":"<ul> <li>Keep <code>toolindex</code> minimal</li> <li>Allow search experimentation without destabilizing the core</li> <li>Improve relevance without changing IDs or schemas</li> </ul>"},{"location":"components/toolsearch/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Provide BM25 ranking</li> <li>Keep search logic decoupled from the index</li> <li>Support pluggable scoring</li> </ul>"},{"location":"components/toolsearch/#example","title":"Example","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{K1: 1.5, B: 0.75})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"components/toolsearch/#diagram","title":"Diagram","text":""},{"location":"components/toolsearch/#usability-notes","title":"Usability notes","text":"<ul> <li>Deterministic ranking avoids jitter</li> <li>BM25 is opt-in and isolated by design</li> </ul>"},{"location":"components/toolsemantic/","title":"toolsemantic","text":"<p>Semantic indexing and retrieval for tools.</p>"},{"location":"components/toolsemantic/#motivation","title":"Motivation","text":"<ul> <li>Improve tool discovery beyond exact match</li> <li>Combine BM25 and embedding-based ranking</li> <li>Keep semantic search decoupled from storage</li> </ul>"},{"location":"components/toolsemantic/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Define semantic document model</li> <li>Provide indexing and search interfaces</li> <li>Compose scoring strategies</li> </ul>"},{"location":"components/toolsemantic/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolindex --&gt; toolsemantic --&gt; search strategies\n</code></pre>"},{"location":"components/toolsemantic/#diagram","title":"Diagram","text":""},{"location":"components/toolsemantic/#usability-notes","title":"Usability notes","text":"<ul> <li>Backends are pluggable and optional</li> <li>Deterministic ranking is required for stability</li> </ul>"},{"location":"components/toolsemantic/#links","title":"Links","text":"<ul> <li>Repository: https://github.com/jonwraymond/toolsemantic</li> <li>Library docs: ../library-docs-from-repos/toolsemantic/index.md</li> </ul>"},{"location":"components/toolset/","title":"toolset","text":"<p>Composable tool collection library for building curated tool surfaces.</p>"},{"location":"components/toolset/#position-in-the-stack","title":"Position in the Stack","text":"<p>toolset sits after <code>tooladapter</code> and before server exposure:</p> <pre><code>toolmodel --&gt; tooladapter --&gt; toolset --&gt; metatools-mcp\n</code></pre> <ul> <li><code>tooladapter</code> normalizes tools into canonical form.</li> <li><code>toolset</code> composes and filters tool collections.</li> <li><code>metatools-mcp</code> can optionally expose a filtered toolset.</li> </ul>"},{"location":"components/toolset/#motivation","title":"Motivation","text":"<ul> <li>Build curated tool sets for specific audiences or capabilities</li> <li>Enforce safety via filters and policies</li> <li>Export to multiple formats (MCP/OpenAI/Anthropic) via adapters</li> </ul>"},{"location":"components/toolset/#core-types","title":"Core Types","text":"Type Purpose <code>Toolset</code> Thread-safe collection of canonical tools <code>Builder</code> Fluent builder for filters/policies <code>FilterFunc</code> Reusable filter predicate <code>Policy</code> Hard allow/deny decisions <code>Exposure</code> Export to MCP/OpenAI/Anthropic via adapters"},{"location":"components/toolset/#example","title":"Example","text":"<pre><code>safeSet, err := toolset.NewBuilder(\"mcp-safe\").\n  FromTools(allTools).\n  WithNamespace(\"mcp\").\n  WithTags([]string{\"safe\"}).\n  ExcludeTools([]string{\"mcp:execute\"}).\n  Build()\n</code></pre>"},{"location":"components/toolset/#diagram","title":"Diagram","text":""},{"location":"components/toolset/#versioning-and-propagation","title":"Versioning and Propagation","text":"<ul> <li>Source of truth: <code>ai-tools-stack/go.mod</code></li> <li>Version matrix: <code>VERSIONS.md</code> (auto-synced)</li> <li>Propagation: <code>scripts/update-version-matrix.sh --apply</code></li> </ul>"},{"location":"components/toolset/#links","title":"Links","text":"<ul> <li>Repository</li> <li>Library Docs (via multirepo import)</li> </ul>"},{"location":"components/toolskill/","title":"toolskill","text":"<p>Skill composition primitives for reusable tool workflows.</p>"},{"location":"components/toolskill/#motivation","title":"Motivation","text":"<ul> <li>Provide a reusable workflow layer over tools</li> <li>Support deterministic planning and guardrails</li> <li>Expose higher-level skills via metatools-mcp</li> </ul>"},{"location":"components/toolskill/#core-responsibilities","title":"Core responsibilities","text":"<ul> <li>Declarative skill model</li> <li>Deterministic planning</li> <li>Guard and policy enforcement</li> </ul>"},{"location":"components/toolskill/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolset + toolrun + toolobserve --&gt; toolskill --&gt; metatools-mcp\n</code></pre>"},{"location":"components/toolskill/#diagram","title":"Diagram","text":""},{"location":"components/toolskill/#usability-notes","title":"Usability notes","text":"<ul> <li>Skills are declarative data, not code</li> <li>Execution is delegated to toolrun</li> </ul>"},{"location":"components/toolskill/#links","title":"Links","text":"<ul> <li>Repository: https://github.com/jonwraymond/toolskill</li> <li>Library docs: ../library-docs-from-repos/toolskill/index.md</li> </ul>"},{"location":"operations/ci-and-versioning/","title":"CI and Versioning","text":""},{"location":"operations/ci-and-versioning/#ci-checks","title":"CI checks","text":"<p>Each repo runs CI for:</p> <ul> <li>go vet</li> <li>go test</li> <li>lint + security (golangci-lint + gosec)</li> </ul>"},{"location":"operations/ci-and-versioning/#go-module-privacy-fast-tag-uptake","title":"Go module privacy (fast tag uptake)","text":"<p>CI sets:</p> <ul> <li><code>GOPRIVATE=github.com/jonwraymond/*</code></li> <li><code>GONOSUMDB=github.com/jonwraymond/*</code></li> </ul> <p>This bypasses the public proxy/sumdb for the org\u2019s modules so newly\u2011pushed tags are immediately usable in CI and local workflows.</p>"},{"location":"operations/ci-and-versioning/#version-alignment","title":"Version alignment","text":"<ul> <li><code>ai-tools-stack/go.mod</code> is the source of truth.</li> <li><code>VERSIONS.md</code> is generated in each repo and updated via:</li> </ul> <pre><code>scripts/update-version-matrix.sh --apply\n</code></pre>"},{"location":"operations/ci-and-versioning/#new-modules-example-tooladapter","title":"New modules (example: tooladapter)","text":"<p>When a new module is added to the stack (for example <code>tooladapter</code>), the propagation steps are:</p> <p>1) Tag the new module (<code>vX.Y.Z</code>). 2) Add it to <code>ai-tools-stack/go.mod</code> at the tagged version. 3) Run <code>scripts/update-version-matrix.sh --apply</code> to sync <code>VERSIONS.md</code> across repos. 4) Update <code>mkdocs.yml</code> to include the new module in Components and Library Docs.</p>"},{"location":"operations/ci-and-versioning/#dependency-bumping","title":"Dependency bumping","text":"<p>Use the DAG-aware bump tool:</p> <pre><code>scripts/bump-dep.sh --dep toolruntime --latest --apply\n</code></pre> <p>This updates all downstream repos and ai-tools-stack in order.</p>"},{"location":"operations/ci-and-versioning/#docs-automation","title":"Docs automation","text":"<p>The unified docs site is built from this repo using MkDocs + the multirepo plugin. GitHub Actions runs on push to main and nightly (scheduled) to pull fresh docs from the tool repos.</p> <p>Versioned docs are published with <code>mike</code>:</p> <ul> <li><code>latest</code> alias is deployed from <code>main</code></li> <li>tag builds deploy versioned docs (for example, <code>v0.1.8</code>) and set <code>stable</code></li> <li>the version selector appears in the site header once at least one tag build exists</li> </ul> <p>Local preview:</p> <pre><code>pip install -r requirements.txt\n./scripts/prepare-mkdocs-multirepo.sh\nmkdocs serve\n</code></pre> <p>Versioned preview:</p> <pre><code>pip install -r requirements.txt\n./scripts/prepare-mkdocs-multirepo.sh\nmike serve\n</code></pre>"},{"location":"operations/consolidation-validation-report/","title":"Consolidation Validation Report","text":"<p>Date: 2026-01-31 PRDs: PRD-190, PRD-191, PRD-192 Validator: Claude Opus 4.5</p>"},{"location":"operations/consolidation-validation-report/#executive-summary","title":"Executive Summary","text":"<p>The ApertureStack consolidation has been successfully completed. All 13 standalone repositories have been deprecated and archived. The codebase has been consolidated from 15 repositories down to 8 (6 consolidated library repos + 2 application repos).</p>"},{"location":"operations/consolidation-validation-report/#repository-status","title":"Repository Status","text":""},{"location":"operations/consolidation-validation-report/#consolidated-repositories-build-test","title":"Consolidated Repositories (Build &amp; Test)","text":"Repository Build Tests CI Status toolfoundation \u2713 \u2713 \u2713 success OK tooldiscovery \u2713 \u2713 \u2713 success OK toolexec \u2713 \u2713 lint issues OK toolcompose \u2713 \u2713 \u2713 success OK toolops \u2713 \u2713 commitlint OK toolprotocol \u2713 \u2713 commitlint OK <p>Note: CI failures are minor lint/commitlint issues, not build or test failures. All repositories build and pass tests locally.</p>"},{"location":"operations/consolidation-validation-report/#application-layer","title":"Application Layer","text":"Repository Build Tests CLI Status metatools-mcp \u2713 \u2713 \u2713 OK ai-tools-stack N/A (docs) N/A N/A OK"},{"location":"operations/consolidation-validation-report/#archive-status","title":"Archive Status","text":"<p>All 13 standalone repositories have been archived:</p> Repository Migrated To Archived toolmodel toolfoundation/model \u2713 tooladapter toolfoundation/adapter \u2713 toolindex tooldiscovery/index \u2713 toolsearch tooldiscovery/search \u2713 toolsemantic tooldiscovery/semantic \u2713 tooldocs tooldiscovery/tooldoc \u2713 toolrun toolexec/run \u2713 toolruntime toolexec/runtime \u2713 toolcode toolexec/code \u2713 toolset toolcompose/set \u2713 toolskill toolcompose/skill \u2713 toolobserve toolops/observe \u2713 toolcache toolops/cache \u2713 <p>Each archived repository contains: - Deprecation notice in README.md - MIGRATION.md with import path changes and migration steps</p>"},{"location":"operations/consolidation-validation-report/#submodule-status","title":"Submodule Status","text":"<p>Fresh clone with <code>--recursive</code> works correctly:</p> <pre><code>git clone --recursive git@github.com:jonwraymond/ApertureStack.git\n</code></pre> <p>8 submodules registered: - ai-tools-stack - metatools-mcp - toolcompose - tooldiscovery - toolexec - toolfoundation - toolops - toolprotocol</p>"},{"location":"operations/consolidation-validation-report/#package-consolidation-summary","title":"Package Consolidation Summary","text":""},{"location":"operations/consolidation-validation-report/#before-29-packages-across-15-repos","title":"Before (29 packages across 15 repos)","text":"<pre><code>15 repositories\n\u251c\u2500\u2500 13 standalone library repos (each with 1-3 packages)\n\u251c\u2500\u2500 metatools-mcp (application)\n\u2514\u2500\u2500 ai-tools-stack (documentation)\n</code></pre>"},{"location":"operations/consolidation-validation-report/#after-29-packages-across-8-repos","title":"After (29 packages across 8 repos)","text":"<pre><code>8 repositories\n\u251c\u2500\u2500 toolfoundation (3 packages: model, adapter, version)\n\u251c\u2500\u2500 tooldiscovery (4 packages: index, search, semantic, tooldoc)\n\u251c\u2500\u2500 toolexec (4+ packages: run, runtime, code, backend)\n\u251c\u2500\u2500 toolcompose (2 packages: set, skill)\n\u251c\u2500\u2500 toolops (6 packages: observe, cache, auth, health, resilience, exporters)\n\u251c\u2500\u2500 toolprotocol (10 packages: transport, wire, discover, content, etc.)\n\u251c\u2500\u2500 metatools-mcp (application)\n\u2514\u2500\u2500 ai-tools-stack (documentation)\n</code></pre>"},{"location":"operations/consolidation-validation-report/#integration-validation","title":"Integration Validation","text":""},{"location":"operations/consolidation-validation-report/#metatools-mcp","title":"metatools-mcp","text":"<ul> <li>Build: <code>go build ./cmd/metatools</code> - SUCCESS</li> <li>Tests: <code>go test ./...</code> - 17 packages passed</li> <li>CLI: <code>./metatools version</code> - Works correctly</li> </ul>"},{"location":"operations/consolidation-validation-report/#fresh-clone-test","title":"Fresh Clone Test","text":"<pre><code>cd /tmp\ngit clone --recursive git@github.com:jonwraymond/ApertureStack.git\n# All 8 submodules cloned successfully\n# All consolidated repos build successfully\n</code></pre>"},{"location":"operations/consolidation-validation-report/#rollback-plan","title":"Rollback Plan","text":"<p>If issues arise, repositories can be unarchived:</p> <pre><code>gh repo unarchive jonwraymond/toolmodel --yes\ngit submodule add git@github.com:jonwraymond/toolmodel.git toolmodel\n</code></pre>"},{"location":"operations/consolidation-validation-report/#conclusion","title":"Conclusion","text":"<p>ApertureStack consolidation COMPLETE</p> <ul> <li>\u2705 15 repos \u2192 8 repos (6 consolidated + metatools-mcp + ai-tools-stack)</li> <li>\u2705 29 packages organized into 6 consolidated repositories</li> <li>\u2705 All smoke tests passing</li> <li>\u2705 Documentation updated with deprecation notices</li> <li>\u2705 Old repos archived (read-only)</li> <li>\u2705 Fresh clone works with <code>--recursive</code></li> </ul>"},{"location":"operations/consolidation-validation-report/#gate-g7-completion-criteria","title":"Gate G7 Completion Criteria","text":"Criterion Status All consolidated repos build \u2713 All consolidated repos pass tests \u2713 metatools-mcp builds with new imports \u2713 All 13 old repos archived \u2713 Fresh clone with --recursive works \u2713 Deprecation notices in all old repos \u2713 MIGRATION.md in all old repos \u2713 <p>Gate G7: PASSED</p>"},{"location":"operations/stack-changelog/","title":"Stack Changelog","text":"<p>Aggregated highlights from each repo\u2019s latest release. For full history, use each repo\u2019s CHANGELOG.</p>"},{"location":"operations/stack-changelog/#version-matrix","title":"Version matrix","text":""},{"location":"operations/stack-changelog/#version-compatibility-current-tags","title":"Version compatibility (current tags)","text":"<ul> <li><code>toolmodel</code>: <code>v0.2.0</code></li> <li><code>tooladapter</code>: <code>v0.2.0</code></li> <li><code>toolset</code>: <code>v1.0.1</code></li> <li><code>toolindex</code>: <code>v0.3.0</code></li> <li><code>tooldocs</code>: <code>v0.2.0</code></li> <li><code>toolrun</code>: <code>v0.3.0</code></li> <li><code>toolcode</code>: <code>v0.3.0</code></li> <li><code>toolruntime</code>: <code>v0.4.0</code></li> <li><code>toolsearch</code>: <code>v0.3.0</code></li> <li><code>toolobserve</code>: <code>v0.2.0</code></li> <li><code>toolcache</code>: <code>v0.2.0</code></li> <li><code>toolsemantic</code>: <code>v0.2.0</code></li> <li><code>toolskill</code>: <code>v0.2.0</code></li> <li><code>metatools-mcp</code>: <code>v0.5.0</code></li> </ul> <p>Generated from <code>ai-tools-stack/go.mod</code>.</p>"},{"location":"operations/stack-changelog/#tooladapter","title":"tooladapter","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features","title":"Features","text":"<ul> <li>tooladapter: add Adapter interface and SchemaFeature (94a0617)</li> <li>tooladapter: add AdapterRegistry (5d947b1)</li> <li>tooladapter: add Anthropic adapter (fe5c4f5)</li> <li>tooladapter: add CanonicalTool and JSONSchema (5aff5f2)</li> <li>tooladapter: add MCP adapter (cb3d86e)</li> <li>tooladapter: add OpenAI adapter (3472725)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolset","title":"toolset","text":"<p>Latest: 1.0.1</p>"},{"location":"operations/stack-changelog/#chores","title":"Chores","text":"<ul> <li>bump tooladapter dependency to v0.2.0</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolmodel","title":"toolmodel","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_1","title":"Features","text":"<ul> <li>add support for tool tags and normalization (e72c0e6)</li> </ul>"},{"location":"operations/stack-changelog/#bug-fixes","title":"Bug Fixes","text":"<ul> <li>add ToolBackend validation and avoid schema mutation (1e2bd12)</li> <li>correct release-please step id (523b87b)</li> <li>simplify release-please token handling (951046d)</li> <li>use app token for release-please (8ae5f64)</li> <li>use PAT for release-please (4690c67)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolindex","title":"toolindex","text":"<p>Latest: 0.3.0</p>"},{"location":"operations/stack-changelog/#features_2","title":"Features","text":"<ul> <li>enforce deterministic searcher for pagination (962da40)</li> <li>mcp: add cursor-based pagination (5f0f95c)</li> <li>mcp: add cursor-based pagination (88d0a81)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#tooldocs","title":"tooldocs","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_3","title":"Features","text":"<ul> <li>implement MCP-aligned tooldocs store (88b6af8)</li> </ul>"},{"location":"operations/stack-changelog/#bug-fixes_1","title":"Bug Fixes","text":"<ul> <li>correct release-please step id (880cd82)</li> <li>enforce max examples on register (31ffd19)</li> <li>revive warnings for ListExamples (d9430e8)</li> <li>simplify release-please token handling (2452e72)</li> <li>use app token for release-please (53a2b82)</li> <li>use PAT for release-please (a425fbf)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolrun","title":"toolrun","text":"<p>Latest: 0.3.0</p>"},{"location":"operations/stack-changelog/#features_4","title":"Features","text":"<ul> <li>add progress callbacks and clarify cancellation (0901636)</li> <li>mcp: add context cancellation propagation (ab5580d)</li> <li>mcp: add context cancellation propagation (55b51c5)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolcode","title":"toolcode","text":"<p>Latest: 0.3.0</p>"},{"location":"operations/stack-changelog/#features_5","title":"Features","text":"<ul> <li>add context to toolcode tools (672e132)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolruntime","title":"toolruntime","text":"<p>Latest: 0.2.1</p>"},{"location":"operations/stack-changelog/#bug-fixes_2","title":"Bug Fixes","text":"<ul> <li>honor context in stub backends (f7afa6e)</li> <li>propagate context through toolruntime gateway (7972a29)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolsearch","title":"toolsearch","text":"<p>Latest: 0.3.0</p>"},{"location":"operations/stack-changelog/#features_6","title":"Features","text":"<ul> <li>mark BM25 searcher deterministic (efc51c8)</li> <li>mark BM25 searcher deterministic (e43ae7a)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolobserve","title":"toolobserve","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_7","title":"Features","text":"<ul> <li>toolobserve: add config validation and observer core (e717465)</li> <li>toolobserve: add execution middleware (bfde9bf)</li> <li>toolobserve: add exporter configuration (f2697e8)</li> <li>toolobserve: add metrics (1869b3f)</li> <li>toolobserve: add structured logger (c6e651c)</li> <li>toolobserve: add tracing (437cac2)</li> </ul>"},{"location":"operations/stack-changelog/#bug-fixes_3","title":"Bug Fixes","text":"<ul> <li>toolobserve: wire exporters and structured logger (0e6213a)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolcache","title":"toolcache","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_8","title":"Features","text":"<ul> <li>toolcache: add cache primitives and middleware (3656e97)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolsemantic","title":"toolsemantic","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_9","title":"Features","text":"<ul> <li>toolsemantic: add document model (39c83c2)</li> <li>toolsemantic: add filters (8116bbd)</li> <li>toolsemantic: add in-memory indexer (236b989)</li> <li>toolsemantic: add scoring strategies (ebbfc11)</li> <li>toolsemantic: add searcher interface (9ac507b)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#toolskill","title":"toolskill","text":"<p>Latest: 0.2.0</p>"},{"location":"operations/stack-changelog/#features_10","title":"Features","text":"<ul> <li>toolskill: add deterministic planner (1c168b1)</li> <li>toolskill: add execution adapter (efe087a)</li> <li>toolskill: add guard policies (7171124)</li> <li>toolskill: add skill and step models (766c561)</li> </ul> <p>Full changelog</p>"},{"location":"operations/stack-changelog/#metatools-mcp","title":"metatools-mcp","text":"<p>Latest: 0.4.0</p>"},{"location":"operations/stack-changelog/#features_11","title":"Features","text":"<ul> <li>backend: add registry, local backend, and adapter (cd0f8a1)</li> <li>cli: add Cobra foundation (bc492ad)</li> <li>config: add Koanf config layer (PRD-003) (7fa2403)</li> <li>middleware: add middleware chain and config (4f70bd2)</li> <li>server: add provider registry and built-in providers (3c8124f)</li> <li>transport: add SSE transport abstraction (PRD-004) (aa42715)</li> </ul>"},{"location":"operations/stack-changelog/#bug-fixes_4","title":"Bug Fixes","text":"<ul> <li>backend: address lint issues (550ebb2)</li> <li>backend: silence revive unused params (70698eb)</li> <li>middleware: resolve lint in tests and config (a306e51)</li> <li>middleware: resolve revive unused params (f87f926)</li> </ul> <p>Full changelog</p> <p>Generated by scripts/generate-combined-changelog.sh</p>"},{"location":"library-docs-from-repos/toolmodel/","title":"toolmodel","text":"<p><code>toolmodel</code> is the canonical, MCP-aligned data model for tools across the stack. It embeds the official MCP Go SDK <code>mcp.Tool</code>, adds namespace + tags, and provides schema validation helpers.</p> <p></p>"},{"location":"library-docs-from-repos/toolmodel/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#motivation","title":"Motivation","text":"<ul> <li>Single source of truth for tool schemas and IDs</li> <li>Protocol alignment by embedding the official MCP SDK type</li> <li>Safe validation with deterministic, dependency-light JSON Schema checks</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#key-apis","title":"Key APIs","text":"<ul> <li><code>Tool</code> (embeds <code>mcp.Tool</code>, adds <code>Namespace</code>, <code>Version</code>, <code>Tags</code>)</li> <li><code>ToolBackend</code> (mcp/provider/local binding)</li> <li><code>SchemaValidator</code> + <code>NewDefaultValidator()</code></li> <li><code>NormalizeTags</code>, <code>ToolID</code>, <code>ParseToolID</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#quickstart","title":"Quickstart","text":"<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\nfunc main() {\n  tool := toolmodel.Tool{\n    Namespace: \"github\",\n    Tool: mcp.Tool{\n      Name:        \"get_repo\",\n      Description: \"Fetch repository metadata\",\n      InputSchema: map[string]any{\n        \"type\": \"object\",\n        \"properties\": map[string]any{\n          \"owner\": {\"type\": \"string\"},\n          \"repo\":  {\"type\": \"string\"},\n        },\n        \"required\": []string{\"owner\", \"repo\"},\n      },\n    },\n    Tags: toolmodel.NormalizeTags([]string{\"GitHub\", \"repos\"}),\n  }\n\n  if err := tool.Validate(); err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Println(tool.ToolID()) // github:get_repo\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/#usability-notes","title":"Usability notes","text":"<ul> <li><code>InputSchema</code>/<code>OutputSchema</code> accept <code>map[string]any</code> or JSON bytes</li> <li>Tags are normalized for search (<code>toolindex</code> + <code>toolsearch</code>)</li> <li>Canonical IDs are stable and human-friendly</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/#next","title":"Next","text":"<ul> <li>Architecture and placement in the stack: <code>architecture.md</code></li> <li>Usage patterns and validation: <code>usage.md</code></li> <li>Additional examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/","title":"API Reference","text":"<p>This is a concise map of the public types and interfaces. See code for details.</p>"},{"location":"library-docs-from-repos/toolmodel/api/#tool","title":"Tool","text":"<p><code>toolmodel.Tool</code> embeds <code>mcp.Tool</code> and adds:</p> <ul> <li><code>Namespace string</code></li> <li><code>Version string</code></li> <li><code>Tags []string</code></li> </ul> <p>Common fields from <code>mcp.Tool</code> used in this stack:</p> <ul> <li><code>Name string</code></li> <li><code>Title string</code></li> <li><code>Description string</code></li> <li><code>InputSchema any</code></li> <li><code>OutputSchema any</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/#ids","title":"IDs","text":"<ul> <li><code>Tool.ToolID() string</code></li> <li><code>ParseToolID(id string) (namespace, name string, err error)</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/api/#backends","title":"Backends","text":"<pre><code>type BackendKind string\nconst (\n  BackendKindMCP      BackendKind = \"mcp\"\n  BackendKindProvider BackendKind = \"provider\"\n  BackendKindLocal    BackendKind = \"local\"\n)\n\ntype ToolBackend struct {\n  Kind     BackendKind\n  MCP      *MCPBackend\n  Provider *ProviderBackend\n  Local    *LocalBackend\n}\n\ntype MCPBackend struct {\n  ServerName string\n}\n\ntype ProviderBackend struct {\n  ProviderID string\n  ToolID     string\n}\n\ntype LocalBackend struct {\n  Name string\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/api/#validation","title":"Validation","text":"<pre><code>type SchemaValidator interface {\n  Validate(schema any, instance any) error\n  ValidateInput(tool *Tool, args any) error\n  ValidateOutput(tool *Tool, result any) error\n}\n\nfunc NewDefaultValidator() *DefaultValidator\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/api/#utilities","title":"Utilities","text":"<ul> <li><code>NormalizeTags([]string) []string</code></li> <li><code>Tool.Validate() error</code></li> <li><code>ToolBackend.Validate() error</code></li> </ul>"},{"location":"library-docs-from-repos/toolmodel/architecture/","title":"Architecture","text":"<p><code>toolmodel</code> sits at the bottom of the stack. Everything else consumes its types and uses it as the canonical source of truth.</p>"},{"location":"library-docs-from-repos/toolmodel/architecture/#component-view","title":"Component view","text":""},{"location":"library-docs-from-repos/toolmodel/architecture/#data-model-view","title":"Data model view","text":""},{"location":"library-docs-from-repos/toolmodel/architecture/#validation-pipeline","title":"Validation pipeline","text":""},{"location":"library-docs-from-repos/toolmodel/architecture/#design-notes","title":"Design notes","text":"<ul> <li>Embeds <code>mcp.Tool</code> to stay aligned with the official MCP SDK.</li> <li>Adds <code>Namespace</code>, <code>Version</code>, and <code>Tags</code> without altering MCP semantics.</li> <li>Keeps validation dependency-light and deterministic.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/","title":"Design Notes","text":"<p>This page captures the tradeoffs and error semantics that guided <code>toolmodel</code>.</p>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Spec alignment over custom types. <code>Tool</code> embeds the official MCP Go SDK <code>mcp.Tool</code> to stay 1:1 with the spec and JSON tags. This minimizes drift but means <code>InputSchema</code>/<code>OutputSchema</code> are <code>any</code>, so validation must be handled explicitly.</li> <li>Minimal extensions. <code>Namespace</code>, <code>Version</code>, and <code>Tags</code> are the only additions to the MCP shape. These are intentionally kept small to preserve transport compatibility and keep higher layers in control of semantics.</li> <li>Explicit tool IDs. Canonical IDs are <code>namespace:name</code> (or just <code>name</code>), computed by <code>ToolID()</code>. This keeps IDs stable across backends while remaining human-readable.</li> <li>Validation boundary. <code>Tool.Validate()</code> enforces naming and required fields only. JSON Schema validation is delegated to <code>SchemaValidator</code> to keep <code>Tool</code> lightweight and reusable.</li> <li>Safe schema validation. The default validator blocks external <code>$ref</code> resolution to avoid network access and non-determinism. This trades off remote schema reuse for safety and predictability.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolmodel</code> uses sentinel errors so callers can reliably classify failures:</p> <ul> <li><code>ErrInvalidToolID</code> \u2013 malformed tool IDs (empty, extra <code>:</code> separators, missing parts).</li> <li><code>ErrInvalidTool</code> \u2013 invalid tool definition (missing name, invalid characters, missing input schema).</li> <li><code>ErrInvalidSchema</code> \u2013 schema is not valid JSON Schema or cannot be parsed.</li> <li><code>ErrUnsupportedSchema</code> \u2013 schema dialect is not supported (only 2020-12 and draft-07 are accepted).</li> <li><code>ErrExternalRef</code> \u2013 external <code>$ref</code> resolution attempted (blocked by default).</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#validation-behavior","title":"Validation behavior","text":"<ul> <li><code>Tool.Validate()</code> enforces name format and <code>InputSchema != nil</code>.</li> <li><code>DefaultValidator.ValidateInput</code> and <code>ValidateOutput</code> return <code>ErrInvalidSchema</code> or <code>ErrUnsupportedSchema</code> when schema parsing or dialect checks fail.</li> <li>Output validation is optional by design; <code>OutputSchema</code> can be absent.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom schema validation: implement <code>SchemaValidator</code> if you need different dialects, format checking, or external reference resolution.</li> <li>Tag strategies: <code>NormalizeTags</code> can be replaced at higher layers (e.g., for hierarchical tags or full-text indexing).</li> <li>Tool ingestion: higher layers can deserialize MCP tool JSON via <code>FromMCPJSON</code> and then enrich with <code>Namespace</code> and <code>Tags</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep <code>Namespace</code> stable even if backend endpoints change.</li> <li>Use short, searchable <code>Tags</code>; <code>NormalizeTags</code> caps to 20 items and 64 chars each.</li> <li>Prefer JSON Schema 2020-12 with explicit <code>type</code> and <code>required</code> fields for best downstream schema derivation.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolmodel/examples/#tag-normalization","title":"Tag normalization","text":"<pre><code>normalized := toolmodel.NormalizeTags([]string{\n  \"  GitHub Repos \",\n  \"GITHUB  repos\",\n  \"  ci/cd  \",\n})\n// =&gt; [\"github-repos\", \"ci-cd\"]\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/examples/#validate-output","title":"Validate output","text":"<pre><code>result := map[string]any{\n  \"full_name\": \"octo/hello\",\n}\n\nif err := validator.ValidateOutput(&amp;tool, result); err != nil {\n  // handle schema mismatch\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/examples/#canonical-id-parsing","title":"Canonical ID parsing","text":"<pre><code>ns, name, err := toolmodel.ParseToolID(\"github:get_repo\")\n// ns = \"github\", name = \"get_repo\"\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolmodel/usage/#define-a-tool","title":"Define a tool","text":"<pre><code>import (\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntool := toolmodel.Tool{\n  Namespace: \"tickets\",\n  Tool: mcp.Tool{\n    Name:        \"create\",\n    Description: \"Create a support ticket\",\n    InputSchema: map[string]any{\n      \"type\": \"object\",\n      \"properties\": map[string]any{\n        \"title\":    {\"type\": \"string\"},\n        \"priority\": {\"type\": \"string\", \"enum\": []string{\"low\", \"high\"}},\n      },\n      \"required\": []string{\"title\"},\n    },\n  },\n  Tags: toolmodel.NormalizeTags([]string{\"Support\", \"Tickets\"}),\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#tool-ids","title":"Tool IDs","text":"<pre><code>id := tool.ToolID()                 // tickets:create\nns, name, _ := toolmodel.ParseToolID(id)\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#backends","title":"Backends","text":"<p><code>toolmodel</code> does not execute anything. It only describes how a tool can be executed. These backends are consumed by <code>toolrun</code>.</p> <pre><code>mcpBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindMCP,\n  MCP:  &amp;toolmodel.MCPBackend{ServerName: \"github\"},\n}\n\nproviderBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindProvider,\n  Provider: &amp;toolmodel.ProviderBackend{\n    ProviderID: \"internal-api\",\n    ToolID:     \"tickets.create\",\n  },\n}\n\nlocalBackend := toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"create_ticket\"},\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#validation","title":"Validation","text":"<pre><code>validator := toolmodel.NewDefaultValidator()\n\nif err := validator.ValidateInput(&amp;tool, map[string]any{\"title\": \"Help\"}); err != nil {\n  // handle validation error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/usage/#dialects-and-safety","title":"Dialects and safety","text":"<ul> <li>JSON Schema 2020-12 is assumed when <code>$schema</code> is missing.</li> <li>draft-07 is accepted (normalized internally).</li> <li>External <code>$ref</code> is blocked (no network resolution).</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/","title":"User Journey","text":"<p>This journey shows how a tool definition flows from authoring to execution across the stack, with <code>toolmodel</code> as the source of truth.</p>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#718096', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph author[\"Tool Authoring\"]\n        Define[\"\ud83d\udcdd Define Tool&lt;br/&gt;&lt;small&gt;toolmodel.Tool&lt;/small&gt;\"]\n        Schema[\"\ud83d\udcd0 InputSchema&lt;br/&gt;&lt;small&gt;JSON Schema 2020-12&lt;/small&gt;\"]\n    end\n\n    subgraph validation[\"Validation\"]\n        Validate[\"\u2705 Tool.Validate()\"]\n        SchemaVal[\"\u2705 SchemaValidator\"]\n    end\n\n    subgraph registration[\"Registration\"]\n        Register[\"\ud83d\udcc7 toolindex.RegisterTool()\"]\n        Backend[\"\u2699\ufe0f ToolBackend&lt;br/&gt;&lt;small&gt;local | provider | mcp&lt;/small&gt;\"]\n    end\n\n    subgraph discovery[\"Discovery\"]\n        Search[\"\ud83d\udd0d search_tools\"]\n        Summary[\"\ud83d\udccb Summary&lt;br/&gt;&lt;small&gt;ID, Name, Tags&lt;/small&gt;\"]\n    end\n\n    subgraph execution[\"Execution\"]\n        Describe[\"\ud83d\udcda describe_tool\"]\n        Run[\"\u25b6\ufe0f run_tool\"]\n    end\n\n    Define --&gt; Schema --&gt; Validate\n    Validate --&gt; SchemaVal --&gt; Register\n    Register --&gt; Backend\n    Backend --&gt; Search --&gt; Summary\n    Summary --&gt; Describe --&gt; Run\n\n    style author fill:#718096,stroke:#4a5568,stroke-width:2px\n    style validation fill:#38a169,stroke:#276749\n    style registration fill:#3182ce,stroke:#2c5282\n    style discovery fill:#d69e2e,stroke:#b7791f\n    style execution fill:#6b46c1,stroke:#553c9a</code></pre>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Author defines a tool using <code>toolmodel.Tool</code> with an MCP-compatible schema.</li> <li>Tool is validated (<code>Tool.Validate()</code> + optional schema validation).</li> <li>Tool is registered into <code>toolindex</code> with a backend binding.</li> <li>Agent discovers tools via <code>search_tools</code> (powered by <code>toolindex</code>).</li> <li>Agent inspects schema/docs via <code>describe_tool</code> (powered by <code>tooldocs</code>).</li> <li>Agent executes the tool via <code>run_tool</code> (powered by <code>toolrun</code>).</li> </ol>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#example-define-a-tool","title":"Example: define a tool","text":"<pre><code>import (\n  \"encoding/json\"\n  \"github.com/jonwraymond/toolmodel\"\n  \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ninputSchema := json.RawMessage(`{\n  \"type\": \"object\",\n  \"properties\": {\n    \"owner\": {\"type\": \"string\"},\n    \"repo\": {\"type\": \"string\"}\n  },\n  \"required\": [\"owner\", \"repo\"]\n}`)\n\nrepoTool := toolmodel.Tool{\n  Tool: mcp.Tool{\n    Name:        \"get_repo\",\n    Title:       \"Get repo details\",\n    Description: \"Fetch repository metadata.\",\n    InputSchema: inputSchema,\n  },\n  Namespace: \"github\",\n  Tags:      []string{\"repo\", \"git\", \"metadata\"},\n}\n\nif err := repoTool.Validate(); err != nil {\n  // handle invalid tool\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>A stable tool ID (<code>github:get_repo</code>) that downstream components can resolve.</li> <li>Schema-driven validation for inputs and outputs (via <code>SchemaValidator</code>).</li> <li>Token-efficient discovery by pushing only summaries into search results.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Invalid tool ID: <code>ErrInvalidToolID</code> when parsing malformed IDs.</li> <li>Invalid tool fields: <code>ErrInvalidTool</code> when name is missing/invalid or input schema is nil.</li> <li>Unsupported schema dialect: <code>ErrUnsupportedSchema</code> for non-2020-12/draft-07 schemas.</li> <li>External refs blocked: <code>ErrExternalRef</code> if the schema attempts external <code>$ref</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/user-journey/#why-this-matters","title":"Why this matters","text":"<p><code>toolmodel</code> keeps the entire stack aligned with the official MCP tool shape while still providing namespaces, versions, and tags needed for real-world registries.</p>"},{"location":"library-docs-from-repos/toolmodel/plans/","title":"toolmodel Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolmodel (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-execution-plan/#schemavalidator","title":"SchemaValidator","text":"<pre><code>func TestSchemaValidator_Contract(t *testing.T) {\n    // Methods:\n    // - Validate(schema any, instance any) error\n    // - ValidateInput(tool *Tool, args any) error\n    // - ValidateOutput(tool *Tool, result any) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolmodel","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>SchemaValidator</code> <code>toolmodel/validator.go:34</code> Validate(schema any, instance any) errorValidateInput(tool Tool, args any) errorValidateOutput(tool Tool, result any) error"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolmodel/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/","title":"tooladapter","text":"<p>Protocol-agnostic tool format conversion library for Go.</p>"},{"location":"library-docs-from-repos/tooladapter/#overview","title":"Overview","text":"<p>tooladapter enables bidirectional transformation between MCP, OpenAI, and Anthropic tool definitions through a canonical intermediate representation (<code>CanonicalTool</code>). It is a pure data-transform library with no I/O, network access, or runtime execution.</p>"},{"location":"library-docs-from-repos/tooladapter/#design-goals","title":"Design Goals","text":"<ol> <li> <p>Pure transforms: All conversions are stateless data transformations. No network calls, no file I/O, no tool execution.</p> </li> <li> <p>Determinism: The same input always produces the same output, enabling caching, deduplication, and reliable testing.</p> </li> <li> <p>Loss visibility: When converting between formats, feature loss is tracked and reported as warnings, not hidden or silently dropped.</p> </li> <li> <p>Minimal dependencies: Only depends on the MCP Go SDK for the MCP adapter. OpenAI and Anthropic adapters use self-contained types with no external SDK dependencies.</p> </li> <li> <p>Go idioms: Errors are wrapped with context and support <code>errors.Unwrap()</code>. The registry is thread-safe. All exported types have GoDoc comments.</p> </li> </ol>"},{"location":"library-docs-from-repos/tooladapter/#position-in-the-stack","title":"Position in the Stack","text":"<p>tooladapter sits alongside (not inside) other ApertureStack libraries:</p> <pre><code>toolmodel --&gt; tooladapter --&gt; toolset --&gt; metatools-mcp\n    |              |\n    v              v\n  MCP-aligned    Protocol-agnostic\n  definitions    conversion layer\n</code></pre> <p>Dependency order (DAG):</p> <ul> <li><code>toolmodel</code> provides MCP-aligned tool definitions</li> <li><code>tooladapter</code> provides protocol conversion (depends on toolmodel for alignment)</li> <li><code>toolset</code> composes tools and can export to multiple formats via tooladapter</li> <li><code>metatools-mcp</code> can optionally wire toolset to expose non-MCP formats</li> </ul> <p>tooladapter does not change the MCP surface. It provides a normalization layer that other components can use to support multiple LLM providers.</p>"},{"location":"library-docs-from-repos/tooladapter/#key-features","title":"Key Features","text":"<ul> <li>Canonical representation: <code>CanonicalTool</code> stores the superset of schema information from all supported formats</li> <li>JSONSchema superset: <code>JSONSchema</code> type supports JSON Schema 2020-12 features including <code>$ref</code>, <code>$defs</code>, combinators (<code>anyOf</code>, <code>oneOf</code>, <code>allOf</code>, <code>not</code>), and draft-07 compatibility</li> <li>Feature loss tracking: <code>FeatureLossWarning</code> indicates when schema features cannot be preserved in the target format</li> <li>Thread-safe registry: <code>AdapterRegistry</code> safely manages adapters across goroutines</li> <li>Round-trip preservation: Format-specific metadata stored in <code>SourceMeta</code> enables better round-trip conversions</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Adapter: thread-safe; pure conversion without mutation; <code>ToCanonical</code>/<code>FromCanonical</code> return errors for invalid schema; deterministic output for identical inputs.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/#installation","title":"Installation","text":"<pre><code>go get github.com/jonwraymond/tooladapter\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/#quick-start","title":"Quick Start","text":"<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/jonwraymond/tooladapter\"\n    \"github.com/jonwraymond/tooladapter/adapters\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\nfunc main() {\n    // Create registry and register adapters\n    registry := tooladapter.NewRegistry()\n    registry.Register(adapters.NewMCPAdapter())\n    registry.Register(adapters.NewOpenAIAdapter())\n    registry.Register(adapters.NewAnthropicAdapter())\n\n    // Create an MCP tool\n    mcpTool := mcp.Tool{\n        Name:        \"get_weather\",\n        Description: \"Get weather for a location\",\n        InputSchema: map[string]any{\n            \"type\": \"object\",\n            \"properties\": map[string]any{\n                \"location\": map[string]any{\n                    \"type\":        \"string\",\n                    \"description\": \"City name\",\n                },\n            },\n            \"required\": []any{\"location\"},\n        },\n    }\n\n    // Convert MCP tool to OpenAI format\n    result, err := registry.Convert(mcpTool, \"mcp\", \"openai\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Check for feature loss warnings\n    for _, w := range result.Warnings {\n        fmt.Printf(\"Warning: %s\\n\", w)\n    }\n\n    openaiFunc := result.Tool.(adapters.OpenAIFunction)\n    fmt.Printf(\"OpenAI function: %s\\n\", openaiFunc.Name)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/#supported-formats","title":"Supported Formats","text":"Format Adapter Supports $ref Supports Combinators Notes MCP <code>MCPAdapter</code> Yes Yes Full JSON Schema support OpenAI <code>OpenAIAdapter</code> No No Strict mode enforces <code>additionalProperties=false</code> Anthropic <code>AnthropicAdapter</code> No Yes Uses <code>input_schema</code> field name"},{"location":"library-docs-from-repos/tooladapter/#architecture","title":"Architecture","text":"<pre><code>+-----------+     +---------------+     +-----------+\n| MCP Tool  |----&gt;| CanonicalTool |----&gt;| OpenAI Fn |\n+-----------+     +---------------+     +-----------+\n      ^                  |                   |\n      |                  v                   |\n      |          +---------------+           |\n      +----------|   Registry    |&lt;----------+\n                 +---------------+\n</code></pre> <p>The registry manages adapters and provides the <code>Convert()</code> method that:</p> <ol> <li>Calls <code>ToCanonical()</code> on the source adapter</li> <li>Checks <code>SupportsFeature()</code> on the target adapter to generate warnings</li> <li>Calls <code>FromCanonical()</code> on the target adapter</li> <li>Returns the converted tool with any feature loss warnings</li> </ol>"},{"location":"library-docs-from-repos/tooladapter/#versioning","title":"Versioning","text":"<p>tooladapter follows semantic versioning. The authoritative version matrix is maintained in <code>ai-tools-stack/go.mod</code> and propagated to <code>VERSIONS.md</code> in each repository.</p> <p>Current version: See the stack version matrix in the published docs: <code>ai-tools-stack &gt; Operations &gt; Stack Changelog</code>.</p>"},{"location":"library-docs-from-repos/tooladapter/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes - Schema decisions, conversion semantics, and limitations</li> <li>User Journey - Complete conversion examples with Mermaid diagrams</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/","title":"Design Notes","text":"<p>This document explains the schema design decisions, conversion semantics, and limitations of the tooladapter library.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#canonicaltool-design","title":"CanonicalTool Design","text":""},{"location":"library-docs-from-repos/tooladapter/design-notes/#purpose","title":"Purpose","text":"<p><code>CanonicalTool</code> is the protocol-agnostic intermediate representation. It stores a superset of information from all supported formats, enabling lossless conversion when the target format supports the features used.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#fields","title":"Fields","text":"Field Type Purpose <code>Namespace</code> <code>string</code> Optional grouping (e.g., \"github\", \"slack\") <code>Name</code> <code>string</code> Required. Tool identifier <code>Version</code> <code>string</code> Semantic version <code>Description</code> <code>string</code> Human-readable explanation <code>Category</code> <code>string</code> Classification <code>Tags</code> <code>[]string</code> Discovery keywords <code>InputSchema</code> <code>*JSONSchema</code> Required. Parameter schema <code>OutputSchema</code> <code>*JSONSchema</code> Optional. Return schema <code>Timeout</code> <code>time.Duration</code> Execution timeout hint <code>SourceFormat</code> <code>string</code> Original format (e.g., \"mcp\") <code>SourceMeta</code> <code>map[string]any</code> Format-specific metadata for round-trip <code>RequiredScopes</code> <code>[]string</code> Authorization scopes"},{"location":"library-docs-from-repos/tooladapter/design-notes/#id-generation","title":"ID Generation","text":"<p>The <code>ID()</code> method returns a stable identifier:</p> <ul> <li>With namespace: <code>\"namespace:name\"</code> (e.g., <code>\"github:get_repo\"</code>)</li> <li>Without namespace: <code>\"name\"</code> (e.g., <code>\"get_weather\"</code>)</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#validation","title":"Validation","text":"<p>The <code>Validate()</code> method checks:</p> <ol> <li><code>Name</code> is not empty</li> <li><code>InputSchema</code> is not nil</li> </ol> <p>This matches MCP requirements where tools must have a name and input schema.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#jsonschema-design","title":"JSONSchema Design","text":""},{"location":"library-docs-from-repos/tooladapter/design-notes/#json-schema-version-support","title":"JSON Schema Version Support","text":"<p>The <code>JSONSchema</code> struct targets JSON Schema 2020-12 while maintaining draft-07 compatibility. This aligns with:</p> <ul> <li>MCP SDK which uses <code>github.com/google/jsonschema-go</code> (2020-12)</li> <li>OpenAI which uses a subset of JSON Schema</li> <li>Anthropic which uses standard JSON Schema features</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#supported-keywords","title":"Supported Keywords","text":"Category Keywords Type <code>type</code> Validation <code>minimum</code>, <code>maximum</code>, <code>minLength</code>, <code>maxLength</code>, <code>pattern</code>, <code>format</code>, <code>enum</code>, <code>const</code> Object <code>properties</code>, <code>required</code>, <code>additionalProperties</code> Array <code>items</code> Composition <code>anyOf</code>, <code>oneOf</code>, <code>allOf</code>, <code>not</code> References <code>$ref</code>, <code>$defs</code> Metadata <code>description</code>, <code>default</code>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#pointer-types-for-optional-fields","title":"Pointer Types for Optional Fields","text":"<p>Numeric constraints use pointers to distinguish \"not set\" from \"set to zero\":</p> <pre><code>type JSONSchema struct {\n    Minimum   *float64  // nil = not specified, &amp;0.0 = minimum is 0\n    Maximum   *float64\n    MinLength *int\n    MaxLength *int\n}\n</code></pre> <p>Similarly, <code>AdditionalProperties</code> uses <code>*bool</code>:</p> <ul> <li><code>nil</code>: not specified (default JSON Schema behavior)</li> <li><code>true</code>: explicitly allow additional properties</li> <li><code>false</code>: explicitly forbid additional properties</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#deepcopy-semantics","title":"DeepCopy Semantics","text":"<p><code>DeepCopy()</code> creates a complete independent copy with:</p> <ul> <li>No aliasing of slices or maps</li> <li>Recursive copying of nested <code>*JSONSchema</code> in Properties, Items, Defs, combinators</li> <li>Copied pointers for numeric constraints</li> </ul> <p>This is essential for safe concurrent use and modification without side effects.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#tomap-conversion","title":"ToMap Conversion","text":"<p><code>ToMap()</code> returns a <code>map[string]any</code> suitable for JSON serialization with:</p> <ul> <li>Zero-value omission: Empty strings, nil pointers, empty slices are omitted</li> <li>Recursive conversion: Nested Properties and Defs are converted to nested maps</li> <li>Correct key names: Uses JSON Schema keywords (<code>$ref</code>, <code>$defs</code>, <code>additionalProperties</code>)</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#feature-support-matrix","title":"Feature Support Matrix","text":"Feature MCP OpenAI Anthropic Notes <code>$ref</code> Yes No No Schema references <code>$defs</code> Yes No No Schema definitions <code>anyOf</code> Yes No Yes Any of listed schemas <code>oneOf</code> Yes No Yes Exactly one of listed schemas <code>allOf</code> Yes No Yes All of listed schemas <code>not</code> Yes No Yes Schema negation <code>pattern</code> Yes Yes* Yes Regex pattern <code>format</code> Yes Yes Yes Semantic format <code>additionalProperties</code> Yes Yes Yes Extra properties control <code>minimum</code>/<code>maximum</code> Yes Yes Yes Numeric bounds <code>minLength</code>/<code>maxLength</code> Yes Yes Yes String length bounds <code>enum</code> Yes Yes Yes Value enumeration <code>const</code> Yes Yes Yes Single value <code>default</code> Yes Yes Yes Default value <p>*OpenAI supports <code>pattern</code> in strict mode only.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#conversion-semantics","title":"Conversion Semantics","text":""},{"location":"library-docs-from-repos/tooladapter/design-notes/#feature-loss-warnings","title":"Feature Loss Warnings","text":"<p>When the target adapter doesn't support a feature used in the source schema, the library generates a <code>FeatureLossWarning</code>:</p> <pre><code>type FeatureLossWarning struct {\n    Feature     SchemaFeature  // e.g., FeatureRef\n    FromAdapter string         // e.g., \"mcp\"\n    ToAdapter   string         // e.g., \"openai\"\n}\n</code></pre> <p>Important: Feature loss is a warning, not an error. The conversion proceeds, but the target schema will be missing those features.</p> <p>Example: Converting MCP tool with <code>$ref</code> to OpenAI:</p> <pre><code>mcpTool := mcp.Tool{\n    Name: \"example\",\n    InputSchema: map[string]any{\n        \"$ref\": \"#/$defs/Person\",\n        \"$defs\": map[string]any{\n            \"Person\": map[string]any{\n                \"type\": \"object\",\n                \"properties\": map[string]any{\n                    \"name\": map[string]any{\"type\": \"string\"},\n                },\n            },\n        },\n    },\n}\n\nresult, _ := registry.Convert(mcpTool, \"mcp\", \"openai\")\n\nfor _, w := range result.Warnings {\n    // \"feature $ref lost converting from mcp to openai\"\n    // \"feature $defs lost converting from mcp to openai\"\n    fmt.Println(w)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#recursive-feature-detection","title":"Recursive Feature Detection","text":"<p>Feature loss detection is recursive. If a schema has nested properties, items, or definitions that use unsupported features, warnings are generated for each occurrence.</p>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#round-trip-preservation","title":"Round-Trip Preservation","text":"<p>Format-specific metadata is stored in <code>SourceMeta</code> to improve round-trip conversions:</p> Format Preserved in SourceMeta MCP <code>title</code> field OpenAI <code>strict</code> mode flag Anthropic (none currently) <p>Example: MCP Title preservation:</p> <pre><code>// MCP -&gt; Canonical: Title stored in SourceMeta\ncanonical, _ := mcpAdapter.ToCanonical(mcpTool)\n// canonical.SourceMeta[\"title\"] == \"My Tool Title\"\n\n// Canonical -&gt; MCP: Title restored from SourceMeta\nrestored, _ := mcpAdapter.FromCanonical(canonical)\n// restored.(mcp.Tool).Title == \"My Tool Title\"\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#determinism-guarantees","title":"Determinism Guarantees","text":"<p>All conversions are deterministic:</p> <ol> <li>Order-insensitive: Map iteration order doesn't affect output</li> <li>No random elements: No UUIDs, timestamps, or random values injected</li> <li>Stable output: Same input always produces identical output</li> </ol> <p>This enables:</p> <ul> <li>Reliable testing with exact output comparison</li> <li>Caching of conversion results</li> <li>Version control of generated tool definitions</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#adapter-specific-behavior","title":"Adapter-Specific Behavior","text":""},{"location":"library-docs-from-repos/tooladapter/design-notes/#mcp-adapter","title":"MCP Adapter","text":"<ul> <li>Full support: All JSONSchema features are preserved</li> <li>SDK types: Uses <code>github.com/modelcontextprotocol/go-sdk/mcp.Tool</code></li> <li>Schema format: <code>InputSchema</code> is <code>map[string]any</code> (standard JSON marshaling)</li> <li>Title handling: Stored in SourceMeta for round-trip</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#openai-adapter","title":"OpenAI Adapter","text":"<ul> <li>Self-contained types: <code>OpenAIFunction</code> struct defined in this module</li> <li>Strict mode: When <code>strict: true</code>:</li> <li>Sets <code>additionalProperties: false</code> on output schema</li> <li>Pattern validation is enabled</li> <li>Limited features: No <code>$ref</code>, <code>$defs</code>, or combinators</li> <li>Field mapping: <code>Parameters</code> (not <code>InputSchema</code>)</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#anthropic-adapter","title":"Anthropic Adapter","text":"<ul> <li>Self-contained types: <code>AnthropicTool</code> struct defined in this module</li> <li>Field mapping: Uses <code>input_schema</code> (not <code>InputSchema</code> or <code>Parameters</code>)</li> <li>Combinator support: Supports <code>anyOf</code>, <code>oneOf</code>, <code>allOf</code>, <code>not</code></li> <li>No references: Does not support <code>$ref</code> or <code>$defs</code></li> </ul>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#error-handling","title":"Error Handling","text":""},{"location":"library-docs-from-repos/tooladapter/design-notes/#conversionerror","title":"ConversionError","text":"<p>All conversion errors are wrapped in <code>ConversionError</code>:</p> <pre><code>type ConversionError struct {\n    Adapter   string  // \"mcp\", \"openai\", \"anthropic\"\n    Direction string  // \"to_canonical\" or \"from_canonical\"\n    Cause     error   // Underlying error\n}\n\nfunc (e *ConversionError) Error() string\nfunc (e *ConversionError) Unwrap() error  // For errors.Is/As\n</code></pre> <p>This enables:</p> <pre><code>result, err := registry.Convert(tool, \"mcp\", \"openai\")\nif err != nil {\n    var convErr *tooladapter.ConversionError\n    if errors.As(err, &amp;convErr) {\n        log.Printf(\"Conversion failed in %s adapter (%s): %v\",\n            convErr.Adapter, convErr.Direction, convErr.Cause)\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#type-validation","title":"Type Validation","text":"<p>Adapters reject incorrect input types with descriptive errors:</p> <pre><code>_, err := mcpAdapter.ToCanonical(\"not a tool\")\n// Error: \"expected mcp.Tool or *mcp.Tool\"\n\n_, err := openaiAdapter.ToCanonical(mcpTool)\n// Error: \"expected OpenAIFunction or *OpenAIFunction\"\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/design-notes/#limitations","title":"Limitations","text":"<ol> <li> <p>No schema validation: This library converts schemas but does not validate data against schemas. Use a JSON Schema validator for that.</p> </li> <li> <p>No I/O: Pure data transforms only. No network calls, file operations, or tool execution.</p> </li> <li> <p>No $ref resolution: References are preserved as-is. The consuming system must resolve them.</p> </li> <li> <p>No schema inference: Schemas must be explicitly provided. The library does not infer schemas from sample data.</p> </li> <li> <p>No streaming: Conversion is synchronous. For large batches, callers should implement their own parallelization.</p> </li> <li> <p>Conservative conversion: The library does not fabricate schema fields. If a feature isn't in the source, it won't appear in the output.</p> </li> </ol>"},{"location":"library-docs-from-repos/tooladapter/user-journey/","title":"User Journey: Tool Format Conversion","text":"<p>This document walks through complete conversion examples between MCP, OpenAI, and Anthropic tool formats.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#journey-1-mcp-to-openai-conversion","title":"Journey 1: MCP to OpenAI Conversion","text":""},{"location":"library-docs-from-repos/tooladapter/user-journey/#scenario","title":"Scenario","text":"<p>You have an MCP server with a <code>get_weather</code> tool and want to expose it to an OpenAI-compatible client (e.g., for use with GPT-4).</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-1-define-the-mcp-tool","title":"Step 1: Define the MCP Tool","text":"<pre><code>import \"github.com/modelcontextprotocol/go-sdk/mcp\"\n\nmcpTool := mcp.Tool{\n    Name:        \"get_weather\",\n    Title:       \"Get Weather\",\n    Description: \"Get current weather for a location\",\n    InputSchema: map[string]any{\n        \"type\": \"object\",\n        \"properties\": map[string]any{\n            \"location\": map[string]any{\n                \"type\":        \"string\",\n                \"description\": \"City name or coordinates\",\n            },\n            \"units\": map[string]any{\n                \"type\":    \"string\",\n                \"enum\":    []any{\"celsius\", \"fahrenheit\"},\n                \"default\": \"celsius\",\n            },\n        },\n        \"required\": []any{\"location\"},\n    },\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-2-set-up-the-registry","title":"Step 2: Set Up the Registry","text":"<pre><code>import (\n    \"github.com/jonwraymond/tooladapter\"\n    \"github.com/jonwraymond/tooladapter/adapters\"\n)\n\nregistry := tooladapter.NewRegistry()\nregistry.Register(adapters.NewMCPAdapter())\nregistry.Register(adapters.NewOpenAIAdapter())\nregistry.Register(adapters.NewAnthropicAdapter())\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-3-convert-to-openai-format","title":"Step 3: Convert to OpenAI Format","text":"<pre><code>result, err := registry.Convert(mcpTool, \"mcp\", \"openai\")\nif err != nil {\n    log.Fatal(err)\n}\n\nopenaiFunc := result.Tool.(adapters.OpenAIFunction)\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#conversion-flow-diagram","title":"Conversion Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'actorBkg': '#2b6cb0', 'actorTextColor': '#fff', 'actorBorder': '#2c5282'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Client as \ud83d\udda5\ufe0f Client\n    participant Registry as \ud83d\udccb AdapterRegistry\n    participant MCP as \ud83d\udce1 MCPAdapter\n    participant Canon as \ud83c\udfaf CanonicalTool\n    participant OpenAI as \ud83e\udd16 OpenAIAdapter\n    participant Result as \ud83d\udce6 OpenAIFunction\n\n    rect rgb(43, 108, 176, 0.1)\n        Note over Client,Canon: Phase 1: Convert to Canonical\n        Client-&gt;&gt;+Registry: Convert(mcpTool, \"mcp\", \"openai\")\n        Registry-&gt;&gt;+MCP: ToCanonical(mcp.Tool)\n        MCP-&gt;&gt;MCP: mapToJSONSchema(InputSchema)\n        MCP-&gt;&gt;Canon: Create CanonicalTool\n        Note over Canon: Name: \"get_weather\"&lt;br/&gt;Description: \"Get current weather...\"&lt;br/&gt;SourceMeta[\"title\"] = \"Get Weather\"\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Note over Registry,OpenAI: Phase 2: Check Feature Loss\n        Registry-&gt;&gt;OpenAI: SupportsFeature(each feature)\n        Note over Registry: Collect warnings for&lt;br/&gt;unsupported features\n    end\n\n    rect rgb(56, 161, 105, 0.1)\n        Note over OpenAI,Result: Phase 3: Convert to Target\n        Registry-&gt;&gt;+OpenAI: FromCanonical(canonical)\n        OpenAI-&gt;&gt;OpenAI: InputSchema.ToMap()\n        OpenAI-&gt;&gt;Result: Create OpenAIFunction\n        Result--&gt;&gt;-OpenAI: OpenAIFunction\n        OpenAI--&gt;&gt;-Registry: tool\n        Registry--&gt;&gt;-Client: ConversionResult{Tool, Warnings}\n    end</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#format-conversion-architecture","title":"Format Conversion Architecture","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#d69e2e'}}}%%\nflowchart LR\n    subgraph sources[\"Source Formats\"]\n        MCP_IN[\"\ud83d\udce1 MCP Tool\"]\n        OPENAI_IN[\"\ud83e\udd16 OpenAI Function\"]\n        ANTHROPIC_IN[\"\ud83d\udd37 Anthropic Tool\"]\n    end\n\n    subgraph canonical[\"Canonical Form\"]\n        Canon[\"\ud83c\udfaf CanonicalTool&lt;br/&gt;&lt;small&gt;\u2022 Name, Description&lt;br/&gt;\u2022 InputSchema (JSONSchema)&lt;br/&gt;\u2022 SourceFormat, SourceMeta&lt;/small&gt;\"]\n    end\n\n    subgraph targets[\"Target Formats\"]\n        MCP_OUT[\"\ud83d\udce1 MCP Tool\"]\n        OPENAI_OUT[\"\ud83e\udd16 OpenAI Function\"]\n        ANTHROPIC_OUT[\"\ud83d\udd37 Anthropic Tool\"]\n    end\n\n    MCP_IN --&gt; Canon\n    OPENAI_IN --&gt; Canon\n    ANTHROPIC_IN --&gt; Canon\n\n    Canon --&gt; MCP_OUT\n    Canon --&gt; OPENAI_OUT\n    Canon --&gt; ANTHROPIC_OUT\n\n    style canonical fill:#d69e2e,stroke:#b7791f,stroke-width:3px\n    style sources fill:#3182ce,stroke:#2c5282\n    style targets fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-4-check-for-feature-loss-warnings","title":"Step 4: Check for Feature Loss Warnings","text":"<pre><code>for _, w := range result.Warnings {\n    log.Printf(\"Warning: %s\", w)\n}\n</code></pre> <p>If the MCP tool used <code>$ref</code>, <code>$defs</code>, or combinators, you would see warnings like:</p> <pre><code>Warning: feature $ref lost converting from mcp to openai\nWarning: feature anyOf lost converting from mcp to openai\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-5-use-the-openai-function","title":"Step 5: Use the OpenAI Function","text":"<pre><code>import \"encoding/json\"\n\nfmt.Printf(\"Function name: %s\\n\", openaiFunc.Name)\nfmt.Printf(\"Description: %s\\n\", openaiFunc.Description)\n\n// Serialize to JSON for OpenAI API\ndata, _ := json.MarshalIndent(openaiFunc, \"\", \"  \")\nfmt.Println(string(data))\n</code></pre> <p>Output:</p> <pre><code>{\n  \"name\": \"get_weather\",\n  \"description\": \"Get current weather for a location\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"location\": {\n        \"type\": \"string\",\n        \"description\": \"City name or coordinates\"\n      },\n      \"units\": {\n        \"type\": \"string\",\n        \"enum\": [\"celsius\", \"fahrenheit\"],\n        \"default\": \"celsius\"\n      }\n    },\n    \"required\": [\"location\"]\n  }\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#journey-2-openai-to-anthropic-conversion","title":"Journey 2: OpenAI to Anthropic Conversion","text":""},{"location":"library-docs-from-repos/tooladapter/user-journey/#scenario_1","title":"Scenario","text":"<p>You have OpenAI function definitions and want to use them with Claude.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-1-define-the-openai-function","title":"Step 1: Define the OpenAI Function","text":"<pre><code>openaiFunc := adapters.OpenAIFunction{\n    Name:        \"search_documents\",\n    Description: \"Search documents by query\",\n    Parameters: map[string]any{\n        \"type\": \"object\",\n        \"properties\": map[string]any{\n            \"query\": map[string]any{\n                \"type\":        \"string\",\n                \"description\": \"Search query\",\n            },\n            \"limit\": map[string]any{\n                \"type\":    \"integer\",\n                \"minimum\": 1,\n                \"maximum\": 100,\n                \"default\": 10,\n            },\n        },\n        \"required\": []any{\"query\"},\n    },\n    Strict: true,\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-2-convert-to-anthropic-format","title":"Step 2: Convert to Anthropic Format","text":"<pre><code>result, err := registry.Convert(openaiFunc, \"openai\", \"anthropic\")\nif err != nil {\n    log.Fatal(err)\n}\n\nanthropicTool := result.Tool.(adapters.AnthropicTool)\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-3-serialize-for-claude-api","title":"Step 3: Serialize for Claude API","text":"<pre><code>data, _ := json.MarshalIndent(anthropicTool, \"\", \"  \")\nfmt.Println(string(data))\n</code></pre> <p>Output:</p> <pre><code>{\n  \"name\": \"search_documents\",\n  \"description\": \"Search documents by query\",\n  \"input_schema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"query\": {\n        \"type\": \"string\",\n        \"description\": \"Search query\"\n      },\n      \"limit\": {\n        \"type\": \"integer\",\n        \"minimum\": 1,\n        \"maximum\": 100,\n        \"default\": 10\n      }\n    },\n    \"required\": [\"query\"]\n  }\n}\n</code></pre> <p>Note that Anthropic uses <code>input_schema</code> while OpenAI uses <code>parameters</code>.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#journey-3-handling-feature-loss","title":"Journey 3: Handling Feature Loss","text":""},{"location":"library-docs-from-repos/tooladapter/user-journey/#scenario_2","title":"Scenario","text":"<p>Converting an MCP tool that uses advanced JSON Schema features to OpenAI format.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-1-define-mcp-tool-with-ref","title":"Step 1: Define MCP Tool with $ref","text":"<pre><code>mcpTool := mcp.Tool{\n    Name:        \"create_user\",\n    Description: \"Create a new user\",\n    InputSchema: map[string]any{\n        \"type\": \"object\",\n        \"properties\": map[string]any{\n            \"user\": map[string]any{\n                \"$ref\": \"#/$defs/User\",\n            },\n        },\n        \"$defs\": map[string]any{\n            \"User\": map[string]any{\n                \"type\": \"object\",\n                \"properties\": map[string]any{\n                    \"name\":  map[string]any{\"type\": \"string\"},\n                    \"email\": map[string]any{\"type\": \"string\", \"format\": \"email\"},\n                },\n                \"required\": []any{\"name\", \"email\"},\n            },\n        },\n        \"required\": []any{\"user\"},\n    },\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-2-convert-and-inspect-warnings","title":"Step 2: Convert and Inspect Warnings","text":"<pre><code>result, err := registry.Convert(mcpTool, \"mcp\", \"openai\")\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"Conversion completed with %d warnings:\\n\", len(result.Warnings))\nfor _, w := range result.Warnings {\n    fmt.Printf(\"  - %s\\n\", w)\n}\n</code></pre> <p>Output:</p> <pre><code>Conversion completed with 2 warnings:\n  - feature $ref lost converting from mcp to openai\n  - feature $defs lost converting from mcp to openai\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#what-happens-to-the-schema","title":"What Happens to the Schema","text":"<p>The <code>$ref</code> and <code>$defs</code> are present in the canonical representation but will be omitted from the OpenAI output since OpenAI doesn't support them. The resulting OpenAI function will have an incomplete schema.</p> <p>Recommendation: When using advanced JSON Schema features, either:</p> <ol> <li>Expand <code>$ref</code> references before conversion</li> <li>Use a target format that supports the features (MCP or Anthropic for combinators)</li> <li>Accept the feature loss and document it</li> </ol>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#journey-4-openai-strict-mode","title":"Journey 4: OpenAI Strict Mode","text":""},{"location":"library-docs-from-repos/tooladapter/user-journey/#scenario_3","title":"Scenario","text":"<p>Enable OpenAI's strict mode for more reliable function calling.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-1-set-strict-mode-via-sourcemeta","title":"Step 1: Set Strict Mode via SourceMeta","text":"<pre><code>// Convert MCP to Canonical first\nmcpAdapter := adapters.NewMCPAdapter()\ncanonical, _ := mcpAdapter.ToCanonical(mcpTool)\n\n// Enable strict mode\ncanonical.SourceMeta[\"strict\"] = true\n\n// Convert to OpenAI\nopenaiAdapter := adapters.NewOpenAIAdapter()\nresult, _ := openaiAdapter.FromCanonical(canonical)\n\nopenaiFunc := result.(adapters.OpenAIFunction)\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#step-2-verify-strict-mode-applied","title":"Step 2: Verify Strict Mode Applied","text":"<pre><code>fmt.Printf(\"Strict mode: %v\\n\", openaiFunc.Strict)\n\n// Check additionalProperties is set to false\ndata, _ := json.MarshalIndent(openaiFunc, \"\", \"  \")\nfmt.Println(string(data))\n</code></pre> <p>Output:</p> <pre><code>{\n  \"name\": \"get_weather\",\n  \"description\": \"Get current weather for a location\",\n  \"parameters\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"location\": { \"type\": \"string\" }\n    },\n    \"required\": [\"location\"],\n    \"additionalProperties\": false\n  },\n  \"strict\": true\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#journey-5-bulk-conversion","title":"Journey 5: Bulk Conversion","text":""},{"location":"library-docs-from-repos/tooladapter/user-journey/#scenario_4","title":"Scenario","text":"<p>Convert multiple tools from one format to another.</p>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#implementation","title":"Implementation","text":"<pre><code>func ConvertTools(\n    registry *tooladapter.AdapterRegistry,\n    tools []mcp.Tool,\n    targetFormat string,\n) ([]any, []tooladapter.FeatureLossWarning) {\n    var converted []any\n    var allWarnings []tooladapter.FeatureLossWarning\n\n    for _, tool := range tools {\n        result, err := registry.Convert(tool, \"mcp\", targetFormat)\n        if err != nil {\n            log.Printf(\"Failed to convert %s: %v\", tool.Name, err)\n            continue\n        }\n        converted = append(converted, result.Tool)\n        allWarnings = append(allWarnings, result.Warnings...)\n    }\n\n    return converted, allWarnings\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#usage","title":"Usage","text":"<pre><code>mcpTools := []mcp.Tool{tool1, tool2, tool3}\nopenaiTools, warnings := ConvertTools(registry, mcpTools, \"openai\")\n\nfmt.Printf(\"Converted %d tools with %d total warnings\\n\",\n    len(openaiTools), len(warnings))\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/user-journey/#summary","title":"Summary","text":"Journey From To Key Points 1 MCP OpenAI Basic conversion, Title in SourceMeta 2 OpenAI Anthropic Field name differences (parameters vs input_schema) 3 MCP OpenAI Feature loss warnings for $ref/$defs 4 MCP OpenAI Strict mode via SourceMeta 5 MCP Any Bulk conversion pattern <p>For more details on schema decisions and limitations, see Design Notes.</p>"},{"location":"library-docs-from-repos/tooladapter/plans/","title":"tooladapter Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 tooladapter (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-execution-plan/#adapter","title":"Adapter","text":"<pre><code>func TestAdapter_Contract(t *testing.T) {\n    // Methods:\n    // - Name() string\n    // - ToCanonical(raw any) (*CanonicalTool, error)\n    // - FromCanonical(tool *CanonicalTool) (any, error)\n    // - SupportsFeature(feature SchemaFeature) bool\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 tooladapter","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Adapter</code> <code>tooladapter/adapter.go:97</code> Name() stringToCanonical(raw any) (CanonicalTool, error)FromCanonical(tool CanonicalTool) (any, error)SupportsFeature(feature SchemaFeature) bool"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/tooladapter/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolset/","title":"toolset","text":"<p>Composable tool collection library for building curated tool surfaces.</p>"},{"location":"library-docs-from-repos/toolset/#overview","title":"Overview","text":"<p>toolset provides a thread-safe <code>Toolset</code> type and a fluent <code>Builder</code> for composing curated tool collections from multiple sources. It is pure data composition: no execution, no I/O, no network. It integrates with <code>tooladapter</code> for multi-format export (MCP/OpenAI/Anthropic), and can optionally ingest tools from <code>toolindex</code> via adapters.</p>"},{"location":"library-docs-from-repos/toolset/#design-goals","title":"Design Goals","text":"<ol> <li>Deterministic output: tool listing and exposure are stable across runs.</li> <li>Non-destructive filtering: filters never mutate the original toolset.</li> <li>Composability: small, reusable filters and policies.</li> <li>Protocol-agnostic exposure: export via <code>tooladapter</code> adapters.</li> <li>Minimal dependencies: no runtime execution or transport coupling.</li> </ol>"},{"location":"library-docs-from-repos/toolset/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolmodel --&gt; tooladapter --&gt; toolset --&gt; metatools-mcp\n</code></pre> <ul> <li><code>tooladapter</code> normalizes tools into canonical form.</li> <li><code>toolset</code> builds curated collections and exports to different formats.</li> <li><code>metatools-mcp</code> may later consume toolset to expose filtered subsets.</li> </ul>"},{"location":"library-docs-from-repos/toolset/#core-types","title":"Core Types","text":"Type Purpose <code>Toolset</code> Thread-safe collection of canonical tools <code>Builder</code> Fluent builder for filters/policies <code>FilterFunc</code> Reusable filter predicate <code>Policy</code> Hard allow/deny decisions <code>Exposure</code> Export to MCP/OpenAI/Anthropic via adapters"},{"location":"library-docs-from-repos/toolset/#quick-start","title":"Quick Start","text":"<pre><code>package main\n\nimport (\n    \"github.com/jonwraymond/toolset\"\n    \"github.com/jonwraymond/tooladapter\"\n)\n\nfunc main() {\n    ts := toolset.New(\"safe-core\")\n\n    ts.Add(&amp;tooladapter.CanonicalTool{\n        Namespace: \"mcp\",\n        Name:      \"search\",\n        Tags:      []string{\"read\", \"safe\"},\n        InputSchema: &amp;tooladapter.JSONSchema{Type: \"object\"},\n    })\n\n    ts.Add(&amp;tooladapter.CanonicalTool{\n        Namespace: \"mcp\",\n        Name:      \"exec\",\n        Tags:      []string{\"write\", \"danger\"},\n        InputSchema: &amp;tooladapter.JSONSchema{Type: \"object\"},\n    })\n\n    safe := ts.Filter(func(t *tooladapter.CanonicalTool) bool {\n        return toolset.TagsAll([]string{\"safe\"})(t)\n    })\n\n    _ = safe\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/#builder-example","title":"Builder Example","text":"<pre><code>builder := toolset.NewBuilder(\"mcp-safe\")\n\nsafeSet, err := builder.\n    FromTools(allTools).\n    WithNamespace(\"mcp\").\n    WithTags([]string{\"safe\"}).\n    ExcludeTools([]string{\"mcp:exec\"}).\n    Build()\n</code></pre>"},{"location":"library-docs-from-repos/toolset/#exposure-example-via-tooladapter","title":"Exposure Example (via tooladapter)","text":"<pre><code>exposure := toolset.NewExposure(safeSet, adapters.NewMCPAdapter())\nexports, warnings, errs := exposure.ExportWithWarnings()\nif len(errs) &gt; 0 {\n    // handle conversion errors (tool IDs are included in the error message)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/#versioning","title":"Versioning","text":"<p>toolset follows semantic versioning aligned with the stack. The source of truth is <code>ai-tools-stack/go.mod</code>, and <code>VERSIONS.md</code> is synchronized across repos.</p> <p>See <code>VERSIONS.md</code> for current versions.</p>"},{"location":"library-docs-from-repos/toolset/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes</li> <li>User Journey</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/","title":"Design Notes","text":"<p>This document captures design decisions, filter semantics, and integration constraints for the toolset library.</p>"},{"location":"library-docs-from-repos/toolset/design-notes/#toolset-core","title":"Toolset Core","text":""},{"location":"library-docs-from-repos/toolset/design-notes/#thread-safety","title":"Thread safety","text":"<p><code>Toolset</code> must be safe for concurrent reads/writes: - Internally uses <code>sync.RWMutex</code>. - <code>Add</code>, <code>Remove</code> take write locks. - <code>Get</code>, <code>Tools</code>, <code>IDs</code>, <code>Count</code> use read locks.</p>"},{"location":"library-docs-from-repos/toolset/design-notes/#deterministic-ordering","title":"Deterministic ordering","text":"<p><code>Tools()</code> and <code>IDs()</code> must return tools in stable order: - Sort lexicographically by canonical tool ID (<code>namespace:name</code>). - Determinism matters for:   - pagination in downstream layers   - stable exposure output   - reproducible tests</p>"},{"location":"library-docs-from-repos/toolset/design-notes/#filtering-semantics","title":"Filtering Semantics","text":"<p>Filters are predicates applied to canonical tools. In the Builder, filters are AND-composed in the order added. The recommended filter helpers:</p> <ul> <li>Namespace filter: include only tools with namespace in allowed set.</li> <li>TagsAny: tool matches if it contains any tag in the set.</li> <li>TagsAll: tool matches only if it contains all tags in the set.</li> <li>Category filter: exact match on <code>Category</code> field.</li> <li>Allow IDs / Deny IDs: explicit allow/deny lists for tool IDs.</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#policy-order","title":"Policy order","text":"<p>Policies apply after all filters. This guarantees that a policy decision can hard-deny any tool even if it passed filters.</p>"},{"location":"library-docs-from-repos/toolset/design-notes/#policy-interface","title":"Policy Interface","text":"<p>A policy is a simple allow/deny decision:</p> <pre><code>type Policy interface {\n    Allow(tool *tooladapter.CanonicalTool) bool\n}\n</code></pre> <p>Use cases: - Restrict tools by namespace or tag - Enforce security categories - Restrict by <code>RequiredScopes</code></p>"},{"location":"library-docs-from-repos/toolset/design-notes/#contract","title":"Contract","text":"<ul> <li>Concurrency: policies must be safe for concurrent use after construction.</li> <li>Nil handling: <code>Allow(nil)</code> must return <code>false</code>.</li> <li>Determinism: results must be stable for identical inputs.</li> <li>Ownership: implementations must not mutate tool data.</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#registry-interface","title":"Registry Interface","text":"<p>Registries provide the tool source for builders:</p> <pre><code>type Registry interface {\n    Tools() []*tooladapter.CanonicalTool\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/design-notes/#contract_1","title":"Contract","text":"<ul> <li>Concurrency: <code>Tools()</code> may be called concurrently.</li> <li>Ownership: returned slice is caller-owned; tools are read-only snapshots.</li> <li>Determinism: ordering should be stable for identical registry state.</li> <li>Nil handling: returning <code>nil</code> is treated as empty.</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#exposure-semantics","title":"Exposure Semantics","text":"<p>Exposure uses <code>tooladapter.Adapter</code> to export toolsets:</p> <ul> <li>Conversion is read-only; no mutation to canonical tools.</li> <li>Feature loss warnings are aggregated from the adapter.</li> <li>Conversion errors are surfaced via <code>ExportWithWarnings()</code> as a <code>[]error</code>.</li> <li>Exposure returns <code>[]any</code> for protocol-specific tool shapes.</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#integration-with-toolindex","title":"Integration with toolindex","text":"<p><code>toolset</code> can optionally ingest tools from <code>toolindex</code> by: - Listing tools from index - Converting <code>toolmodel.Tool</code> to <code>tooladapter.CanonicalTool</code> via MCP adapter</p> <p>This keeps toolset independent of execution (<code>toolrun</code>) or docs (<code>tooldocs</code>).</p>"},{"location":"library-docs-from-repos/toolset/design-notes/#non-goals","title":"Non-goals","text":"<ul> <li>Runtime execution or transport wiring</li> <li>Persistence or caching</li> <li>Multi-tenant enforcement</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#error-strategy","title":"Error Strategy","text":"<ul> <li>Builder returns errors for missing sources or invalid inputs.</li> <li>Filters and policies are pure functions and should not panic.</li> <li><code>ExportWithWarnings()</code> returns conversion errors (tool ID included in the error).</li> </ul>"},{"location":"library-docs-from-repos/toolset/design-notes/#performance","title":"Performance","text":"<ul> <li>Filters are O(n) over tool count.</li> <li>Repeated <code>Tools()</code> calls should avoid re-sorting if possible (optional cache).</li> </ul>"},{"location":"library-docs-from-repos/toolset/user-journey/","title":"User Journey: Curated Toolset Exposure","text":"<p>This walkthrough shows how to build a safe MCP-only toolset and export it for use by an MCP server or other consumer.</p>"},{"location":"library-docs-from-repos/toolset/user-journey/#scenario","title":"Scenario","text":"<p>You have a large tool registry but want to expose only safe, read-only tools from the <code>mcp</code> namespace. You also want a single export step that can later be adapted to OpenAI or Anthropic formats.</p>"},{"location":"library-docs-from-repos/toolset/user-journey/#step-1-define-canonical-tools","title":"Step 1: Define canonical tools","text":"<pre><code>import \"github.com/jonwraymond/tooladapter\"\n\nall := []*tooladapter.CanonicalTool{\n    {\n        Namespace:   \"mcp\",\n        Name:        \"search\",\n        Tags:        []string{\"read\", \"safe\"},\n        Description: \"Search resources\",\n        InputSchema: &amp;tooladapter.JSONSchema{Type: \"object\"},\n    },\n    {\n        Namespace:   \"mcp\",\n        Name:        \"execute\",\n        Tags:        []string{\"write\", \"danger\"},\n        Description: \"Execute a command\",\n        InputSchema: &amp;tooladapter.JSONSchema{Type: \"object\"},\n    },\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/user-journey/#step-2-build-a-filtered-toolset","title":"Step 2: Build a filtered toolset","text":"<pre><code>import \"github.com/jonwraymond/toolset\"\n\nsafe, err := toolset.NewBuilder(\"mcp-safe\").\n    FromTools(all).\n    WithNamespace(\"mcp\").\n    WithTags([]string{\"safe\"}).\n    ExcludeTools([]string{\"mcp:execute\"}).\n    Build()\n</code></pre> <p>At this point, <code>safe</code> contains only the <code>mcp:search</code> tool.</p>"},{"location":"library-docs-from-repos/toolset/user-journey/#step-3-export-for-mcp-usage","title":"Step 3: Export for MCP usage","text":"<pre><code>import \"github.com/jonwraymond/tooladapter/adapters\"\n\nexposure := toolset.NewExposure(safe, adapters.NewMCPAdapter())\nexports, warnings, errs := exposure.ExportWithWarnings()\nif len(errs) &gt; 0 {\n    // handle conversion errors (tool IDs included)\n}\n</code></pre> <p>If the tools used unsupported schema features, you would see warnings here. If a tool fails conversion, it will be omitted from <code>exports</code> and reported in <code>errs</code>.</p>"},{"location":"library-docs-from-repos/toolset/user-journey/#flow-diagram","title":"Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#3182ce'}}}%%\nflowchart LR\n    subgraph input[\"Input\"]\n        A[\"\ud83d\udce6 Canonical Tools\"]\n    end\n\n    subgraph building[\"Building\"]\n        B[\"\ud83d\udd28 Builder\"]\n        C{\"\ud83d\udd0d Filters&lt;br/&gt;&lt;small&gt;Namespace, Tags,&lt;br/&gt;IDs, Categories&lt;/small&gt;\"}\n        D[\"\ud83d\udd12 Policy&lt;br/&gt;&lt;small&gt;Allow/Deny/Warn&lt;/small&gt;\"]\n    end\n\n    subgraph result[\"Result\"]\n        E[\"\ud83d\udce6 Toolset&lt;br/&gt;&lt;small&gt;Thread-safe&lt;/small&gt;\"]\n    end\n\n    subgraph export[\"Export\"]\n        F[\"\ud83d\udd04 Exposure\"]\n        G1[\"\ud83d\udce1 MCP\"]\n        G2[\"\ud83e\udd16 OpenAI\"]\n        G3[\"\ud83d\udd37 Anthropic\"]\n    end\n\n    A --&gt; B --&gt; C --&gt; D --&gt; E\n    E --&gt; F\n    F --&gt; G1\n    F --&gt; G2\n    F --&gt; G3\n\n    style input fill:#718096,stroke:#4a5568\n    style building fill:#3182ce,stroke:#2c5282\n    style result fill:#38a169,stroke:#276749\n    style export fill:#d69e2e,stroke:#b7791f</code></pre>"},{"location":"library-docs-from-repos/toolset/user-journey/#composition-pipeline","title":"Composition Pipeline","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart TD\n    subgraph sources[\"Tool Sources\"]\n        All[\"\ud83d\udce6 All Canonical Tools&lt;br/&gt;&lt;small&gt;from tooladapter&lt;/small&gt;\"]\n    end\n\n    subgraph builder[\"toolset.Builder Chain\"]\n        B1[\"FromTools(all)\"]\n        B2[\"WithNamespace('mcp')\"]\n        B3[\"WithTags(['safe'])\"]\n        B4[\"ExcludeTools(['mcp:execute'])\"]\n        B5[\"WithPolicy(readOnlyPolicy)\"]\n        Build[\"Build()\"]\n    end\n\n    subgraph output[\"Output\"]\n        Safe[\"\ud83d\udce6 Safe Toolset&lt;br/&gt;&lt;small&gt;Only mcp:search&lt;/small&gt;\"]\n    end\n\n    All --&gt; B1 --&gt; B2 --&gt; B3 --&gt; B4 --&gt; B5 --&gt; Build --&gt; Safe\n\n    style sources fill:#718096,stroke:#4a5568\n    style builder fill:#6b46c1,stroke:#553c9a\n    style output fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolset/user-journey/#notes","title":"Notes","text":"<ul> <li>Filters are AND-composed.</li> <li>Policies run last and can hard-deny tools.</li> <li>Exposure never mutates the underlying Toolset.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/","title":"toolset Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 toolset (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#policy","title":"Policy","text":"<pre><code>func TestPolicy_Contract(t *testing.T) {\n    // Methods:\n    // - Allow(tool *tooladapter.CanonicalTool) bool\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-execution-plan/#registry","title":"Registry","text":"<pre><code>func TestRegistry_Contract(t *testing.T) {\n    // Methods:\n    // - Tools() []*tooladapter.CanonicalTool\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 toolset","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Policy</code> <code>toolset/policy.go:6</code> Allow(tool *tooladapter.CanonicalTool) bool <code>Registry</code> <code>toolset/builder.go:10</code> Tools() []*tooladapter.CanonicalTool"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolset/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/","title":"toolindex","text":"<p><code>toolindex</code> is the global registry and progressive discovery layer for tools. It stores <code>toolmodel.Tool</code> + <code>toolmodel.ToolBackend</code>, provides search, and returns token-cheap summaries.</p> <p></p>"},{"location":"library-docs-from-repos/toolindex/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#motivation","title":"Motivation","text":"<ul> <li>Progressive disclosure: search returns summaries, not schemas</li> <li>Deterministic lookup: canonical tool IDs resolve to stable backends</li> <li>Pluggable search: swap lexical search for BM25 or semantic ranking</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#key-apis","title":"Key APIs","text":"<ul> <li><code>Index</code> interface</li> <li><code>InMemoryIndex</code> implementation</li> <li><code>Search</code> + <code>ListNamespaces</code></li> <li><code>RegisterTool(s)</code> + <code>GetTool</code></li> <li><code>Searcher</code> interface for pluggable ranking</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#quickstart","title":"Quickstart","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n_ = idx.RegisterTool(tool, backend)\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/#usability-notes","title":"Usability notes","text":"<ul> <li>Summaries are token-cheap and safe to display in discovery</li> <li>Namespaces group tools for easy filtering</li> <li>Backends can be replaced without changing the tool ID</li> </ul>"},{"location":"library-docs-from-repos/toolindex/#next","title":"Next","text":"<ul> <li>Architecture and data flow: <code>architecture.md</code></li> <li>Usage patterns and options: <code>usage.md</code></li> <li>Searcher examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolindex/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolindex/api/#index-interface","title":"Index interface","text":"<pre><code>type Index interface {\n  RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) error\n  RegisterTools(regs []ToolRegistration) error\n  RegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) error\n\n  UnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) error\n\n  GetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)\n  GetAllBackends(id string) ([]toolmodel.ToolBackend, error)\n\n  Search(query string, limit int) ([]Summary, error)\n  SearchPage(query string, limit int, cursor string) ([]Summary, string, error)\n  ListNamespaces() ([]string, error)\n  ListNamespacesPage(limit int, cursor string) ([]string, string, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#index-contract","title":"Index contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Errors: use <code>errors.Is</code> with <code>ErrInvalidTool</code>, <code>ErrInvalidBackend</code>, <code>ErrNotFound</code>,   <code>ErrInvalidCursor</code>, and <code>ErrNonDeterministicSearcher</code>.</li> <li>Ownership: returned slices are caller-owned; elements are read-only snapshots.</li> <li>Determinism: search and namespace listings must return stable ordering.</li> <li>Nil/zero: <code>SearchPage</code> requires <code>limit &gt; 0</code>; empty inputs are treated as no-ops.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/api/#change-notifications-optional","title":"Change notifications (optional)","text":"<pre><code>type ChangeType string\n\nconst (\n  ChangeRegistered     ChangeType = \"registered\"\n  ChangeUpdated        ChangeType = \"updated\"\n  ChangeBackendRemoved ChangeType = \"backend_removed\"\n  ChangeToolRemoved    ChangeType = \"tool_removed\"\n  ChangeRefreshed      ChangeType = \"refreshed\"\n)\n\ntype ChangeEvent struct {\n  Type    ChangeType\n  ToolID  string\n  Backend toolmodel.ToolBackend\n  Version uint64\n}\n\ntype ChangeListener func(ChangeEvent)\n\ntype ChangeNotifier interface {\n  OnChange(listener ChangeListener) (unsubscribe func())\n}\n\ntype Refresher interface {\n  Refresh() uint64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#changenotifierrefresher-contract","title":"ChangeNotifier/Refresher contract","text":"<ul> <li><code>OnChange</code> returns a non-nil unsubscribe func; it is safe to call multiple times.</li> <li><code>Refresh</code> returns a monotonic version and is safe for concurrent use.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/api/#summary","title":"Summary","text":"<pre><code>type Summary struct {\n  ID               string\n  Name             string\n  Namespace        string\n  ShortDescription string\n  Tags             []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#registration","title":"Registration","text":"<pre><code>type ToolRegistration struct {\n  Tool    toolmodel.Tool\n  Backend toolmodel.ToolBackend\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#searcher","title":"Searcher","text":"<pre><code>type Searcher interface {\n  Search(query string, limit int, docs []SearchDoc) ([]Summary, error)\n}\n\n// Optional deterministic marker for cursor pagination\ntype DeterministicSearcher interface {\n  Searcher\n  Deterministic() bool\n}\n\ntype SearchDoc struct {\n  ID      string\n  DocText string\n  Summary Summary\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#searcher-contract","title":"Searcher contract","text":"<ul> <li>Concurrency: implementations should be safe for concurrent use or documented otherwise.</li> <li>Determinism: stable ordering required for cursor pagination; use deterministic tie-breaks.</li> <li>Nil/zero: <code>limit &lt;= 0</code> should return an empty result set.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/api/#options","title":"Options","text":"<pre><code>type IndexOptions struct {\n  BackendSelector BackendSelector\n  Searcher        Searcher\n  RequireDeterministicSearcher *bool\n}\n\ntype BackendSelector func([]toolmodel.ToolBackend) toolmodel.ToolBackend\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/api/#errors","title":"Errors","text":"<ul> <li><code>ErrNotFound</code></li> <li><code>ErrInvalidTool</code></li> <li><code>ErrInvalidBackend</code></li> <li><code>ErrInvalidCursor</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/architecture/","title":"Architecture","text":"<p><code>toolindex</code> maintains a canonical map of tools and a cached search document set. It is optimized for frequent reads and infrequent writes.</p>"},{"location":"library-docs-from-repos/toolindex/architecture/#registration-search-flow","title":"Registration + search flow","text":""},{"location":"library-docs-from-repos/toolindex/architecture/#search-sequence","title":"Search sequence","text":""},{"location":"library-docs-from-repos/toolindex/architecture/#progressive-disclosure-contract","title":"Progressive disclosure contract","text":"<ul> <li><code>Search</code> returns summaries only</li> <li>Schema and examples are retrieved later via <code>tooldocs</code></li> </ul>"},{"location":"library-docs-from-repos/toolindex/architecture/#default-backend-policy","title":"Default backend policy","text":"<p>The default backend selector prefers:</p> <ol> <li>local</li> <li>provider</li> <li>mcp</li> </ol> <p>Exported as <code>toolindex.DefaultBackendSelector</code>.</p>"},{"location":"library-docs-from-repos/toolindex/changelog/","title":"Changelog","text":""},{"location":"library-docs-from-repos/toolindex/changelog/#unreleased","title":"Unreleased","text":""},{"location":"library-docs-from-repos/toolindex/changelog/#added","title":"Added","text":"<ul> <li>Cursor-based pagination (<code>SearchPage</code>, <code>ListNamespacesPage</code>) with opaque tokens and <code>ErrInvalidCursor</code>.</li> <li>Deterministic tie-breaker for equal-score search results to keep pagination stable.</li> <li>Deterministic searcher enforcement for cursor pagination (<code>ErrNonDeterministicSearcher</code>).</li> </ul>"},{"location":"library-docs-from-repos/toolindex/changelog/#changed","title":"Changed","text":"<ul> <li>Search pagination now validates cursors against index versioning.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/","title":"Design Notes","text":"<p>This page captures the tradeoffs and error semantics behind <code>toolindex</code>.</p>"},{"location":"library-docs-from-repos/toolindex/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>In-memory first. <code>InMemoryIndex</code> favors low latency and zero dependencies. It trades persistence for speed and simplicity (persistence can be added later behind the same <code>Index</code> interface).</li> <li>Progressive disclosure. Search returns summaries only; full schemas stay out of the discovery path to keep token costs low.</li> <li>Deterministic behavior. Search docs are cached and sorted by tool ID to keep results reproducible across runs; cursor pagination validates against index versioning and requires deterministic ordering from the configured searcher.</li> <li>Protocol-agnostic backends. Backends are stored as metadata only; the index does not execute tools or depend on transport details.</li> <li>MCP-field consistency check. If multiple backends register the same tool ID, the MCP tool fields must match. This prevents silent divergence across backends.</li> <li>Pluggable search. <code>Searcher</code> allows swapping lexical search with BM25 or semantic search without changing the index API.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolindex</code> exposes sentinel errors for predictable failure handling:</p> <ul> <li><code>ErrNotFound</code> \u2013 tool or backend not present.</li> <li><code>ErrInvalidTool</code> \u2013 tool validation failed (delegates to <code>toolmodel.Tool.Validate</code>).</li> <li><code>ErrInvalidBackend</code> \u2013 backend is missing required fields for its kind.</li> <li><code>ErrInvalidCursor</code> \u2013 cursor tokens are malformed or stale.</li> <li><code>ErrNonDeterministicSearcher</code> \u2013 pagination requested with a non-deterministic searcher.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#registration-failures","title":"Registration failures","text":"<ul> <li>If a tool with the same ID is registered and its MCP fields differ, registration fails with <code>ErrInvalidTool</code>.</li> <li>Invalid backend structures return <code>ErrInvalidBackend</code> with a descriptive message.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#lookup-failures","title":"Lookup failures","text":"<ul> <li><code>GetTool</code> / <code>GetAllBackends</code> return <code>ErrNotFound</code> when the tool ID is missing.</li> <li><code>UnregisterBackend</code> returns <code>ErrNotFound</code> if the tool or backend is not present.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#search-behavior","title":"Search behavior","text":"<ul> <li>Lexical default: substring matching with scoring (name &gt; namespace &gt; description/tags).</li> <li>Empty queries: return the first N tools (deterministic order).</li> <li>Cursor pagination: <code>SearchPage</code> and <code>ListNamespacesPage</code> return opaque cursor tokens validated against index version.</li> <li>Tags: normalized via <code>toolmodel.NormalizeTags</code> and included in the search corpus.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backend selector: inject a policy (e.g., \u201cprefer MCP over local\u201d).</li> <li>Custom searcher: replace lexical search with <code>toolsearch</code> BM25 or a semantic engine.</li> <li>External indexing: implement <code>Index</code> with a DB-backed or remote store in the future.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Prefer <code>RegisterToolsFromMCP</code> for ingesting MCP server tools.</li> <li>Normalize tags at ingestion to keep search results consistent.</li> <li>Keep namespaces stable so tool IDs remain durable across deployments.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolindex/examples/#custom-backend-selection","title":"Custom backend selection","text":"<pre><code>selector := func(backends []toolmodel.ToolBackend) toolmodel.ToolBackend {\n  // Prefer MCP for this app\n  for _, b := range backends {\n    if b.Kind == toolmodel.BackendKindMCP {\n      return b\n    }\n  }\n  return toolindex.DefaultBackendSelector(backends)\n}\n\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{BackendSelector: selector})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/examples/#inject-bm25-searcher","title":"Inject BM25 searcher","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{K1: 1.4, B: 0.75})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/examples/#multiple-backends","title":"Multiple backends","text":"<pre><code>_ = idx.RegisterTool(tool, toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindMCP,\n  MCP:  &amp;toolmodel.MCPBackend{ServerName: \"github\"},\n})\n\n_ = idx.RegisterTool(tool, toolmodel.ToolBackend{\n  Kind:  toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"get_repo\"},\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolindex/usage/#register-tools","title":"Register tools","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\nreg := toolindex.ToolRegistration{Tool: tool, Backend: backend}\nif err := idx.RegisterTools([]toolindex.ToolRegistration{reg}); err != nil {\n  // handle error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#search","title":"Search","text":"<pre><code>summaries, err := idx.Search(\"repo metadata\", 5)\nif err != nil {\n  // handle error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#search-with-cursor-pagination","title":"Search with cursor pagination","text":"<pre><code>summaries, nextCursor, err := idx.SearchPage(\"repo metadata\", 20, \"\")\nif err != nil {\n  // handle error\n}\nif nextCursor != \"\" {\n  nextPage, _, _ := idx.SearchPage(\"repo metadata\", 20, nextCursor)\n  _ = nextPage\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#list-namespaces-with-cursor-pagination","title":"List namespaces with cursor pagination","text":"<pre><code>namespaces, nextCursor, err := idx.ListNamespacesPage(50, \"\")\nif err != nil {\n  // handle error\n}\nif nextCursor != \"\" {\n  nextPage, _, _ := idx.ListNamespacesPage(50, nextCursor)\n  _ = nextPage\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#lookup-and-backends","title":"Lookup and backends","text":"<pre><code>t, defaultBackend, err := idx.GetTool(\"github:get_repo\")\nif err != nil {\n  // handle not found\n}\n\nallBackends, _ := idx.GetAllBackends(t.ToolID())\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#register-from-mcp","title":"Register from MCP","text":"<pre><code>_ = idx.RegisterToolsFromMCP(\"github\", []toolmodel.Tool{toolA, toolB})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/usage/#options","title":"Options","text":"<pre><code>idx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{\n  BackendSelector: mySelector,\n  Searcher:        mySearcher,\n  // RequireDeterministicSearcher: boolPtr(true), // enforce stable pagination\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolindex</code> supports end-to-end agent workflows by powering discovery and canonical lookup.</p>"},{"location":"library-docs-from-repos/toolindex/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#3182ce', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph ingest[\"Tool Ingestion\"]\n        MCP[\"\ud83d\udce1 MCP Servers\"]\n        Local[\"\ud83c\udfe0 Local Tools\"]\n        Provider[\"\ud83d\udd0c Provider Tools\"]\n        RegMCP[\"RegisterToolsFromMCP()\"]\n        RegTool[\"RegisterTool()\"]\n    end\n\n    subgraph index[\"toolindex.Index\"]\n        Registry[\"\ud83d\udcc7 In-Memory Registry&lt;br/&gt;&lt;small&gt;Thread-safe, RWMutex&lt;/small&gt;\"]\n        Backends[\"\u2699\ufe0f Backend Map&lt;br/&gt;&lt;small&gt;toolID \u2192 []ToolBackend&lt;/small&gt;\"]\n    end\n\n    subgraph search[\"Search\"]\n        Query[\"\ud83d\udd0d Search(query, limit)\"]\n        Searcher[\"\ud83c\udfaf Searcher Interface&lt;br/&gt;&lt;small&gt;lexical | BM25 | semantic&lt;/small&gt;\"]\n        Results[\"\ud83d\udccb Summary[]&lt;br/&gt;&lt;small&gt;No schemas (token-cheap)&lt;/small&gt;\"]\n    end\n\n    subgraph lookup[\"Lookup\"]\n        Get[\"\ud83d\udcd6 GetTool(id)\"]\n        GetBE[\"\u2699\ufe0f GetAllBackends(id)\"]\n        Tool[\"\ud83e\uddf1 toolmodel.Tool\"]\n    end\n\n    MCP --&gt; RegMCP --&gt; Registry\n    Local --&gt; RegTool --&gt; Registry\n    Provider --&gt; RegTool\n    Registry --&gt; Backends\n\n    Registry --&gt; Query --&gt; Searcher --&gt; Results\n    Registry --&gt; Get --&gt; Tool\n    Backends --&gt; GetBE\n\n    style ingest fill:#718096,stroke:#4a5568\n    style index fill:#3182ce,stroke:#2c5282,stroke-width:2px\n    style search fill:#d69e2e,stroke:#b7791f\n    style lookup fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Ingest tools from MCP servers or local registries:</li> <li><code>RegisterToolsFromMCP(serverName, tools)</code></li> <li><code>RegisterTool(tool, backend)</code> for local/provider tools</li> <li>Agent discovers tools via <code>search_tools</code> (summary only).</li> <li>Agent selects a tool ID and requests schema/docs (<code>describe_tool</code>).</li> <li>Agent executes via <code>run_tool</code> or <code>run_chain</code>.</li> </ol>"},{"location":"library-docs-from-repos/toolindex/user-journey/#example-register-and-search","title":"Example: register and search","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\n// MCP-backed tools\n_ = idx.RegisterToolsFromMCP(\"github\", []toolmodel.Tool{repoTool})\n\n// Local tool\n_ = idx.RegisterTool(localTool, toolmodel.ToolBackend{\n  Kind: toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"local_handler\"},\n})\n\nsummaries, _ := idx.Search(\"repo\", 5)\nfor _, s := range summaries {\n  fmt.Println(s.ID, s.ShortDescription)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Fast, deterministic search results.</li> <li>Stable tool IDs across backends.</li> <li>Safe summaries for progressive disclosure.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrInvalidTool</code> when tool validation fails.</li> <li><code>ErrInvalidBackend</code> when backend metadata is incomplete.</li> <li><code>ErrNotFound</code> for missing tool IDs or backends.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/user-journey/#why-this-matters","title":"Why this matters","text":"<p><code>toolindex</code> is the \u201cfront door\u201d for tool discovery. It keeps discovery cheap and consistent while letting execution and documentation happen elsewhere.</p>"},{"location":"library-docs-from-repos/toolindex/plans/","title":"toolindex Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolindex (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#index","title":"Index","text":"<pre><code>func TestIndex_Contract(t *testing.T) {\n    // Methods:\n    // - RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) error\n    // - RegisterTools(regs []ToolRegistration) error\n    // - RegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) error\n    // - UnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) error\n    // - GetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)\n    // - GetAllBackends(id string) ([]toolmodel.ToolBackend, error)\n    // - Search(query string, limit int) ([]Summary, error)\n    // - SearchPage(query string, limit int, cursor string) ([]Summary, string, error)\n    // - ListNamespaces() ([]string, error)\n    // - ListNamespacesPage(limit int, cursor string) ([]string, string, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#searcher","title":"Searcher","text":"<pre><code>func TestSearcher_Contract(t *testing.T) {\n    // Methods:\n    // - Search(query string, limit int, docs []SearchDoc) ([]Summary, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#deterministicsearcher","title":"DeterministicSearcher","text":"<pre><code>func TestDeterministicSearcher_Contract(t *testing.T) {\n    // Methods:\n    // - Searcher\n    // - Deterministic() bool\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#changenotifier","title":"ChangeNotifier","text":"<pre><code>func TestChangeNotifier_Contract(t *testing.T) {\n    // Methods:\n    // - OnChange(listener ChangeListener) (unsubscribe func())\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-execution-plan/#refresher","title":"Refresher","text":"<pre><code>func TestRefresher_Contract(t *testing.T) {\n    // Methods:\n    // - Refresh() uint64\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolindex","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Index</code> <code>toolindex/index.go:51</code> RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) errorRegisterTools(regs []ToolRegistration) errorRegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) errorUnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) errorGetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)GetAllBackends(id string) ([]toolmodel.ToolBackend, error)Search(query string, limit int) ([]Summary, error)SearchPage(query string, limit int, cursor string) ([]Summary, string, error)ListNamespaces() ([]string, error)ListNamespacesPage(limit int, cursor string) ([]string, string, error) <code>Searcher</code> <code>toolindex/index.go:81</code> Search(query string, limit int, docs []SearchDoc) ([]Summary, error) <code>DeterministicSearcher</code> <code>toolindex/index.go:90</code> SearcherDeterministic() bool <code>ChangeNotifier</code> <code>toolindex/index.go:118</code> OnChange(listener ChangeListener) (unsubscribe func()) <code>Refresher</code> <code>toolindex/index.go:123</code> Refresh() uint64"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolindex/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/","title":"tooldocs","text":"<p><code>tooldocs</code> provides progressive documentation and examples for tools defined in <code>toolmodel</code> and discovered via <code>toolindex</code>.</p> <p></p>"},{"location":"library-docs-from-repos/tooldocs/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#motivation","title":"Motivation","text":"<ul> <li>Token efficiency: fetch details only when needed</li> <li>Better tool usage: schema + examples reduce call errors</li> <li>Usability: humans and agents see consistent, structured guidance</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#key-apis","title":"Key APIs","text":"<ul> <li><code>Store</code> interface</li> <li><code>InMemoryStore</code> implementation</li> <li><code>DescribeTool</code> (summary/schema/full)</li> <li><code>ListExamples</code></li> <li><code>DocEntry</code> + <code>ToolExample</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#quickstart","title":"Quickstart","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:get_repo\", tooldocs.DocEntry{\n  Summary: \"Fetch repository metadata\",\n  Notes:   \"Requires authentication.\",\n})\n\ndoc, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nexamples, _ := store.ListExamples(\"github:get_repo\", 2)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/#usability-notes","title":"Usability notes","text":"<ul> <li>Summary and schema are safe defaults for discovery</li> <li>Examples are capped to prevent token blowups</li> <li>Notes and external refs are optional but highly recommended</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/#next","title":"Next","text":"<ul> <li>Detail tiers and resolution: <code>architecture.md</code></li> <li>Registration and caps: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/tooldocs/api/#store-interface","title":"Store interface","text":"<pre><code>type Store interface {\n  DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n  ListExamples(id string, maxExamples int) ([]ToolExample, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#store-contract","title":"Store contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Errors: use <code>errors.Is</code> with <code>ErrNotFound</code>, <code>ErrInvalidDetail</code>, <code>ErrNoTool</code>, <code>ErrArgsTooLarge</code>.</li> <li>Ownership: returned docs/examples are caller-owned snapshots.</li> <li>Determinism: identical inputs over unchanged data yield stable results.</li> <li>Nil/zero: empty IDs are treated as not found; <code>maxExamples &lt;= 0</code> returns zero examples.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/api/#detail-levels","title":"Detail levels","text":"<pre><code>const (\n  DetailSummary DetailLevel = \"summary\"\n  DetailSchema  DetailLevel = \"schema\"\n  DetailFull    DetailLevel = \"full\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#tooldoc","title":"ToolDoc","text":"<pre><code>type ToolDoc struct {\n  Tool         *toolmodel.Tool\n  Summary      string\n  SchemaInfo   *SchemaInfo\n  Notes        string\n  Examples     []ToolExample\n  ExternalRefs []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#toolexample","title":"ToolExample","text":"<pre><code>type ToolExample struct {\n  ID          string\n  Title       string\n  Description string\n  Args        map[string]any\n  ResultHint  string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#schemainfo","title":"SchemaInfo","text":"<pre><code>type SchemaInfo struct {\n  Required []string\n  Defaults map[string]any\n  Types    map[string][]string\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#schemainfo-contract","title":"SchemaInfo contract","text":"<ul> <li><code>Required</code> lists required fields from the input schema.</li> <li><code>Defaults</code> contains default values derived from schema defaults.</li> <li><code>Types</code> captures the observed JSON schema types per field (stable ordering not guaranteed).</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/api/#storeoptions","title":"StoreOptions","text":"<pre><code>type StoreOptions struct {\n  Index        toolindex.Index\n  ToolResolver func(id string) (*toolmodel.Tool, error)\n  MaxExamples  int\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#inmemorystore","title":"InMemoryStore","text":"<pre><code>func NewInMemoryStore(opts StoreOptions) *InMemoryStore\nfunc (s *InMemoryStore) RegisterDoc(id string, entry DocEntry) error\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/api/#errors","title":"Errors","text":"<ul> <li><code>ErrNotFound</code></li> <li><code>ErrInvalidDetail</code></li> <li><code>ErrNoTool</code></li> <li><code>ErrArgsTooLarge</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/architecture/","title":"Architecture","text":"<p><code>tooldocs</code> adds a documentation layer on top of <code>toolmodel</code>. It does not change schemas; it augments them with guidance and examples.</p>"},{"location":"library-docs-from-repos/tooldocs/architecture/#tiered-disclosure","title":"Tiered disclosure","text":""},{"location":"library-docs-from-repos/tooldocs/architecture/#resolution-sequence","title":"Resolution sequence","text":""},{"location":"library-docs-from-repos/tooldocs/architecture/#progressive-disclosure-contract","title":"Progressive disclosure contract","text":"<ul> <li><code>DetailSummary</code>: short text only</li> <li><code>DetailSchema</code>: full tool + derived schema info</li> <li><code>DetailFull</code>: schema + notes + examples</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/architecture/#resolution-modes","title":"Resolution modes","text":"<ul> <li>via <code>toolindex.Index</code> (preferred)</li> <li>via a custom <code>ToolResolver</code> function</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/","title":"Design Notes","text":"<p>This page explains the design choices and error semantics for <code>tooldocs</code>.</p>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Progressive detail tiers. <code>DetailSummary</code>, <code>DetailSchema</code>, and <code>DetailFull</code> keep large docs out of the default path while still allowing rich guidance on demand.</li> <li>Schema-first truth. <code>ToolDoc.Tool</code> (from <code>toolmodel</code>) remains the canonical schema source; docs only augment, they do not override.</li> <li>Token safety caps. Examples, summaries, notes, and args are capped to prevent context bloat in downstream LLM usage.</li> <li>Best-effort schema derivation. <code>SchemaInfo</code> is derived from JSON Schema when possible; missing or complex schema features simply result in empty fields.</li> <li>Mutable-safety. Args are deep-copied and normalized to MCP-native shapes on registration and retrieval to avoid mutation bugs.</li> <li>Flexible resolution. Docs can be served from the index or a custom resolver, enabling file-backed or remote sources without changing the interface.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>tooldocs</code> exposes sentinel errors for predictable handling:</p> <ul> <li><code>ErrNotFound</code> \u2013 no docs and no tool found for the given ID.</li> <li><code>ErrInvalidDetail</code> \u2013 unknown detail level requested.</li> <li><code>ErrNoTool</code> \u2013 schema/full requested but tool is not resolvable.</li> <li><code>ErrArgsTooLarge</code> \u2013 example args exceed depth/size caps.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#behavior-by-level","title":"Behavior by level","text":"<ul> <li>Summary: works when either docs or tool exist; returns <code>ErrNotFound</code> only if both are missing.</li> <li>Schema/Full: requires <code>toolmodel.Tool</code> (from <code>toolindex</code> or <code>ToolResolver</code>), otherwise returns <code>ErrNoTool</code>.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom resolvers: provide <code>ToolResolver</code> when tools are not in <code>toolindex</code>.</li> <li>Alternative stores: implement <code>Store</code> for file-backed or remote doc sources.</li> <li>Docs generation: generate <code>DocEntry</code> from code comments or external sources and register at startup.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep examples short and bounded; the caps (<code>MaxArgsDepth</code>, <code>MaxArgsKeys</code>, etc.) are enforced at registration time.</li> <li>Prefer a small number of high-quality examples over many low-signal ones.</li> <li>Use <code>SchemaInfo</code> only for UI hints and human guidance; use actual schemas for validation.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/tooldocs/examples/#schema-level-detail","title":"Schema-level detail","text":"<pre><code>doc, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailSchema)\nfmt.Println(doc.Tool.InputSchema)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/examples/#full-detail-with-examples","title":"Full detail with examples","text":"<pre><code>full, _ := store.DescribeTool(\"github:get_repo\", tooldocs.DetailFull)\nfor _, ex := range full.Examples {\n  fmt.Println(ex.Title, ex.Args)\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/examples/#resolver-only-usage-no-toolindex","title":"Resolver-only usage (no toolindex)","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{\n  ToolResolver: func(id string) (*toolmodel.Tool, error) {\n    if id != \"tickets:create\" {\n      return nil, fmt.Errorf(\"unknown: %s\", id)\n    }\n    t := toolmodel.Tool{Namespace: \"tickets\"}\n    t.Name = \"create\"\n    t.Description = \"Create a support ticket\"\n    t.InputSchema = map[string]any{\"type\": \"object\"}\n    return &amp;t, nil\n  },\n})\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/tooldocs/usage/#register-docs","title":"Register docs","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{\n  Index:       idx,\n  MaxExamples: 3,\n})\n\nerr := store.RegisterDoc(\"tickets:create\", tooldocs.DocEntry{\n  Summary: \"Create a support ticket\",\n  Notes:   \"Requires authentication. Supports idempotency via request_id.\",\n  Examples: []tooldocs.ToolExample{\n    {\n      Title:       \"Minimal\",\n      Description: \"Create a low-priority ticket\",\n      Args:        map[string]any{\"title\": \"Login broken\"},\n      ResultHint:  \"Ticket object with id and status\",\n    },\n  },\n})\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#describe-tools","title":"Describe tools","text":"<pre><code>doc, _ := store.DescribeTool(\"tickets:create\", tooldocs.DetailSchema)\nfull, _ := store.DescribeTool(\"tickets:create\", tooldocs.DetailFull)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#list-examples","title":"List examples","text":"<pre><code>examples, _ := store.ListExamples(\"tickets:create\", 2)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/usage/#size-caps","title":"Size caps","text":"<p>Examples are validated at registration time:</p> <ul> <li><code>MaxArgsDepth = 5</code></li> <li><code>MaxArgsKeys = 50</code></li> <li><code>MaxDescriptionLen = 300</code></li> <li><code>MaxResultHintLen = 200</code></li> </ul>"},{"location":"library-docs-from-repos/tooldocs/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>tooldocs</code> provides progressive disclosure in an end-to-end agent workflow.</p>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#d69e2e', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph discovery[\"Phase 1: Discovery\"]\n        Search[\"\ud83d\udd0d search_tools(query)\"]\n        Summaries[\"\ud83d\udccb Summary[]&lt;br/&gt;&lt;small&gt;ID, Name, Tags only&lt;/small&gt;\"]\n    end\n\n    subgraph schema[\"Phase 2: Schema\"]\n        DescSchema[\"\ud83d\udcd0 describe_tool(id, 'schema')\"]\n        SchemaDoc[\"\ud83d\udcda ToolDoc&lt;br/&gt;&lt;small&gt;+ InputSchema&lt;br/&gt;+ OutputSchema&lt;/small&gt;\"]\n    end\n\n    subgraph full[\"Phase 3: Full\"]\n        DescFull[\"\ud83d\udcd6 describe_tool(id, 'full')\"]\n        FullDoc[\"\ud83d\udcda ToolDoc&lt;br/&gt;&lt;small&gt;+ Notes&lt;br/&gt;+ Examples&lt;br/&gt;+ ExternalRefs&lt;/small&gt;\"]\n    end\n\n    subgraph examples[\"Examples\"]\n        ListEx[\"\ud83d\udca1 list_tool_examples(id)\"]\n        ExList[\"\ud83d\udccb ToolExample[]&lt;br/&gt;&lt;small&gt;Args + ResultHint&lt;/small&gt;\"]\n    end\n\n    subgraph execution[\"Phase 4: Execute\"]\n        Run[\"\u25b6\ufe0f run_tool(id, args)\"]\n    end\n\n    Search --&gt; Summaries\n    Summaries --&gt;|\"select tool\"| DescSchema --&gt; SchemaDoc\n    SchemaDoc --&gt;|\"need guidance\"| DescFull --&gt; FullDoc\n    SchemaDoc --&gt;|\"need examples\"| ListEx --&gt; ExList\n    SchemaDoc --&gt; Run\n    FullDoc --&gt; Run\n    ExList --&gt; Run\n\n    style discovery fill:#3182ce,stroke:#2c5282\n    style schema fill:#d69e2e,stroke:#b7791f,stroke-width:2px\n    style full fill:#6b46c1,stroke:#553c9a\n    style examples fill:#e53e3e,stroke:#c53030\n    style execution fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#detail-levels","title":"Detail Levels","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart LR\n    subgraph summary[\"DetailSummary\"]\n        S[\"\ud83d\udccb 1-2 line description&lt;br/&gt;\ud83c\udff7\ufe0f Tags&lt;br/&gt;\ud83d\udcc1 Namespace\"]\n    end\n\n    subgraph schema[\"DetailSchema\"]\n        SC[\"\ud83d\udccb Full description&lt;br/&gt;\ud83d\udcd0 Input schema&lt;br/&gt;\ud83d\udce4 Output schema\"]\n    end\n\n    subgraph full[\"DetailFull\"]\n        F[\"\ud83d\udccb Everything&lt;br/&gt;\ud83d\udcdd Notes&lt;br/&gt;\ud83d\udca1 Examples&lt;br/&gt;\ud83d\udd17 ExternalRefs\"]\n    end\n\n    summary --&gt;|\"~50 tokens\"| schema --&gt;|\"~200 tokens\"| full\n\n    style summary fill:#38a169,stroke:#276749\n    style schema fill:#d69e2e,stroke:#b7791f\n    style full fill:#6b46c1,stroke:#553c9a</code></pre>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Discovery: agent finds candidate tools via <code>search_tools</code>.</li> <li>Schema retrieval: agent requests <code>detail_level=\"schema\"</code> to see required parameters.</li> <li>Full guidance: agent requests <code>detail_level=\"full\"</code> or <code>list_tool_examples</code> when extra guidance is needed.</li> <li>Execution: agent calls the tool using <code>toolrun</code> with validated args.</li> </ol>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#example-register-docs-and-fetch","title":"Example: register docs and fetch","text":"<pre><code>store := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\n\n_ = store.RegisterDoc(\"github:create_issue\", tooldocs.DocEntry{\n  Summary: \"Create a GitHub issue.\",\n  Notes:   \"Use labels sparingly; title is required.\",\n  Examples: []tooldocs.ToolExample{\n    {\n      Title:       \"Create a bug issue\",\n      Description: \"Create a bug ticket with a label.\",\n      Args: map[string]any{\n        \"owner\": \"acme\",\n        \"repo\": \"app\",\n        \"title\": \"Crash on login\",\n        \"labels\": []any{\"bug\"},\n      },\n      ResultHint: \"Returns the issue number and URL.\",\n    },\n  },\n})\n\ndoc, _ := store.DescribeTool(\"github:create_issue\", tooldocs.DetailFull)\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Clear, compact guidance without shipping the full schema by default.</li> <li>Predictable errors when docs are missing or a tool cannot be resolved.</li> <li>Examples that are safe to include in LLM context.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrNoTool</code> when requesting schema/full without tool registration.</li> <li><code>ErrArgsTooLarge</code> when example payloads exceed caps.</li> <li><code>ErrInvalidDetail</code> for invalid detail levels.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/","title":"tooldocs Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 tooldocs (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-execution-plan/#store","title":"Store","text":"<pre><code>func TestStore_Contract(t *testing.T) {\n    // Methods:\n    // - DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n    // - ListExamples(id string, maxExamples int) ([]ToolExample, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 tooldocs","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Store</code> <code>tooldocs/store.go:34</code> DescribeTool(id string, level DetailLevel) (ToolDoc, error)ListExamples(id string, maxExamples int) ([]ToolExample, error)"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/tooldocs/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/","title":"toolrun","text":"<p><code>toolrun</code> executes tools and chains. It resolves tools/backends, validates inputs/outputs against JSON Schema, dispatches to the correct executor, and normalizes results.</p> <p></p>"},{"location":"library-docs-from-repos/toolrun/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolrun/#motivation","title":"Motivation","text":"<ul> <li>Consistent execution across MCP, provider, and local tools</li> <li>Safety via schema validation and normalized results</li> <li>Usability with clear error wrapping and chain semantics</li> </ul>"},{"location":"library-docs-from-repos/toolrun/#key-apis","title":"Key APIs","text":"<ul> <li><code>Runner</code> interface</li> <li><code>DefaultRunner</code> (via <code>NewRunner</code>)</li> <li><code>Run</code>, <code>RunStream</code>, <code>RunChain</code></li> <li><code>ChainStep</code>, <code>RunResult</code>, <code>StreamEvent</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/#quickstart","title":"Quickstart","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n\nres, _ := runner.Run(ctx, \"github:get_repo\", map[string]any{\"owner\": \"o\", \"repo\": \"r\"})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/#usability-notes","title":"Usability notes","text":"<ul> <li>Backend selection is deterministic by default</li> <li>Chain steps can inject <code>previous</code> results</li> <li>Streaming is optional; non-streaming backends return <code>ErrStreamNotSupported</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/#next","title":"Next","text":"<ul> <li>Execution pipeline: <code>architecture.md</code></li> <li>Configuration and options: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolrun/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolrun/api/#runner-interface","title":"Runner interface","text":"<pre><code>type Runner interface {\n  Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n  RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n  RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n}\n\n// Optional progress interface\ntype ProgressRunner interface {\n  RunWithProgress(ctx context.Context, toolID string, args map[string]any, onProgress ProgressCallback) (RunResult, error)\n  RunChainWithProgress(ctx context.Context, steps []ChainStep, onProgress ProgressCallback) (RunResult, []StepResult, error)\n}\n\ntype ProgressCallback func(ProgressEvent)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#runner-contract","title":"Runner contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: methods honor cancellation/deadlines and return <code>ctx.Err()</code> when canceled.</li> <li>Errors: use <code>errors.Is</code> with <code>ErrInvalidToolID</code>, <code>ErrToolNotFound</code>, <code>ErrValidation</code>,   <code>ErrExecution</code>, <code>ErrOutputValidation</code>, and <code>ErrStreamNotSupported</code>.</li> <li>Ownership: args are read-only; returned results are caller-owned snapshots.</li> <li>Determinism: identical inputs over stable backends should yield stable results.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index           toolindex.Index\n  ToolResolver    func(id string) (*toolmodel.Tool, error)\n  BackendsResolver func(id string) ([]toolmodel.ToolBackend, error)\n  BackendSelector toolindex.BackendSelector\n  Validator       toolmodel.SchemaValidator\n  ValidateInput   bool\n  ValidateOutput  bool\n  MCP      MCPExecutor\n  Provider ProviderExecutor\n  Local    LocalRegistry\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#executors","title":"Executors","text":"<pre><code>type MCPExecutor interface {\n  CallTool(ctx context.Context, serverName string, params *mcp.CallToolParams) (*mcp.CallToolResult, error)\n  CallToolStream(ctx context.Context, serverName string, params *mcp.CallToolParams) (&lt;-chan StreamEvent, error)\n}\n\ntype ProviderExecutor interface {\n  CallTool(ctx context.Context, providerID, toolID string, args map[string]any) (any, error)\n  CallToolStream(ctx context.Context, providerID, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\ntype LocalRegistry interface {\n  Get(name string) (LocalHandler, bool)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#executor-contracts","title":"Executor contracts","text":"<ul> <li>MCPExecutor/ProviderExecutor must return <code>ErrStreamNotSupported</code> for unsupported streaming.</li> <li>If streaming is supported and error is nil, the returned channel must be non-nil.</li> <li>LocalRegistry must return <code>(nil, false)</code> for unknown names.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/api/#results","title":"Results","text":"<pre><code>type ChainStep struct {\n  ToolID      string\n  Args        map[string]any\n  UsePrevious bool\n}\n\ntype RunResult struct {\n  Tool       toolmodel.Tool\n  Backend    toolmodel.ToolBackend\n  Structured any\n  MCPResult  *mcp.CallToolResult\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#streaming","title":"Streaming","text":"<pre><code>type StreamEvent struct {\n  Kind  StreamEventKind\n  ToolID string\n  Data  any\n  Err   error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/api/#errors","title":"Errors","text":"<ul> <li><code>ErrToolNotFound</code></li> <li><code>ErrInvalidToolID</code></li> <li><code>ErrNoBackends</code></li> <li><code>ErrValidation</code></li> <li><code>ErrOutputValidation</code></li> <li><code>ErrExecution</code></li> <li><code>ErrStreamNotSupported</code></li> </ul>"},{"location":"library-docs-from-repos/toolrun/architecture/","title":"Architecture","text":"<p><code>toolrun</code> implements a consistent execution pipeline with validation and backend dispatch. It is transport-agnostic and depends on <code>toolmodel</code> types.</p>"},{"location":"library-docs-from-repos/toolrun/architecture/#single-tool-execution","title":"Single-tool execution","text":""},{"location":"library-docs-from-repos/toolrun/architecture/#chain-execution","title":"Chain execution","text":""},{"location":"library-docs-from-repos/toolrun/changelog/","title":"Changelog","text":""},{"location":"library-docs-from-repos/toolrun/changelog/#unreleased","title":"Unreleased","text":""},{"location":"library-docs-from-repos/toolrun/changelog/#added","title":"Added","text":"<ul> <li>Context cancellation checks for <code>Run</code>, <code>RunChain</code>, and tool resolution.</li> <li>Tests covering cancellation behavior between chain steps and before execution.</li> <li>Progress callbacks via <code>ProgressRunner</code> with start/end and per-step updates.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/design-notes/","title":"Design Notes","text":"<p>This page documents the key tradeoffs and error semantics behind <code>toolrun</code>.</p>"},{"location":"library-docs-from-repos/toolrun/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Backend-agnostic execution. The runner dispatches to MCP, provider, or local backends through narrow executor interfaces. This keeps tool execution pluggable without embedding transport details.</li> <li>Index-first resolution. When configured, <code>toolindex</code> is the primary source for tool definitions and backends. Optional resolvers allow ad-hoc tools or dynamic backends without an index.</li> <li>Validation on by default. Input and output validation is enabled by default to catch schema errors early. This trades a small amount of latency for correctness and safety.</li> <li>Strict chaining policy. Chains stop on the first error (v1) and inject previous results at <code>args[\"previous\"]</code> when requested. This is deterministic and easy to reason about, but not a branching workflow engine.</li> <li>Structured-first results. For MCP backends, <code>StructuredContent</code> is preferred; otherwise text content is best-effort parsed as JSON. This avoids losing structure while preserving fallback behavior.</li> <li>Context-aware execution. Runner methods check <code>context.Context</code> and pass it to backends; full cancellation depends on backend support.</li> <li>Optional progress callbacks. <code>ProgressRunner</code> provides coarse progress updates for chains and long-running tools without changing the core <code>Runner</code> API.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolrun</code> uses sentinel errors and wrapped context via <code>ToolError</code>:</p> <ul> <li><code>ErrToolNotFound</code> \u2013 no tool definition could be resolved.</li> <li><code>ErrNoBackends</code> \u2013 tool exists but no backend is available.</li> <li><code>ErrValidation</code> \u2013 input validation failed.</li> <li><code>ErrExecution</code> \u2013 backend execution failed.</li> <li><code>ErrOutputValidation</code> \u2013 output validation failed.</li> <li><code>ErrStreamNotSupported</code> \u2013 streaming is not supported by the selected backend.</li> </ul> <p><code>ToolError</code> wraps these with <code>ToolID</code>, <code>Backend</code>, and <code>Op</code> (e.g., <code>resolve</code>, <code>execute</code>, <code>validate_input</code>).</p>"},{"location":"library-docs-from-repos/toolrun/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backend selection: provide <code>BackendSelector</code> to prioritize specific backends.</li> <li>Custom validation: plug in a different <code>SchemaValidator</code> implementation.</li> <li>Custom executors: implement <code>MCPExecutor</code>, <code>ProviderExecutor</code>, or <code>LocalRegistry</code> for your runtime.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Prefer registering tools in <code>toolindex</code> for consistent resolution and backends.</li> <li>Enable output validation in production to catch schema drift early.</li> <li>Use streaming only when your backend supports it; otherwise expect <code>ErrStreamNotSupported</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolrun/examples/#local-tool-execution","title":"Local tool execution","text":"<pre><code>registry := toolrun.NewLocalRegistry()\nregistry.Register(\"ping\", func(ctx context.Context, args map[string]any) (any, error) {\n  return map[string]any{\"ok\": true}, nil\n})\n\nrunner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithLocalRegistry(registry),\n)\n\nres, _ := runner.Run(ctx, \"local:ping\", map[string]any{})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/examples/#streaming","title":"Streaming","text":"<pre><code>ch, err := runner.RunStream(ctx, \"logs:stream\", map[string]any{\"tail\": 100})\nif err != nil {\n  // handle ErrStreamNotSupported\n}\nfor ev := range ch {\n  fmt.Println(ev.Data)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/examples/#backend-resolution-fallback","title":"Backend resolution fallback","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithToolResolver(func(id string) (*toolmodel.Tool, error) {\n    // resolve from external store\n    return &amp;tool, nil\n  }),\n  toolrun.WithBackendsResolver(func(id string) ([]toolmodel.ToolBackend, error) {\n    return []toolmodel.ToolBackend{backend}, nil\n  }),\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolrun/usage/#configure-a-runner","title":"Configure a runner","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n  toolrun.WithProviderExecutor(providerExec),\n  toolrun.WithLocalRegistry(localRegistry),\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#validation-control","title":"Validation control","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithValidation(true, false), // validate input, skip output\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#run-a-tool","title":"Run a tool","text":"<pre><code>res, err := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"octo\",\n  \"repo\":  \"hello\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/usage/#run-a-chain","title":"Run a chain","text":"<pre><code>steps := []toolrun.ChainStep{\n  {ToolID: \"user:get\", Args: map[string]any{\"user_id\": \"123\"}},\n  {ToolID: \"orders:list\", UsePrevious: true},\n}\n\nfinal, all, err := runner.RunChain(ctx, steps)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolrun</code> executes tools and chains in a full end-to-end agent flow.</p>"},{"location":"library-docs-from-repos/toolrun/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#38a169', 'primaryTextColor': '#fff'}}}%%\nflowchart LR\n    subgraph input[\"Input\"]\n        Request[\"\ud83d\udce5 Run(toolID, args)\"]\n    end\n\n    subgraph resolve[\"Resolution\"]\n        GetTool[\"\ud83d\udd0d GetTool(id)\"]\n        GetBackends[\"\u2699\ufe0f GetAllBackends(id)\"]\n        Select[\"\ud83c\udfaf BackendSelector&lt;br/&gt;&lt;small&gt;local &gt; provider &gt; mcp&lt;/small&gt;\"]\n    end\n\n    subgraph validate1[\"Input Validation\"]\n        ValIn[\"\u2705 ValidateInput()&lt;br/&gt;&lt;small&gt;JSON Schema&lt;/small&gt;\"]\n    end\n\n    subgraph dispatch[\"Dispatch\"]\n        Backend{\"Backend&lt;br/&gt;Type?\"}\n        Local[\"\ud83c\udfe0 Local\"]\n        Provider[\"\ud83d\udd0c Provider\"]\n        MCP[\"\ud83d\udce1 MCP\"]\n    end\n\n    subgraph normalize[\"Normalize\"]\n        Norm[\"\ud83d\udce4 NormalizeResult()\"]\n    end\n\n    subgraph validate2[\"Output Validation\"]\n        ValOut[\"\u2705 ValidateOutput()&lt;br/&gt;&lt;small&gt;optional&lt;/small&gt;\"]\n    end\n\n    subgraph output[\"Output\"]\n        Result[\"\ud83d\udce6 RunResult&lt;br/&gt;&lt;small&gt;Structured | Text | Error&lt;/small&gt;\"]\n    end\n\n    Request --&gt; GetTool --&gt; GetBackends --&gt; Select --&gt; ValIn --&gt; Backend\n    Backend --&gt;|local| Local --&gt; Norm\n    Backend --&gt;|provider| Provider --&gt; Norm\n    Backend --&gt;|mcp| MCP --&gt; Norm\n    Norm --&gt; ValOut --&gt; Result\n\n    style input fill:#3182ce,stroke:#2c5282\n    style resolve fill:#d69e2e,stroke:#b7791f\n    style validate1 fill:#38a169,stroke:#276749\n    style dispatch fill:#6b46c1,stroke:#553c9a,stroke-width:2px\n    style normalize fill:#e53e3e,stroke:#c53030\n    style validate2 fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#chain-execution","title":"Chain Execution","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nsequenceDiagram\n    autonumber\n    participant Client as \ud83d\udda5\ufe0f Client\n    participant Runner as \u25b6\ufe0f Runner\n    participant Step1 as \ud83d\udccc Step 1\n    participant Step2 as \ud83d\udccc Step 2\n\n    Client-&gt;&gt;+Runner: RunChain([step1, step2])\n\n    rect rgb(56, 161, 105, 0.1)\n        Runner-&gt;&gt;+Step1: Run(\"github:get_repo\", args)\n        Step1--&gt;&gt;-Runner: {repo: {...}}\n        Note right of Runner: Store as \"previous\"\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Runner-&gt;&gt;Runner: args[\"previous\"] = step1Result\n        Runner-&gt;&gt;+Step2: Run(\"github:list_issues\", {previous: ...})\n        Step2--&gt;&gt;-Runner: {issues: [...]}\n    end\n\n    Runner--&gt;&gt;-Client: ChainResult {final, steps[]}</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Resolve the tool and its backends (via <code>toolindex</code> or resolver callbacks).</li> <li>Select the backend (default priority: local &gt; provider &gt; MCP).</li> <li>Validate input against JSON Schema.</li> <li>Dispatch to the selected backend.</li> <li>Normalize output (structured content preferred).</li> <li>Validate output (optional).</li> </ol>"},{"location":"library-docs-from-repos/toolrun/user-journey/#example-run-a-tool","title":"Example: run a tool","text":"<pre><code>runner := toolrun.NewRunner(\n  toolrun.WithIndex(idx),\n  toolrun.WithMCPExecutor(mcpExec),\n)\n\nres, err := runner.Run(ctx, \"github:get_repo\", map[string]any{\n  \"owner\": \"acme\",\n  \"repo\":  \"app\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#example-chain-two-tools","title":"Example: chain two tools","text":"<pre><code>steps := []toolrun.ChainStep{\n  {ToolID: \"github:get_repo\", Args: map[string]any{\"owner\": \"acme\", \"repo\": \"app\"}},\n  {ToolID: \"github:list_issues\", UsePrevious: true},\n}\n\nfinal, stepsOut, err := runner.RunChain(ctx, steps)\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Consistent execution across backends.</li> <li>Structured results suitable for chaining.</li> <li>Explicit error classification with <code>ToolError</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrToolNotFound</code> if the tool is missing.</li> <li><code>ErrValidation</code> for schema violations.</li> <li><code>ErrExecution</code> for backend errors.</li> <li><code>ErrStreamNotSupported</code> when streaming is requested but unsupported.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/","title":"toolrun Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolrun (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#runner","title":"Runner","text":"<pre><code>func TestRunner_Contract(t *testing.T) {\n    // Methods:\n    // - Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    // - RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    // - RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#progressrunner","title":"ProgressRunner","text":"<pre><code>func TestProgressRunner_Contract(t *testing.T) {\n    // Methods:\n    // - RunWithProgress(ctx context.Context, toolID string, args map[string]any, onProgress ProgressCallback) (RunResult, error)\n    // - RunChainWithProgress(ctx context.Context, steps []ChainStep, onProgress ProgressCallback) (RunResult, []StepResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#mcpexecutor","title":"MCPExecutor","text":"<pre><code>func TestMCPExecutor_Contract(t *testing.T) {\n    // Methods:\n    // - CallTool(ctx context.Context, serverName string, params *mcp.CallToolParams) (*mcp.CallToolResult, error)\n    // - CallToolStream(ctx context.Context, serverName string, params *mcp.CallToolParams) (&lt;-chan StreamEvent, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#providerexecutor","title":"ProviderExecutor","text":"<pre><code>func TestProviderExecutor_Contract(t *testing.T) {\n    // Methods:\n    // - CallTool(ctx context.Context, providerID, toolID string, args map[string]any) (any, error)\n    // - CallToolStream(ctx context.Context, providerID, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-execution-plan/#localregistry","title":"LocalRegistry","text":"<pre><code>func TestLocalRegistry_Contract(t *testing.T) {\n    // Methods:\n    // - Get(name string) (LocalHandler, bool)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolrun","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Runner</code> <code>toolrun/runner.go:8</code> Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error) <code>ProgressRunner</code> <code>toolrun/runner.go:34</code> RunWithProgress(ctx context.Context, toolID string, args map[string]any, onProgress ProgressCallback) (RunResult, error)RunChainWithProgress(ctx context.Context, steps []ChainStep, onProgress ProgressCallback) (RunResult, []StepResult, error) <code>MCPExecutor</code> <code>toolrun/executor.go:11</code> CallTool(ctx context.Context, serverName string, params mcp.CallToolParams) (mcp.CallToolResult, error)CallToolStream(ctx context.Context, serverName string, params *mcp.CallToolParams) (&lt;-chan StreamEvent, error) <code>ProviderExecutor</code> <code>toolrun/executor.go:23</code> CallTool(ctx context.Context, providerID, toolID string, args map[string]any) (any, error)CallToolStream(ctx context.Context, providerID, toolID string, args map[string]any) (&lt;-chan StreamEvent, error) <code>LocalRegistry</code> <code>toolrun/executor.go:41</code> Get(name string) (LocalHandler, bool)"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolrun/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/","title":"toolcode","text":"<p><code>toolcode</code> executes short orchestration snippets over the tool stack. It exposes Search/Describe/Run helpers to code, enforces timeouts and limits, and records tool calls for observability.</p> <p></p>"},{"location":"library-docs-from-repos/toolcode/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolcode/#motivation","title":"Motivation","text":"<ul> <li>Programmable orchestration: loops, conditionals, fallbacks</li> <li>Uniform tool surface: same helpers regardless of backend</li> <li>Traceability: tool call records for debugging and audits</li> </ul>"},{"location":"library-docs-from-repos/toolcode/#key-apis","title":"Key APIs","text":"<ul> <li><code>Executor</code> interface (<code>ExecuteCode</code>)</li> <li><code>DefaultExecutor</code> implementation</li> <li><code>Engine</code> interface (pluggable runtime)</li> <li><code>ExecuteParams</code>, <code>ExecuteResult</code>, <code>ToolCallRecord</code></li> </ul>"},{"location":"library-docs-from-repos/toolcode/#quickstart","title":"Quickstart","text":"<pre><code>exec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n\nres, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/#usability-notes","title":"Usability notes","text":"<ul> <li><code>ExecuteParams</code> supports per-call timeouts</li> <li>Tool calls are capped via config and params</li> <li><code>ExecuteResult</code> includes tool call traces</li> </ul>"},{"location":"library-docs-from-repos/toolcode/#next","title":"Next","text":"<ul> <li>Execution pipeline: <code>architecture.md</code></li> <li>Config, limits, and params: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolcode/api/#executor","title":"Executor","text":"<pre><code>type Executor interface {\n  ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#executor-contract","title":"Executor contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honor cancellation/deadlines; deadline exceeded wraps <code>ErrLimitExceeded</code>.</li> <li>Errors: configuration failures return <code>ErrConfiguration</code>.</li> <li>Ownership: params are read-only; results are caller-owned snapshots.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/#engine","title":"Engine","text":"<pre><code>type Engine interface {\n  Execute(ctx context.Context, params ExecuteParams, tools Tools) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#engine-contract","title":"Engine contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honor cancellation/deadlines and return <code>ctx.Err()</code> when canceled.</li> <li>Errors: use <code>CodeError</code> where possible to include line/column metadata.</li> <li>Ownership: params/tools are read-only; results are caller-owned snapshots.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/#tools-surface","title":"Tools surface","text":"<pre><code>type Tools interface {\n  SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)\n  ListNamespaces(ctx context.Context) ([]string, error)\n  DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n  ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)\n  RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n  RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n  Println(args ...any)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#tools-contract","title":"Tools contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: methods honor cancellation/deadlines and return <code>ctx.Err()</code> when canceled.</li> <li>Ownership: args are read-only; results are caller-owned snapshots.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/#params-results","title":"Params + results","text":"<pre><code>type ExecuteParams struct {\n  Language     string\n  Code         string\n  Timeout      time.Duration\n  MaxToolCalls int\n}\n\ntype ExecuteResult struct {\n  Value      any\n  Stdout     string\n  Stderr     string\n  ToolCalls  []ToolCallRecord\n  DurationMs int64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#toolcallrecord","title":"ToolCallRecord","text":"<pre><code>type ToolCallRecord struct {\n  ToolID     string\n  Args       map[string]any\n  Structured any\n  BackendKind string\n  Error      string\n  ErrorOp    string\n  DurationMs int64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/api/#errors","title":"Errors","text":"<ul> <li><code>ErrConfiguration</code></li> <li><code>ErrLimitExceeded</code></li> <li><code>CodeError</code></li> </ul>"},{"location":"library-docs-from-repos/toolcode/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index          toolindex.Index\n  Docs           tooldocs.Store\n  Run            toolrun.Runner\n  Engine         Engine\n  DefaultTimeout time.Duration\n  DefaultLanguage string\n  MaxToolCalls   int\n  MaxChainSteps  int\n  Logger         Logger\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/architecture/","title":"Architecture","text":"<p><code>toolcode</code> wraps tool discovery, docs, and execution into a single programmable surface. The actual code execution is delegated to an injected <code>Engine</code>.</p>"},{"location":"library-docs-from-repos/toolcode/architecture/#execution-flow","title":"Execution flow","text":""},{"location":"library-docs-from-repos/toolcode/architecture/#snippet-lifecycle","title":"Snippet lifecycle","text":""},{"location":"library-docs-from-repos/toolcode/architecture/#control-points","title":"Control points","text":"<ul> <li><code>Config</code> controls limits and defaults</li> <li><code>Engine</code> controls the execution sandbox</li> <li><code>Tools</code> surface mediates tool calls and captures traces</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/","title":"Design Notes","text":"<p>This page explains the tradeoffs and error semantics behind <code>toolcode</code>.</p>"},{"location":"library-docs-from-repos/toolcode/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Engine abstraction. <code>toolcode</code> does not execute code directly. It delegates to a pluggable <code>Engine</code> so you can swap in different interpreters or sandboxes without changing the API.</li> <li>Narrow tools surface. Code snippets only see a constrained <code>Tools</code> interface (SearchTools, DescribeTool, RunTool, RunChain, Println). This limits what code can do and keeps behavior consistent.</li> <li>Limits-first design. Max tool calls and chain steps are enforced in the tools environment. Timeouts are enforced at the executor level.</li> <li>Structured observability. Every tool call is recorded with duration, backend kind, and error op for auditability.</li> <li>Default language. If not specified, <code>DefaultLanguage</code> is used (\"go\" by default), but the engine decides how that language is implemented.</li> <li>Deep copy normalization. Arguments and results are normalized to MCP-native shapes when recorded. Supported shapes include <code>map[string]any</code>, <code>[]any</code>, and common typed slices/maps; unsupported types are passed through without deep copy.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolcode</code> uses sentinel errors for predictable handling:</p> <ul> <li><code>ErrCodeExecution</code> \u2013 syntax/runtime errors in the snippet.</li> <li><code>ErrConfiguration</code> \u2013 missing required config (Index, Docs, Run, Engine).</li> <li><code>ErrLimitExceeded</code> \u2013 timeouts, max tool calls, or max chain steps exceeded.</li> </ul> <p><code>CodeError</code> wraps engine errors with optional line/column info.</p>"},{"location":"library-docs-from-repos/toolcode/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom engines: implement <code>Engine</code> for a sandboxed interpreter, WASM runtime, or remote execution service.</li> <li>Custom logging: provide a <code>Logger</code> to track tool calls and execution duration.</li> <li>Runtime integration: use <code>toolruntime/toolcodeengine</code> to run <code>toolcode</code> on top of secure runtime backends.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Keep snippets short and deterministic; <code>ExecuteParams</code> is intended for orchestration, not full applications.</li> <li>Use <code>MaxToolCalls</code> to prevent runaway tool usage in long snippets.</li> <li>Treat <code>Stdout</code> as diagnostic output only; use <code>Value</code> for structured results.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolcode/examples/#minimal-snippet","title":"Minimal snippet","text":"<pre><code>res, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/examples/#tool-selection-execution","title":"Tool selection + execution","text":"<pre><code>code := `\n  tools := SearchTools(\"get repo\", 3)\n  if len(tools) == 0 {\n    __out = \"no tools\"\n  } else {\n    __out = RunTool(tools[0].ID, map[string]any{\"owner\":\"octo\",\"repo\":\"hello\"})\n  }\n`\n\nres, _ := exec.ExecuteCode(ctx, toolcode.ExecuteParams{Language: \"go\", Code: code})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/examples/#chain-helper","title":"Chain helper","text":"<pre><code>steps := []ChainStep{\n  {ToolID: \"user:get\", Args: map[string]any{\"user_id\": \"123\"}},\n  {ToolID: \"orders:list\", UsePrevious: true},\n}\n\ncode := `__out = RunChain(steps)`\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolcode/usage/#configure-an-executor","title":"Configure an executor","text":"<pre><code>exec, err := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:          idx,\n  Docs:           docs,\n  Run:            runner,\n  Engine:         engine,\n  DefaultTimeout: 5 * time.Second,\n  MaxToolCalls:   32,\n  MaxChainSteps:  8,\n})\nif err != nil {\n  // handle config error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/#execute-a-snippet","title":"Execute a snippet","text":"<pre><code>res, err := exec.ExecuteCode(ctx, toolcode.ExecuteParams{\n  Language: \"go\",\n  Code: `\n    tools := SearchTools(\"repo\", 3)\n    repo := RunTool(tools[0].ID, map[string]any{\"owner\":\"o\",\"repo\":\"r\"})\n    __out = repo\n  `,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/usage/#limits","title":"Limits","text":"<ul> <li><code>MaxToolCalls</code> caps tool invocations per execution</li> <li><code>MaxChainSteps</code> caps chain length</li> <li><code>DefaultTimeout</code> applies when params omit a timeout</li> </ul>"},{"location":"library-docs-from-repos/toolcode/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolcode</code> enables end-to-end orchestration using code snippets.</p>"},{"location":"library-docs-from-repos/toolcode/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph input[\"Input\"]\n        Code[\"\ud83d\udcbb Code Snippet&lt;br/&gt;&lt;small&gt;SearchTools, RunTool, etc.&lt;/small&gt;\"]\n    end\n\n    subgraph executor[\"Executor\"]\n        Exec[\"\u2699\ufe0f toolcode.Executor\"]\n        Limits[\"\ud83d\udee1\ufe0f Limits&lt;br/&gt;&lt;small&gt;timeout, maxToolCalls&lt;/small&gt;\"]\n    end\n\n    subgraph engine[\"Engine\"]\n        Eng[\"\ud83d\udd27 Engine.Run()\"]\n        Tools[\"\ud83d\udd28 Tools Environment\"]\n    end\n\n    subgraph metatools[\"Metatool Surface\"]\n        Search[\"\ud83d\udd0d SearchTools()\"]\n        Describe[\"\ud83d\udcda DescribeTool()\"]\n        RunTool[\"\u25b6\ufe0f RunTool()\"]\n        RunChain[\"\ud83d\udd17 RunChain()\"]\n        Println[\"\ud83d\udda8\ufe0f Println()\"]\n    end\n\n    subgraph output[\"Output\"]\n        Result[\"\ud83d\udce6 ExecuteResult&lt;br/&gt;&lt;small&gt;Value + Stdout + ToolCalls[]&lt;/small&gt;\"]\n    end\n\n    Code --&gt; Exec --&gt; Limits --&gt; Eng --&gt; Tools\n    Tools --&gt; Search\n    Tools --&gt; Describe\n    Tools --&gt; RunTool\n    Tools --&gt; RunChain\n    Tools --&gt; Println\n    Search --&gt; Result\n    RunTool --&gt; Result\n    RunChain --&gt; Result\n\n    style input fill:#3182ce,stroke:#2c5282\n    style executor fill:#6b46c1,stroke:#553c9a,stroke-width:2px\n    style engine fill:#d69e2e,stroke:#b7791f\n    style metatools fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolcode/user-journey/#tool-call-recording","title":"Tool Call Recording","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e'}}}%%\nflowchart LR\n    subgraph snippet[\"Code Snippet\"]\n        Call1[\"RunTool('a', args)\"]\n        Call2[\"RunTool('b', args)\"]\n        Call3[\"RunChain([...])\"]\n    end\n\n    subgraph recording[\"Recording\"]\n        Rec[\"\ud83d\udcdd ToolCallRecord[]&lt;br/&gt;&lt;small&gt;ToolID, Args, Result,&lt;br/&gt;Backend, Duration&lt;/small&gt;\"]\n    end\n\n    subgraph result[\"ExecuteResult\"]\n        Value[\"Value: __out\"]\n        Stdout[\"Stdout: captured\"]\n        Calls[\"ToolCalls: [...]\"]\n    end\n\n    Call1 --&gt; Rec\n    Call2 --&gt; Rec\n    Call3 --&gt; Rec\n    Rec --&gt; Calls\n    snippet --&gt; Value\n    snippet --&gt; Stdout\n\n    style snippet fill:#6b46c1,stroke:#553c9a\n    style recording fill:#e53e3e,stroke:#c53030\n    style result fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolcode/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Agent submits a snippet to <code>execute_code</code>.</li> <li>Executor sets limits (timeout, tool call caps).</li> <li>Engine runs the snippet with a <code>Tools</code> environment.</li> <li>Snippet orchestrates tools via Search/Describe/Run APIs.</li> <li>Result is returned as <code>ExecuteResult</code> (Value + ToolCalls + Stdout).</li> </ol>"},{"location":"library-docs-from-repos/toolcode/user-journey/#example-pick-a-tool-and-run-it","title":"Example: pick a tool and run it","text":"<pre><code>code := `\nresults, _ := SearchTools(\"create issue\", 5)\nchoice := results[0]\n\nschema, _ := DescribeTool(choice.ID, \"schema\")\n_ = schema // use schema in real code\n\nres, _ := RunTool(choice.ID, map[string]any{\"title\": \"Bug\", \"body\": \"...\"})\n__out = res.Structured\n`\n\nexec, _ := toolcode.NewDefaultExecutor(cfg)\nresult, err := exec.ExecuteCode(ctx, toolcode.ExecuteParams{Code: code})\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>A deterministic orchestration surface with strong limits.</li> <li>Tool call traces for audit/debugging.</li> <li>Easy integration with secure runtimes via <code>toolruntime</code> adapters.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrConfiguration</code> if required dependencies are missing.</li> <li><code>ErrLimitExceeded</code> if timeouts or tool call caps are hit.</li> <li><code>ErrCodeExecution</code> if the engine rejects the snippet.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/","title":"toolcode Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolcode (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#logger","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Logf(format string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#tools","title":"Tools","text":"<pre><code>func TestTools_Contract(t *testing.T) {\n    // Methods:\n    // - SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)\n    // - ListNamespaces(ctx context.Context) ([]string, error)\n    // - DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n    // - ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)\n    // - RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n    // - RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n    // - Println(args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#engine","title":"Engine","text":"<pre><code>func TestEngine_Contract(t *testing.T) {\n    // Methods:\n    // - Execute(ctx context.Context, params ExecuteParams, tools Tools) (ExecuteResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-execution-plan/#executor","title":"Executor","text":"<pre><code>func TestExecutor_Contract(t *testing.T) {\n    // Methods:\n    // - ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolcode","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Logger</code> <code>toolcode/logger.go:5</code> Logf(format string, args ...any) <code>Tools</code> <code>toolcode/tools.go:19</code> SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)ListNamespaces(ctx context.Context) ([]string, error)DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)Println(args ...any) <code>Engine</code> <code>toolcode/engine.go:14</code> Execute(ctx context.Context, params ExecuteParams, tools Tools) (ExecuteResult, error) <code>Executor</code> <code>toolcode/executor.go:12</code> ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolcode/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/","title":"toolruntime","text":"<p><code>toolruntime</code> defines the runtime and trust boundary for executing code in <code>toolcode</code>. It routes execution to backends with configurable security profiles.</p> <p></p>"},{"location":"library-docs-from-repos/toolruntime/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#motivation","title":"Motivation","text":"<ul> <li>Isolation for untrusted or semi-trusted code</li> <li>Portability across environments (host, containers, VMs)</li> <li>Policy via explicit security profiles</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#key-apis","title":"Key APIs","text":"<ul> <li><code>Runtime</code> interface</li> <li><code>DefaultRuntime</code> implementation</li> <li><code>Backend</code> interface</li> <li><code>SecurityProfile</code> (dev/standard/hardened)</li> <li><code>ExecuteRequest</code> / <code>ExecuteResult</code></li> <li><code>backend/wasm</code> interfaces (Runner, ModuleLoader, HealthChecker, StreamRunner)</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#quickstart-dev","title":"Quickstart (dev)","text":"<pre><code>backend := unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess})\n\nrt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: backend,\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/#usability-notes","title":"Usability notes","text":"<ul> <li>Profiles keep policy separate from implementation</li> <li>Backends are swappable without changing the executor API</li> <li>Tool calls are mediated via the gateway interface</li> <li>WASM backends run in-process with explicit resource limits and no network by default</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/#next","title":"Next","text":"<ul> <li>Runtime pipeline and profiles: <code>architecture.md</code></li> <li>Backend configuration: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolruntime/api/#runtime","title":"Runtime","text":"<pre><code>type Runtime interface {\n  Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#runtime-contract","title":"Runtime contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honors cancellation/deadlines and returns <code>ctx.Err()</code> when canceled.</li> <li>Errors: request validation uses <code>ErrMissingGateway</code>/<code>ErrInvalidRequest</code>;   backend selection uses <code>ErrRuntimeUnavailable</code>/<code>ErrBackendDenied</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/#backend","title":"Backend","text":"<pre><code>type Backend interface {\n  Kind() BackendKind\n  Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#backend-contract","title":"Backend contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honors cancellation/deadlines and returns <code>ctx.Err()</code> when canceled.</li> <li>Errors: validation should return <code>ErrInvalidRequest</code> where applicable.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/#wasm-backend-interfaces","title":"WASM backend interfaces","text":"<pre><code>type Runner interface {\n  Run(ctx context.Context, spec Spec) (Result, error)\n}\n\ntype StreamRunner interface {\n  Runner\n  RunStream(ctx context.Context, spec Spec) (&lt;-chan StreamEvent, error)\n}\n\ntype ModuleLoader interface {\n  Load(ctx context.Context, binary []byte) (CompiledModule, error)\n  Close(ctx context.Context) error\n}\n\ntype HealthChecker interface {\n  Ping(ctx context.Context) error\n  Info(ctx context.Context) (RuntimeInfo, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#wasm-contract","title":"WASM contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use unless documented.</li> <li>Context: honors cancellation/deadlines and returns <code>ctx.Err()</code> when canceled.</li> <li>Streaming: <code>RunStream</code> returns a non-nil channel when <code>err == nil</code> and closes it on completion.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/#spec-result","title":"Spec / Result","text":"<pre><code>type Spec struct {\n  Module     []byte\n  EntryPoint string\n  Args       []string\n  Env        []string\n  Stdin      []byte\n  Mounts     []Mount\n  Resources  ResourceSpec\n  Security   SecuritySpec\n  Timeout    time.Duration\n  Labels     map[string]string\n}\n\ntype Result struct {\n  ExitCode     int\n  Stdout       string\n  Stderr       string\n  Duration     time.Duration\n  FuelConsumed uint64\n  MemoryUsed   uint64\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#securityprofile","title":"SecurityProfile","text":"<pre><code>type SecurityProfile string\nconst (\n  ProfileDev      SecurityProfile = \"dev\"\n  ProfileStandard SecurityProfile = \"standard\"\n  ProfileHardened SecurityProfile = \"hardened\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#executerequest-executeresult","title":"ExecuteRequest / ExecuteResult","text":"<pre><code>type ExecuteRequest struct {\n  Language string\n  Code     string\n  Args     map[string]any\n  Profile  SecurityProfile\n  Gateway  ToolGateway\n  Timeout  time.Duration\n}\n\ntype ExecuteResult struct {\n  Value      any\n  Stdout     string\n  Stderr     string\n  ToolCalls  []ToolCallRecord\n  Duration   time.Duration\n  Backend    BackendInfo\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#toolgateway","title":"ToolGateway","text":"<pre><code>type ToolGateway interface {\n  SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)\n  ListNamespaces(ctx context.Context) ([]string, error)\n  DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n  ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)\n  RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n  RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#toolgateway-contract","title":"ToolGateway contract","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honors cancellation/deadlines and returns <code>ctx.Err()</code> when canceled.</li> <li>Ownership: args are read-only; results are caller-owned snapshots.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/api/#runtimeconfig","title":"RuntimeConfig","text":"<pre><code>type RuntimeConfig struct {\n  Backends           map[SecurityProfile]Backend\n  DenyUnsafeProfiles []SecurityProfile\n  DefaultProfile     SecurityProfile\n  Logger             Logger\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/api/#errors","title":"Errors","text":"<ul> <li><code>ErrMissingGateway</code></li> <li><code>ErrInvalidRequest</code></li> <li><code>ErrRuntimeUnavailable</code></li> <li><code>ErrBackendDenied</code></li> </ul>"},{"location":"library-docs-from-repos/toolruntime/architecture/","title":"Architecture","text":"<p><code>toolruntime</code> is the execution boundary underneath <code>toolcode</code>. It chooses a backend based on the requested security profile.</p>"},{"location":"library-docs-from-repos/toolruntime/architecture/#runtime-selection","title":"Runtime selection","text":""},{"location":"library-docs-from-repos/toolruntime/architecture/#wasm-backend","title":"WASM backend","text":"<p>The WASM backend runs in-process using a pluggable runtime (wazero/wasmtime/wasmer). It relies on the <code>backend/wasm</code> interfaces for module loading, health checks, and streaming output, keeping runtime bindings out of core <code>toolruntime</code>.</p>"},{"location":"library-docs-from-repos/toolruntime/architecture/#execution-sequence","title":"Execution sequence","text":""},{"location":"library-docs-from-repos/toolruntime/architecture/#profiles","title":"Profiles","text":"<ul> <li><code>dev</code>: convenience, unsafe host allowed</li> <li><code>standard</code>: safer defaults, may deny unsafe backend</li> <li><code>hardened</code>: expected to require strong isolation</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>toolruntime</code>.</p>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>Runtime as router. <code>toolruntime</code> does not execute code itself; it routes requests to backends based on a security profile. This keeps policy separate from execution.</li> <li>Explicit security profiles. <code>dev</code>, <code>standard</code>, and <code>hardened</code> provide predictable isolation tiers. This trades flexibility for clarity and safer defaults.</li> <li>Gateway boundary. Executed code never talks to toolindex/tooldocs/toolrun directly. Instead it receives a <code>ToolGateway</code>, which preserves the trust boundary.</li> <li>Context propagation. Gateway operations check <code>ctx.Err()</code> and cancel early, so timeouts and cancellations flow through to tool discovery and execution calls.</li> <li>Backend diversity. Backends represent different isolation levels (host, containers, microVMs, WASM, remote). This lets deployments match security and performance needs.</li> <li>WASM isolation. WASM runs in-process with explicit resource limits and no network by default, trading stronger isolation for lower overhead.</li> <li>Limits are declarative. <code>Limits</code> are requested by the caller, and backends report which limits were actually enforced.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>toolruntime</code> uses sentinel errors for classification:</p> <ul> <li><code>ErrRuntimeUnavailable</code> \u2013 no backend exists for the requested profile.</li> <li><code>ErrBackendDenied</code> \u2013 policy denies the backend (e.g., unsafe host for hardened profile).</li> <li><code>ErrSandboxViolation</code> \u2013 sandbox policy was violated.</li> <li><code>ErrTimeout</code> \u2013 execution exceeded timeout.</li> <li><code>ErrResourceLimit</code> \u2013 resource limits exceeded.</li> <li><code>ErrMissingGateway</code> / <code>ErrMissingCode</code> \u2013 invalid <code>ExecuteRequest</code>.</li> <li><code>ErrInvalidLimits</code> \u2013 limits validation failed.</li> </ul> <p><code>RuntimeError</code> wraps backend failures with <code>BackendKind</code>, <code>Op</code>, and <code>Retryable</code>.</p>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom backends: implement <code>Backend</code> to integrate Docker, containerd, Kubernetes, gVisor, WASM, or a remote execution service.</li> <li>WASM contracts: <code>backend/wasm</code> defines <code>Runner</code>, <code>StreamRunner</code>, <code>ModuleLoader</code>, and <code>HealthChecker</code> to keep runtime-specific code outside toolruntime.</li> <li>Custom gateways: use <code>gateway/direct</code> for in-process execution or <code>gateway/proxy</code> for RPC-mediated execution.</li> <li>Toolcode integration: <code>toolcodeengine</code> adapts <code>toolruntime</code> into a <code>toolcode.Engine</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Use <code>ProfileStandard</code> by default; reserve <code>ProfileDev</code> for trusted environments.</li> <li>Enforce <code>DenyUnsafeProfiles</code> to prevent accidental unsafe execution.</li> <li>Report <code>LimitsEnforced</code> accurately so callers can detect degraded enforcement.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolruntime/examples/#toolcode-integration","title":"Toolcode integration","text":"<pre><code>engine, err := toolcodeengine.New(toolcodeengine.Config{\n  Runtime: rt,\n  Profile: toolruntime.ProfileDev,\n})\nif err != nil {\n  return err\n}\n\nexec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index:  idx,\n  Docs:   docs,\n  Run:    runner,\n  Engine: engine,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/examples/#inspect-tool-calls","title":"Inspect tool calls","text":"<pre><code>res, _ := rt.Execute(ctx, toolruntime.ExecuteRequest{\n  Language: \"go\",\n  Code:     \"__out = 1\",\n  Profile:  toolruntime.ProfileDev,\n  Gateway:  gw,\n})\n\nfor _, call := range res.ToolCalls {\n  fmt.Println(call.ToolID, call.Duration)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolruntime/usage/#create-a-runtime","title":"Create a runtime","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DefaultProfile: toolruntime.ProfileDev,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/#execute-code","title":"Execute code","text":"<pre><code>res, err := rt.Execute(ctx, toolruntime.ExecuteRequest{\n  Language: \"go\",\n  Code:     \"__out = 2 + 2\",\n  Profile:  toolruntime.ProfileDev,\n  Gateway:  gw,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/#wasm-backend-interface","title":"WASM backend (interface)","text":"<p><code>toolruntime</code> defines the WASM backend interface in <code>backend/wasm</code>. You can wire any compliant runtime (wazero/wasmtime/wasmer) by supplying a <code>Runner</code> implementation.</p> <pre><code>wasmBackend := wasm.New(wasm.Config{\n  Runtime:    \"wazero\",\n  EnableWASI: true,\n  Client:     myWasmRunner, // implements wasm.Runner\n})\n\nrt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileStandard: wasmBackend,\n  },\n  DefaultProfile: toolruntime.ProfileStandard,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/usage/#deny-unsafe-backend","title":"Deny unsafe backend","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileDev: unsafe.New(unsafe.Config{Mode: unsafe.ModeSubprocess}),\n  },\n  DenyUnsafeProfiles: []toolruntime.SecurityProfile{toolruntime.ProfileStandard},\n  DefaultProfile:     toolruntime.ProfileStandard,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolruntime</code> powers secure code execution in the broader stack.</p>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph config[\"Configuration\"]\n        Cfg[\"\u2699\ufe0f RuntimeConfig\"]\n        Profiles[\"\ud83d\udd12 Security Profiles&lt;br/&gt;&lt;small&gt;Dev | Standard | Hardened&lt;/small&gt;\"]\n    end\n\n    subgraph runtime[\"toolruntime.Runtime\"]\n        Router[\"\ud83d\udd00 Backend Router\"]\n    end\n\n    subgraph backends[\"Execution Backends\"]\n        Unsafe[\"\u26a0\ufe0f UnsafeHost&lt;br/&gt;&lt;small&gt;dev only&lt;/small&gt;\"]\n        Docker[\"\ud83d\udc33 Docker&lt;br/&gt;&lt;small&gt;container isolation&lt;/small&gt;\"]\n        K8s[\"\u2638\ufe0f Kubernetes&lt;br/&gt;&lt;small&gt;short-lived pods&lt;/small&gt;\"]\n        GVisor[\"\ud83d\udee1\ufe0f gVisor&lt;br/&gt;&lt;small&gt;user-space kernel&lt;/small&gt;\"]\n        Kata[\"\ud83d\udd10 Kata&lt;br/&gt;&lt;small&gt;lightweight VMs&lt;/small&gt;\"]\n        WASM[\"\ud83c\udf10 WASM&lt;br/&gt;&lt;small&gt;in-process sandbox&lt;/small&gt;\"]\n    end\n\n    subgraph gateway[\"Tool Gateway\"]\n        TG[\"\ud83d\udeaa ToolGateway&lt;br/&gt;&lt;small&gt;only allowed surface&lt;/small&gt;\"]\n        Search[\"SearchTools()\"]\n        Describe[\"DescribeTool()\"]\n        RunTool[\"RunTool()\"]\n    end\n\n    subgraph output[\"Output\"]\n        Result[\"\ud83d\udce6 ExecuteResult&lt;br/&gt;&lt;small&gt;+ LimitsEnforced&lt;/small&gt;\"]\n    end\n\n    Cfg --&gt; Profiles --&gt; Router\n    Router --&gt;|dev| Unsafe\n    Router --&gt;|standard| Docker\n    Router --&gt;|standard| K8s\n    Router --&gt;|hardened| GVisor\n    Router --&gt;|hardened| Kata\n    Router --&gt;|any| WASM\n\n    Docker --&gt; TG\n    K8s --&gt; TG\n    GVisor --&gt; TG\n    WASM --&gt; TG\n\n    TG --&gt; Search\n    TG --&gt; Describe\n    TG --&gt; RunTool\n    TG --&gt; Result\n\n    style config fill:#718096,stroke:#4a5568\n    style runtime fill:#e53e3e,stroke:#c53030,stroke-width:2px\n    style backends fill:#6b46c1,stroke:#553c9a\n    style gateway fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#security-profiles","title":"Security Profiles","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e'}}}%%\nflowchart LR\n    subgraph dev[\"ProfileDev\"]\n        D1[\"\u26a0\ufe0f Minimal restrictions\"]\n        D2[\"Direct host access\"]\n        D3[\"No isolation\"]\n    end\n\n    subgraph standard[\"ProfileStandard\"]\n        S1[\"\ud83d\udd12 No network egress\"]\n        S2[\"Read-only rootfs\"]\n        S3[\"Container isolation\"]\n    end\n\n    subgraph hardened[\"ProfileHardened\"]\n        H1[\"\ud83d\udee1\ufe0f seccomp filters\"]\n        H2[\"gVisor/Kata/microVM\"]\n        H3[\"Maximum isolation\"]\n    end\n\n    dev --&gt;|\"upgrade\"| standard --&gt;|\"upgrade\"| hardened\n\n    style dev fill:#d69e2e,stroke:#b7791f\n    style standard fill:#3182ce,stroke:#2c5282\n    style hardened fill:#e53e3e,stroke:#c53030</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Configure runtime with backends keyed by security profile.</li> <li>Wrap tool access using a <code>ToolGateway</code> (direct or proxy).</li> <li>Execute request is routed to the backend based on profile.</li> <li>Backend runs code with controlled access to tools via the gateway.</li> <li>Result and tool calls are returned, with <code>LimitsEnforced</code> indicating actual enforcement.</li> </ol>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#example-wire-runtime-to-toolcode","title":"Example: wire runtime to toolcode","text":"<pre><code>rt := toolruntime.NewDefaultRuntime(toolruntime.RuntimeConfig{\n  Backends: map[toolruntime.SecurityProfile]toolruntime.Backend{\n    toolruntime.ProfileStandard: mySandboxBackend,\n  },\n  DefaultProfile: toolruntime.ProfileStandard,\n})\n\nengine, err := toolcodeengine.New(toolcodeengine.Config{\n  Runtime: rt,\n  Profile: toolruntime.ProfileStandard,\n})\nif err != nil {\n  return err\n}\n\nexec, _ := toolcode.NewDefaultExecutor(toolcode.Config{\n  Index: idx,\n  Docs:  docs,\n  Run:   runner,\n  Engine: engine,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Clear security posture by profile.</li> <li>Consistent tool access via a gateway boundary.</li> <li>Transparent limit enforcement reporting.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li><code>ErrRuntimeUnavailable</code> if no backend is registered for the profile.</li> <li><code>ErrBackendDenied</code> when policy blocks unsafe backends.</li> <li><code>ErrTimeout</code> / <code>ErrResourceLimit</code> on enforced limits.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/","title":"toolruntime Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolruntime (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#backend","title":"Backend","text":"<pre><code>func TestBackend_Contract(t *testing.T) {\n    // Methods:\n    // - Kind() BackendKind\n    // - Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#runtime","title":"Runtime","text":"<pre><code>func TestRuntime_Contract(t *testing.T) {\n    // Methods:\n    // - Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#toolcallrecorder","title":"toolCallRecorder","text":"<pre><code>func TesttoolCallRecorder_Contract(t *testing.T) {\n    // Methods:\n    // - GetToolCalls() []ToolCallRecord\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#toolgateway","title":"ToolGateway","text":"<pre><code>func TestToolGateway_Contract(t *testing.T) {\n    // Methods:\n    // - SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)\n    // - ListNamespaces(ctx context.Context) ([]string, error)\n    // - DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)\n    // - ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)\n    // - RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)\n    // - RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#connection","title":"Connection","text":"<pre><code>func TestConnection_Contract(t *testing.T) {\n    // Methods:\n    // - Send(ctx context.Context, msg Message) error\n    // - Receive(ctx context.Context) (Message, error)\n    // - Close() error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#codec","title":"Codec","text":"<pre><code>func TestCodec_Contract(t *testing.T) {\n    // Methods:\n    // - Encode(msg Message) ([]byte, error)\n    // - Decode(data []byte) (Message, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_1","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_2","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_3","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_4","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_5","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_6","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_7","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_8","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_9","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-execution-plan/#logger_10","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(msg string, args ...any)\n    // - Warn(msg string, args ...any)\n    // - Error(msg string, args ...any)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolruntime","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Backend</code> <code>toolruntime/backend.go:7</code> Kind() BackendKindExecute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error) <code>Runtime</code> <code>toolruntime/runtime.go:12</code> Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error) <code>Logger</code> <code>toolruntime/runtime.go:38</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>toolCallRecorder</code> <code>toolruntime/runtime.go:56</code> GetToolCalls() []ToolCallRecord <code>ToolGateway</code> <code>toolruntime/types.go:260</code> SearchTools(ctx context.Context, query string, limit int) ([]toolindex.Summary, error)ListNamespaces(ctx context.Context) ([]string, error)DescribeTool(ctx context.Context, id string, level tooldocs.DetailLevel) (tooldocs.ToolDoc, error)ListToolExamples(ctx context.Context, id string, maxExamples int) ([]tooldocs.ToolExample, error)RunTool(ctx context.Context, id string, args map[string]any) (toolrun.RunResult, error)RunChain(ctx context.Context, steps []toolrun.ChainStep) (toolrun.RunResult, []toolrun.StepResult, error) <code>Connection</code> <code>toolruntime/gateway/proxy/protocol.go:32</code> Send(ctx context.Context, msg Message) errorReceive(ctx context.Context) (Message, error)Close() error <code>Codec</code> <code>toolruntime/gateway/proxy/protocol.go:44</code> Encode(msg Message) ([]byte, error)Decode(data []byte) (Message, error) <code>Logger</code> <code>toolruntime/backend/temporal/temporal.go:31</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/docker/docker.go:64</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/gvisor/gvisor.go:27</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/containerd/containerd.go:27</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/wasm/wasm.go:30</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/unsafe/unsafe.go:46</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/kata/kata.go:27</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/firecracker/firecracker.go:28</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/kubernetes/kubernetes.go:27</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any) <code>Logger</code> <code>toolruntime/backend/remote/remote.go:27</code> Info(msg string, args ...any)Warn(msg string, args ...any)Error(msg string, args ...any)"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolruntime/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/","title":"toolsearch","text":"<p><code>toolsearch</code> provides higher-quality search strategies for <code>toolindex</code> while keeping heavy dependencies out of the core registry. Today it ships a BM25 searcher backed by Bleve.</p> <p></p>"},{"location":"library-docs-from-repos/toolsearch/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#motivation","title":"Motivation","text":"<ul> <li>Keep toolindex small while enabling stronger ranking</li> <li>Experiment safely with search without changing core behavior</li> <li>Deterministic results for stable agent behavior</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#key-apis","title":"Key APIs","text":"<ul> <li><code>BM25Searcher</code> (implements <code>toolindex.Searcher</code>)</li> <li><code>BM25Config</code> for ranking and safety caps</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#interface-contracts","title":"Interface Contracts","text":"<ul> <li><code>BM25Searcher</code> is deterministic and safe for concurrent use.</li> <li>Implements <code>toolindex.Searcher</code> and <code>toolindex.DeterministicSearcher</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#quickstart","title":"Quickstart","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/#usability-notes","title":"Usability notes","text":"<ul> <li>Deterministic ordering avoids jitter in tool selection</li> <li>Index fingerprinting avoids rebuilds on no-op updates</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/#next","title":"Next","text":"<ul> <li>Ranking pipeline: <code>architecture.md</code></li> <li>Configuration and caps: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolsearch/api/#bm25config","title":"BM25Config","text":"<pre><code>type BM25Config struct {\n  NameBoost      int\n  NamespaceBoost int\n  TagsBoost      int\n  MaxDocs        int\n  MaxDocTextLen  int\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/api/#bm25searcher","title":"BM25Searcher","text":"<pre><code>type BM25Searcher struct {}\n\nfunc NewBM25Searcher(cfg BM25Config) *BM25Searcher\n\n// implements toolindex.Searcher\nfunc (s *BM25Searcher) Search(query string, limit int, docs []toolindex.SearchDoc) ([]toolindex.Summary, error)\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/architecture/","title":"Architecture","text":"<p><code>toolsearch</code> is a pluggable search strategy for <code>toolindex</code>.</p>"},{"location":"library-docs-from-repos/toolsearch/architecture/#indexing-flow","title":"Indexing flow","text":""},{"location":"library-docs-from-repos/toolsearch/architecture/#search-sequence","title":"Search sequence","text":""},{"location":"library-docs-from-repos/toolsearch/architecture/#determinism","title":"Determinism","text":"<ul> <li>Docs are sorted by ID before indexing</li> <li>Tie-breaking uses score DESC, then ID ASC</li> <li>Fingerprints ensure stable caching</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>toolsearch</code>.</p>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>BM25 via Bleve. <code>toolsearch</code> uses Bleve's BM25 implementation for a strong lexical baseline without bringing in a full search stack.</li> <li>Field weighting by duplication. Instead of multi-field indexing, the searcher builds a single weighted document by duplicating name/namespace/tag tokens. This keeps the index schema simple and predictable.</li> <li>Deterministic ordering. Documents are sorted by tool ID before indexing. Ties are broken by tool ID to avoid nondeterministic results.</li> <li>In-memory index. Uses Bleve's in-memory index for speed and simplicity; this trades persistence for low overhead.</li> <li>Fingerprint-based rebuild. Index rebuilds only when the tool set changes (based on a fingerprint), reducing overhead for repeated searches.</li> <li>Safe query parsing. Uses a plain <code>MatchQuery</code> (no operator syntax) to prevent query syntax injection.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#error-semantics","title":"Error semantics","text":"<ul> <li>BM25 search returns standard <code>error</code> values from Bleve.</li> <li><code>Search</code> returns empty slices on empty queries or no docs; it does not treat these as errors.</li> <li><code>Close</code> frees index resources; callers should treat errors from <code>Close</code> as operational warnings.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Custom weights: configure <code>NameBoost</code>, <code>NamespaceBoost</code>, and <code>TagsBoost</code>.</li> <li>Safety caps: limit search surface with <code>MaxDocs</code> or <code>MaxDocTextLen</code>.</li> <li>Alternative engines: implement <code>toolindex.Searcher</code> to swap BM25 out for semantic search later.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/design-notes/#operational-guidance","title":"Operational guidance","text":"<ul> <li>Start with BM25 if lexical search quality matters; switch to semantic only if needed.</li> <li>Keep <code>MaxDocTextLen</code> modest to avoid oversized indices from long descriptions.</li> <li>Use deterministic doc ordering to keep search results stable across deploys.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/toolsearch/examples/#deterministic-ranking","title":"Deterministic ranking","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{})\nidx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n\nresults, _ := idx.Search(\"repo\", 10)\n// results are deterministic across runs\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/examples/#custom-boosts","title":"Custom boosts","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{\n  NameBoost:      5,\n  NamespaceBoost: 3,\n  TagsBoost:      1,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/toolsearch/usage/#configure-bm25","title":"Configure BM25","text":"<pre><code>searcher := toolsearch.NewBM25Searcher(toolsearch.BM25Config{\n  NameBoost:      3,\n  NamespaceBoost: 2,\n  TagsBoost:      2,\n  MaxDocs:        5000,\n  MaxDocTextLen:  2000,\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/#inject-into-toolindex","title":"Inject into toolindex","text":"<pre><code>idx := toolindex.NewInMemoryIndex(toolindex.IndexOptions{Searcher: searcher})\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/usage/#safety-controls","title":"Safety controls","text":"<ul> <li><code>MaxDocs</code>: cap indexed documents</li> <li><code>MaxDocTextLen</code>: truncate long descriptions</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/user-journey/","title":"User Journey","text":"<p>This journey shows how <code>toolsearch</code> slots into the end-to-end workflow as a pluggable search engine.</p>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#end-to-end-flow-stack-view","title":"End-to-end flow (stack view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#d69e2e', 'primaryTextColor': '#fff'}}}%%\nflowchart TB\n    subgraph config[\"Configuration\"]\n        Env[\"\ud83d\udd27 Environment Variables\"]\n        Strategy[\"METATOOLS_SEARCH_STRATEGY=bm25\"]\n        Boosts[\"Field Boosts:&lt;br/&gt;&lt;small&gt;name: 4x, namespace: 2x, tags: 1x&lt;/small&gt;\"]\n    end\n\n    subgraph index[\"toolindex\"]\n        Docs[\"\ud83d\udcc4 SearchDoc[]&lt;br/&gt;&lt;small&gt;ID, Name, Namespace,&lt;br/&gt;Description, Tags&lt;/small&gt;\"]\n    end\n\n    subgraph searcher[\"toolsearch.BM25Searcher\"]\n        BM[\"\ud83d\udd0d BM25 Algorithm\"]\n        Bleve[\"\ud83d\udcca Bleve Index&lt;br/&gt;&lt;small&gt;auto-rebuild on change&lt;/small&gt;\"]\n        Score[\"\ud83c\udfc6 Score + Rank\"]\n    end\n\n    subgraph output[\"Results\"]\n        Results[\"\ud83d\udccb Summary[]&lt;br/&gt;&lt;small&gt;deterministic ordering&lt;/small&gt;\"]\n    end\n\n    Env --&gt; Strategy --&gt; Boosts\n    Boosts --&gt; BM\n    Docs --&gt; Bleve --&gt; BM --&gt; Score --&gt; Results\n\n    style config fill:#718096,stroke:#4a5568\n    style index fill:#3182ce,stroke:#2c5282\n    style searcher fill:#d69e2e,stroke:#b7791f,stroke-width:2px\n    style output fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#search-strategy-interface","title":"Search Strategy Interface","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#3182ce'}}}%%\nflowchart LR\n    subgraph interface[\"Searcher Interface\"]\n        Search[\"Search(docs, query, limit)\"]\n    end\n\n    subgraph implementations[\"Implementations\"]\n        Lexical[\"\ud83d\udcdd Lexical&lt;br/&gt;&lt;small&gt;simple substring&lt;/small&gt;\"]\n        BM25[\"\ud83d\udd0d BM25&lt;br/&gt;&lt;small&gt;TF-IDF ranking&lt;/small&gt;\"]\n        Semantic[\"\ud83e\udde0 Semantic&lt;br/&gt;&lt;small&gt;vector similarity&lt;/small&gt;\"]\n    end\n\n    subgraph index[\"toolindex\"]\n        Plug[\"\ud83d\udd0c Pluggable&lt;br/&gt;&lt;small&gt;WithSearcher()&lt;/small&gt;\"]\n    end\n\n    interface --&gt; Lexical\n    interface --&gt; BM25\n    interface --&gt; Semantic\n\n    Lexical --&gt; Plug\n    BM25 --&gt; Plug\n    Semantic --&gt; Plug\n\n    style interface fill:#3182ce,stroke:#2c5282\n    style implementations fill:#d69e2e,stroke:#b7791f\n    style index fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Enable BM25 in <code>metatools-mcp</code> using the <code>toolsearch</code> build tag.</li> <li>Set env vars (e.g., <code>METATOOLS_SEARCH_STRATEGY=bm25</code>).</li> <li>Search requests now flow through the BM25 searcher.</li> </ol>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#example-configure-bm25-via-env","title":"Example: configure BM25 via env","text":"<pre><code># build with toolsearch support\nGOFLAGS=\"-tags=toolsearch\" go build ./cmd/metatools\n\n# choose BM25 strategy at runtime\nexport METATOOLS_SEARCH_STRATEGY=bm25\nexport METATOOLS_SEARCH_BM25_NAME_BOOST=4\nexport METATOOLS_SEARCH_BM25_TAGS_BOOST=2\n</code></pre>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Higher-quality lexical ranking for tool discovery.</li> <li>Deterministic ordering and tie-breaking.</li> <li>No API changes required in <code>toolindex</code> or <code>metatools-mcp</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Build without the <code>toolsearch</code> tag and request <code>bm25</code> strategy (fails fast).</li> <li>Oversized tool descriptions if <code>MaxDocTextLen</code> is not capped.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/","title":"toolsearch Plans","text":"Item File Status PRD-001 <code>2026-01-30-prd-001-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-001-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/","title":"PRD-001 Execution Plan \u2014 toolsearch (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-001-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":"<p>No interfaces in this repo; add a verification test to assert zero interfaces or document N/A.</p>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/","title":"PRD-001 Interface Contracts \u2014 toolsearch","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"<p>This repo defines no Go interfaces; the work is verification-only.</p>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolsearch/plans/2026-01-30-prd-001-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/","title":"toolobserve","text":"<p>Observability primitives for tool execution: tracing, metrics, and structured logs.</p>"},{"location":"library-docs-from-repos/toolobserve/#overview","title":"Overview","text":"<p>toolobserve provides OpenTelemetry-based instrumentation that can be attached to <code>toolrun</code>, <code>toolruntime</code>, and <code>metatools-mcp</code> via middleware. It is pure observability: no execution, no I/O, no network beyond exporter setup.</p>"},{"location":"library-docs-from-repos/toolobserve/#design-goals","title":"Design Goals","text":"<ol> <li>Deterministic telemetry: stable span/metric names and attributes</li> <li>Context propagation: instrumentation preserves <code>context.Context</code></li> <li>Low overhead: opt-in exporters and sampling support</li> <li>Thread safety: safe under concurrent tool execution</li> <li>Minimal dependencies: OTel SDK only; no server/transport coupling</li> </ol>"},{"location":"library-docs-from-repos/toolobserve/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolrun/toolruntime --&gt; toolobserve --&gt; exporters (OTLP/Jaeger/Prometheus)\n                          \\\n                           -&gt; metatools-mcp middleware\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#api-reference","title":"API Reference","text":""},{"location":"library-docs-from-repos/toolobserve/#core-types","title":"Core Types","text":"Type Purpose <code>Config</code> Observability configuration (exporters, sampling) <code>Observer</code> Central entry point for tracing/metrics/logs <code>ToolMeta</code> Tool metadata for telemetry attribution <code>Middleware</code> Wraps execution with tracing, metrics, logging <code>Tracer</code> Span creation and context propagation <code>Metrics</code> Counters and histograms for tool execution <code>Logger</code> Structured log emission with tool context"},{"location":"library-docs-from-repos/toolobserve/#config","title":"Config","text":"<pre><code>type Config struct {\n    ServiceName string         // Required: service name for telemetry\n    Version     string         // Optional: service version\n    Tracing     TracingConfig  // Tracing configuration\n    Metrics     MetricsConfig  // Metrics configuration\n    Logging     LoggingConfig  // Logging configuration\n}\n\ntype TracingConfig struct {\n    Enabled   bool    // Enable tracing\n    Exporter  string  // stdout|otlp|jaeger|none\n    SamplePct float64 // 0.0-1.0 sampling rate\n}\n\ntype MetricsConfig struct {\n    Enabled  bool   // Enable metrics\n    Exporter string // stdout|otlp|prometheus|none\n}\n\ntype LoggingConfig struct {\n    Enabled bool   // Enable logging\n    Level   string // debug|info|warn|error\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#observer","title":"Observer","text":"<pre><code>type Observer interface {\n    Tracer() trace.Tracer     // OpenTelemetry tracer\n    Meter() metric.Meter      // OpenTelemetry meter\n    Logger() Logger           // Structured logger\n    Shutdown(ctx context.Context) error\n}\n\n// Create an observer\nobserver, err := toolobserve.NewObserver(ctx, cfg)\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#toolmeta","title":"ToolMeta","text":"<pre><code>type ToolMeta struct {\n    ID        string   // Fully qualified tool ID (optional, derived if empty)\n    Namespace string   // Tool namespace (e.g., \"github\")\n    Name      string   // Tool name (required)\n    Version   string   // Tool version\n    Tags      []string // Tags for discovery\n    Category  string   // Tool category\n}\n\n// Methods\nmeta.SpanName() string  // Returns \"tool.exec.&lt;namespace&gt;.&lt;name&gt;\"\nmeta.ToolID() string    // Returns \"&lt;namespace&gt;.&lt;name&gt;\" or just \"&lt;name&gt;\"\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#middleware","title":"Middleware","text":"<pre><code>type ExecuteFunc func(ctx context.Context, tool ToolMeta, input any) (any, error)\n\ntype Middleware struct {\n    // ...\n}\n\n// Create middleware from components\nmw := toolobserve.NewMiddleware(tracer, metrics, logger)\n\n// Or create from observer\nmw, err := toolobserve.MiddlewareFromObserver(observer)\n\n// Wrap execution function\nwrapped := mw.Wrap(myExecuteFunc)\n\n// Execute with full observability\nresult, err := wrapped(ctx, meta, input)\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#logger","title":"Logger","text":"<pre><code>type Logger interface {\n    Info(ctx context.Context, msg string, fields ...Field)\n    Warn(ctx context.Context, msg string, fields ...Field)\n    Error(ctx context.Context, msg string, fields ...Field)\n    Debug(ctx context.Context, msg string, fields ...Field)\n    WithTool(meta ToolMeta) Logger\n}\n\ntype Field struct {\n    Key   string\n    Value any\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Observer: thread-safe; <code>Shutdown</code> honors context and is idempotent.</li> <li>Tracer: thread-safe; <code>StartSpan</code> honors context; <code>EndSpan</code> is best-effort.</li> <li>Metrics: thread-safe; <code>RecordExecution</code> is best-effort and must not panic.</li> <li>Logger: thread-safe; logging is best-effort and must not panic; <code>WithTool</code> returns a non-nil logger.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/#usage-examples","title":"Usage Examples","text":""},{"location":"library-docs-from-repos/toolobserve/#basic-setup","title":"Basic Setup","text":"<pre><code>cfg := toolobserve.Config{\n    ServiceName: \"metatools\",\n    Version:     \"1.0.0\",\n    Tracing: toolobserve.TracingConfig{\n        Enabled:   true,\n        Exporter:  \"stdout\",\n        SamplePct: 1.0,\n    },\n    Metrics: toolobserve.MetricsConfig{\n        Enabled:  true,\n        Exporter: \"prometheus\",\n    },\n    Logging: toolobserve.LoggingConfig{\n        Enabled: true,\n        Level:   \"info\",\n    },\n}\n\nobserver, err := toolobserve.NewObserver(ctx, cfg)\nif err != nil {\n    log.Fatal(err)\n}\ndefer observer.Shutdown(ctx)\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#with-otlp-backend","title":"With OTLP Backend","text":"<pre><code>// Set environment variable\nos.Setenv(\"OTEL_EXPORTER_OTLP_ENDPOINT\", \"http://localhost:4317\")\n\ncfg := toolobserve.Config{\n    ServiceName: \"metatools\",\n    Tracing: toolobserve.TracingConfig{\n        Enabled:   true,\n        Exporter:  \"otlp\",\n        SamplePct: 0.1, // 10% sampling\n    },\n    Metrics: toolobserve.MetricsConfig{\n        Enabled:  true,\n        Exporter: \"otlp\",\n    },\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#integration-with-toolrun","title":"Integration with toolrun","text":"<pre><code>// Wrap a toolrun executor\nexecutor := func(ctx context.Context, tool toolobserve.ToolMeta, input any) (any, error) {\n    // Call toolrun.Run() here\n    return toolrun.Run(ctx, toolID, args)\n}\n\nmw, _ := toolobserve.MiddlewareFromObserver(observer)\ninstrumentedExecutor := mw.Wrap(executor)\n\n// All executions now emit spans, metrics, and logs\nresult, err := instrumentedExecutor(ctx, meta, input)\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#telemetry-output","title":"Telemetry Output","text":""},{"location":"library-docs-from-repos/toolobserve/#spans","title":"Spans","text":"<pre><code>Span: tool.exec.github.create_issue\n  Attributes:\n    tool.id: github.create_issue\n    tool.namespace: github\n    tool.name: create_issue\n    tool.version: 1.0.0\n    tool.error: false\n  Duration: 150ms\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#metrics","title":"Metrics","text":"<pre><code>tool.exec.total{tool.id=\"github.create_issue\"} 42\ntool.exec.errors{tool.id=\"github.create_issue\"} 3\ntool.exec.duration_ms{tool.id=\"github.create_issue\"} histogram\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#logs","title":"Logs","text":"<pre><code>{\n  \"timestamp\": \"2026-01-29T12:00:00Z\",\n  \"level\": \"info\",\n  \"msg\": \"tool execution completed\",\n  \"tool.id\": \"github.create_issue\",\n  \"tool.namespace\": \"github\",\n  \"tool.name\": \"create_issue\",\n  \"duration_ms\": 150.5\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/#versioning","title":"Versioning","text":"<p>toolobserve follows semantic versioning aligned with the stack. The source of truth is <code>ai-tools-stack/go.mod</code>, and <code>VERSIONS.md</code> is synchronized across repos.</p>"},{"location":"library-docs-from-repos/toolobserve/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes</li> <li>User Journey</li> <li>Plans</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/","title":"Design Notes: Observability Boundaries","text":""},{"location":"library-docs-from-repos/toolobserve/design-notes/#core-principles","title":"Core Principles","text":"<ul> <li>No execution logic: toolobserve never executes tools; it only observes.</li> <li>Pure instrumentation: create spans/metrics/logs around provided callbacks.</li> <li>Context-first: all APIs accept <code>context.Context</code> and propagate it.</li> <li>Zero side effects by default: exporters are opt-in and configurable.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/#telemetry-naming","title":"Telemetry Naming","text":"<ul> <li>Spans follow <code>tool.&lt;namespace&gt;.&lt;name&gt;</code> naming.</li> <li>Attributes include <code>tool.id</code>, <code>tool.namespace</code>, <code>tool.name</code>, <code>tool.version</code>.</li> <li>Metrics use stable names (<code>tool.exec.duration_ms</code>, <code>tool.exec.errors_total</code>).</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/#error-semantics","title":"Error Semantics","text":"<ul> <li>Errors are recorded on spans and emitted as structured log fields.</li> <li>No panics; errors are returned to callers and logged with context.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/#exporter-strategy","title":"Exporter Strategy","text":"<ul> <li>Exporter config is declarative and validated at startup.</li> <li>Multiple exporters can be enabled simultaneously.</li> <li>Exporter failures do not crash the process; they are logged.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/#concurrency","title":"Concurrency","text":"<ul> <li>Observer and metric registries are safe under concurrent use.</li> <li>Middleware must be re-entrant and avoid shared mutable state.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/design-notes/#integration-points","title":"Integration Points","text":"<ul> <li><code>toolrun</code>: wrap <code>RunTool</code> and <code>RunChain</code> execution.</li> <li><code>toolruntime</code>: wrap backend execution calls.</li> <li><code>metatools-mcp</code>: wire middleware in server pipeline.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/user-journey/","title":"User Journey: Observability for Tool Execution","text":""},{"location":"library-docs-from-repos/toolobserve/user-journey/#scenario","title":"Scenario","text":"<p>You want to instrument tool execution with tracing and metrics, exporting to OTLP for traces and Prometheus for metrics. You also want structured logs for failed tool calls.</p>"},{"location":"library-docs-from-repos/toolobserve/user-journey/#step-1-configure-observer","title":"Step 1: Configure observer","text":"<pre><code>cfg := toolobserve.Config{\n    ServiceName: \"metatools\",\n    Version:     \"0.1.0\",\n    Tracing: toolobserve.TracingConfig{\n        Enabled:  true,\n        Exporter: \"otlp\",\n    },\n    Metrics: toolobserve.MetricsConfig{\n        Enabled:  true,\n        Exporter: \"prometheus\",\n    },\n    Logging: toolobserve.LoggingConfig{Enabled: true},\n}\nobserver, _ := toolobserve.NewObserver(cfg)\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/user-journey/#step-2-wrap-execution","title":"Step 2: Wrap execution","text":"<pre><code>mw := toolobserve.NewMiddleware(observer)\nwrapped := mw.Wrap(toolrunExecutor)\n_ = wrapped\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/user-journey/#step-3-inspect-telemetry","title":"Step 3: Inspect telemetry","text":"<ul> <li>Spans appear as <code>tool.mcp.search</code> with duration and error tags.</li> <li>Metrics show execution counts and latency histograms.</li> <li>Logs include tool ID, inputs (redacted), and error messages.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/user-journey/#flow-diagram","title":"Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e'}}}%%\nflowchart LR\n    subgraph input[\"Input\"]\n        A[\"\ud83d\udce5 Tool Call\"]\n    end\n\n    subgraph middleware[\"Middleware Layer\"]\n        B[\"\ud83d\udd00 Middleware.Wrap()\"]\n        C[\"\ud83d\udc41\ufe0f Observer\"]\n    end\n\n    subgraph telemetry[\"Telemetry\"]\n        D[\"\ud83d\udd0d Tracing&lt;br/&gt;&lt;small&gt;tool.exec.{ns}.{name}&lt;/small&gt;\"]\n        E[\"\ud83d\udcca Metrics&lt;br/&gt;&lt;small&gt;counters, histograms&lt;/small&gt;\"]\n        F[\"\ud83d\udcdd Logging&lt;br/&gt;&lt;small&gt;structured fields&lt;/small&gt;\"]\n    end\n\n    subgraph exporters[\"Exporters\"]\n        G[\"\ud83d\udce1 OTLP\"]\n        H[\"\ud83d\udcc8 Prometheus\"]\n        I[\"\ud83d\udd0d Jaeger\"]\n        J[\"\ud83d\udda5\ufe0f Stdout\"]\n    end\n\n    A --&gt; B --&gt; C\n    C --&gt; D\n    C --&gt; E\n    C --&gt; F\n    D --&gt; G\n    D --&gt; I\n    E --&gt; H\n    E --&gt; G\n    F --&gt; J\n\n    style input fill:#3182ce,stroke:#2c5282\n    style middleware fill:#e53e3e,stroke:#c53030,stroke-width:2px\n    style telemetry fill:#6b46c1,stroke:#553c9a\n    style exporters fill:#d69e2e,stroke:#b7791f</code></pre>"},{"location":"library-docs-from-repos/toolobserve/user-journey/#observability-architecture","title":"Observability Architecture","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e53e3e'}}}%%\nflowchart TB\n    subgraph config[\"Configuration\"]\n        Cfg[\"toolobserve.Config&lt;br/&gt;&lt;small&gt;ServiceName, Version&lt;br/&gt;Tracing, Metrics, Logging&lt;/small&gt;\"]\n    end\n\n    subgraph observer[\"Observer\"]\n        Obs[\"NewObserver(cfg)\"]\n        TP[\"TracerProvider\"]\n        MP[\"MeterProvider\"]\n        Logger[\"Structured Logger\"]\n    end\n\n    subgraph middleware[\"Middleware\"]\n        MW[\"NewMiddleware(observer)\"]\n        Wrap[\"mw.Wrap(executor)\"]\n    end\n\n    subgraph execution[\"Wrapped Execution\"]\n        Pre[\"Pre: StartSpan, Log start\"]\n        Exec[\"Execute Tool\"]\n        Post[\"Post: EndSpan, Record metrics, Log end\"]\n    end\n\n    Cfg --&gt; Obs\n    Obs --&gt; TP\n    Obs --&gt; MP\n    Obs --&gt; Logger\n    Obs --&gt; MW --&gt; Wrap\n    Wrap --&gt; Pre --&gt; Exec --&gt; Post\n\n    style config fill:#3182ce,stroke:#2c5282\n    style observer fill:#e53e3e,stroke:#c53030\n    style middleware fill:#6b46c1,stroke:#553c9a\n    style execution fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/","title":"toolobserve Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 toolobserve (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#metrics","title":"Metrics","text":"<pre><code>func TestMetrics_Contract(t *testing.T) {\n    // Methods:\n    // - RecordExecution(ctx context.Context, meta ToolMeta, duration time.Duration, err error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#extendedlogger","title":"ExtendedLogger","text":"<pre><code>func TestExtendedLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Logger\n    // - WithTool(meta ToolMeta) Logger\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#observer","title":"Observer","text":"<pre><code>func TestObserver_Contract(t *testing.T) {\n    // Methods:\n    // - Tracer() trace.Tracer\n    // - Meter() metric.Meter\n    // - Logger() Logger\n    // - Shutdown(ctx context.Context) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#logger","title":"Logger","text":"<pre><code>func TestLogger_Contract(t *testing.T) {\n    // Methods:\n    // - Info(ctx context.Context, msg string, fields ...Field)\n    // - Warn(ctx context.Context, msg string, fields ...Field)\n    // - Error(ctx context.Context, msg string, fields ...Field)\n    // - Debug(ctx context.Context, msg string, fields ...Field)\n    // - WithTool(meta ToolMeta) Logger\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-execution-plan/#tracer","title":"Tracer","text":"<pre><code>func TestTracer_Contract(t *testing.T) {\n    // Methods:\n    // - StartSpan(ctx context.Context, meta ToolMeta) (context.Context, trace.Span)\n    // - EndSpan(span trace.Span, err error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 toolobserve","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Metrics</code> <code>toolobserve/metrics.go:12</code> RecordExecution(ctx context.Context, meta ToolMeta, duration time.Duration, err error) <code>ExtendedLogger</code> <code>toolobserve/logger.go:182</code> LoggerWithTool(meta ToolMeta) Logger <code>Observer</code> <code>toolobserve/observe.go:106</code> Tracer() trace.TracerMeter() metric.MeterLogger() LoggerShutdown(ctx context.Context) error <code>Logger</code> <code>toolobserve/observe.go:121</code> Info(ctx context.Context, msg string, fields ...Field)Warn(ctx context.Context, msg string, fields ...Field)Error(ctx context.Context, msg string, fields ...Field)Debug(ctx context.Context, msg string, fields ...Field)WithTool(meta ToolMeta) Logger <code>Tracer</code> <code>toolobserve/tracer.go:44</code> StartSpan(ctx context.Context, meta ToolMeta) (context.Context, trace.Span)EndSpan(span trace.Span, err error)"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolobserve/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/","title":"toolcache","text":"<p>Caching primitives for tool execution and discovery.</p>"},{"location":"library-docs-from-repos/toolcache/#overview","title":"Overview","text":"<p>toolcache provides cache interfaces and common helpers for tool execution results and registry lookups. It is a pure data/cache library: no execution, no transport, no network I/O. Backends are plugged in by the caller.</p>"},{"location":"library-docs-from-repos/toolcache/#design-goals","title":"Design Goals","text":"<ol> <li>Deterministic cache keys and stable serialization</li> <li>Pluggable backends (in-memory, Redis optional)</li> <li>Clear TTL and invalidation semantics</li> <li>Thread-safe access under concurrency</li> <li>Minimal dependencies</li> </ol>"},{"location":"library-docs-from-repos/toolcache/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolrun/toolindex --&gt; toolcache --&gt; backends\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#core-types","title":"Core Types","text":"Type Purpose <code>Cache</code> Core interface for get/set/delete <code>Keyer</code> Deterministic key generation for tool inputs <code>Policy</code> TTL, size limits, and invalidation rules <code>CacheMiddleware</code> Wrap execution with cache lookup/store"},{"location":"library-docs-from-repos/toolcache/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Cache: thread-safe; honors context cancellation; <code>ValidateKey</code> defines valid keys.</li> <li>Keyer: deterministic and thread-safe; returns errors for unsupported inputs.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/#detailed-usage","title":"Detailed Usage","text":""},{"location":"library-docs-from-repos/toolcache/#basic-setup","title":"Basic Setup","text":"<pre><code>import (\n    \"context\"\n    \"time\"\n\n    \"github.com/jonwraymond/toolcache\"\n)\n\n// Create cache with default policy\ncache := toolcache.NewMemoryCache(toolcache.DefaultPolicy())\n\n// Create keyer for deterministic key generation\nkeyer := toolcache.NewDefaultKeyer()\n\n// Create custom policy\npolicy := toolcache.Policy{\n    DefaultTTL:  5 * time.Minute,\n    MaxTTL:      1 * time.Hour,\n    AllowUnsafe: false,\n}\n\n// Create middleware\nmw := toolcache.NewCacheMiddleware(cache, keyer, policy, toolcache.DefaultSkipRule)\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#executing-tools-with-caching","title":"Executing Tools with Caching","text":"<pre><code>// Define your tool executor\nexecutor := func(ctx context.Context, toolID string, input any) ([]byte, error) {\n    // Your tool execution logic\n    return []byte(\"result\"), nil\n}\n\n// Execute with caching\nctx := context.Background()\nresult, err := mw.Execute(\n    ctx,\n    \"myns:read_file\",\n    map[string]any{\"path\": \"/tmp/file.txt\"},\n    []string{\"read\"},\n    executor,\n)\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#cache-key-generation","title":"Cache Key Generation","text":"<p>The <code>DefaultKeyer</code> generates deterministic keys using canonical JSON serialization:</p> <pre><code>keyer := toolcache.NewDefaultKeyer()\n\n// Same inputs always produce same keys\nkey1, _ := keyer.Key(\"myns:read_file\", map[string]any{\"path\": \"/tmp/file\", \"mode\": \"r\"})\nkey2, _ := keyer.Key(\"myns:read_file\", map[string]any{\"mode\": \"r\", \"path\": \"/tmp/file\"})\n// key1 == key2 (field order doesn't matter)\n\n// Different inputs produce different keys\nkey3, _ := keyer.Key(\"myns:read_file\", map[string]any{\"path\": \"/tmp/other\"})\n// key3 != key1\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#ttl-policy-management","title":"TTL Policy Management","text":"<pre><code>// Default policy: 5m default, 1h max, no unsafe\npolicy := toolcache.DefaultPolicy()\n\n// Compute effective TTL\nttl1 := policy.EffectiveTTL(0)              // Returns DefaultTTL (5m)\nttl2 := policy.EffectiveTTL(3 * time.Minute) // Returns 3m (override)\nttl3 := policy.EffectiveTTL(2 * time.Hour)   // Returns MaxTTL (1h, clamped)\n\n// Disable caching\nnoCache := toolcache.NoCachePolicy()\nttl4 := noCache.EffectiveTTL(0) // Returns 0 (no caching)\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#custom-skip-rules","title":"Custom Skip Rules","text":"<p>Skip rules control which tools bypass caching:</p> <pre><code>// Skip tools in specific namespaces\ncustomSkip := func(toolID string, tags []string) bool {\n    return strings.HasPrefix(toolID, \"dangerous:\")\n}\n\nmw := toolcache.NewCacheMiddleware(cache, keyer, policy, customSkip)\n\n// Never skip (cache everything, even unsafe operations)\n// WARNING: Only use with AllowUnsafe: true\nneverSkip := func(toolID string, tags []string) bool {\n    return false\n}\n\npolicy := toolcache.Policy{\n    DefaultTTL:  5 * time.Minute,\n    AllowUnsafe: true, // Required for caching unsafe operations\n}\nmw := toolcache.NewCacheMiddleware(cache, keyer, policy, neverSkip)\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#direct-cache-operations","title":"Direct Cache Operations","text":"<p>You can use the <code>Cache</code> interface directly for custom caching needs:</p> <pre><code>cache := toolcache.NewMemoryCache(toolcache.DefaultPolicy())\n\n// Set a value with TTL\nctx := context.Background()\nerr := cache.Set(ctx, \"mykey\", []byte(\"myvalue\"), 5*time.Minute)\n\n// Get a value\nvalue, ok := cache.Get(ctx, \"mykey\")\nif ok {\n    fmt.Println(string(value))\n}\n\n// Delete a value\nerr = cache.Delete(ctx, \"mykey\")\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#thread-safety","title":"Thread-Safety","text":"<p>All components are safe for concurrent use:</p> <pre><code>cache := toolcache.NewMemoryCache(toolcache.DefaultPolicy())\nkeyer := toolcache.NewDefaultKeyer()\nmw := toolcache.NewCacheMiddleware(cache, keyer, policy, toolcache.DefaultSkipRule)\n\n// Safe to use from multiple goroutines\nfor i := 0; i &lt; 10; i++ {\n    go func(id int) {\n        result, _ := mw.Execute(\n            context.Background(),\n            \"myns:tool\",\n            map[string]any{\"id\": id},\n            []string{\"read\"},\n            executor,\n        )\n        fmt.Println(string(result))\n    }(i)\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#key-validation","title":"Key Validation","text":"<p>Cache keys are validated to ensure backend compatibility:</p> <pre><code>// Valid keys\nerr := toolcache.ValidateKey(\"toolcache:myns:tool:abc123\") // nil\n\n// Invalid keys\nerr = toolcache.ValidateKey(\"\")                    // ErrInvalidKey\nerr = toolcache.ValidateKey(\"key\\nwith\\nnewlines\") // ErrInvalidKey\nerr = toolcache.ValidateKey(strings.Repeat(\"x\", 513)) // ErrKeyTooLong\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"library-docs-from-repos/toolcache/#custom-cache-backend","title":"Custom Cache Backend","text":"<p>Implement the <code>Cache</code> interface for custom backends:</p> <pre><code>type RedisCache struct {\n    client *redis.Client\n}\n\nfunc (c *RedisCache) Get(ctx context.Context, key string) ([]byte, bool) {\n    val, err := c.client.Get(ctx, key).Bytes()\n    if err == redis.Nil {\n        return nil, false\n    }\n    if err != nil {\n        return nil, false\n    }\n    return val, true\n}\n\nfunc (c *RedisCache) Set(ctx context.Context, key string, value []byte, ttl time.Duration) error {\n    return c.client.Set(ctx, key, value, ttl).Err()\n}\n\nfunc (c *RedisCache) Delete(ctx context.Context, key string) error {\n    return c.client.Del(ctx, key).Err()\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#custom-keyer","title":"Custom Keyer","text":"<p>Implement the <code>Keyer</code> interface for custom key generation:</p> <pre><code>type PrefixKeyer struct {\n    prefix string\n    base   toolcache.Keyer\n}\n\nfunc (k *PrefixKeyer) Key(toolID string, input any) (string, error) {\n    baseKey, err := k.base.Key(toolID, input)\n    if err != nil {\n        return \"\", err\n    }\n    return k.prefix + \":\" + baseKey, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/#versioning","title":"Versioning","text":"<p>toolcache follows semantic versioning aligned with the stack. The source of truth is <code>ai-tools-stack/go.mod</code>, and <code>VERSIONS.md</code> is synchronized across repos.</p>"},{"location":"library-docs-from-repos/toolcache/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes</li> <li>User Journey</li> <li>Plans</li> </ul>"},{"location":"library-docs-from-repos/toolcache/design-notes/","title":"Design Notes: Caching Semantics","text":""},{"location":"library-docs-from-repos/toolcache/design-notes/#core-principles","title":"Core Principles","text":"<ul> <li>Determinism: cache keys must be stable across runs.</li> <li>Explicit TTLs: cache entries always have explicit lifetimes.</li> <li>Isolation: no shared mutable state across caches.</li> <li>Opt-in caching: callers decide what to cache.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/design-notes/#cache-keying","title":"Cache Keying","text":"<ul> <li>Keys are derived from tool ID + normalized input payload.</li> <li>Keyer must be deterministic and order-insensitive for maps.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/design-notes/#invalidation","title":"Invalidation","text":"<ul> <li>Support TTL-based expiration.</li> <li>Optional explicit invalidation by tool ID or key prefix.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/design-notes/#concurrency","title":"Concurrency","text":"<ul> <li>Cache interfaces must be safe under concurrent access.</li> <li>Middleware must be re-entrant.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/design-notes/#integration-points","title":"Integration Points","text":"<ul> <li><code>toolrun</code>: wrap <code>RunTool</code> and <code>RunChain</code> with cache checks.</li> <li><code>toolindex</code>: cache namespace/tool listings.</li> <li><code>metatools-mcp</code>: optional caching in provider layer.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/user-journey/","title":"User Journey: Caching Tool Results","text":""},{"location":"library-docs-from-repos/toolcache/user-journey/#scenario","title":"Scenario","text":"<p>You want to cache results for read-only tools to reduce latency and cost. Cache entries expire after 30 seconds, and you want deterministic keys.</p>"},{"location":"library-docs-from-repos/toolcache/user-journey/#step-1-initialize-cache","title":"Step 1: Initialize cache","text":"<pre><code>cache := toolcache.NewMemoryCache(\n    toolcache.WithDefaultTTL(30*time.Second),\n)\nkeyer := toolcache.NewKeyer()\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/user-journey/#step-2-wrap-execution","title":"Step 2: Wrap execution","text":"<pre><code>mw := toolcache.NewMiddleware(cache, keyer)\nwrapped := mw.Wrap(toolrunExecutor)\n_ = wrapped\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/user-journey/#step-3-execute-tool","title":"Step 3: Execute tool","text":"<ul> <li>First call populates cache</li> <li>Subsequent calls within TTL return cached result</li> </ul>"},{"location":"library-docs-from-repos/toolcache/user-journey/#flow-diagram","title":"Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#38a169'}}}%%\nflowchart TD\n    subgraph input[\"Input\"]\n        A[\"\ud83d\udce5 Tool Call&lt;br/&gt;&lt;small&gt;toolID + args&lt;/small&gt;\"]\n    end\n\n    subgraph middleware[\"Cache Middleware\"]\n        Skip{\"\ud83d\udd0d Check&lt;br/&gt;Skip Rules?\"}\n        SkipNote[\"Skip tags:&lt;br/&gt;&lt;small&gt;write, danger, unsafe,&lt;br/&gt;mutation, delete&lt;/small&gt;\"]\n\n        Key[\"\ud83d\udd11 Generate Key&lt;br/&gt;&lt;small&gt;toolcache:{id}:{SHA256(args)}&lt;/small&gt;\"]\n        Lookup[\"\ud83d\udcbe Cache.Get(key)\"]\n        Hit{\"Cache&lt;br/&gt;Hit?\"}\n    end\n\n    subgraph execution[\"Execution\"]\n        Exec[\"\u25b6\ufe0f Execute Tool\"]\n    end\n\n    subgraph store[\"Cache Store\"]\n        Store[\"\ud83d\udcbe Cache.Set(key, result)\"]\n        TTL[\"\u23f1\ufe0f TTL: 30s default\"]\n    end\n\n    subgraph output[\"Output\"]\n        Return[\"\ud83d\udce4 Return Result\"]\n    end\n\n    A --&gt; Skip\n    SkipNote -.-&gt; Skip\n    Skip --&gt;|\"matches skip tag\"| Exec\n    Skip --&gt;|\"cacheable\"| Key --&gt; Lookup --&gt; Hit\n    Hit --&gt;|\"\u2705 yes\"| Return\n    Hit --&gt;|\"\u274c no\"| Exec\n    Exec --&gt; Store --&gt; TTL --&gt; Return\n\n    style input fill:#3182ce,stroke:#2c5282\n    style middleware fill:#38a169,stroke:#276749,stroke-width:2px\n    style execution fill:#d69e2e,stroke:#b7791f\n    style store fill:#6b46c1,stroke:#553c9a\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolcache/user-journey/#cache-key-generation","title":"Cache Key Generation","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart LR\n    subgraph input[\"Inputs\"]\n        ToolID[\"toolID&lt;br/&gt;&lt;small&gt;github:create_issue&lt;/small&gt;\"]\n        Args[\"args&lt;br/&gt;&lt;small&gt;{repo: 'org/repo'}&lt;/small&gt;\"]\n    end\n\n    subgraph keyer[\"Keyer.Generate()\"]\n        Canon[\"Canonical JSON&lt;br/&gt;&lt;small&gt;sorted keys&lt;/small&gt;\"]\n        Hash[\"SHA-256 Hash\"]\n    end\n\n    subgraph output[\"Output\"]\n        Key[\"Cache Key&lt;br/&gt;&lt;small&gt;toolcache:github:create_issue:a1b2c3...&lt;/small&gt;\"]\n    end\n\n    ToolID --&gt; Canon\n    Args --&gt; Canon\n    Canon --&gt; Hash --&gt; Key\n\n    style input fill:#3182ce,stroke:#2c5282\n    style keyer fill:#6b46c1,stroke:#553c9a\n    style output fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolcache/plans/","title":"toolcache Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 toolcache (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#cache","title":"Cache","text":"<pre><code>func TestCache_Contract(t *testing.T) {\n    // Methods:\n    // - Get(ctx context.Context, key string) (value []byte, ok bool)\n    // - Set(ctx context.Context, key string, value []byte, ttl time.Duration) error\n    // - Delete(ctx context.Context, key string) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-execution-plan/#keyer","title":"Keyer","text":"<pre><code>func TestKeyer_Contract(t *testing.T) {\n    // Methods:\n    // - Key(toolID string, input any) (string, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 toolcache","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Cache</code> <code>toolcache/cache.go:18</code> Get(ctx context.Context, key string) (value []byte, ok bool)Set(ctx context.Context, key string, value []byte, ttl time.Duration) errorDelete(ctx context.Context, key string) error <code>Keyer</code> <code>toolcache/keyer.go:11</code> Key(toolID string, input any) (string, error)"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolcache/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/","title":"toolsemantic","text":"<p>Semantic indexing and retrieval for tools.</p>"},{"location":"library-docs-from-repos/toolsemantic/#overview","title":"Overview","text":"<p>toolsemantic provides interfaces for semantic search across tool metadata and schemas. It is pluggable and backend-agnostic: no network dependencies and no required vector database. Callers bring embeddings and storage.</p>"},{"location":"library-docs-from-repos/toolsemantic/#design-goals","title":"Design Goals","text":"<ol> <li>Pluggable strategies (BM25, embeddings, hybrid)</li> <li>Deterministic scoring and ranking</li> <li>Clear separation between indexing and query</li> <li>Minimal dependencies</li> <li>Compatibility with <code>toolindex</code> and <code>toolsearch</code></li> </ol>"},{"location":"library-docs-from-repos/toolsemantic/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolindex --&gt; toolsemantic --&gt; search backends\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/#core-types","title":"Core Types","text":"Type Purpose <code>Indexer</code> Adds/updates tool documents <code>Searcher</code> Queries tools by semantic similarity <code>Embedder</code> Generates embeddings for tool docs <code>Strategy</code> Combines BM25 + vector scores"},{"location":"library-docs-from-repos/toolsemantic/#quick-start","title":"Quick Start","text":"<pre><code>idx := toolsemantic.NewInMemoryIndex()\n_ = idx.Add(ctx, toolsemantic.Document{\n    ID:          \"weather:get\",\n    Namespace:   \"weather\",\n    Name:        \"get\",\n    Description: \"Get weather for a location\",\n    Tags:        []string{\"read\", \"weather\"},\n})\n\nstrategy := toolsemantic.NewBM25Strategy(nil)\nsearcher := toolsemantic.NewSearcher(idx, strategy)\nresults, _ := searcher.Search(ctx, \"find weather tools\")\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/#versioning","title":"Versioning","text":"<p>toolsemantic follows semantic versioning aligned with the stack. The source of truth is <code>ai-tools-stack/go.mod</code>, and <code>VERSIONS.md</code> is synchronized across repos.</p>"},{"location":"library-docs-from-repos/toolsemantic/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes</li> <li>User Journey</li> <li>Plans</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/","title":"Design Notes: Semantic Retrieval","text":""},{"location":"library-docs-from-repos/toolsemantic/design-notes/#core-principles","title":"Core Principles","text":"<ul> <li>Backend agnostic: no hard dependency on vector stores.</li> <li>Composable scoring: support BM25-only, vector-only, and hybrid.</li> <li>Deterministic ranking: stable tie-breakers for reproducible results.</li> <li>Separation of concerns: indexing vs searching are distinct interfaces.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#indexing","title":"Indexing","text":"<ul> <li>Tool documents include namespace, name, description, tags, and schema hints.</li> <li>Embeddings are generated by a caller-supplied <code>Embedder</code>.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#querying","title":"Querying","text":"<ul> <li>Query text is embedded and compared to tool documents.</li> <li>Optional filters (namespace, tags, category) are applied post-score.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#integration-points","title":"Integration Points","text":"<ul> <li><code>toolindex</code>: source of tool documents.</li> <li><code>toolsearch</code>: optional BM25 implementation for baseline ranking.</li> <li><code>metatools-mcp</code>: provider layer can call semantic search.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#interface-contracts","title":"Interface Contracts","text":""},{"location":"library-docs-from-repos/toolsemantic/design-notes/#indexer","title":"Indexer","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: methods honor cancellation/deadlines where applicable.</li> <li>Errors: invalid IDs return <code>ErrInvalidDocumentID</code>.</li> <li>Determinism: <code>List</code> returns stable ordering.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#searcher","title":"Searcher","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: methods honor cancellation/deadlines.</li> <li>Determinism: ordering is stable for identical inputs.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/design-notes/#strategy-bm25scorer-embedder","title":"Strategy / BM25Scorer / Embedder","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: <code>Embed</code>/<code>Score</code> honor cancellation/deadlines.</li> <li>Determinism: identical inputs yield stable scores.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/","title":"User Journey: Semantic Tool Search","text":""},{"location":"library-docs-from-repos/toolsemantic/user-journey/#scenario","title":"Scenario","text":"<p>You want to retrieve tools by intent rather than exact name matching. The query \"summarize meeting notes\" should return tools tagged for summarization.</p>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/#step-1-build-a-semantic-index","title":"Step 1: Build a semantic index","text":"<pre><code>idx := toolsemantic.NewInMemoryIndex()\n_ = idx.Add(ctx, toolsemantic.Document{\n    ID:          \"docs:summarize\",\n    Namespace:   \"docs\",\n    Name:        \"summarize\",\n    Description: \"Summarize a document\",\n    Tags:        []string{\"summarize\", \"read\"},\n})\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/#step-2-query-the-index","title":"Step 2: Query the index","text":"<pre><code>strategy := toolsemantic.NewBM25Strategy(nil)\nsearcher := toolsemantic.NewSearcher(idx, strategy)\nresults, _ := searcher.Search(ctx, \"summarize meeting notes\")\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/#step-3-filter-results","title":"Step 3: Filter results","text":"<pre><code>filtered := make([]toolsemantic.Result, 0, len(results))\nfor _, r := range results {\n    if r.Document.Namespace == \"docs\" {\n        filtered = append(filtered, r)\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/#flow-diagram","title":"Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart LR\n    subgraph input[\"Input\"]\n        A[\"\ud83d\udd0d Query Text&lt;br/&gt;&lt;small&gt;'summarize meeting notes'&lt;/small&gt;\"]\n    end\n\n    subgraph embedding[\"Embedding\"]\n        B[\"\ud83e\udde0 Embedder&lt;br/&gt;&lt;small&gt;text \u2192 vector&lt;/small&gt;\"]\n    end\n\n    subgraph search[\"Vector Search\"]\n        C[\"\ud83d\udcca Vector Query&lt;br/&gt;&lt;small&gt;cosine similarity&lt;/small&gt;\"]\n        D[\"\ud83c\udfc6 Score + Rank\"]\n    end\n\n    subgraph filtering[\"Post-Processing\"]\n        E[\"\ud83d\udd0d Filter/Sort&lt;br/&gt;&lt;small&gt;namespace, threshold&lt;/small&gt;\"]\n    end\n\n    subgraph output[\"Output\"]\n        F[\"\ud83d\udccb Results&lt;br/&gt;&lt;small&gt;Document[] with scores&lt;/small&gt;\"]\n    end\n\n    A --&gt; B --&gt; C --&gt; D --&gt; E --&gt; F\n\n    style input fill:#3182ce,stroke:#2c5282\n    style embedding fill:#6b46c1,stroke:#553c9a,stroke-width:2px\n    style search fill:#d69e2e,stroke:#b7791f\n    style filtering fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/user-journey/#semantic-search-architecture","title":"Semantic Search Architecture","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart TB\n    subgraph indexing[\"Indexing Phase\"]\n        Doc[\"\ud83d\udcc4 Document&lt;br/&gt;&lt;small&gt;ID, Name, Description, Tags&lt;/small&gt;\"]\n        Embed1[\"\ud83e\udde0 Embedder\"]\n        Vec[\"\ud83d\udcca Vector&lt;br/&gt;&lt;small&gt;[0.12, -0.34, ...]&lt;/small&gt;\"]\n        Store[\"\ud83d\udcbe Vector Store\"]\n    end\n\n    subgraph querying[\"Query Phase\"]\n        Query[\"\ud83d\udd0d Query Text\"]\n        Embed2[\"\ud83e\udde0 Embedder\"]\n        QVec[\"\ud83d\udcca Query Vector\"]\n        Sim[\"\ud83d\udcd0 Similarity Search&lt;br/&gt;&lt;small&gt;cosine, dot product&lt;/small&gt;\"]\n    end\n\n    subgraph results[\"Results\"]\n        Ranked[\"\ud83c\udfc6 Ranked Documents\"]\n        Filtered[\"\ud83d\udd0d Filtered Results\"]\n    end\n\n    Doc --&gt; Embed1 --&gt; Vec --&gt; Store\n    Query --&gt; Embed2 --&gt; QVec --&gt; Sim\n    Store --&gt; Sim\n    Sim --&gt; Ranked --&gt; Filtered\n\n    style indexing fill:#3182ce,stroke:#2c5282\n    style querying fill:#6b46c1,stroke:#553c9a\n    style results fill:#38a169,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/","title":"toolsemantic Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 toolsemantic (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#bm25scorer","title":"BM25Scorer","text":"<pre><code>func TestBM25Scorer_Contract(t *testing.T) {\n    // Methods:\n    // - Score(query string, doc Document) float64\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#embedder","title":"Embedder","text":"<pre><code>func TestEmbedder_Contract(t *testing.T) {\n    // Methods:\n    // - Embed(ctx context.Context, text string) ([]float32, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#strategy","title":"Strategy","text":"<pre><code>func TestStrategy_Contract(t *testing.T) {\n    // Methods:\n    // - Score(ctx context.Context, query string, doc Document) (float64, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#searcher","title":"Searcher","text":"<pre><code>func TestSearcher_Contract(t *testing.T) {\n    // Methods:\n    // - Search(ctx context.Context, query string) ([]Result, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-execution-plan/#indexer","title":"Indexer","text":"<pre><code>func TestIndexer_Contract(t *testing.T) {\n    // Methods:\n    // - Add(ctx context.Context, doc Document) error\n    // - Update(ctx context.Context, doc Document) error\n    // - Remove(ctx context.Context, id string) error\n    // - Get(ctx context.Context, id string) (Document, bool)\n    // - List(ctx context.Context) []Document\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 toolsemantic","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>BM25Scorer</code> <code>toolsemantic/strategy.go:16</code> Score(query string, doc Document) float64 <code>Embedder</code> <code>toolsemantic/strategy.go:21</code> Embed(ctx context.Context, text string) ([]float32, error) <code>Strategy</code> <code>toolsemantic/searcher.go:18</code> Score(ctx context.Context, query string, doc Document) (float64, error) <code>Searcher</code> <code>toolsemantic/searcher.go:23</code> Search(ctx context.Context, query string) ([]Result, error) <code>Indexer</code> <code>toolsemantic/indexer.go:13</code> Add(ctx context.Context, doc Document) errorUpdate(ctx context.Context, doc Document) errorRemove(ctx context.Context, id string) errorGet(ctx context.Context, id string) (Document, bool)List(ctx context.Context) []Document"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolsemantic/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/","title":"toolskill","text":"<p>Skill composition primitives for reusable tool workflows.</p>"},{"location":"library-docs-from-repos/toolskill/#overview","title":"Overview","text":"<p>toolskill defines a declarative model for composing tools into reusable skills: sequences, branching, and guardrails. It does not execute tools itself; it integrates with <code>toolrun</code> for execution and <code>toolobserve</code> for telemetry.</p>"},{"location":"library-docs-from-repos/toolskill/#design-goals","title":"Design Goals","text":"<ol> <li>Declarative skill definitions</li> <li>Deterministic step ordering</li> <li>Policy and guard integration</li> <li>Composable, reusable workflows</li> <li>Minimal dependencies</li> </ol>"},{"location":"library-docs-from-repos/toolskill/#position-in-the-stack","title":"Position in the Stack","text":"<pre><code>toolset + toolrun + toolobserve --&gt; toolskill --&gt; metatools-mcp\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/#core-types","title":"Core Types","text":"Type Purpose <code>Skill</code> Declarative workflow definition <code>Step</code> Single tool call or sub-skill <code>Guard</code> Pre/post conditions and policy checks <code>Planner</code> Resolves step order and dependencies"},{"location":"library-docs-from-repos/toolskill/#quick-start","title":"Quick Start","text":"<pre><code>skill := toolskill.Skill{\n    Name: \"summarize-docs\",\n    Steps: []toolskill.Step{\n        {ID: \"search\", ToolID: \"mcp:search\"},\n        {ID: \"summarize\", ToolID: \"mcp:summarize\"},\n    },\n}\n\nplan, _ := toolskill.NewPlanner().Plan(skill)\nresults, _ := toolskill.Execute(ctx, plan, runner)\n_ = results\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/#versioning","title":"Versioning","text":"<p>toolskill follows semantic versioning aligned with the stack. The source of truth is <code>ai-tools-stack/go.mod</code>, and <code>VERSIONS.md</code> is synchronized across repos.</p>"},{"location":"library-docs-from-repos/toolskill/#next-steps","title":"Next Steps","text":"<ul> <li>Design Notes</li> <li>User Journey</li> <li>Plans</li> </ul>"},{"location":"library-docs-from-repos/toolskill/design-notes/","title":"Design Notes: Skill Composition","text":""},{"location":"library-docs-from-repos/toolskill/design-notes/#core-principles","title":"Core Principles","text":"<ul> <li>Declarative first: skills are data, not code.</li> <li>Deterministic planning: step order is stable and reproducible.</li> <li>Guards and policies: validate preconditions and ensure safety.</li> <li>Composable: skills can reference other skills.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/design-notes/#step-model","title":"Step Model","text":"<ul> <li>Steps reference tool IDs and input bindings.</li> <li>Steps can be sequential, parallel, or conditional (future).</li> </ul>"},{"location":"library-docs-from-repos/toolskill/design-notes/#integration-points","title":"Integration Points","text":"<ul> <li><code>toolrun</code>: execution of steps</li> <li><code>toolset</code>: curated tool availability</li> <li><code>toolobserve</code>: telemetry around skill execution</li> <li><code>metatools-mcp</code>: expose skills as higher-level capabilities</li> </ul>"},{"location":"library-docs-from-repos/toolskill/design-notes/#interface-contracts","title":"Interface Contracts","text":""},{"location":"library-docs-from-repos/toolskill/design-notes/#runner","title":"Runner","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Context: honors cancellation/deadlines and returns <code>ctx.Err()</code> when canceled.</li> <li>Errors: execution failures return non-nil error; no panic.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/design-notes/#guard","title":"Guard","text":"<ul> <li>Concurrency: implementations are safe for concurrent use.</li> <li>Errors: validation failures return non-nil error; no panic.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/user-journey/","title":"User Journey: Building a Skill","text":""},{"location":"library-docs-from-repos/toolskill/user-journey/#scenario","title":"Scenario","text":"<p>You want to define a reusable \"summarize-research\" skill that searches for papers, extracts abstracts, and summarizes the result.</p>"},{"location":"library-docs-from-repos/toolskill/user-journey/#step-1-define-the-skill","title":"Step 1: Define the skill","text":"<pre><code>skill := toolskill.Skill{\n    Name: \"summarize-research\",\n    Steps: []toolskill.Step{\n        {ID: \"search\", ToolID: \"mcp:search_papers\"},\n        {ID: \"extract\", ToolID: \"mcp:extract_abstracts\"},\n        {ID: \"summarize\", ToolID: \"mcp:summarize\"},\n    },\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/user-journey/#step-2-add-a-guard","title":"Step 2: Add a guard","text":"<pre><code>guard := toolskill.MaxStepsGuard(5)\n_ = guard.Validate(skill)\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/user-journey/#step-3-execute-via-toolrun","title":"Step 3: Execute via toolrun","text":"<pre><code>plan, _ := toolskill.NewPlanner().Plan(skill)\nexecutor := toolrun.NewExecutor(...)\nresult, _ := toolskill.Execute(ctx, plan, executor)\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/user-journey/#flow-diagram","title":"Flow Diagram","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart LR\n    subgraph definition[\"Definition\"]\n        A[\"\ud83c\udfaf Skill Definition&lt;br/&gt;&lt;small&gt;name, steps[]&lt;/small&gt;\"]\n    end\n\n    subgraph planning[\"Planning\"]\n        B[\"\ud83d\udcd0 Planner&lt;br/&gt;&lt;small&gt;dependency resolution&lt;/small&gt;\"]\n        C[\"\ud83d\udee1\ufe0f Guard/Policy&lt;br/&gt;&lt;small&gt;MaxSteps, AllowedNS&lt;/small&gt;\"]\n    end\n\n    subgraph execution[\"Execution\"]\n        D[\"\u25b6\ufe0f toolrun.RunChain()&lt;br/&gt;&lt;small&gt;step-by-step&lt;/small&gt;\"]\n    end\n\n    subgraph output[\"Output\"]\n        E[\"\ud83d\udce6 SkillResult&lt;br/&gt;&lt;small&gt;final + step results&lt;/small&gt;\"]\n    end\n\n    A --&gt; B --&gt; C --&gt; D --&gt; E\n\n    style definition fill:#6b46c1,stroke:#553c9a,stroke-width:2px\n    style planning fill:#d69e2e,stroke:#b7791f\n    style execution fill:#38a169,stroke:#276749\n    style output fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolskill/user-journey/#skill-execution-pipeline","title":"Skill Execution Pipeline","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#6b46c1'}}}%%\nflowchart TB\n    subgraph skill[\"Skill: summarize-research\"]\n        S1[\"\ud83d\udccc Step 1&lt;br/&gt;&lt;small&gt;mcp:search_papers&lt;/small&gt;\"]\n        S2[\"\ud83d\udccc Step 2&lt;br/&gt;&lt;small&gt;mcp:extract_abstracts&lt;/small&gt;\"]\n        S3[\"\ud83d\udccc Step 3&lt;br/&gt;&lt;small&gt;mcp:summarize&lt;/small&gt;\"]\n    end\n\n    subgraph guards[\"Guards\"]\n        G1[\"\ud83d\udee1\ufe0f MaxStepsGuard(5)\"]\n        G2[\"\ud83d\udd12 AllowedNamespaces(['mcp'])\"]\n    end\n\n    subgraph planner[\"Planning\"]\n        Plan[\"\ud83d\udcd0 Planner.Plan()\"]\n        ExecPlan[\"\ud83d\udcdc ExecutionPlan\"]\n    end\n\n    subgraph execution[\"Execution\"]\n        Exec[\"\u25b6\ufe0f toolskill.Execute()\"]\n        Chain[\"\ud83d\udd17 toolrun.RunChain()\"]\n    end\n\n    subgraph results[\"Results\"]\n        R1[\"\ud83d\udcc4 Step 1 Result: papers[]\"]\n        R2[\"\ud83d\udcc4 Step 2 Result: abstracts[]\"]\n        R3[\"\ud83d\udcc4 Step 3 Result: summary\"]\n        Final[\"\ud83d\udce6 Final: summary\"]\n    end\n\n    S1 --&gt; S2 --&gt; S3\n    S3 --&gt; G1\n    S3 --&gt; G2\n    G1 --&gt; Plan\n    G2 --&gt; Plan\n    Plan --&gt; ExecPlan --&gt; Exec --&gt; Chain\n    Chain --&gt; R1 --&gt; R2 --&gt; R3 --&gt; Final\n\n    style skill fill:#6b46c1,stroke:#553c9a\n    style guards fill:#e53e3e,stroke:#c53030\n    style planner fill:#d69e2e,stroke:#b7791f\n    style execution fill:#38a169,stroke:#276749\n    style results fill:#3182ce,stroke:#2c5282</code></pre>"},{"location":"library-docs-from-repos/toolskill/plans/","title":"toolskill Plans","text":"Item File Status PRD-002 <code>2026-01-30-prd-002-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-002-execution-plan.md</code> Done"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/","title":"PRD-002 Execution Plan \u2014 toolskill (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-002-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#runner","title":"Runner","text":"<pre><code>func TestRunner_Contract(t *testing.T) {\n    // Methods:\n    // - Run(ctx context.Context, step Step) (any, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-execution-plan/#guard","title":"Guard","text":"<pre><code>func TestGuard_Contract(t *testing.T) {\n    // Methods:\n    // - Validate(skill Skill) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/","title":"PRD-002 Interface Contracts \u2014 toolskill","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>Runner</code> <code>toolskill/execute.go:6</code> Run(ctx context.Context, step Step) (any, error) <code>Guard</code> <code>toolskill/guard.go:9</code> Validate(skill Skill) error"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/toolskill/plans/2026-01-30-prd-002-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/","title":"metatools-mcp","text":"<p><code>metatools-mcp</code> is the MCP server that exposes the tool stack via a small, progressive-disclosure tool surface. It composes toolmodel, toolindex, tooldocs, toolrun, and optionally toolcode/toolruntime.</p> <p></p>"},{"location":"library-docs-from-repos/metatools-mcp/#deep-dives","title":"Deep dives","text":"<ul> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#motivation","title":"Motivation","text":"<ul> <li>One MCP surface for discovery, docs, and execution</li> <li>Progressive disclosure to keep tool context small</li> <li>Pluggable design for search, runtimes, and engines</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#mcp-tools-exposed","title":"MCP tools exposed","text":"<ul> <li><code>search_tools</code></li> <li><code>list_namespaces</code></li> <li><code>describe_tool</code></li> <li><code>list_tool_examples</code></li> <li><code>run_tool</code></li> <li><code>run_chain</code></li> <li><code>execute_code</code> (optional)</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#quickstart","title":"Quickstart","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\ndocs := tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx})\nrunner := toolrun.NewRunner(toolrun.WithIndex(idx))\n\ncfg := adapters.NewConfig(idx, docs, runner, nil)\nserver, _ := server.New(cfg)\n\n_ = server.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/#usability-notes","title":"Usability notes","text":"<ul> <li>Fewer MCP tools means simpler agent prompts</li> <li>Outputs are structured and aligned to MCP schemas</li> <li>Search and execution behaviors are deterministic by default</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#runtime-notes-execute_code","title":"Runtime notes (execute_code)","text":"<p><code>execute_code</code> is optional and wired behind the <code>toolruntime</code> build tag. By default, the runtime uses the unsafe dev profile; when Docker is available, set <code>METATOOLS_RUNTIME_PROFILE=standard</code> to enable the hardened Docker backend. WASM can be enabled with <code>METATOOLS_WASM_ENABLED=true</code> and selected with <code>METATOOLS_RUNTIME_BACKEND=wasm</code>.</p>"},{"location":"library-docs-from-repos/metatools-mcp/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Transport: thread-safe; <code>Serve</code> honors context; <code>Close</code> is idempotent.</li> <li>Backend: thread-safe; <code>ListTools</code>/<code>Execute</code> honor context; streaming backends return non-nil channel when err is nil.</li> <li>ToolProvider: thread-safe; <code>Handle</code> honors context; streaming providers return non-nil channel when err is nil.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#next","title":"Next","text":"<ul> <li>Server architecture: <code>architecture.md</code></li> <li>Ordered execution plan: <code>plan-of-record.md</code></li> <li>Configuration and env vars: <code>usage.md</code></li> <li>Examples: <code>examples.md</code></li> <li>Design Notes: design-notes.md</li> <li>User Journey: user-journey.md</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/#proposals","title":"Proposals","text":"<p>Master Plan: - ROADMAP - Master roadmap with all work streams, phases, and milestones</p> <p>Architecture: - Pluggable Architecture - Extensible, modular design - Architecture Evaluation - Championship-level comparison - Component Library Analysis - Tool* library ecosystem - Architecture Review - Comprehensive proposal analysis and consistency check - MCP Spec Alignment - Targeted spec compliance improvements</p> <p>Features: - Protocol-Agnostic Tools - Composable toolsets and protocol adapters - Multi-Tenancy Extension - Tenant isolation patterns - Agent Skills - Higher-level capability composition (see ROADMAP)</p> <p>Implementation: - Implementation Phases - Phased rollout plan</p>"},{"location":"library-docs-from-repos/metatools-mcp/api/","title":"API Reference","text":""},{"location":"library-docs-from-repos/metatools-mcp/api/#server","title":"Server","text":"<pre><code>func New(cfg config.Config) (*Server, error)\nfunc (s *Server) Run(ctx context.Context, transport mcp.Transport) error\nfunc (s *Server) MCPServer() *mcp.Server\nfunc (s *Server) ListTools() []*mcp.Tool\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#config","title":"Config","text":"<pre><code>type Config struct {\n  Index    toolindex.Index\n  Docs     tooldocs.Store\n  Runner   toolrun.Runner\n  Executor toolcode.Executor // optional\n\n  NotifyToolListChanged           bool\n  NotifyToolListChangedDebounceMs int\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Transport: thread-safe; <code>Serve</code> honors context; <code>Close</code> is idempotent.</li> <li>Backend: thread-safe; <code>ListTools</code>/<code>Execute</code> honor context; streaming backends must return non-nil channel when err is nil.</li> <li>ToolProvider: thread-safe; <code>Handle</code> honors context; streaming providers must return non-nil channel when err is nil.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/api/#transport","title":"Transport","text":"<p>The transport layer is in <code>internal/transport</code>:</p> <pre><code>// Transport interface for MCP protocol transports\ntype Transport interface {\n  Name() string\n  Info() Info\n  Serve(ctx context.Context, server Server) error\n  Close() error\n}\n\n// Info describes a transport instance\ntype Info struct {\n  Name string\n  Addr string\n  Path string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#available-transports","title":"Available transports","text":"Type Struct Use Case stdio <code>StdioTransport</code> Claude Desktop, local CLI streamable <code>StreamableHTTPTransport</code> Web apps, HTTP clients (MCP 2025-03-26) sse <code>SSETransport</code> Legacy HTTP clients (deprecated)"},{"location":"library-docs-from-repos/metatools-mcp/api/#streamablehttpconfig","title":"StreamableHTTPConfig","text":"<pre><code>type StreamableHTTPConfig struct {\n  Host              string        // Network interface (default: \"0.0.0.0\")\n  Port              int           // TCP port (required)\n  Path              string        // Endpoint path (default: \"/mcp\")\n  ReadHeaderTimeout time.Duration // Header read timeout (default: 10s)\n  TLS               TLSConfig     // HTTPS configuration\n  Stateless         bool          // Disable session management\n  JSONResponse      bool          // Prefer JSON over SSE streaming\n  SessionTimeout    time.Duration // Idle session cleanup\n}\n\ntype TLSConfig struct {\n  Enabled  bool\n  CertFile string\n  KeyFile  string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/api/#toolruntime-integration","title":"Toolruntime integration","text":"<p>When built with <code>-tags toolruntime</code>, <code>execute_code</code> is backed by a <code>toolruntime</code> runtime. The runtime selects a profile at startup:</p> <ul> <li><code>dev</code> profile: unsafe subprocess backend (default).</li> <li><code>standard</code> profile: Docker sandbox by default or WASM when selected.</li> <li><code>METATOOLS_DOCKER_IMAGE</code> overrides the sandbox image name.</li> <li><code>METATOOLS_WASM_ENABLED=true</code> enables the WASM backend (wazero).</li> <li><code>METATOOLS_RUNTIME_BACKEND=wasm</code> selects WASM for the standard profile.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/api/#mcp-tool-io-types","title":"MCP tool I/O types","text":"<p>These are exported in <code>pkg/metatools</code>:</p> <ul> <li><code>SearchToolsInput</code> / <code>SearchToolsOutput</code></li> <li><code>ListNamespacesInput</code> / <code>ListNamespacesOutput</code></li> <li><code>DescribeToolInput</code> / <code>DescribeToolOutput</code></li> <li><code>ListToolExamplesInput</code> / <code>ListToolExamplesOutput</code></li> <li><code>RunToolInput</code> / <code>RunToolOutput</code></li> <li><code>RunChainInput</code> / <code>RunChainOutput</code></li> <li><code>ExecuteCodeInput</code> / <code>ExecuteCodeOutput</code></li> </ul> <p>Notes: - <code>SearchToolsInput</code>/<code>ListNamespacesInput</code> accept <code>limit</code> + <code>cursor</code>. - <code>SearchToolsOutput</code>/<code>ListNamespacesOutput</code> return <code>nextCursor</code> when more data exists.</p>"},{"location":"library-docs-from-repos/metatools-mcp/api/#error-codes","title":"Error codes","text":"<p>Metatools surfaces standardized error codes (strings), including:</p> <ul> <li><code>tool_not_found</code></li> <li><code>no_backends</code></li> <li><code>validation_input</code></li> <li><code>validation_output</code></li> <li><code>execution_failed</code></li> <li><code>stream_not_supported</code></li> <li><code>chain_step_failed</code></li> <li><code>cancelled</code></li> <li><code>timeout</code></li> <li><code>internal</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/","title":"Architecture","text":"<p><code>metatools-mcp</code> composes the core libraries and exposes a small MCP tool surface.</p>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#transport-layer","title":"Transport layer","text":"<p>The transport layer abstracts how clients connect to the MCP server. All transports implement the <code>Transport</code> interface, enabling protocol flexibility without changing server logic.</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#805ad5'}}}%%\nclassDiagram\n    class Transport {\n        &lt;&lt;interface&gt;&gt;\n        +Name() string\n        +Info() Info\n        +Serve(ctx, server) error\n        +Close() error\n    }\n\n    class StdioTransport {\n        +Name() \"stdio\"\n        +Serve() stdin/stdout\n    }\n\n    class StreamableHTTPTransport {\n        +Config StreamableHTTPConfig\n        +Name() \"streamable\"\n        +Serve() HTTP POST/GET/DELETE\n    }\n\n    class SSETransport {\n        +Config SSEConfig\n        +Name() \"sse\"\n        +Serve() HTTP + SSE\n    }\n\n    Transport &lt;|.. StdioTransport\n    Transport &lt;|.. StreamableHTTPTransport\n    Transport &lt;|.. SSETransport\n\n    note for StreamableHTTPTransport \"MCP spec 2025-03-26\\nRecommended for HTTP\"\n    note for SSETransport \"Deprecated\"</code></pre> Transport Protocol Session Best For <code>stdio</code> stdin/stdout JSON-RPC Implicit Claude Desktop, local CLI <code>streamable</code> HTTP POST/GET/DELETE Mcp-Session-Id header Web apps, remote clients <code>sse</code> HTTP + Server-Sent Events Cookie-based Legacy (deprecated)"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#component-wiring","title":"Component wiring","text":""},{"location":"library-docs-from-repos/metatools-mcp/architecture/#runtime-layer-execute_code","title":"Runtime layer (execute_code)","text":"<p>When built with the <code>toolruntime</code> tag, <code>execute_code</code> is backed by a runtime that selects between an unsafe dev backend and a Docker-backed standard backend. Docker is opt-in via <code>METATOOLS_RUNTIME_PROFILE=standard</code>.</p> <p>Standard isolation can also be provided by the WASM backend when enabled (<code>METATOOLS_WASM_ENABLED=true</code>, <code>METATOOLS_RUNTIME_BACKEND=wasm</code>). If Docker is unavailable and WASM is enabled, the server falls back to WASM for the standard profile.</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0'}}}%%\nflowchart LR\n    Agent[\"AI Agent\"] --&gt; MCP[\"metatools-mcp\"]\n    MCP --&gt; Toolcode[\"toolcode Executor\"]\n    Toolcode --&gt; Runtime[\"toolruntime Runtime\"]\n\n    Runtime --&gt; Dev[\"dev profile&lt;br/&gt;unsafe subprocess\"]\n    Runtime --&gt; Standard[\"standard profile&lt;br/&gt;Docker sandbox\"]\n\n    style MCP fill:#2b6cb0,stroke:#2c5282\n    style Toolcode fill:#6b46c1,stroke:#553c9a\n    style Runtime fill:#4a5568,stroke:#2d3748\n    style Dev fill:#dd6b20,stroke:#c05621\n    style Standard fill:#2f855a,stroke:#276749</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/architecture/#progressive-disclosure-flow","title":"Progressive disclosure flow","text":""},{"location":"library-docs-from-repos/metatools-mcp/architecture/#mcp-tool-mapping","title":"MCP tool mapping","text":""},{"location":"library-docs-from-repos/metatools-mcp/changelog/","title":"Changelog","text":""},{"location":"library-docs-from-repos/metatools-mcp/changelog/#unreleased","title":"Unreleased","text":""},{"location":"library-docs-from-repos/metatools-mcp/changelog/#added","title":"Added","text":"<ul> <li>Cursor-based pagination for <code>search_tools</code> and <code>list_namespaces</code> with opaque cursors.</li> <li><code>notifications/tools/list_changed</code> support with debounce and env toggle.</li> <li>Tests for list-changed notifications and cancellation propagation.</li> <li>Progress notifications for <code>run_tool</code>, <code>run_chain</code>, and <code>execute_code</code> when a progress token is provided.</li> <li>Cancellation and timeout error codes (<code>cancelled</code>, <code>timeout</code>) for tool failures.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/changelog/#changed","title":"Changed","text":"<ul> <li><code>list_namespaces</code> input/output schemas now include <code>limit</code>, <code>cursor</code>, and <code>nextCursor</code>.</li> <li>Cursor helpers marked deprecated in favor of toolindex tokens.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/","title":"Design Notes","text":"<p>This page documents the tradeoffs and error semantics behind <code>metatools-mcp</code>.</p>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#design-tradeoffs","title":"Design tradeoffs","text":"<ul> <li>MCP-native surface. All metatools (search, describe, run, chain, execute_code) are exposed via the official MCP Go SDK types to keep wire compatibility.</li> <li>Adapters, not re-implementation. The server delegates to toolindex/tooldocs/toolrun/toolcode via thin adapters so the libraries remain the source of truth.</li> <li>Structured error objects. Tool-level errors are returned in a consistent <code>ErrorObject</code> shape rather than raw Go errors, preserving the MCP tool contract.</li> <li>Explicit limits. Inputs such as <code>limit</code> and <code>max</code> are capped for safe defaults (e.g., search limit cap 100, examples cap 5).</li> <li>Opaque pagination. Cursor tokens are opaque and validated against index mutations to prevent stale paging.</li> <li>Pluggable search. BM25 is optional via build tags (<code>toolsearch</code>) and runtime config via env vars.</li> <li>Change notifications. Tool list updates emit <code>notifications/tools/list_changed</code> with a debounce window; notifications can be disabled and are emitted as a single list change per debounce window.</li> <li>Transport abstraction. The <code>Transport</code> interface decouples protocol handling from server logic, enabling stdio, SSE, and Streamable HTTP without code changes.</li> <li>Runtime isolation. <code>execute_code</code> is optional; the <code>toolruntime</code> build tag enables sandboxed execution with runtime profile selection.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#transport-layer","title":"Transport layer","text":"<p>The transport layer abstracts how clients connect to the MCP server. All transports implement the same <code>Transport</code> interface, ensuring identical behavior regardless of protocol:</p> <pre><code>type Transport interface {\n    Name() string\n    Info() Info\n    Serve(ctx context.Context, server Server) error\n    Close() error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#transport-selection-rationale","title":"Transport selection rationale","text":"Transport Status Use Case Rationale <code>stdio</code> Recommended (local) Claude Desktop, local CLIs Zero config, implicit session, lowest latency <code>streamable</code> Recommended (HTTP) Web apps, remote clients MCP spec 2025-03-26 compliant, session management, bidirectional <code>sse</code> Deprecated Legacy web clients Superseded by streamable per MCP spec"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#streamable-http-design-decisions","title":"Streamable HTTP design decisions","text":"<ol> <li> <p>Single endpoint (<code>/mcp</code>): Follows MCP spec 2025-03-26 with POST/GET/DELETE methods    on one path, simplifying routing and CORS configuration.</p> </li> <li> <p>Session management via header: Uses <code>Mcp-Session-Id</code> header (not cookies) for    stateless load balancing compatibility and explicit session lifecycle.</p> </li> <li> <p>Stateless mode option: Enables serverless/FaaS deployments where session    persistence is impractical. Trade-off: no server-initiated requests.</p> </li> <li> <p>JSON vs SSE response modes: Default SSE streaming supports long-running tools;    <code>JSONResponse=true</code> option for simpler request/response patterns.</p> </li> <li> <p>TLS built-in: Direct TLS support avoids reverse proxy requirements for simple    deployments while allowing proxy termination for complex setups.</p> </li> <li> <p>Graceful shutdown: 5-second timeout allows in-flight requests to complete,    balancing responsiveness with reliability.</p> </li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#error-semantics","title":"Error semantics","text":"<p><code>metatools-mcp</code> distinguishes protocol errors from tool errors:</p> <ul> <li>Protocol errors (invalid input) return a non-nil error from handlers.</li> <li>Tool errors are wrapped into <code>ErrorObject</code> and returned with <code>isError = true</code> so MCP clients treat them as tool failures.</li> </ul> <p>Key error behaviors:</p> <ul> <li><code>run_tool</code> rejects <code>stream=true</code> and <code>backend_override</code> in the default handler (not supported yet).</li> <li><code>run_chain</code> stops on first error and returns partial results with an <code>ErrorObject</code>.</li> <li><code>describe_tool</code>/<code>list_tool_examples</code> return validation errors when required fields are missing.</li> <li>Invalid cursors return JSON-RPC invalid params.</li> <li>Cancellation and timeouts map to <code>cancelled</code> and <code>timeout</code> error codes.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#extension-points","title":"Extension points","text":"<ul> <li>Transport: implement <code>Transport</code> interface to add new protocols (e.g., WebSocket, gRPC).</li> <li>Search strategy: enable BM25 via the <code>toolsearch</code> build tag and env vars.</li> <li>Tool execution: swap <code>toolrun</code> runner implementation or configure different backends.</li> <li>Code execution: plug in a different <code>toolcode.Engine</code> (e.g., toolruntime-backed).</li> <li>Progress: when a progress token is provided, <code>run_tool</code>, <code>run_chain</code>, and <code>execute_code</code> emit progress notifications. If the runner supports progress callbacks, step-level updates are forwarded; otherwise a coarse start/end signal is sent.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#runtime-profile-selection","title":"Runtime profile selection","text":"<p>When built with <code>-tags toolruntime</code>, metatools-mcp wires <code>toolruntime</code> into <code>toolcode</code>:</p> <ul> <li>Dev profile (<code>dev</code>) uses the unsafe subprocess backend for fast iteration.</li> <li>Standard profile (<code>standard</code>) uses Docker by default or WASM when selected.</li> <li>Set <code>METATOOLS_RUNTIME_PROFILE=standard</code> to opt into standard isolation.</li> <li>Use <code>METATOOLS_RUNTIME_BACKEND=wasm</code> with <code>METATOOLS_WASM_ENABLED=true</code> to   prefer the WASM backend (wazero) for standard profile.</li> <li>If Docker is unavailable and WASM is enabled, the server falls back to WASM   for the standard profile.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#operational-guidance","title":"Operational guidance","text":""},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#transport-configuration","title":"Transport configuration","text":"<ul> <li>Use <code>--transport=stdio</code> (default) for Claude Desktop and local CLI integration.</li> <li>Use <code>--transport=streamable --port=8080</code> for HTTP-based clients and web applications.</li> <li>Configure TLS for production HTTP deployments: <code>--tls --tls-cert=cert.pem --tls-key=key.pem</code></li> <li>Use <code>--stateless</code> for serverless/FaaS where session persistence is unavailable.</li> <li>Set <code>METATOOLS_TRANSPORT_STREAMABLE_SESSION_TIMEOUT</code> to control idle session cleanup.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#search-configuration","title":"Search configuration","text":"<ul> <li>Use environment variables to configure search strategy:</li> <li><code>METATOOLS_SEARCH_STRATEGY=lexical|bm25</code></li> <li><code>METATOOLS_SEARCH_BM25_*</code> for weighting and caps</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/design-notes/#general-guidance","title":"General guidance","text":"<ul> <li>Keep tool schemas in <code>toolmodel</code> to preserve MCP compatibility end-to-end.</li> <li>Treat metatools as the stable surface; update libraries behind it as needed.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/examples/","title":"Examples","text":""},{"location":"library-docs-from-repos/metatools-mcp/examples/#register-a-local-tool-expose-mcp-server","title":"Register a local tool + expose MCP server","text":"<pre><code>idx := toolindex.NewInMemoryIndex()\n\nlocal := toolrun.NewLocalRegistry()\nlocal.Register(\"ping\", func(ctx context.Context, args map[string]any) (any, error) {\n  return map[string]any{\"ok\": true}, nil\n})\n\n_ = idx.RegisterTool(toolmodel.Tool{\n  Namespace: \"local\",\n  Tool: mcp.Tool{\n    Name:        \"ping\",\n    Description: \"Simple health check\",\n    InputSchema: map[string]any{\"type\": \"object\"},\n  },\n}, toolmodel.ToolBackend{\n  Kind:  toolmodel.BackendKindLocal,\n  Local: &amp;toolmodel.LocalBackend{Name: \"ping\"},\n})\n\nrunner := toolrun.NewRunner(toolrun.WithIndex(idx), toolrun.WithLocalRegistry(local))\n\ncfg := adapters.NewConfig(idx, tooldocs.NewInMemoryStore(tooldocs.StoreOptions{Index: idx}), runner, nil)\nserver, _ := server.New(cfg)\n_ = server.Run(context.Background(), &amp;mcp.StdioTransport{})\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/examples/#tool-search-and-execution","title":"Tool search and execution","text":"<pre><code>summaries, _ := idx.Search(\"ping\", 3)\n\nres, _ := runner.Run(ctx, summaries[0].ID, map[string]any{})\nfmt.Println(res.Structured)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/","title":"Plan of Record (Ordered Execution)","text":"<p>This page consolidates all proposals and PRDs into a single, ordered execution sequence. It is intentionally Go\u2011architecture focused: concurrency safety, context propagation, and production operational boundaries are explicit in each phase.</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#principles-go-architect-evaluation","title":"Principles (Go Architect Evaluation)","text":"<ul> <li>Context propagation is a contract: every long\u2011running or remote execution path must honor <code>context.Context</code> for cancellation and timeouts.</li> <li>Concurrency safety by default: all registries and caches must be thread\u2011safe under concurrent reads/writes.</li> <li>Errors are data: tool errors should be structured and preserved end\u2011to\u2011end rather than surfaced as raw panics.</li> <li>Stable seams first: prioritize interfaces, wiring, and deterministic behaviors before adding new feature surface.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#current-baseline-already-in-place","title":"Current Baseline (already in place)","text":"<p>These libraries and contracts are the foundation and must remain stable:</p> <ul> <li><code>toolmodel</code> \u2013 core types and MCP schema compatibility</li> <li><code>toolindex</code> \u2013 registry + discovery</li> <li><code>tooldocs</code> \u2013 progressive disclosure docs/examples</li> <li><code>toolrun</code> \u2013 execution and chaining</li> <li><code>toolcode</code> \u2013 code orchestration (optional)</li> <li><code>toolruntime</code> \u2013 sandbox/runtime isolation (optional)</li> <li><code>toolsearch</code> \u2013 BM25 search implementation (optional)</li> </ul> <p>See the master roadmap for the current version matrix: ROADMAP</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-0-spec-alignment-server-correctness-p1","title":"Phase 0 \u2014 Spec Alignment &amp; Server Correctness (P1)","text":"<p>Goal: Ensure the MCP server edge is protocol\u2011correct before expanding capability.</p> <ol> <li>MCP spec alignment (PRD\u2011015)</li> <li><code>notifications/tools/list_changed</code></li> <li>pagination/cursor consistency</li> <li>cancellation propagation</li> <li>optional progress forwarding</li> </ol> <p>Docs: - Proposal: MCP Spec Alignment - PRD: PRD\u2011015</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-1-core-exposure-mvp-foundation","title":"Phase 1 \u2014 Core Exposure (MVP Foundation)","text":"<p>Goal: Provide CLI, configuration, transport, and provider/backends for production use.</p> <ol> <li>CLI foundation (PRD\u2011002)</li> <li>Configuration layer (PRD\u2011003)</li> <li>Transport layer (PRD\u2011004)</li> <li>Tool provider registry (PRD\u2011005)</li> <li>Backend registry (PRD\u2011006)</li> <li>Middleware chain (PRD\u2011007)</li> </ol> <p>Docs: - PRDs: PRD\u2011002, PRD\u2011003,   PRD\u2011004, PRD\u2011005,   PRD\u2011006, PRD\u2011007</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-2-protocol-layer","title":"Phase 2 \u2014 Protocol Layer","text":"<p>Goal: Normalize tools into composable, protocol\u2011agnostic sets without changing core semantics.</p> <ol> <li>tooladapter (PRD\u2011008)</li> <li>toolset (PRD\u2011009)</li> </ol> <p>Docs: - PRD\u2011008 - PRD\u2011009</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-3-crosscutting-observability-caching","title":"Phase 3 \u2014 Cross\u2011Cutting Observability &amp; Caching","text":"<p>Goal: Make the system operationally measurable and resilient.</p> <ol> <li>toolobserve (PRD\u2011010)</li> <li>toolcache (PRD\u2011011)</li> </ol> <p>Docs: - PRD\u2011010 - PRD\u2011011</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-4-enterprise-extensions","title":"Phase 4 \u2014 Enterprise Extensions","text":"<p>Goal: Enable scale, isolation, and advanced discovery without destabilizing core APIs.</p> <ol> <li>Multi\u2011tenancy core (PRD\u2011012)</li> <li>toolsemantic (PRD\u2011013)</li> </ol> <p>Docs: - PRD\u2011012 - PRD\u2011013</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-5-agent-skills","title":"Phase 5 \u2014 Agent Skills","text":"<p>Goal: Higher\u2011level capability composition for reusable workflows.</p> <ol> <li>toolskill (PRD\u2011014)</li> </ol> <p>Docs: - PRD\u2011014</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#phase-6-runtime-expansion","title":"Phase 6 \u2014 Runtime Expansion","text":"<p>Goal: Expand sandbox options and isolation strategies.</p> <ol> <li>toolruntime Docker backend (PRD\u2011001)</li> </ol> <p>Docs: - PRD\u2011001</p>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#go-architecture-review-summary","title":"Go Architecture Review (Summary)","text":"<ul> <li>Context propagation: enforce in all public execution APIs; cancellation must be honored by toolrun/toolruntime to avoid leaked goroutines.</li> <li>Concurrency safety: all registries must be RW\u2011safe; avoid maps without guards under write paths.</li> <li>Pagination correctness: use stable cursors and cap limits across list endpoints.</li> <li>Error semantics: preserve tool errors as structured data; avoid panics in runtime paths.</li> <li>Observability: add tracing hooks before multi\u2011tenant and semantic layers to avoid blind spots.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plan-of-record/#reference-docs","title":"Reference Docs","text":"<ul> <li>ROADMAP</li> <li>Pluggable Architecture</li> <li>Implementation Phases</li> <li>Architecture Evaluation</li> <li>Protocol\u2011Agnostic Tools</li> <li>Multi\u2011Tenancy</li> <li>Architecture Review</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/usage/","title":"Usage","text":""},{"location":"library-docs-from-repos/metatools-mcp/usage/#build-and-run-stdio","title":"Build and run (stdio)","text":"<pre><code>go run ./cmd/metatools serve\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#cli-overview","title":"CLI overview","text":"<pre><code>metatools serve --transport=stdio                        # Local/Claude Desktop (default)\nmetatools serve --transport=streamable --port=8080       # HTTP clients (recommended)\nmetatools serve --transport=sse --port=8080              # Legacy HTTP clients (deprecated)\nmetatools version\nmetatools config validate --config examples/metatools.yaml\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#transport-selection","title":"Transport selection","text":"Transport Use Case Protocol <code>stdio</code> Claude Desktop, local CLI clients stdin/stdout JSON-RPC <code>streamable</code> Web apps, REST APIs, remote clients HTTP POST/GET/DELETE (MCP 2025-03-26) <code>sse</code> Legacy web clients HTTP + Server-Sent Events (deprecated)"},{"location":"library-docs-from-repos/metatools-mcp/usage/#streamable-http-recommended-for-http","title":"Streamable HTTP (recommended for HTTP)","text":"<p>Streamable HTTP is the MCP spec (2025-03-26) transport replacing SSE:</p> <pre><code># Basic HTTP server\nmetatools serve --transport=streamable --port=8080\n\n# With TLS\nmetatools serve --transport=streamable --port=443 \\\n  --tls --tls-cert=cert.pem --tls-key=key.pem\n\n# Stateless mode (no session tracking)\nmetatools serve --transport=streamable --port=8080 --stateless\n</code></pre> <p>Protocol flow: 1. Client POSTs JSON-RPC to <code>/mcp</code> with <code>initialize</code> request 2. Server responds with <code>Mcp-Session-Id</code> header 3. Client includes session ID in subsequent requests 4. Client may GET <code>/mcp</code> for server notification stream 5. Client DELETEs <code>/mcp</code> to terminate session</p> <p>YAML configuration: <pre><code>transport:\n  type: streamable\n  http:\n    host: 0.0.0.0\n    port: 8080\n    tls:\n      enabled: true\n      cert: /path/to/cert.pem\n      key: /path/to/key.pem\n  streamable:\n    stateless: false        # Enable session management\n    json_response: false    # Use SSE streaming (default)\n    session_timeout: 30m    # Clean up idle sessions\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#configuration-files-koanf","title":"Configuration files (Koanf)","text":"<p>Config precedence: 1. Defaults 2. Config file (<code>--config</code>) 3. Environment variables (<code>METATOOLS_</code> prefix) 4. CLI flags</p> <p>Example file: <code>examples/metatools.yaml</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#provider-toggles","title":"Provider toggles","text":"<p>Built-in metatools can be enabled/disabled via <code>providers.*.enabled</code> in the config file (see the <code>providers</code> block in <code>examples/metatools.yaml</code>). This controls which MCP tools are registered at startup.</p>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#middleware-chain","title":"Middleware chain","text":"<p>Configure optional middleware in <code>middleware.chain</code> (ordered) with per-middleware settings under <code>middleware.configs</code>. Built-in middleware: <code>logging</code>, <code>metrics</code>.</p>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#enable-bm25-search-build-tag-env","title":"Enable BM25 search (build tag + env)","text":"<pre><code>go build -tags toolsearch ./cmd/metatools\nMETATOOLS_SEARCH_STRATEGY=bm25 ./metatools\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#environment-variables","title":"Environment variables","text":""},{"location":"library-docs-from-repos/metatools-mcp/usage/#cli-defaults-serve-command","title":"CLI defaults (serve command)","text":"<p>These map directly to <code>metatools serve</code> flags when the flags are not set:</p> Variable Default Description <code>METATOOLS_TRANSPORT</code> <code>stdio</code> Transport type: <code>stdio</code>, <code>streamable</code>, <code>sse</code> <code>METATOOLS_PORT</code> <code>8080</code> Port for HTTP transports <code>METATOOLS_HOST</code> <code>0.0.0.0</code> Host/interface for HTTP transports <code>METATOOLS_CONFIG</code> \"\" Path to config file"},{"location":"library-docs-from-repos/metatools-mcp/usage/#transport-configuration-koanf-config","title":"Transport configuration (Koanf config)","text":"<p>These map to the config schema loaded by <code>config.Load</code>:</p> Variable Default Description <code>METATOOLS_TRANSPORT_TYPE</code> <code>stdio</code> Transport type: <code>stdio</code>, <code>streamable</code>, <code>sse</code> <code>METATOOLS_TRANSPORT_HTTP_HOST</code> <code>0.0.0.0</code> Host/interface for HTTP transports <code>METATOOLS_TRANSPORT_HTTP_PORT</code> <code>8080</code> Port for HTTP transports <code>METATOOLS_TRANSPORT_HTTP_TLS_ENABLED</code> <code>false</code> Enable TLS for HTTP transports <code>METATOOLS_TRANSPORT_HTTP_TLS_CERT</code> \"\" TLS certificate path <code>METATOOLS_TRANSPORT_HTTP_TLS_KEY</code> \"\" TLS key path <code>METATOOLS_TRANSPORT_STREAMABLE_STATELESS</code> <code>false</code> Disable session management <code>METATOOLS_TRANSPORT_STREAMABLE_JSON_RESPONSE</code> <code>false</code> Prefer JSON over SSE streaming <code>METATOOLS_TRANSPORT_STREAMABLE_SESSION_TIMEOUT</code> <code>30m</code> Idle session cleanup duration"},{"location":"library-docs-from-repos/metatools-mcp/usage/#runtime-configuration-toolruntime-build-tag","title":"Runtime configuration (toolruntime build tag)","text":"Variable Default Description <code>METATOOLS_RUNTIME_PROFILE</code> <code>dev</code> <code>dev</code> (unsafe) or <code>standard</code> (Docker) <code>METATOOLS_DOCKER_IMAGE</code> <code>toolruntime-sandbox:latest</code> Docker image for standard profile <code>METATOOLS_WASM_ENABLED</code> <code>false</code> Enable WASM backend (wazero) <code>METATOOLS_RUNTIME_BACKEND</code> <code>docker</code> Preferred standard backend: <code>docker</code> or <code>wasm</code>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#search-configuration","title":"Search configuration","text":"Variable Default Description <code>METATOOLS_SEARCH_STRATEGY</code> <code>lexical</code> <code>lexical</code> or <code>bm25</code> <code>METATOOLS_SEARCH_BM25_NAME_BOOST</code> <code>3</code> BM25 name field boost <code>METATOOLS_SEARCH_BM25_NAMESPACE_BOOST</code> <code>2</code> BM25 namespace field boost <code>METATOOLS_SEARCH_BM25_TAGS_BOOST</code> <code>2</code> BM25 tags field boost <code>METATOOLS_SEARCH_BM25_MAX_DOCS</code> <code>0</code> Max docs to index (0=unlimited) <code>METATOOLS_SEARCH_BM25_MAX_DOCTEXT_LEN</code> <code>0</code> Max doc text length (0=unlimited) <code>METATOOLS_NOTIFY_TOOL_LIST_CHANGED</code> <code>true</code> Emit <code>notifications/tools/list_changed</code> on index updates <code>METATOOLS_NOTIFY_TOOL_LIST_CHANGED_DEBOUNCE_MS</code> <code>150</code> Debounce window for list change notifications"},{"location":"library-docs-from-repos/metatools-mcp/usage/#pagination-and-cursors","title":"Pagination and cursors","text":"<ul> <li><code>search_tools</code> and <code>list_namespaces</code> accept <code>limit</code> (default 20, max 100) and <code>cursor</code>.</li> <li>Responses include <code>nextCursor</code> when more results are available.</li> <li>Cursor tokens are opaque and invalid cursors return JSON-RPC invalid params.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#tool-list-change-notifications","title":"Tool list change notifications","text":"<ul> <li><code>notifications/tools/list_changed</code> is emitted when the underlying toolindex changes.</li> <li>Notifications are debounced to avoid client spam and can be disabled with <code>METATOOLS_NOTIFY_TOOL_LIST_CHANGED=false</code>.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#progress-notifications","title":"Progress notifications","text":"<p>When callers supply a progress token, <code>run_tool</code>, <code>run_chain</code>, and <code>execute_code</code> emit progress notifications. If the runner exposes progress callbacks, step-level updates are forwarded; otherwise a coarse start/end signal is emitted.</p>"},{"location":"library-docs-from-repos/metatools-mcp/usage/#optional-toolruntime-support","title":"Optional toolruntime support","text":"<pre><code>go run -tags toolruntime ./cmd/metatools\n</code></pre> <p>This enables <code>execute_code</code> backed by a <code>toolruntime</code> engine. By default it uses the <code>dev</code> (unsafe) profile; set <code>METATOOLS_RUNTIME_PROFILE=standard</code> to enable the Docker backend when available. To use WASM instead, set <code>METATOOLS_WASM_ENABLED=true</code> and <code>METATOOLS_RUNTIME_BACKEND=wasm</code>.</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/","title":"User Journey","text":"<p>This journey shows the full end-to-end agent workflow via MCP metatools.</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#transport-selection","title":"Transport selection","text":"<p>Before tool discovery begins, clients establish a connection via one of the supported transports. The transport choice depends on the client environment:</p> <pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0'}}}%%\nflowchart LR\n    subgraph clients[\"Clients\"]\n        Claude[\"\ud83d\udda5\ufe0f Claude Desktop\"]\n        WebApp[\"\ud83c\udf10 Web Application\"]\n        CLI[\"\u2328\ufe0f CLI Tool\"]\n    end\n\n    subgraph transports[\"Transport Layer\"]\n        Stdio[\"\ud83d\udcdf stdio&lt;br/&gt;&lt;small&gt;stdin/stdout&lt;/small&gt;\"]\n        Streamable[\"\ud83d\udd04 streamable&lt;br/&gt;&lt;small&gt;HTTP POST/GET/DELETE&lt;/small&gt;\"]\n        SSE[\"\ud83d\udce1 sse&lt;br/&gt;&lt;small&gt;deprecated&lt;/small&gt;\"]\n    end\n\n    subgraph server[\"metatools-mcp\"]\n        MCP[\"\ud83d\udd37 MCP Server\"]\n    end\n\n    Claude --&gt; Stdio --&gt; MCP\n    WebApp --&gt; Streamable --&gt; MCP\n    CLI --&gt; Stdio --&gt; MCP\n    WebApp -.-&gt; SSE -.-&gt; MCP\n\n    style clients fill:#4a5568,stroke:#2d3748\n    style transports fill:#805ad5,stroke:#6b46c1\n    style server fill:#2b6cb0,stroke:#2c5282\n    style SSE fill:#718096,stroke:#4a5568,stroke-dasharray: 5 5</code></pre> Transport Client Type Session Protocol <code>stdio</code> Local CLI, Claude Desktop Implicit stdin/stdout JSON-RPC <code>streamable</code> Web apps, remote clients Mcp-Session-Id header HTTP (MCP 2025-03-26) <code>sse</code> Legacy web clients Cookie-based HTTP + SSE (deprecated) <p>Streamable HTTP session flow: 1. Client POSTs <code>initialize</code> request to <code>/mcp</code> 2. Server returns <code>Mcp-Session-Id</code> header 3. Client includes session ID in all subsequent requests 4. Client may open GET stream for server notifications 5. Client sends DELETE to terminate session</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#end-to-end-flow-agent-view","title":"End-to-end flow (agent view)","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0', 'primaryTextColor': '#fff'}}}%%\nsequenceDiagram\n    autonumber\n\n    participant Agent as \ud83e\udd16 AI Agent\n    participant Transport as \ud83d\udd04 Transport\n    participant MCP as \ud83d\udd37 metatools-mcp\n    participant Index as \ud83d\udcc7 toolindex\n    participant Docs as \ud83d\udcda tooldocs\n    participant Run as \u25b6\ufe0f toolrun\n    participant Code as \ud83d\udcbb toolcode\n\n    rect rgb(128, 90, 213, 0.1)\n        Note over Agent,MCP: Phase 0: Connection\n        Agent-&gt;&gt;+Transport: Connect (stdio/streamable/sse)\n        Transport-&gt;&gt;+MCP: initialize\n        MCP--&gt;&gt;-Transport: capabilities + session\n        Transport--&gt;&gt;-Agent: Ready\n    end\n\n    rect rgb(43, 108, 176, 0.1)\n        Note over Agent,Index: Phase 1: Discovery\n        Agent-&gt;&gt;+MCP: search_tools(\"create issue\", 5)\n        MCP-&gt;&gt;+Index: Search(query, limit)\n        Index--&gt;&gt;-MCP: Summary[]\n        MCP--&gt;&gt;-Agent: summaries (no schemas)\n    end\n\n    rect rgb(214, 158, 46, 0.1)\n        Note over Agent,Docs: Phase 2: Documentation\n        Agent-&gt;&gt;+MCP: describe_tool(id, \"schema\")\n        MCP-&gt;&gt;+Docs: DescribeTool(id, DetailSchema)\n        Docs--&gt;&gt;-MCP: ToolDoc\n        MCP--&gt;&gt;-Agent: tool schema + description\n    end\n\n    rect rgb(56, 161, 105, 0.1)\n        Note over Agent,Run: Phase 3: Execution\n        Agent-&gt;&gt;+MCP: run_tool(id, args)\n        MCP-&gt;&gt;+Run: Run(ctx, id, args)\n        Run--&gt;&gt;-MCP: RunResult\n        MCP--&gt;&gt;-Agent: result\n    end\n\n    rect rgb(107, 70, 193, 0.1)\n        Note over Agent,Code: Phase 4: Orchestration (optional)\n        Agent-&gt;&gt;+MCP: execute_code(snippet)\n        MCP-&gt;&gt;+Code: ExecuteCode(ctx, params)\n        Code--&gt;&gt;-MCP: ExecuteResult\n        MCP--&gt;&gt;-Agent: value + tool calls\n    end</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#mcp-tool-surface","title":"MCP Tool Surface","text":"<pre><code>%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#2b6cb0'}}}%%\nflowchart TB\n    subgraph agent[\"AI Agent\"]\n        Request[\"\ud83d\udce5 MCP Request&lt;br/&gt;&lt;small&gt;JSON-RPC&lt;/small&gt;\"]\n    end\n\n    subgraph transport[\"Transport Layer\"]\n        Stdio[\"\ud83d\udcdf stdio\"]\n        Streamable[\"\ud83d\udd04 streamable\"]\n    end\n\n    subgraph metatools[\"metatools-mcp\"]\n        Server[\"\ud83d\udd37 MCP Server\"]\n\n        subgraph discovery[\"Discovery Tools\"]\n            SearchTools[\"\ud83d\udd0d search_tools\"]\n            ListNS[\"\ud83d\udcc1 list_namespaces\"]\n        end\n\n        subgraph docs[\"Documentation Tools\"]\n            DescribeTool[\"\ud83d\udcda describe_tool\"]\n            ListExamples[\"\ud83d\udca1 list_tool_examples\"]\n        end\n\n        subgraph execution[\"Execution Tools\"]\n            RunTool[\"\u25b6\ufe0f run_tool\"]\n            RunChain[\"\ud83d\udd17 run_chain\"]\n        end\n\n        subgraph orchestration[\"Orchestration (optional)\"]\n            ExecCode[\"\ud83d\udcbb execute_code\"]\n        end\n    end\n\n    subgraph stack[\"Stack Libraries\"]\n        Index[\"\ud83d\udcc7 toolindex\"]\n        Docs2[\"\ud83d\udcda tooldocs\"]\n        Run[\"\u25b6\ufe0f toolrun\"]\n        Code[\"\ud83d\udcbb toolcode\"]\n    end\n\n    Request --&gt; Stdio &amp; Streamable --&gt; Server\n    Server --&gt; SearchTools --&gt; Index\n    Server --&gt; ListNS --&gt; Index\n    Server --&gt; DescribeTool --&gt; Docs2\n    Server --&gt; ListExamples --&gt; Docs2\n    Server --&gt; RunTool --&gt; Run\n    Server --&gt; RunChain --&gt; Run\n    Server --&gt; ExecCode --&gt; Code\n\n    style agent fill:#4a5568,stroke:#2d3748\n    style transport fill:#805ad5,stroke:#6b46c1\n    style metatools fill:#2b6cb0,stroke:#2c5282,stroke-width:2px\n    style discovery fill:#3182ce,stroke:#2c5282\n    style docs fill:#d69e2e,stroke:#b7791f\n    style execution fill:#38a169,stroke:#276749\n    style orchestration fill:#6b46c1,stroke:#553c9a\n    style stack fill:#718096,stroke:#4a5568</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#step-by-step","title":"Step-by-step","text":"<ol> <li>Connect via transport (stdio for local, streamable HTTP for remote).</li> <li>Discover tools with <code>search_tools</code> (summary-only results).</li> <li>Inspect schema using <code>describe_tool</code> (schema or full detail).</li> <li>Execute a single tool with <code>run_tool</code> or a sequence with <code>run_chain</code>.</li> <li>Orchestrate complex flows using <code>execute_code</code> (optional).</li> </ol> <p>When built with <code>-tags toolruntime</code>, <code>execute_code</code> runs in a sandboxed runtime. Default profile is <code>dev</code> (unsafe); set <code>METATOOLS_RUNTIME_PROFILE=standard</code> to enable Docker when available. Set <code>METATOOLS_WASM_ENABLED=true</code> and <code>METATOOLS_RUNTIME_BACKEND=wasm</code> to use the WASM backend instead.</p>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#example-full-agent-workflow","title":"Example: full agent workflow","text":"<pre><code>1) search_tools(\"create issue\", limit=5)\n2) describe_tool(\"github:create_issue\", detail_level=\"schema\")\n3) run_tool(\"github:create_issue\", args={...})\n4) run_chain([{tool_id:\"github:get_issue\"}, {tool_id:\"github:add_label\", use_previous:true}])\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#expected-outcomes","title":"Expected outcomes","text":"<ul> <li>Stable MCP-compatible APIs for discovery, documentation, and execution.</li> <li>Consistent error objects for tool failures.</li> <li>Progressive disclosure to minimize token costs.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/user-journey/#common-failure-modes","title":"Common failure modes","text":"<ul> <li>Invalid input payloads (handler validation errors).</li> <li>Tool-level errors returned in <code>ErrorObject</code> with <code>code</code> and <code>op</code> fields.</li> <li>Unsupported options (e.g., <code>stream=true</code> for <code>run_tool</code>).</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/","title":"metatools-mcp Plans","text":"Item File Status PRD-016 <code>2026-01-30-prd-016-interface-contracts.md</code> Done Execution plan <code>2026-01-30-prd-016-execution-plan.md</code> Done PRD-017 <code>2026-01-30-prd-017-auth-middleware.md</code> Ready"},{"location":"library-docs-from-repos/metatools-mcp/plans/#architecture-proposals","title":"Architecture Proposals","text":"Proposal File Purpose Persistence Boundary <code>../proposals/persistence-boundary.md</code> Interfaces in core, implementations out Auth Middleware <code>../proposals/auth-middleware.md</code> Pluggable authentication &amp; authorization"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/","title":"PRD-016 Execution Plan \u2014 metatools-mcp (TDD)","text":"<p>Status: Done Date: 2026-01-30 PRD: <code>2026-01-30-prd-016-interface-contracts.md</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#tdd-workflow-required","title":"TDD Workflow (required)","text":"<ol> <li>Red \u2014 write failing contract tests</li> <li>Red verification \u2014 run tests</li> <li>Green \u2014 minimal code/doc changes</li> <li>Green verification \u2014 run tests</li> <li>Commit \u2014 one commit per task</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#tasks","title":"Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#task-0-inventory-contract-outline","title":"Task 0 \u2014 Inventory + contract outline","text":"<ul> <li>Confirm interface list and method signatures.</li> <li>Draft explicit contract bullets for each interface.</li> <li>Update docs/plans/README.md with this PRD + plan.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#task-1-contract-tests-redgreen","title":"Task 1 \u2014 Contract tests (Red/Green)","text":"<ul> <li>Add <code>*_contract_test.go</code> with tests for each interface listed below.</li> <li>Use stub implementations where needed.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#task-2-godoc-contracts","title":"Task 2 \u2014 GoDoc contracts","text":"<ul> <li>Add/expand GoDoc on each interface with explicit contract clauses (thread-safety, errors, context, ownership).</li> <li>Update README/design-notes if user-facing.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#task-3-verification","title":"Task 3 \u2014 Verification","text":"<ul> <li>Run <code>go test ./...</code></li> <li>Run linters if configured (golangci-lint / gosec).</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#test-skeletons-contract_testgo","title":"Test Skeletons (contract_test.go)","text":""},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#metricscollector","title":"MetricsCollector","text":"<pre><code>func TestMetricsCollector_Contract(t *testing.T) {\n    // Methods:\n    // - Start(tool string)\n    // - Finish(tool string, err error, duration time.Duration)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#server","title":"Server","text":"<pre><code>func TestServer_Contract(t *testing.T) {\n    // Methods:\n    // - Run(ctx context.Context, transport mcp.Transport) error\n    // - MCPServer() *mcp.Server\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#transport","title":"Transport","text":"<pre><code>func TestTransport_Contract(t *testing.T) {\n    // Methods:\n    // - Name() string\n    // - Info() Info\n    // - Serve(ctx context.Context, server Server) error\n    // - Close() error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#toolprovider","title":"ToolProvider","text":"<pre><code>func TestToolProvider_Contract(t *testing.T) {\n    // Methods:\n    // - Name() string\n    // - Enabled() bool\n    // - Tool() mcp.Tool\n    // - Handle(ctx context.Context, req *mcp.CallToolRequest, args map[string]any) (*mcp.CallToolResult, any, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#configurableprovider","title":"ConfigurableProvider","text":"<pre><code>func TestConfigurableProvider_Contract(t *testing.T) {\n    // Methods:\n    // - ToolProvider\n    // - Configure(cfg map[string]any) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#streamingprovider","title":"StreamingProvider","text":"<pre><code>func TestStreamingProvider_Contract(t *testing.T) {\n    // Methods:\n    // - ToolProvider\n    // - HandleStream(ctx context.Context, req *mcp.CallToolRequest, args map[string]any) (&lt;-chan any, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#backend","title":"Backend","text":"<pre><code>func TestBackend_Contract(t *testing.T) {\n    // Methods:\n    // - Kind() string\n    // - Name() string\n    // - Enabled() bool\n    // - ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n    // - Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n    // - Start(ctx context.Context) error\n    // - Stop() error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#configurablebackend","title":"ConfigurableBackend","text":"<pre><code>func TestConfigurableBackend_Contract(t *testing.T) {\n    // Methods:\n    // - Backend\n    // - Configure(raw []byte) error\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#streamingbackend","title":"StreamingBackend","text":"<pre><code>func TestStreamingBackend_Contract(t *testing.T) {\n    // Methods:\n    // - Backend\n    // - ExecuteStream(ctx context.Context, tool string, args map[string]any) (&lt;-chan any, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#index","title":"Index","text":"<pre><code>func TestIndex_Contract(t *testing.T) {\n    // Methods:\n    // - SearchPage(ctx context.Context, query string, limit int, cursor string) ([]metatools.ToolSummary, string, error)\n    // - ListNamespacesPage(ctx context.Context, limit int, cursor string) ([]string, string, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#store","title":"Store","text":"<pre><code>func TestStore_Contract(t *testing.T) {\n    // Methods:\n    // - DescribeTool(ctx context.Context, id string, level string) (ToolDoc, error)\n    // - ListExamples(ctx context.Context, id string, maxExamples int) ([]metatools.ToolExample, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#runner","title":"Runner","text":"<pre><code>func TestRunner_Contract(t *testing.T) {\n    // Methods:\n    // - Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    // - RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#progressrunner","title":"ProgressRunner","text":"<pre><code>func TestProgressRunner_Contract(t *testing.T) {\n    // Methods:\n    // - RunWithProgress(ctx context.Context, toolID string, args map[string]any, onProgress func(ProgressEvent)) (RunResult, error)\n    // - RunChainWithProgress(ctx context.Context, steps []ChainStep, onProgress func(ProgressEvent)) (RunResult, []StepResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-execution-plan/#executor","title":"Executor","text":"<pre><code>func TestExecutor_Contract(t *testing.T) {\n    // Methods:\n    // - ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)\n    // Contract assertions:\n    // - Concurrency guarantees documented and enforced\n    // - Error semantics (types/wrapping) validated\n    // - Context cancellation respected (if applicable)\n    // - Deterministic ordering where required\n    // - Nil/zero input handling specified\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/","title":"PRD-016 Interface Contracts \u2014 metatools-mcp","text":"<p>Status: Done Date: 2026-01-30</p>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#overview","title":"Overview","text":"<p>Define explicit interface contracts (GoDoc + documented semantics) for all interfaces in this repo. Contracts must state concurrency guarantees, error semantics, ownership of inputs/outputs, and context handling.</p>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#goals","title":"Goals","text":"<ul> <li>Every interface has explicit GoDoc describing behavioral contract.</li> <li>Contract behavior is codified in tests (contract tests).</li> <li>Docs/README updated where behavior is user-facing.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#non-goals","title":"Non-Goals","text":"<ul> <li>No API shape changes unless required to satisfy the contract tests.</li> <li>No new features beyond contract clarity and tests.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#interface-inventory","title":"Interface Inventory","text":"Interface File Methods <code>MetricsCollector</code> <code>metatools-mcp/internal/middleware/metrics.go:22</code> Start(tool string)Finish(tool string, err error, duration time.Duration) <code>Server</code> <code>metatools-mcp/internal/transport/transport.go:10</code> Run(ctx context.Context, transport mcp.Transport) errorMCPServer() *mcp.Server <code>Transport</code> <code>metatools-mcp/internal/transport/transport.go:23</code> Name() stringInfo() InfoServe(ctx context.Context, server Server) errorClose() error <code>ToolProvider</code> <code>metatools-mcp/internal/provider/provider.go:11</code> Name() stringEnabled() boolTool() mcp.ToolHandle(ctx context.Context, req mcp.CallToolRequest, args map[string]any) (mcp.CallToolResult, any, error) <code>ConfigurableProvider</code> <code>metatools-mcp/internal/provider/provider.go:27</code> ToolProviderConfigure(cfg map[string]any) error <code>StreamingProvider</code> <code>metatools-mcp/internal/provider/provider.go:35</code> ToolProviderHandleStream(ctx context.Context, req *mcp.CallToolRequest, args map[string]any) (&lt;-chan any, error) <code>Backend</code> <code>metatools-mcp/internal/backend/backend.go:20</code> Kind() stringName() stringEnabled() boolListTools(ctx context.Context) ([]toolmodel.Tool, error)Execute(ctx context.Context, tool string, args map[string]any) (any, error)Start(ctx context.Context) errorStop() error <code>ConfigurableBackend</code> <code>metatools-mcp/internal/backend/backend.go:44</code> BackendConfigure(raw []byte) error <code>StreamingBackend</code> <code>metatools-mcp/internal/backend/backend.go:51</code> BackendExecuteStream(ctx context.Context, tool string, args map[string]any) (&lt;-chan any, error) <code>Index</code> <code>metatools-mcp/internal/handlers/interfaces.go:10</code> SearchPage(ctx context.Context, query string, limit int, cursor string) ([]metatools.ToolSummary, string, error)ListNamespacesPage(ctx context.Context, limit int, cursor string) ([]string, string, error) <code>Store</code> <code>metatools-mcp/internal/handlers/interfaces.go:26</code> DescribeTool(ctx context.Context, id string, level string) (ToolDoc, error)ListExamples(ctx context.Context, id string, maxExamples int) ([]metatools.ToolExample, error) <code>Runner</code> <code>metatools-mcp/internal/handlers/interfaces.go:64</code> Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error) <code>ProgressRunner</code> <code>metatools-mcp/internal/handlers/interfaces.go:70</code> RunWithProgress(ctx context.Context, toolID string, args map[string]any, onProgress func(ProgressEvent)) (RunResult, error)RunChainWithProgress(ctx context.Context, steps []ChainStep, onProgress func(ProgressEvent)) (RunResult, []StepResult, error) <code>Executor</code> <code>metatools-mcp/internal/handlers/interfaces.go:92</code> ExecuteCode(ctx context.Context, params ExecuteParams) (ExecuteResult, error)"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#contract-template-apply-per-interface","title":"Contract Template (apply per interface)","text":"<ul> <li>Thread-safety: explicitly state if safe for concurrent use.</li> <li>Context: cancellation/deadline handling (if context is a parameter).</li> <li>Errors: classification, retryability, and wrapping expectations.</li> <li>Ownership: who owns/allocates inputs/outputs; mutation expectations.</li> <li>Determinism/order: ordering guarantees for returned slices/maps/streams.</li> <li>Nil/zero handling: behavior for nil inputs or empty values.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-016-interface-contracts/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>All interfaces have GoDoc with explicit behavioral contract.</li> <li>Contract tests exist and pass.</li> <li>No interface contract contradictions across repos.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/","title":"PRD-017: Pluggable Authentication &amp; Authorization Middleware","text":"<p>Status: Ready for Implementation Date: 2026-01-30 Priority: P1 (High) Depends On: PRD-016 (Interface Contracts) Proposal: auth-middleware.md Architecture: persistence-boundary.md</p>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#overview","title":"Overview","text":"<p>Implement a 100% pluggable authentication and authorization middleware following the persistence boundary architecture. Core interfaces live in <code>internal/auth</code>, implementations are pluggable via factory registration.</p>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#scope","title":"Scope","text":""},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#in-scope","title":"In Scope","text":"<ul> <li>Core auth interfaces (<code>Authenticator</code>, <code>Authorizer</code>, <code>Identity</code>)</li> <li>JWT authenticator with JWKS support</li> <li>API Key authenticator with pluggable store interface</li> <li>Simple RBAC authorizer (no external dependencies)</li> <li>Casbin authorizer (optional, build-tagged)</li> <li>Auth middleware integration with existing middleware chain</li> <li>Context propagation helpers</li> <li>YAML configuration support</li> <li>CLI flags for basic auth configuration</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#out-of-scope-future-prds","title":"Out of Scope (Future PRDs)","text":"<ul> <li>OAuth2 token introspection (PRD-018)</li> <li>mTLS authenticator (PRD-019)</li> <li>OPA authorizer (PRD-020)</li> <li>Persistence implementations (toolpersist library)</li> <li>Multi-tenancy integration (after auth foundation)</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#implementation-tasks","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-1-core-identity-types","title":"Task 1: Core Identity Types","text":"<p>Files: - <code>internal/auth/identity.go</code> - <code>internal/auth/identity_test.go</code></p> <pre><code>// internal/auth/identity.go\npackage auth\n\nimport (\n    \"context\"\n    \"time\"\n)\n\n// Identity represents an authenticated principal.\ntype Identity struct {\n    Principal   string            `json:\"principal\"`\n    TenantID    string            `json:\"tenant_id,omitempty\"`\n    Roles       []string          `json:\"roles,omitempty\"`\n    Permissions []string          `json:\"permissions,omitempty\"`\n    Claims      map[string]any    `json:\"claims,omitempty\"`\n    Method      AuthMethod        `json:\"method\"`\n    Metadata    map[string]string `json:\"metadata,omitempty\"`\n    ExpiresAt   time.Time         `json:\"expires_at,omitempty\"`\n    IssuedAt    time.Time         `json:\"issued_at\"`\n}\n\n// AuthMethod identifies how the identity was authenticated.\ntype AuthMethod string\n\nconst (\n    AuthMethodJWT       AuthMethod = \"jwt\"\n    AuthMethodOAuth2    AuthMethod = \"oauth2\"\n    AuthMethodAPIKey    AuthMethod = \"api_key\"\n    AuthMethodMTLS      AuthMethod = \"mtls\"\n    AuthMethodBasic     AuthMethod = \"basic\"\n    AuthMethodAnonymous AuthMethod = \"anonymous\"\n)\n\n// HasRole checks if the identity has a specific role.\nfunc (id *Identity) HasRole(role string) bool {\n    for _, r := range id.Roles {\n        if r == role {\n            return true\n        }\n    }\n    return false\n}\n\n// HasPermission checks if the identity has a specific permission.\nfunc (id *Identity) HasPermission(perm string) bool {\n    for _, p := range id.Permissions {\n        if p == perm {\n            return true\n        }\n    }\n    return false\n}\n\n// HasAnyRole checks if the identity has any of the specified roles.\nfunc (id *Identity) HasAnyRole(roles ...string) bool {\n    for _, role := range roles {\n        if id.HasRole(role) {\n            return true\n        }\n    }\n    return false\n}\n\n// IsExpired checks if the identity has expired.\nfunc (id *Identity) IsExpired() bool {\n    if id.ExpiresAt.IsZero() {\n        return false\n    }\n    return time.Now().After(id.ExpiresAt)\n}\n\n// Context key for identity storage.\ntype identityKey struct{}\n\n// WithIdentity adds an identity to the context.\nfunc WithIdentity(ctx context.Context, id *Identity) context.Context {\n    return context.WithValue(ctx, identityKey{}, id)\n}\n\n// IdentityFromContext retrieves the identity from context.\nfunc IdentityFromContext(ctx context.Context) *Identity {\n    if v := ctx.Value(identityKey{}); v != nil {\n        return v.(*Identity)\n    }\n    return nil\n}\n\n// PrincipalFromContext retrieves the principal from context.\nfunc PrincipalFromContext(ctx context.Context) string {\n    if id := IdentityFromContext(ctx); id != nil {\n        return id.Principal\n    }\n    return \"\"\n}\n\n// TenantIDFromContext retrieves the tenant ID from context.\nfunc TenantIDFromContext(ctx context.Context) string {\n    if id := IdentityFromContext(ctx); id != nil {\n        return id.TenantID\n    }\n    return \"\"\n}\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/identity_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"testing\"\n    \"time\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestIdentity_HasRole(t *testing.T) {\n    id := &amp;Identity{Roles: []string{\"admin\", \"user\"}}\n\n    assert.True(t, id.HasRole(\"admin\"))\n    assert.True(t, id.HasRole(\"user\"))\n    assert.False(t, id.HasRole(\"superuser\"))\n}\n\nfunc TestIdentity_HasPermission(t *testing.T) {\n    id := &amp;Identity{Permissions: []string{\"read:tools\", \"write:tools\"}}\n\n    assert.True(t, id.HasPermission(\"read:tools\"))\n    assert.False(t, id.HasPermission(\"delete:tools\"))\n}\n\nfunc TestIdentity_HasAnyRole(t *testing.T) {\n    id := &amp;Identity{Roles: []string{\"user\"}}\n\n    assert.True(t, id.HasAnyRole(\"admin\", \"user\"))\n    assert.False(t, id.HasAnyRole(\"admin\", \"superuser\"))\n}\n\nfunc TestIdentity_IsExpired(t *testing.T) {\n    t.Run(\"not expired\", func(t *testing.T) {\n        id := &amp;Identity{ExpiresAt: time.Now().Add(time.Hour)}\n        assert.False(t, id.IsExpired())\n    })\n\n    t.Run(\"expired\", func(t *testing.T) {\n        id := &amp;Identity{ExpiresAt: time.Now().Add(-time.Hour)}\n        assert.True(t, id.IsExpired())\n    })\n\n    t.Run(\"no expiry\", func(t *testing.T) {\n        id := &amp;Identity{}\n        assert.False(t, id.IsExpired())\n    })\n}\n\nfunc TestIdentityContext(t *testing.T) {\n    ctx := context.Background()\n\n    // No identity in context\n    assert.Nil(t, IdentityFromContext(ctx))\n    assert.Empty(t, PrincipalFromContext(ctx))\n    assert.Empty(t, TenantIDFromContext(ctx))\n\n    // Add identity\n    id := &amp;Identity{\n        Principal: \"alice\",\n        TenantID:  \"acme-corp\",\n    }\n    ctx = WithIdentity(ctx, id)\n\n    // Retrieve identity\n    retrieved := IdentityFromContext(ctx)\n    require.NotNil(t, retrieved)\n    assert.Equal(t, \"alice\", retrieved.Principal)\n    assert.Equal(t, \"acme-corp\", retrieved.TenantID)\n\n    // Convenience helpers\n    assert.Equal(t, \"alice\", PrincipalFromContext(ctx))\n    assert.Equal(t, \"acme-corp\", TenantIDFromContext(ctx))\n}\n</code></pre> <p>Verification:</p> <pre><code>go test ./internal/auth/... -run TestIdentity -v\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-2-authenticator-interface-types","title":"Task 2: Authenticator Interface &amp; Types","text":"<p>Files: - <code>internal/auth/authenticator.go</code> - <code>internal/auth/authenticator_test.go</code></p> <pre><code>// internal/auth/authenticator.go\npackage auth\n\nimport (\n    \"context\"\n    \"crypto/x509\"\n    \"errors\"\n)\n\n// Common authentication errors.\nvar (\n    ErrUnauthorized       = errors.New(\"unauthorized\")\n    ErrInvalidCredentials = errors.New(\"invalid credentials\")\n    ErrInvalidToken       = errors.New(\"invalid token\")\n    ErrTokenExpired       = errors.New(\"token expired\")\n    ErrMissingCredentials = errors.New(\"missing credentials\")\n    ErrUnsupportedMethod  = errors.New(\"unsupported authentication method\")\n)\n\n// AuthRequest contains request data for authentication.\ntype AuthRequest struct {\n    Headers    map[string][]string\n    Method     string\n    Resource   string\n    RemoteAddr string\n    TLSInfo    *TLSInfo\n    Raw        any\n}\n\n// TLSInfo contains client certificate information.\ntype TLSInfo struct {\n    PeerCertificates []*x509.Certificate\n    Verified         bool\n    CommonName       string\n    DNSNames         []string\n}\n\n// GetHeader retrieves a header value.\nfunc (r *AuthRequest) GetHeader(name string) string {\n    if values, ok := r.Headers[name]; ok &amp;&amp; len(values) &gt; 0 {\n        return values[0]\n    }\n    return \"\"\n}\n\n// AuthResult encapsulates authentication outcome.\ntype AuthResult struct {\n    Authenticated bool\n    Identity      *Identity\n    Error         error\n    Challenge     string\n}\n\n// Authenticator validates credentials and returns an identity.\ntype Authenticator interface {\n    Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error)\n    Name() string\n    Supports(ctx context.Context, req *AuthRequest) bool\n}\n\n// AuthenticatorFunc is a function adapter for Authenticator.\ntype AuthenticatorFunc func(ctx context.Context, req *AuthRequest) (*AuthResult, error)\n\n// Authenticate implements Authenticator.\nfunc (f AuthenticatorFunc) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    return f(ctx, req)\n}\n\n// Name implements Authenticator.\nfunc (f AuthenticatorFunc) Name() string { return \"func\" }\n\n// Supports implements Authenticator.\nfunc (f AuthenticatorFunc) Supports(ctx context.Context, req *AuthRequest) bool { return true }\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/authenticator_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestAuthRequest_GetHeader(t *testing.T) {\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer token123\"},\n            \"X-API-Key\":     {\"key456\"},\n        },\n    }\n\n    assert.Equal(t, \"Bearer token123\", req.GetHeader(\"Authorization\"))\n    assert.Equal(t, \"key456\", req.GetHeader(\"X-API-Key\"))\n    assert.Empty(t, req.GetHeader(\"Missing\"))\n}\n\nfunc TestAuthenticatorFunc(t *testing.T) {\n    called := false\n    auth := AuthenticatorFunc(func(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n        called = true\n        return &amp;AuthResult{Authenticated: true}, nil\n    })\n\n    result, err := auth.Authenticate(context.Background(), &amp;AuthRequest{})\n    assert.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.True(t, called)\n    assert.Equal(t, \"func\", auth.Name())\n    assert.True(t, auth.Supports(context.Background(), &amp;AuthRequest{}))\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-3-composite-authenticator","title":"Task 3: Composite Authenticator","text":"<p>Files: - <code>internal/auth/composite.go</code> - <code>internal/auth/composite_test.go</code></p> <pre><code>// internal/auth/composite.go\npackage auth\n\nimport (\n    \"context\"\n    \"errors\"\n)\n\n// CompositeAuthenticator tries multiple authenticators in order.\ntype CompositeAuthenticator struct {\n    Authenticators []Authenticator\n    StopOnFirst    bool\n}\n\n// NewCompositeAuthenticator creates a composite authenticator.\nfunc NewCompositeAuthenticator(authenticators ...Authenticator) *CompositeAuthenticator {\n    return &amp;CompositeAuthenticator{\n        Authenticators: authenticators,\n        StopOnFirst:    true,\n    }\n}\n\n// Authenticate implements Authenticator.\nfunc (c *CompositeAuthenticator) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    var lastResult *AuthResult\n    var errs []error\n\n    for _, auth := range c.Authenticators {\n        if !auth.Supports(ctx, req) {\n            continue\n        }\n\n        result, err := auth.Authenticate(ctx, req)\n        if err != nil {\n            errs = append(errs, err)\n            continue\n        }\n\n        if result.Authenticated {\n            if c.StopOnFirst {\n                return result, nil\n            }\n            lastResult = result\n        } else {\n            lastResult = result\n        }\n    }\n\n    if lastResult != nil &amp;&amp; lastResult.Authenticated {\n        return lastResult, nil\n    }\n\n    if lastResult != nil {\n        return lastResult, nil\n    }\n\n    // No authenticator succeeded\n    return &amp;AuthResult{\n        Authenticated: false,\n        Challenge:     \"Bearer\",\n        Error:         errors.Join(append([]error{ErrUnauthorized}, errs...)...),\n    }, nil\n}\n\n// Name implements Authenticator.\nfunc (c *CompositeAuthenticator) Name() string {\n    return \"composite\"\n}\n\n// Supports implements Authenticator.\nfunc (c *CompositeAuthenticator) Supports(ctx context.Context, req *AuthRequest) bool {\n    for _, auth := range c.Authenticators {\n        if auth.Supports(ctx, req) {\n            return true\n        }\n    }\n    return false\n}\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/composite_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"errors\"\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestCompositeAuthenticator_FirstSucceeds(t *testing.T) {\n    auth1 := &amp;mockAuthenticator{\n        name:     \"auth1\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: true, Identity: &amp;Identity{Principal: \"user1\"}},\n    }\n    auth2 := &amp;mockAuthenticator{\n        name:     \"auth2\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: true, Identity: &amp;Identity{Principal: \"user2\"}},\n    }\n\n    composite := NewCompositeAuthenticator(auth1, auth2)\n    result, err := composite.Authenticate(context.Background(), &amp;AuthRequest{})\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"user1\", result.Identity.Principal)\n    assert.True(t, auth1.called)\n    assert.False(t, auth2.called) // StopOnFirst\n}\n\nfunc TestCompositeAuthenticator_FallbackToSecond(t *testing.T) {\n    auth1 := &amp;mockAuthenticator{\n        name:     \"auth1\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: false},\n    }\n    auth2 := &amp;mockAuthenticator{\n        name:     \"auth2\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: true, Identity: &amp;Identity{Principal: \"user2\"}},\n    }\n\n    composite := NewCompositeAuthenticator(auth1, auth2)\n    result, err := composite.Authenticate(context.Background(), &amp;AuthRequest{})\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"user2\", result.Identity.Principal)\n}\n\nfunc TestCompositeAuthenticator_AllFail(t *testing.T) {\n    auth1 := &amp;mockAuthenticator{\n        name:     \"auth1\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: false},\n    }\n    auth2 := &amp;mockAuthenticator{\n        name:     \"auth2\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: false},\n    }\n\n    composite := NewCompositeAuthenticator(auth1, auth2)\n    result, err := composite.Authenticate(context.Background(), &amp;AuthRequest{})\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrUnauthorized)\n}\n\nfunc TestCompositeAuthenticator_SkipsUnsupported(t *testing.T) {\n    auth1 := &amp;mockAuthenticator{\n        name:     \"auth1\",\n        supports: false, // Does not support\n        result:   &amp;AuthResult{Authenticated: true},\n    }\n    auth2 := &amp;mockAuthenticator{\n        name:     \"auth2\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: true, Identity: &amp;Identity{Principal: \"user2\"}},\n    }\n\n    composite := NewCompositeAuthenticator(auth1, auth2)\n    result, err := composite.Authenticate(context.Background(), &amp;AuthRequest{})\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"user2\", result.Identity.Principal)\n    assert.False(t, auth1.called)\n    assert.True(t, auth2.called)\n}\n\nfunc TestCompositeAuthenticator_HandlesErrors(t *testing.T) {\n    auth1 := &amp;mockAuthenticator{\n        name:     \"auth1\",\n        supports: true,\n        err:      errors.New(\"network error\"),\n    }\n    auth2 := &amp;mockAuthenticator{\n        name:     \"auth2\",\n        supports: true,\n        result:   &amp;AuthResult{Authenticated: true, Identity: &amp;Identity{Principal: \"user2\"}},\n    }\n\n    composite := NewCompositeAuthenticator(auth1, auth2)\n    result, err := composite.Authenticate(context.Background(), &amp;AuthRequest{})\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"user2\", result.Identity.Principal)\n}\n\n// mockAuthenticator for testing\ntype mockAuthenticator struct {\n    name     string\n    supports bool\n    result   *AuthResult\n    err      error\n    called   bool\n}\n\nfunc (m *mockAuthenticator) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    m.called = true\n    return m.result, m.err\n}\n\nfunc (m *mockAuthenticator) Name() string { return m.name }\n\nfunc (m *mockAuthenticator) Supports(ctx context.Context, req *AuthRequest) bool {\n    return m.supports\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-4-jwt-authenticator","title":"Task 4: JWT Authenticator","text":"<p>Files: - <code>internal/auth/jwt.go</code> - <code>internal/auth/jwt_test.go</code></p> <pre><code>// internal/auth/jwt.go\npackage auth\n\nimport (\n    \"context\"\n    \"crypto/rsa\"\n    \"errors\"\n    \"fmt\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/golang-jwt/jwt/v5\"\n)\n\n// JWTConfig configures JWT validation.\ntype JWTConfig struct {\n    Issuer           string        `yaml:\"issuer\"`\n    Audience         string        `yaml:\"audience\"`\n    HeaderName       string        `yaml:\"header_name\"`\n    TokenPrefix      string        `yaml:\"token_prefix\"`\n    ClockSkew        time.Duration `yaml:\"clock_skew\"`\n    RequiredClaims   []string      `yaml:\"required_claims\"`\n    PrincipalClaim   string        `yaml:\"principal_claim\"`\n    TenantClaim      string        `yaml:\"tenant_claim\"`\n    RolesClaim       string        `yaml:\"roles_claim\"`\n    PermissionsClaim string        `yaml:\"permissions_claim\"`\n}\n\n// DefaultJWTConfig returns sensible defaults.\nfunc DefaultJWTConfig() JWTConfig {\n    return JWTConfig{\n        HeaderName:     \"Authorization\",\n        TokenPrefix:    \"Bearer \",\n        ClockSkew:      5 * time.Minute,\n        PrincipalClaim: \"sub\",\n    }\n}\n\n// KeyProvider fetches signing keys for JWT validation.\ntype KeyProvider interface {\n    GetKey(ctx context.Context, keyID string) (any, error)\n    GetKeys(ctx context.Context) ([]any, error)\n}\n\n// StaticKeyProvider uses a single static key.\ntype StaticKeyProvider struct {\n    Key any\n}\n\n// GetKey implements KeyProvider.\nfunc (p *StaticKeyProvider) GetKey(ctx context.Context, keyID string) (any, error) {\n    return p.Key, nil\n}\n\n// GetKeys implements KeyProvider.\nfunc (p *StaticKeyProvider) GetKeys(ctx context.Context) ([]any, error) {\n    return []any{p.Key}, nil\n}\n\n// JWTAuthenticator validates JWT tokens.\ntype JWTAuthenticator struct {\n    Config      JWTConfig\n    KeyProvider KeyProvider\n}\n\n// NewJWTAuthenticator creates a JWT authenticator.\nfunc NewJWTAuthenticator(cfg JWTConfig, keyProvider KeyProvider) *JWTAuthenticator {\n    if cfg.HeaderName == \"\" {\n        cfg.HeaderName = \"Authorization\"\n    }\n    if cfg.TokenPrefix == \"\" {\n        cfg.TokenPrefix = \"Bearer \"\n    }\n    if cfg.PrincipalClaim == \"\" {\n        cfg.PrincipalClaim = \"sub\"\n    }\n    return &amp;JWTAuthenticator{\n        Config:      cfg,\n        KeyProvider: keyProvider,\n    }\n}\n\n// Authenticate implements Authenticator.\nfunc (a *JWTAuthenticator) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    // Extract token from header\n    header := req.GetHeader(a.Config.HeaderName)\n    if header == \"\" {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Challenge:     \"Bearer\",\n            Error:         ErrMissingCredentials,\n        }, nil\n    }\n\n    // Remove prefix\n    if !strings.HasPrefix(header, a.Config.TokenPrefix) {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Challenge:     \"Bearer\",\n            Error:         ErrInvalidToken,\n        }, nil\n    }\n    tokenString := strings.TrimPrefix(header, a.Config.TokenPrefix)\n\n    // Parse and validate token\n    token, err := jwt.Parse(tokenString, func(token *jwt.Token) (any, error) {\n        // Get key ID from header\n        kid, _ := token.Header[\"kid\"].(string)\n        return a.KeyProvider.GetKey(ctx, kid)\n    }, jwt.WithLeeway(a.Config.ClockSkew))\n\n    if err != nil {\n        if errors.Is(err, jwt.ErrTokenExpired) {\n            return &amp;AuthResult{\n                Authenticated: false,\n                Challenge:     \"Bearer error=\\\"invalid_token\\\", error_description=\\\"token expired\\\"\",\n                Error:         ErrTokenExpired,\n            }, nil\n        }\n        return &amp;AuthResult{\n            Authenticated: false,\n            Challenge:     \"Bearer error=\\\"invalid_token\\\"\",\n            Error:         fmt.Errorf(\"%w: %v\", ErrInvalidToken, err),\n        }, nil\n    }\n\n    if !token.Valid {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Challenge:     \"Bearer error=\\\"invalid_token\\\"\",\n            Error:         ErrInvalidToken,\n        }, nil\n    }\n\n    // Extract claims\n    claims, ok := token.Claims.(jwt.MapClaims)\n    if !ok {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Error:         errors.New(\"invalid claims format\"),\n        }, nil\n    }\n\n    // Validate issuer\n    if a.Config.Issuer != \"\" {\n        if iss, _ := claims[\"iss\"].(string); iss != a.Config.Issuer {\n            return &amp;AuthResult{\n                Authenticated: false,\n                Error:         errors.New(\"invalid issuer\"),\n            }, nil\n        }\n    }\n\n    // Validate audience\n    if a.Config.Audience != \"\" {\n        audClaim := claims[\"aud\"]\n        valid := false\n        switch aud := audClaim.(type) {\n        case string:\n            valid = aud == a.Config.Audience\n        case []any:\n            for _, a := range aud {\n                if s, ok := a.(string); ok &amp;&amp; s == a.Config.Audience {\n                    valid = true\n                    break\n                }\n            }\n        }\n        if !valid {\n            return &amp;AuthResult{\n                Authenticated: false,\n                Error:         errors.New(\"invalid audience\"),\n            }, nil\n        }\n    }\n\n    // Check required claims\n    for _, claim := range a.Config.RequiredClaims {\n        if _, ok := claims[claim]; !ok {\n            return &amp;AuthResult{\n                Authenticated: false,\n                Error:         fmt.Errorf(\"missing required claim: %s\", claim),\n            }, nil\n        }\n    }\n\n    // Build identity\n    identity := a.buildIdentity(claims)\n\n    return &amp;AuthResult{\n        Authenticated: true,\n        Identity:      identity,\n    }, nil\n}\n\nfunc (a *JWTAuthenticator) buildIdentity(claims jwt.MapClaims) *Identity {\n    id := &amp;Identity{\n        Method:   AuthMethodJWT,\n        Claims:   make(map[string]any),\n        IssuedAt: time.Now(),\n    }\n\n    // Principal\n    if principal, ok := claims[a.Config.PrincipalClaim].(string); ok {\n        id.Principal = principal\n    }\n\n    // Tenant\n    if a.Config.TenantClaim != \"\" {\n        if tenant, ok := claims[a.Config.TenantClaim].(string); ok {\n            id.TenantID = tenant\n        }\n    }\n\n    // Roles\n    if a.Config.RolesClaim != \"\" {\n        if roles, ok := claims[a.Config.RolesClaim].([]any); ok {\n            for _, r := range roles {\n                if s, ok := r.(string); ok {\n                    id.Roles = append(id.Roles, s)\n                }\n            }\n        }\n    }\n\n    // Permissions\n    if a.Config.PermissionsClaim != \"\" {\n        if perms, ok := claims[a.Config.PermissionsClaim].([]any); ok {\n            for _, p := range perms {\n                if s, ok := p.(string); ok {\n                    id.Permissions = append(id.Permissions, s)\n                }\n            }\n        }\n    }\n\n    // Expiration\n    if exp, ok := claims[\"exp\"].(float64); ok {\n        id.ExpiresAt = time.Unix(int64(exp), 0)\n    }\n\n    // Copy all claims\n    for k, v := range claims {\n        id.Claims[k] = v\n    }\n\n    return id\n}\n\n// Name implements Authenticator.\nfunc (a *JWTAuthenticator) Name() string {\n    return \"jwt\"\n}\n\n// Supports implements Authenticator.\nfunc (a *JWTAuthenticator) Supports(ctx context.Context, req *AuthRequest) bool {\n    header := req.GetHeader(a.Config.HeaderName)\n    return strings.HasPrefix(header, a.Config.TokenPrefix)\n}\n\n// NewStaticKeyProvider creates a key provider with a static key.\nfunc NewStaticKeyProvider(key any) *StaticKeyProvider {\n    return &amp;StaticKeyProvider{Key: key}\n}\n\n// NewRSAKeyProvider creates a key provider with an RSA public key.\nfunc NewRSAKeyProvider(key *rsa.PublicKey) *StaticKeyProvider {\n    return &amp;StaticKeyProvider{Key: key}\n}\n\n// NewHMACKeyProvider creates a key provider with an HMAC secret.\nfunc NewHMACKeyProvider(secret []byte) *StaticKeyProvider {\n    return &amp;StaticKeyProvider{Key: secret}\n}\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/jwt_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"testing\"\n    \"time\"\n\n    \"github.com/golang-jwt/jwt/v5\"\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nvar testSecret = []byte(\"test-secret-key-for-jwt-testing\")\n\nfunc createTestToken(claims jwt.MapClaims) string {\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)\n    tokenString, _ := token.SignedString(testSecret)\n    return tokenString\n}\n\nfunc TestJWTAuthenticator_ValidToken(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        JWTConfig{\n            Issuer:         \"test-issuer\",\n            Audience:       \"test-audience\",\n            PrincipalClaim: \"sub\",\n            RolesClaim:     \"roles\",\n        },\n        NewHMACKeyProvider(testSecret),\n    )\n\n    token := createTestToken(jwt.MapClaims{\n        \"sub\":   \"alice\",\n        \"iss\":   \"test-issuer\",\n        \"aud\":   \"test-audience\",\n        \"exp\":   time.Now().Add(time.Hour).Unix(),\n        \"roles\": []any{\"admin\", \"user\"},\n    })\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer \" + token},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    require.NotNil(t, result.Identity)\n    assert.Equal(t, \"alice\", result.Identity.Principal)\n    assert.Equal(t, AuthMethodJWT, result.Identity.Method)\n    assert.Contains(t, result.Identity.Roles, \"admin\")\n    assert.Contains(t, result.Identity.Roles, \"user\")\n}\n\nfunc TestJWTAuthenticator_ExpiredToken(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        DefaultJWTConfig(),\n        NewHMACKeyProvider(testSecret),\n    )\n\n    token := createTestToken(jwt.MapClaims{\n        \"sub\": \"alice\",\n        \"exp\": time.Now().Add(-time.Hour).Unix(), // Expired\n    })\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer \" + token},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrTokenExpired)\n}\n\nfunc TestJWTAuthenticator_InvalidSignature(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        DefaultJWTConfig(),\n        NewHMACKeyProvider([]byte(\"wrong-secret\")),\n    )\n\n    token := createTestToken(jwt.MapClaims{\n        \"sub\": \"alice\",\n        \"exp\": time.Now().Add(time.Hour).Unix(),\n    })\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer \" + token},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrInvalidToken)\n}\n\nfunc TestJWTAuthenticator_MissingToken(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        DefaultJWTConfig(),\n        NewHMACKeyProvider(testSecret),\n    )\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{},\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrMissingCredentials)\n}\n\nfunc TestJWTAuthenticator_InvalidIssuer(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        JWTConfig{\n            Issuer: \"expected-issuer\",\n        },\n        NewHMACKeyProvider(testSecret),\n    )\n\n    token := createTestToken(jwt.MapClaims{\n        \"sub\": \"alice\",\n        \"iss\": \"wrong-issuer\",\n        \"exp\": time.Now().Add(time.Hour).Unix(),\n    })\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer \" + token},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n}\n\nfunc TestJWTAuthenticator_TenantClaim(t *testing.T) {\n    auth := NewJWTAuthenticator(\n        JWTConfig{\n            PrincipalClaim: \"sub\",\n            TenantClaim:    \"org_id\",\n        },\n        NewHMACKeyProvider(testSecret),\n    )\n\n    token := createTestToken(jwt.MapClaims{\n        \"sub\":    \"alice\",\n        \"org_id\": \"acme-corp\",\n        \"exp\":    time.Now().Add(time.Hour).Unix(),\n    })\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"Authorization\": {\"Bearer \" + token},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"acme-corp\", result.Identity.TenantID)\n}\n\nfunc TestJWTAuthenticator_Supports(t *testing.T) {\n    auth := NewJWTAuthenticator(DefaultJWTConfig(), NewHMACKeyProvider(testSecret))\n\n    t.Run(\"supports bearer token\", func(t *testing.T) {\n        req := &amp;AuthRequest{\n            Headers: map[string][]string{\n                \"Authorization\": {\"Bearer token\"},\n            },\n        }\n        assert.True(t, auth.Supports(context.Background(), req))\n    })\n\n    t.Run(\"does not support api key\", func(t *testing.T) {\n        req := &amp;AuthRequest{\n            Headers: map[string][]string{\n                \"X-API-Key\": {\"key123\"},\n            },\n        }\n        assert.False(t, auth.Supports(context.Background(), req))\n    })\n\n    t.Run(\"does not support basic auth\", func(t *testing.T) {\n        req := &amp;AuthRequest{\n            Headers: map[string][]string{\n                \"Authorization\": {\"Basic dXNlcjpwYXNz\"},\n            },\n        }\n        assert.False(t, auth.Supports(context.Background(), req))\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-5-api-key-authenticator","title":"Task 5: API Key Authenticator","text":"<p>Files: - <code>internal/auth/apikey.go</code> - <code>internal/auth/apikey_test.go</code></p> <pre><code>// internal/auth/apikey.go\npackage auth\n\nimport (\n    \"context\"\n    \"crypto/sha256\"\n    \"crypto/subtle\"\n    \"encoding/hex\"\n    \"strings\"\n    \"time\"\n)\n\n// APIKeyConfig configures API key validation.\ntype APIKeyConfig struct {\n    HeaderName    string `yaml:\"header_name\"`\n    QueryParam    string `yaml:\"query_param\"`\n    Prefix        string `yaml:\"prefix\"`\n    HashAlgorithm string `yaml:\"hash_algorithm\"` // none, sha256\n}\n\n// DefaultAPIKeyConfig returns sensible defaults.\nfunc DefaultAPIKeyConfig() APIKeyConfig {\n    return APIKeyConfig{\n        HeaderName:    \"X-API-Key\",\n        HashAlgorithm: \"none\",\n    }\n}\n\n// APIKeyInfo contains API key metadata.\ntype APIKeyInfo struct {\n    ID          string\n    Name        string\n    KeyHash     string // Hashed key for storage\n    Principal   string\n    TenantID    string\n    Roles       []string\n    Permissions []string\n    Scopes      []string\n    Metadata    map[string]string\n    CreatedAt   time.Time\n    ExpiresAt   *time.Time\n    LastUsedAt  *time.Time\n}\n\n// IsExpired checks if the API key has expired.\nfunc (k *APIKeyInfo) IsExpired() bool {\n    if k.ExpiresAt == nil {\n        return false\n    }\n    return time.Now().After(*k.ExpiresAt)\n}\n\n// APIKeyStore retrieves API key information.\n// This is the pluggable interface - implementations live in toolpersist.\ntype APIKeyStore interface {\n    Lookup(ctx context.Context, keyHash string) (*APIKeyInfo, error)\n}\n\n// APIKeyAuthenticator validates API keys.\ntype APIKeyAuthenticator struct {\n    Config APIKeyConfig\n    Store  APIKeyStore\n}\n\n// NewAPIKeyAuthenticator creates an API key authenticator.\nfunc NewAPIKeyAuthenticator(cfg APIKeyConfig, store APIKeyStore) *APIKeyAuthenticator {\n    if cfg.HeaderName == \"\" {\n        cfg.HeaderName = \"X-API-Key\"\n    }\n    return &amp;APIKeyAuthenticator{\n        Config: cfg,\n        Store:  store,\n    }\n}\n\n// Authenticate implements Authenticator.\nfunc (a *APIKeyAuthenticator) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    // Extract API key\n    key := a.extractKey(req)\n    if key == \"\" {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Error:         ErrMissingCredentials,\n        }, nil\n    }\n\n    // Hash the key for lookup\n    keyHash := a.hashKey(key)\n\n    // Lookup key info\n    info, err := a.Store.Lookup(ctx, keyHash)\n    if err != nil {\n        return nil, err // System error\n    }\n    if info == nil {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Error:         ErrInvalidCredentials,\n        }, nil\n    }\n\n    // Check expiration\n    if info.IsExpired() {\n        return &amp;AuthResult{\n            Authenticated: false,\n            Error:         ErrTokenExpired,\n        }, nil\n    }\n\n    // Build identity\n    identity := &amp;Identity{\n        Principal:   info.Principal,\n        TenantID:    info.TenantID,\n        Roles:       info.Roles,\n        Permissions: info.Permissions,\n        Method:      AuthMethodAPIKey,\n        Metadata:    info.Metadata,\n        IssuedAt:    info.CreatedAt,\n    }\n    if info.ExpiresAt != nil {\n        identity.ExpiresAt = *info.ExpiresAt\n    }\n\n    return &amp;AuthResult{\n        Authenticated: true,\n        Identity:      identity,\n    }, nil\n}\n\nfunc (a *APIKeyAuthenticator) extractKey(req *AuthRequest) string {\n    // Try header first\n    key := req.GetHeader(a.Config.HeaderName)\n    if key != \"\" {\n        if a.Config.Prefix != \"\" {\n            key = strings.TrimPrefix(key, a.Config.Prefix)\n        }\n        return key\n    }\n    return \"\"\n}\n\nfunc (a *APIKeyAuthenticator) hashKey(key string) string {\n    switch a.Config.HashAlgorithm {\n    case \"sha256\":\n        hash := sha256.Sum256([]byte(key))\n        return hex.EncodeToString(hash[:])\n    default:\n        return key\n    }\n}\n\n// Name implements Authenticator.\nfunc (a *APIKeyAuthenticator) Name() string {\n    return \"api_key\"\n}\n\n// Supports implements Authenticator.\nfunc (a *APIKeyAuthenticator) Supports(ctx context.Context, req *AuthRequest) bool {\n    return req.GetHeader(a.Config.HeaderName) != \"\"\n}\n\n// HashAPIKey hashes an API key for storage.\nfunc HashAPIKey(key string, algorithm string) string {\n    switch algorithm {\n    case \"sha256\":\n        hash := sha256.Sum256([]byte(key))\n        return hex.EncodeToString(hash[:])\n    default:\n        return key\n    }\n}\n\n// ValidateAPIKey compares a key against a stored hash.\nfunc ValidateAPIKey(key, storedHash, algorithm string) bool {\n    keyHash := HashAPIKey(key, algorithm)\n    return subtle.ConstantTimeCompare([]byte(keyHash), []byte(storedHash)) == 1\n}\n\n// MemoryAPIKeyStore is an in-memory implementation for testing.\ntype MemoryAPIKeyStore struct {\n    keys map[string]*APIKeyInfo\n}\n\n// NewMemoryAPIKeyStore creates an in-memory API key store.\nfunc NewMemoryAPIKeyStore() *MemoryAPIKeyStore {\n    return &amp;MemoryAPIKeyStore{\n        keys: make(map[string]*APIKeyInfo),\n    }\n}\n\n// Add stores an API key.\nfunc (s *MemoryAPIKeyStore) Add(info *APIKeyInfo) {\n    s.keys[info.KeyHash] = info\n}\n\n// Lookup implements APIKeyStore.\nfunc (s *MemoryAPIKeyStore) Lookup(ctx context.Context, keyHash string) (*APIKeyInfo, error) {\n    return s.keys[keyHash], nil\n}\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/apikey_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"testing\"\n    \"time\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestAPIKeyAuthenticator_ValidKey(t *testing.T) {\n    store := NewMemoryAPIKeyStore()\n    store.Add(&amp;APIKeyInfo{\n        ID:        \"key1\",\n        KeyHash:   \"test-api-key\",\n        Principal: \"alice\",\n        TenantID:  \"acme-corp\",\n        Roles:     []string{\"user\"},\n    })\n\n    auth := NewAPIKeyAuthenticator(DefaultAPIKeyConfig(), store)\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"X-API-Key\": {\"test-api-key\"},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    require.NotNil(t, result.Identity)\n    assert.Equal(t, \"alice\", result.Identity.Principal)\n    assert.Equal(t, \"acme-corp\", result.Identity.TenantID)\n    assert.Equal(t, AuthMethodAPIKey, result.Identity.Method)\n}\n\nfunc TestAPIKeyAuthenticator_HashedKey(t *testing.T) {\n    store := NewMemoryAPIKeyStore()\n    keyHash := HashAPIKey(\"my-secret-key\", \"sha256\")\n    store.Add(&amp;APIKeyInfo{\n        ID:        \"key1\",\n        KeyHash:   keyHash,\n        Principal: \"bob\",\n    })\n\n    auth := NewAPIKeyAuthenticator(\n        APIKeyConfig{\n            HeaderName:    \"X-API-Key\",\n            HashAlgorithm: \"sha256\",\n        },\n        store,\n    )\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"X-API-Key\": {\"my-secret-key\"},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.True(t, result.Authenticated)\n    assert.Equal(t, \"bob\", result.Identity.Principal)\n}\n\nfunc TestAPIKeyAuthenticator_InvalidKey(t *testing.T) {\n    store := NewMemoryAPIKeyStore()\n    auth := NewAPIKeyAuthenticator(DefaultAPIKeyConfig(), store)\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"X-API-Key\": {\"invalid-key\"},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrInvalidCredentials)\n}\n\nfunc TestAPIKeyAuthenticator_ExpiredKey(t *testing.T) {\n    expiredTime := time.Now().Add(-time.Hour)\n    store := NewMemoryAPIKeyStore()\n    store.Add(&amp;APIKeyInfo{\n        ID:        \"key1\",\n        KeyHash:   \"expired-key\",\n        Principal: \"alice\",\n        ExpiresAt: &amp;expiredTime,\n    })\n\n    auth := NewAPIKeyAuthenticator(DefaultAPIKeyConfig(), store)\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{\n            \"X-API-Key\": {\"expired-key\"},\n        },\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrTokenExpired)\n}\n\nfunc TestAPIKeyAuthenticator_MissingKey(t *testing.T) {\n    store := NewMemoryAPIKeyStore()\n    auth := NewAPIKeyAuthenticator(DefaultAPIKeyConfig(), store)\n\n    req := &amp;AuthRequest{\n        Headers: map[string][]string{},\n    }\n\n    result, err := auth.Authenticate(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Authenticated)\n    assert.ErrorIs(t, result.Error, ErrMissingCredentials)\n}\n\nfunc TestAPIKeyAuthenticator_Supports(t *testing.T) {\n    auth := NewAPIKeyAuthenticator(DefaultAPIKeyConfig(), NewMemoryAPIKeyStore())\n\n    t.Run(\"supports X-API-Key header\", func(t *testing.T) {\n        req := &amp;AuthRequest{\n            Headers: map[string][]string{\n                \"X-API-Key\": {\"key123\"},\n            },\n        }\n        assert.True(t, auth.Supports(context.Background(), req))\n    })\n\n    t.Run(\"does not support bearer token\", func(t *testing.T) {\n        req := &amp;AuthRequest{\n            Headers: map[string][]string{\n                \"Authorization\": {\"Bearer token\"},\n            },\n        }\n        assert.False(t, auth.Supports(context.Background(), req))\n    })\n}\n\nfunc TestHashAPIKey(t *testing.T) {\n    key := \"my-secret-key\"\n\n    t.Run(\"sha256\", func(t *testing.T) {\n        hash := HashAPIKey(key, \"sha256\")\n        assert.Len(t, hash, 64) // SHA256 hex = 64 chars\n        assert.NotEqual(t, key, hash)\n    })\n\n    t.Run(\"none\", func(t *testing.T) {\n        hash := HashAPIKey(key, \"none\")\n        assert.Equal(t, key, hash)\n    })\n}\n\nfunc TestValidateAPIKey(t *testing.T) {\n    key := \"my-secret-key\"\n    hash := HashAPIKey(key, \"sha256\")\n\n    assert.True(t, ValidateAPIKey(key, hash, \"sha256\"))\n    assert.False(t, ValidateAPIKey(\"wrong-key\", hash, \"sha256\"))\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-6-authorizer-interface-simple-rbac","title":"Task 6: Authorizer Interface &amp; Simple RBAC","text":"<p>Files: - <code>internal/auth/authorizer.go</code> - <code>internal/auth/rbac.go</code> - <code>internal/auth/authorizer_test.go</code> - <code>internal/auth/rbac_test.go</code></p> <pre><code>// internal/auth/authorizer.go\npackage auth\n\nimport (\n    \"context\"\n    \"errors\"\n    \"fmt\"\n)\n\n// Common authorization errors.\nvar (\n    ErrForbidden        = errors.New(\"forbidden\")\n    ErrInsufficientRole = errors.New(\"insufficient role\")\n)\n\n// AuthzRequest contains the authorization request parameters.\ntype AuthzRequest struct {\n    Subject      *Identity\n    Resource     string\n    Action       string\n    ResourceType string\n    Context      map[string]any\n}\n\n// AuthzError provides detailed authorization failure information.\ntype AuthzError struct {\n    Subject  string\n    Resource string\n    Action   string\n    Reason   string\n}\n\nfunc (e *AuthzError) Error() string {\n    return fmt.Sprintf(\"authorization denied: %s cannot %s on %s: %s\",\n        e.Subject, e.Action, e.Resource, e.Reason)\n}\n\nfunc (e *AuthzError) Unwrap() error {\n    return ErrForbidden\n}\n\n// Authorizer makes access control decisions.\ntype Authorizer interface {\n    Authorize(ctx context.Context, req *AuthzRequest) error\n    Name() string\n}\n\n// AuthorizerFunc is a function adapter for Authorizer.\ntype AuthorizerFunc func(ctx context.Context, req *AuthzRequest) error\n\n// Authorize implements Authorizer.\nfunc (f AuthorizerFunc) Authorize(ctx context.Context, req *AuthzRequest) error {\n    return f(ctx, req)\n}\n\n// Name implements Authorizer.\nfunc (f AuthorizerFunc) Name() string { return \"func\" }\n\n// AllowAllAuthorizer permits all requests.\nvar AllowAllAuthorizer = AuthorizerFunc(func(ctx context.Context, req *AuthzRequest) error {\n    return nil\n})\n\n// DenyAllAuthorizer denies all requests.\nvar DenyAllAuthorizer = AuthorizerFunc(func(ctx context.Context, req *AuthzRequest) error {\n    return &amp;AuthzError{\n        Subject:  req.Subject.Principal,\n        Resource: req.Resource,\n        Action:   req.Action,\n        Reason:   \"all access denied\",\n    }\n})\n</code></pre> <pre><code>// internal/auth/rbac.go\npackage auth\n\nimport (\n    \"context\"\n    \"slices\"\n    \"strings\"\n)\n\n// RBACConfig defines roles and permissions.\ntype RBACConfig struct {\n    Roles       map[string]RoleConfig `yaml:\"roles\"`\n    DefaultRole string                `yaml:\"default_role\"`\n}\n\n// RoleConfig defines a role's permissions.\ntype RoleConfig struct {\n    Permissions    []string `yaml:\"permissions\"`\n    Inherits       []string `yaml:\"inherits\"`\n    AllowedTools   []string `yaml:\"allowed_tools\"`\n    DeniedTools    []string `yaml:\"denied_tools\"`\n    AllowedActions []string `yaml:\"allowed_actions\"`\n}\n\n// SimpleRBACAuthorizer provides basic RBAC without external dependencies.\ntype SimpleRBACAuthorizer struct {\n    Config RBACConfig\n}\n\n// NewSimpleRBACAuthorizer creates a simple RBAC authorizer.\nfunc NewSimpleRBACAuthorizer(cfg RBACConfig) *SimpleRBACAuthorizer {\n    return &amp;SimpleRBACAuthorizer{Config: cfg}\n}\n\n// Authorize implements Authorizer.\nfunc (a *SimpleRBACAuthorizer) Authorize(ctx context.Context, req *AuthzRequest) error {\n    if req.Subject == nil {\n        return &amp;AuthzError{\n            Subject:  \"anonymous\",\n            Resource: req.Resource,\n            Action:   req.Action,\n            Reason:   \"no identity\",\n        }\n    }\n\n    // Get effective permissions\n    permissions := a.resolvePermissions(req.Subject)\n    allowedTools := a.resolveAllowedTools(req.Subject)\n    deniedTools := a.resolveDeniedTools(req.Subject)\n    allowedActions := a.resolveAllowedActions(req.Subject)\n\n    // Check for wildcard permission\n    if slices.Contains(permissions, \"*\") {\n        return nil\n    }\n\n    // Check denied tools first (takes precedence)\n    for _, pattern := range deniedTools {\n        if matchPattern(req.Resource, pattern) {\n            return &amp;AuthzError{\n                Subject:  req.Subject.Principal,\n                Resource: req.Resource,\n                Action:   req.Action,\n                Reason:   \"tool explicitly denied\",\n            }\n        }\n    }\n\n    // Check action allowed\n    if len(allowedActions) &gt; 0 &amp;&amp; !slices.Contains(allowedActions, req.Action) &amp;&amp; !slices.Contains(allowedActions, \"*\") {\n        return &amp;AuthzError{\n            Subject:  req.Subject.Principal,\n            Resource: req.Resource,\n            Action:   req.Action,\n            Reason:   \"action not allowed\",\n        }\n    }\n\n    // Check tool allowed\n    if len(allowedTools) &gt; 0 {\n        allowed := false\n        for _, pattern := range allowedTools {\n            if matchPattern(req.Resource, pattern) {\n                allowed = true\n                break\n            }\n        }\n        if !allowed &amp;&amp; !slices.Contains(allowedTools, \"*\") {\n            return &amp;AuthzError{\n                Subject:  req.Subject.Principal,\n                Resource: req.Resource,\n                Action:   req.Action,\n                Reason:   \"tool not allowed\",\n            }\n        }\n    }\n\n    // Check explicit permission\n    permKey := req.ResourceType + \":\" + req.Action\n    toolKey := \"tool:\" + req.Resource\n\n    if slices.Contains(permissions, permKey) || slices.Contains(permissions, toolKey) {\n        return nil\n    }\n\n    // If we have allowed tools/actions and passed those checks, allow\n    if len(allowedTools) &gt; 0 || len(allowedActions) &gt; 0 {\n        return nil\n    }\n\n    return &amp;AuthzError{\n        Subject:  req.Subject.Principal,\n        Resource: req.Resource,\n        Action:   req.Action,\n        Reason:   \"insufficient permissions\",\n    }\n}\n\nfunc (a *SimpleRBACAuthorizer) resolvePermissions(id *Identity) []string {\n    var perms []string\n    seen := make(map[string]bool)\n\n    var resolve func(roles []string)\n    resolve = func(roles []string) {\n        for _, role := range roles {\n            if seen[role] {\n                continue\n            }\n            seen[role] = true\n\n            if cfg, ok := a.Config.Roles[role]; ok {\n                perms = append(perms, cfg.Permissions...)\n                resolve(cfg.Inherits)\n            }\n        }\n    }\n\n    // Start with identity's roles\n    resolve(id.Roles)\n\n    // Add default role if no roles\n    if len(id.Roles) == 0 &amp;&amp; a.Config.DefaultRole != \"\" {\n        resolve([]string{a.Config.DefaultRole})\n    }\n\n    // Add identity's direct permissions\n    perms = append(perms, id.Permissions...)\n\n    return perms\n}\n\nfunc (a *SimpleRBACAuthorizer) resolveAllowedTools(id *Identity) []string {\n    var tools []string\n    seen := make(map[string]bool)\n\n    var resolve func(roles []string)\n    resolve = func(roles []string) {\n        for _, role := range roles {\n            if seen[role] {\n                continue\n            }\n            seen[role] = true\n\n            if cfg, ok := a.Config.Roles[role]; ok {\n                tools = append(tools, cfg.AllowedTools...)\n                resolve(cfg.Inherits)\n            }\n        }\n    }\n\n    resolve(id.Roles)\n    if len(id.Roles) == 0 &amp;&amp; a.Config.DefaultRole != \"\" {\n        resolve([]string{a.Config.DefaultRole})\n    }\n\n    return tools\n}\n\nfunc (a *SimpleRBACAuthorizer) resolveDeniedTools(id *Identity) []string {\n    var tools []string\n    seen := make(map[string]bool)\n\n    var resolve func(roles []string)\n    resolve = func(roles []string) {\n        for _, role := range roles {\n            if seen[role] {\n                continue\n            }\n            seen[role] = true\n\n            if cfg, ok := a.Config.Roles[role]; ok {\n                tools = append(tools, cfg.DeniedTools...)\n                resolve(cfg.Inherits)\n            }\n        }\n    }\n\n    resolve(id.Roles)\n    return tools\n}\n\nfunc (a *SimpleRBACAuthorizer) resolveAllowedActions(id *Identity) []string {\n    var actions []string\n    seen := make(map[string]bool)\n\n    var resolve func(roles []string)\n    resolve = func(roles []string) {\n        for _, role := range roles {\n            if seen[role] {\n                continue\n            }\n            seen[role] = true\n\n            if cfg, ok := a.Config.Roles[role]; ok {\n                actions = append(actions, cfg.AllowedActions...)\n                resolve(cfg.Inherits)\n            }\n        }\n    }\n\n    resolve(id.Roles)\n    if len(id.Roles) == 0 &amp;&amp; a.Config.DefaultRole != \"\" {\n        resolve([]string{a.Config.DefaultRole})\n    }\n\n    return actions\n}\n\n// Name implements Authorizer.\nfunc (a *SimpleRBACAuthorizer) Name() string {\n    return \"simple_rbac\"\n}\n\n// matchPattern matches a resource against a glob-like pattern.\n// Supports * as wildcard prefix/suffix (e.g., \"search_*\", \"*_tool\", \"*\")\nfunc matchPattern(resource, pattern string) bool {\n    if pattern == \"*\" {\n        return true\n    }\n    if strings.HasPrefix(pattern, \"*\") &amp;&amp; strings.HasSuffix(pattern, \"*\") {\n        return strings.Contains(resource, pattern[1:len(pattern)-1])\n    }\n    if strings.HasPrefix(pattern, \"*\") {\n        return strings.HasSuffix(resource, pattern[1:])\n    }\n    if strings.HasSuffix(pattern, \"*\") {\n        return strings.HasPrefix(resource, pattern[:len(pattern)-1])\n    }\n    return resource == pattern\n}\n</code></pre> <p>Tests:</p> <pre><code>// internal/auth/rbac_test.go\npackage auth\n\nimport (\n    \"context\"\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc TestSimpleRBACAuthorizer_AdminRole(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{\n        Roles: map[string]RoleConfig{\n            \"admin\": {Permissions: []string{\"*\"}},\n        },\n    })\n\n    req := &amp;AuthzRequest{\n        Subject:      &amp;Identity{Principal: \"alice\", Roles: []string{\"admin\"}},\n        Resource:     \"execute_code\",\n        Action:       \"call\",\n        ResourceType: \"tool\",\n    }\n\n    err := authz.Authorize(context.Background(), req)\n    assert.NoError(t, err)\n}\n\nfunc TestSimpleRBACAuthorizer_UserRole(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{\n        Roles: map[string]RoleConfig{\n            \"user\": {\n                AllowedActions: []string{\"call\", \"list\"},\n                AllowedTools:   []string{\"search_*\", \"describe_*\"},\n            },\n        },\n    })\n\n    t.Run(\"allowed tool\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"bob\", Roles: []string{\"user\"}},\n            Resource:     \"search_tools\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        assert.NoError(t, err)\n    })\n\n    t.Run(\"denied tool\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"bob\", Roles: []string{\"user\"}},\n            Resource:     \"execute_code\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        require.Error(t, err)\n        assert.ErrorIs(t, err, ErrForbidden)\n    })\n\n    t.Run(\"denied action\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"bob\", Roles: []string{\"user\"}},\n            Resource:     \"search_tools\",\n            Action:       \"delete\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        require.Error(t, err)\n    })\n}\n\nfunc TestSimpleRBACAuthorizer_DeniedToolsTakePrecedence(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{\n        Roles: map[string]RoleConfig{\n            \"user\": {\n                AllowedTools: []string{\"*\"},\n                DeniedTools:  []string{\"execute_code\", \"dangerous_*\"},\n            },\n        },\n    })\n\n    t.Run(\"explicitly denied\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"bob\", Roles: []string{\"user\"}},\n            Resource:     \"execute_code\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        require.Error(t, err)\n        var authzErr *AuthzError\n        require.ErrorAs(t, err, &amp;authzErr)\n        assert.Contains(t, authzErr.Reason, \"denied\")\n    })\n\n    t.Run(\"pattern denied\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"bob\", Roles: []string{\"user\"}},\n            Resource:     \"dangerous_operation\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        require.Error(t, err)\n    })\n}\n\nfunc TestSimpleRBACAuthorizer_RoleInheritance(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{\n        Roles: map[string]RoleConfig{\n            \"admin\": {\n                Permissions: []string{\"*\"},\n            },\n            \"power_user\": {\n                Inherits:     []string{\"user\"},\n                AllowedTools: []string{\"execute_code\"},\n            },\n            \"user\": {\n                AllowedActions: []string{\"call\", \"list\"},\n                AllowedTools:   []string{\"search_*\"},\n            },\n        },\n    })\n\n    t.Run(\"inherits from user\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"carol\", Roles: []string{\"power_user\"}},\n            Resource:     \"search_tools\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        assert.NoError(t, err)\n    })\n\n    t.Run(\"has own permissions\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"carol\", Roles: []string{\"power_user\"}},\n            Resource:     \"execute_code\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        assert.NoError(t, err)\n    })\n}\n\nfunc TestSimpleRBACAuthorizer_DefaultRole(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{\n        DefaultRole: \"anonymous\",\n        Roles: map[string]RoleConfig{\n            \"anonymous\": {\n                AllowedActions: []string{\"list\"},\n            },\n        },\n    })\n\n    t.Run(\"uses default role\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"unknown\"}, // No roles\n            Resource:     \"any_tool\",\n            Action:       \"list\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        assert.NoError(t, err)\n    })\n\n    t.Run(\"denied without role\", func(t *testing.T) {\n        req := &amp;AuthzRequest{\n            Subject:      &amp;Identity{Principal: \"unknown\"},\n            Resource:     \"any_tool\",\n            Action:       \"call\",\n            ResourceType: \"tool\",\n        }\n        err := authz.Authorize(context.Background(), req)\n        require.Error(t, err)\n    })\n}\n\nfunc TestSimpleRBACAuthorizer_NoIdentity(t *testing.T) {\n    authz := NewSimpleRBACAuthorizer(RBACConfig{})\n\n    req := &amp;AuthzRequest{\n        Subject:  nil,\n        Resource: \"any_tool\",\n        Action:   \"call\",\n    }\n\n    err := authz.Authorize(context.Background(), req)\n    require.Error(t, err)\n}\n\nfunc TestMatchPattern(t *testing.T) {\n    tests := []struct {\n        resource string\n        pattern  string\n        expected bool\n    }{\n        {\"search_tools\", \"search_*\", true},\n        {\"search_tools\", \"*_tools\", true},\n        {\"search_tools\", \"*\", true},\n        {\"search_tools\", \"search_tools\", true},\n        {\"search_tools\", \"other_*\", false},\n        {\"search_tools\", \"*_other\", false},\n        {\"search_tools\", \"exact_match\", false},\n        {\"long_search_tools\", \"*search*\", true},\n    }\n\n    for _, tc := range tests {\n        t.Run(tc.resource+\"/\"+tc.pattern, func(t *testing.T) {\n            assert.Equal(t, tc.expected, matchPattern(tc.resource, tc.pattern))\n        })\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-7-auth-middleware-integration","title":"Task 7: Auth Middleware Integration","text":"<p>Files: - <code>internal/auth/middleware.go</code> - <code>internal/auth/middleware_test.go</code></p> <pre><code>// internal/auth/middleware.go\npackage auth\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/mcp\"\n    \"github.com/jonwraymond/metatools-mcp/internal/middleware\"\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n)\n\n// AuthMiddlewareConfig configures the authentication middleware.\ntype AuthMiddlewareConfig struct {\n    AllowAnonymous    bool\n    AnonymousIdentity *Identity\n    SkipMethods       []string\n    OnAuthFailure     func(ctx context.Context, err error) error\n}\n\n// DefaultAuthMiddlewareConfig returns sensible defaults.\nfunc DefaultAuthMiddlewareConfig() AuthMiddlewareConfig {\n    return AuthMiddlewareConfig{\n        AllowAnonymous: false,\n        AnonymousIdentity: &amp;Identity{\n            Principal: \"anonymous\",\n            Method:    AuthMethodAnonymous,\n        },\n    }\n}\n\n// AuthMiddleware creates authentication middleware.\nfunc AuthMiddleware(auth Authenticator, cfg AuthMiddlewareConfig) middleware.Middleware {\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;authMiddleware{\n            auth:   auth,\n            next:   next,\n            config: cfg,\n        }\n    }\n}\n\ntype authMiddleware struct {\n    auth   Authenticator\n    next   provider.ToolProvider\n    config AuthMiddlewareConfig\n}\n\nfunc (m *authMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    // Build auth request from context\n    req := buildAuthRequestFromContext(ctx)\n\n    // Authenticate\n    result, err := m.auth.Authenticate(ctx, req)\n    if err != nil {\n        return nil, fmt.Errorf(\"authentication error: %w\", err)\n    }\n\n    if !result.Authenticated {\n        if m.config.AllowAnonymous {\n            ctx = WithIdentity(ctx, m.config.AnonymousIdentity)\n        } else {\n            if m.config.OnAuthFailure != nil {\n                return nil, m.config.OnAuthFailure(ctx, result.Error)\n            }\n            return nil, &amp;AuthError{\n                Code:      \"UNAUTHENTICATED\",\n                Message:   \"authentication required\",\n                Challenge: result.Challenge,\n            }\n        }\n    } else {\n        ctx = WithIdentity(ctx, result.Identity)\n    }\n\n    return m.next.Handle(ctx, input)\n}\n\nfunc (m *authMiddleware) Name() string        { return m.next.Name() }\nfunc (m *authMiddleware) Description() string { return m.next.Description() }\nfunc (m *authMiddleware) InputSchema() map[string]any { return m.next.InputSchema() }\n\n// AuthzMiddlewareConfig configures the authorization middleware.\ntype AuthzMiddlewareConfig struct {\n    ResourceResolver func(ctx context.Context, input map[string]any) string\n    ActionResolver   func(ctx context.Context, input map[string]any) string\n    ContextBuilder   func(ctx context.Context, input map[string]any) map[string]any\n    OnDenied         func(ctx context.Context, err error) error\n}\n\n// DefaultAuthzMiddlewareConfig returns sensible defaults.\nfunc DefaultAuthzMiddlewareConfig() AuthzMiddlewareConfig {\n    return AuthzMiddlewareConfig{\n        ResourceResolver: func(ctx context.Context, input map[string]any) string {\n            if name, ok := input[\"name\"].(string); ok {\n                return name\n            }\n            return \"\"\n        },\n        ActionResolver: func(ctx context.Context, input map[string]any) string {\n            return \"call\"\n        },\n        ContextBuilder: func(ctx context.Context, input map[string]any) map[string]any {\n            return nil\n        },\n    }\n}\n\n// AuthzMiddleware creates authorization middleware.\nfunc AuthzMiddleware(authz Authorizer, cfg AuthzMiddlewareConfig) middleware.Middleware {\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;authzMiddleware{\n            authz:  authz,\n            next:   next,\n            config: cfg,\n        }\n    }\n}\n\ntype authzMiddleware struct {\n    authz  Authorizer\n    next   provider.ToolProvider\n    config AuthzMiddlewareConfig\n}\n\nfunc (m *authzMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    identity := IdentityFromContext(ctx)\n    if identity == nil {\n        return nil, &amp;AuthError{Code: \"UNAUTHENTICATED\", Message: \"no identity in context\"}\n    }\n\n    req := &amp;AuthzRequest{\n        Subject:      identity,\n        Resource:     m.config.ResourceResolver(ctx, input),\n        Action:       m.config.ActionResolver(ctx, input),\n        ResourceType: \"tool\",\n        Context:      m.config.ContextBuilder(ctx, input),\n    }\n\n    if err := m.authz.Authorize(ctx, req); err != nil {\n        if m.config.OnDenied != nil {\n            return nil, m.config.OnDenied(ctx, err)\n        }\n        return nil, &amp;AuthError{\n            Code:    \"FORBIDDEN\",\n            Message: err.Error(),\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n\nfunc (m *authzMiddleware) Name() string        { return m.next.Name() }\nfunc (m *authzMiddleware) Description() string { return m.next.Description() }\nfunc (m *authzMiddleware) InputSchema() map[string]any { return m.next.InputSchema() }\n\n// AuthError represents an authentication/authorization error.\ntype AuthError struct {\n    Code      string\n    Message   string\n    Challenge string\n}\n\nfunc (e *AuthError) Error() string {\n    return fmt.Sprintf(\"%s: %s\", e.Code, e.Message)\n}\n\n// buildAuthRequestFromContext creates an AuthRequest from context.\n// In real usage, this would extract headers from the transport layer.\nfunc buildAuthRequestFromContext(ctx context.Context) *AuthRequest {\n    req := &amp;AuthRequest{\n        Headers: make(map[string][]string),\n    }\n\n    // Extract headers from context if available\n    if headers, ok := ctx.Value(headersKey{}).(map[string][]string); ok {\n        req.Headers = headers\n    }\n\n    return req\n}\n\n// Context key for headers.\ntype headersKey struct{}\n\n// WithHeaders adds request headers to context.\nfunc WithHeaders(ctx context.Context, headers map[string][]string) context.Context {\n    return context.WithValue(ctx, headersKey{}, headers)\n}\n\n// HeadersFromContext retrieves headers from context.\nfunc HeadersFromContext(ctx context.Context) map[string][]string {\n    if headers, ok := ctx.Value(headersKey{}).(map[string][]string); ok {\n        return headers\n    }\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#task-8-factory-registration","title":"Task 8: Factory Registration","text":"<p>Files: - <code>internal/auth/factory.go</code> - <code>internal/auth/factory_test.go</code></p> <pre><code>// internal/auth/factory.go\npackage auth\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/middleware\"\n)\n\n// AuthenticatorFactory creates an Authenticator from configuration.\ntype AuthenticatorFactory func(cfg map[string]any) (Authenticator, error)\n\n// AuthorizerFactory creates an Authorizer from configuration.\ntype AuthorizerFactory func(cfg map[string]any) (Authorizer, error)\n\n// Registry holds auth component factories.\ntype Registry struct {\n    mu             sync.RWMutex\n    authenticators map[string]AuthenticatorFactory\n    authorizers    map[string]AuthorizerFactory\n}\n\n// NewRegistry creates a new auth registry.\nfunc NewRegistry() *Registry {\n    return &amp;Registry{\n        authenticators: make(map[string]AuthenticatorFactory),\n        authorizers:    make(map[string]AuthorizerFactory),\n    }\n}\n\n// RegisterAuthenticator registers an authenticator factory.\nfunc (r *Registry) RegisterAuthenticator(name string, factory AuthenticatorFactory) {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    r.authenticators[name] = factory\n}\n\n// RegisterAuthorizer registers an authorizer factory.\nfunc (r *Registry) RegisterAuthorizer(name string, factory AuthorizerFactory) {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    r.authorizers[name] = factory\n}\n\n// GetAuthenticator retrieves an authenticator factory.\nfunc (r *Registry) GetAuthenticator(name string) (AuthenticatorFactory, bool) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n    f, ok := r.authenticators[name]\n    return f, ok\n}\n\n// GetAuthorizer retrieves an authorizer factory.\nfunc (r *Registry) GetAuthorizer(name string) (AuthorizerFactory, bool) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n    f, ok := r.authorizers[name]\n    return f, ok\n}\n\n// DefaultRegistry is the global auth registry.\nvar DefaultRegistry = NewRegistry()\n\nfunc init() {\n    // Register built-in authenticators\n    DefaultRegistry.RegisterAuthenticator(\"jwt\", func(cfg map[string]any) (Authenticator, error) {\n        jwtCfg := DefaultJWTConfig()\n        if err := mapToStruct(cfg, &amp;jwtCfg); err != nil {\n            return nil, fmt.Errorf(\"jwt config: %w\", err)\n        }\n\n        // Get key provider based on config\n        keyProvider, err := buildKeyProvider(cfg)\n        if err != nil {\n            return nil, fmt.Errorf(\"jwt key provider: %w\", err)\n        }\n\n        return NewJWTAuthenticator(jwtCfg, keyProvider), nil\n    })\n\n    DefaultRegistry.RegisterAuthenticator(\"api_key\", func(cfg map[string]any) (Authenticator, error) {\n        apiKeyCfg := DefaultAPIKeyConfig()\n        if err := mapToStruct(cfg, &amp;apiKeyCfg); err != nil {\n            return nil, fmt.Errorf(\"api_key config: %w\", err)\n        }\n\n        // Get key store based on config\n        store, err := buildAPIKeyStore(cfg)\n        if err != nil {\n            return nil, fmt.Errorf(\"api_key store: %w\", err)\n        }\n\n        return NewAPIKeyAuthenticator(apiKeyCfg, store), nil\n    })\n\n    // Register built-in authorizers\n    DefaultRegistry.RegisterAuthorizer(\"simple_rbac\", func(cfg map[string]any) (Authorizer, error) {\n        rbacCfg := RBACConfig{}\n        if err := mapToStruct(cfg, &amp;rbacCfg); err != nil {\n            return nil, fmt.Errorf(\"rbac config: %w\", err)\n        }\n        return NewSimpleRBACAuthorizer(rbacCfg), nil\n    })\n\n    DefaultRegistry.RegisterAuthorizer(\"allow_all\", func(cfg map[string]any) (Authorizer, error) {\n        return AllowAllAuthorizer, nil\n    })\n\n    DefaultRegistry.RegisterAuthorizer(\"deny_all\", func(cfg map[string]any) (Authorizer, error) {\n        return DenyAllAuthorizer, nil\n    })\n\n    // Register middleware factories with global middleware registry\n    middleware.DefaultRegistry.Register(\"auth\", func(cfg map[string]any) (middleware.Middleware, error) {\n        authType, _ := cfg[\"type\"].(string)\n        if authType == \"\" {\n            authType = \"jwt\"\n        }\n\n        factory, ok := DefaultRegistry.GetAuthenticator(authType)\n        if !ok {\n            return nil, fmt.Errorf(\"unknown authenticator type: %s\", authType)\n        }\n\n        auth, err := factory(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        mwCfg := DefaultAuthMiddlewareConfig()\n        if allowAnon, ok := cfg[\"allow_anonymous\"].(bool); ok {\n            mwCfg.AllowAnonymous = allowAnon\n        }\n\n        return AuthMiddleware(auth, mwCfg), nil\n    })\n\n    middleware.DefaultRegistry.Register(\"authz\", func(cfg map[string]any) (middleware.Middleware, error) {\n        authzType, _ := cfg[\"type\"].(string)\n        if authzType == \"\" {\n            authzType = \"simple_rbac\"\n        }\n\n        factory, ok := DefaultRegistry.GetAuthorizer(authzType)\n        if !ok {\n            return nil, fmt.Errorf(\"unknown authorizer type: %s\", authzType)\n        }\n\n        authz, err := factory(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        return AuthzMiddleware(authz, DefaultAuthzMiddlewareConfig()), nil\n    })\n}\n\n// buildKeyProvider creates a KeyProvider from configuration.\nfunc buildKeyProvider(cfg map[string]any) (KeyProvider, error) {\n    // Check for static secret\n    if secret, ok := cfg[\"secret\"].(string); ok {\n        return NewHMACKeyProvider([]byte(secret)), nil\n    }\n\n    // Check for JWKS URL (future: implement JWKSKeyProvider)\n    if jwksURL, ok := cfg[\"jwks_url\"].(string); ok {\n        _ = jwksURL // TODO: Implement JWKSKeyProvider\n        return nil, fmt.Errorf(\"JWKS not yet implemented\")\n    }\n\n    return nil, fmt.Errorf(\"no key provider configured\")\n}\n\n// buildAPIKeyStore creates an APIKeyStore from configuration.\nfunc buildAPIKeyStore(cfg map[string]any) (APIKeyStore, error) {\n    storeCfg, _ := cfg[\"store\"].(map[string]any)\n    storeType, _ := storeCfg[\"type\"].(string)\n\n    switch storeType {\n    case \"memory\", \"\":\n        return NewMemoryAPIKeyStore(), nil\n    // Future: case \"redis\", \"postgres\"\n    default:\n        return nil, fmt.Errorf(\"unknown api_key store type: %s\", storeType)\n    }\n}\n\n// mapToStruct converts a map to a struct using reflection.\n// This is a simplified version - real implementation would use mapstructure.\nfunc mapToStruct(m map[string]any, target any) error {\n    // TODO: Use github.com/mitchellh/mapstructure\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#verification","title":"Verification","text":"<pre><code># Run all auth tests\ngo test ./internal/auth/... -v\n\n# Run with coverage\ngo test ./internal/auth/... -cover\n\n# Run specific test\ngo test ./internal/auth/... -run TestJWTAuthenticator -v\n\n# Lint\ngolangci-lint run ./internal/auth/...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#definition-of-done","title":"Definition of Done","text":"<ul> <li>[ ] All tests pass with &gt;80% coverage</li> <li>[ ] No golangci-lint errors</li> <li>[ ] Interfaces documented with godoc comments</li> <li>[ ] Factory registration working</li> <li>[ ] Middleware chain integration verified</li> <li>[ ] YAML configuration parsing works</li> <li>[ ] Context propagation verified</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#dependencies","title":"Dependencies","text":"<pre><code>go get github.com/golang-jwt/jwt/v5\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/plans/2026-01-30-prd-017-auth-middleware/#changelog","title":"Changelog","text":"Date Change 2026-01-30 Initial auth middleware PRD"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/","title":"Architecture Review: Comprehensive Proposal Analysis","text":"<p>Date: 2026-01-28 Status: Review Complete Reviewer: Architecture Review Agent</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#executive-summary","title":"Executive Summary","text":"<p>After thorough review of all 7 proposal documents against the current metatools-mcp codebase, the architecture is well-designed and internally consistent, with some notable areas requiring attention before implementation.</p> <p>Overall Score: 8.5/10</p> Category Score Status Interface Consistency 9/10 \u2705 Minor variations to fix Dependency Graph 8/10 \u26a0\ufe0f Some implicit deps Timeline Feasibility 6/10 \ud83d\udd34 Major discrepancy Coverage 8/10 \u26a0\ufe0f Some gaps Architectural Smells 7/10 \u26a0\ufe0f Complexity concerns"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#1-critical-issues-must-fix-before-implementation","title":"1. Critical Issues (Must Fix Before Implementation)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#11-timeline-discrepancy","title":"1.1 Timeline Discrepancy \ud83d\udd34","text":"<p>Finding: Three documents give different timeline estimates for the same work:</p> Document Total Timeline MVP Timeline ROADMAP.md 21 weeks 7 weeks implementation-phases.md 6-7 weeks 3-4 weeks architecture-evaluation.md 13 weeks (implied) Not specified <p>Root Cause: Each document measures a different scope: - implementation-phases.md: Core pluggable architecture only - architecture-evaluation.md: Core + key enterprise features - ROADMAP.md: Full ecosystem including agent skills</p> <p>Impact: Teams could plan with wrong expectations, resource allocation issues.</p> <p>Recommendation: <pre><code># Add to ROADMAP.md Executive Summary:\n\n## Scope Clarification\n\n| Milestone | Scope | Timeline |\n|-----------|-------|----------|\n| **MVP** | CLI, Config, Transport, Provider Registry | 7 weeks |\n| **Protocol** | + tooladapter, toolset | 14 weeks |\n| **Enterprise** | + toolsemantic, toolgateway, multi-tenancy | 17 weeks |\n| **Full** | + toolskill (Agent Skills) | 21 weeks |\n\nNote: implementation-phases.md covers MVP scope only.\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#12-transport-interface-signature-mismatch","title":"1.2 Transport Interface Signature Mismatch \ud83d\udd34","text":"<p>Finding: The <code>Transport</code> interface has inconsistent signatures across documents:</p> <pre><code>// pluggable-architecture.md (lines 274-288)\ntype Transport interface {\n    Name() string           // \u2705 Present\n    Serve(ctx context.Context, handler RequestHandler) error\n    Close() error\n    Info() TransportInfo    // Uses \"TransportInfo\"\n}\n\n// ROADMAP.md (lines 277-284)\ntype Transport interface {\n    // Name() - MISSING \u274c\n    Serve(ctx context.Context, handler RequestHandler) error\n    Close() error\n    Info() TransportInfo\n}\n\n// implementation-phases.md (lines 341-353)\ntype Transport interface {\n    Name() string\n    Serve(ctx context.Context, handler RequestHandler) error\n    Close() error\n    Info() Info             // Uses \"Info\" not \"TransportInfo\" \u274c\n}\n</code></pre> <p>Impact: Implementation confusion, potential compile errors.</p> <p>Recommendation: Standardize on pluggable-architecture.md version with <code>Name()</code> method and <code>TransportInfo</code> type. Update ROADMAP.md and implementation-phases.md.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#2-medium-priority-issues","title":"2. Medium Priority Issues","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#21-missing-dependencies-in-toolskill","title":"2.1 Missing Dependencies in toolskill","text":"<p>Finding: ROADMAP.md line 97 lists toolskill dependencies as <code>toolset, toolrun</code>.</p> <p>However, the SkillRuntime specification (lines 1329-1344) shows it also requires: - <code>toolobserve</code> for tracing (SkillContext has <code>Tracer trace.Tracer</code>) - <code>toolversion</code> for skill versioning (mentioned in Edge Cases)</p> <p>Impact: Incomplete dependency graph could cause integration issues.</p> <p>Recommendation: Update ROADMAP.md: <pre><code>| **toolskill** | Skills | ... | toolset, toolrun, toolobserve (optional), toolversion |\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#22-missing-toolprompt-library","title":"2.2 Missing toolprompt Library","text":"<p>Finding: architecture-evaluation.md (lines 371-394) identifies MCP Prompts as a gap. ROADMAP.md includes <code>toolresource</code> but not <code>toolprompt</code>.</p> <p>MCP Prompts are a core feature for standardized agent interactions.</p> <p>Impact: Incomplete MCP feature coverage.</p> <p>Recommendation: Either: 1. Add <code>toolprompt</code> to Stream D: Enterprise, OR 2. Document explicit exclusion rationale in ROADMAP.md</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#23-session-management-not-addressed","title":"2.3 Session Management Not Addressed","text":"<p>Finding: architecture-evaluation.md (line 173) notes MCP SDK has session management that metatools lacks. This gap is not addressed in any proposal.</p> <p>Impact: Multi-tenant stateful connections may need session tracking.</p> <p>Recommendation: Add session management consideration to multi-tenancy.md: <pre><code>### Session Management Integration\n\nFor stateful tenant connections, integrate with MCP SDK session:\n- Session ID \u2192 Tenant resolution\n- Session lifecycle \u2192 Tenant quota tracking\n- Session data \u2192 Tenant-scoped storage\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#24-index-interface-missing-onchangerefresh","title":"2.4 Index Interface Missing OnChange/Refresh","text":"<p>Finding: component-library-analysis.md (line 218) proposes adding <code>OnChange</code> callback and <code>Refresh()</code> to Index interface for hot reload. This is not reflected in ROADMAP.md's interface contracts.</p> <p>Impact: Hot reload capability won't be standardized.</p> <p>Recommendation: Add to ROADMAP.md Section 5 Interface Contracts: <pre><code>type Index interface {\n    // ... existing methods ...\n    OnChange(callback func(event RegistryEvent)) func()  // Returns unsubscribe function\n    Refresh() error                                       // Force refresh from backends\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#25-upstreamdownstream-impact-matrix-incomplete","title":"2.5 Upstream/Downstream Impact Matrix Incomplete","text":"<p>Finding: ROADMAP.md (lines 165-176) provides an impact matrix but is missing entries for new libraries.</p> <p>Missing Entries:</p> Change In Affects Upstream Affects Downstream toolsemantic None toolgateway (search routing) toolskill toolset, toolrun metatools (skill exposure), toolgateway toolaudit None All tenant-aware middleware toolresilience None All middleware, toolgateway"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#3-architectural-smells","title":"3. Architectural Smells","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#31-toolsemantic-complexity-explosion","title":"3.1 toolsemantic Complexity Explosion \u26a0\ufe0f","text":"<p>Finding: ROADMAP.md specifies 8 major interfaces for semantic search:</p> Interface Complexity Necessity for MVP Embedder Low \u2705 Required VectorIndex Medium \u2705 Required HybridSearcher Medium \u2705 Required Reranker Medium \u26a0\ufe0f Nice-to-have KnowledgeGraph High \u274c Experimental HierarchicalChunker High \u274c Experimental AgenticRetriever High \u274c Experimental ColBERTIndex High \u274c Specialized <p>Accuracy Benchmarks (from ROADMAP.md): - BM25 only: 78% - Hybrid (BM25+Vector): 94%  \u2190 16% improvement - Hybrid + Reranker: 97%    \u2190 3% more - Full stack: 98%           \u2190 1% more for 5 extra interfaces</p> <p>Impact: Over-engineering risk, delayed delivery.</p> <p>Recommendation: Phase the implementation: <pre><code>## toolsemantic Phased Delivery\n\n| Phase | Version | Interfaces | Accuracy |\n|-------|---------|------------|----------|\n| 1 | v0.1 | Embedder, VectorIndex, HybridSearcher | 94% |\n| 2 | v0.2 | + Reranker | 97% |\n| 3 | v0.3 | + KnowledgeGraph | 98% |\n| 4 | v1.0 | + AgenticRetriever, ColBERT | 98%+ |\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#32-middleware-proliferation","title":"3.2 Middleware Proliferation \u26a0\ufe0f","text":"<p>Finding: Combined proposals define 10+ middleware types: - Logging, Auth, RateLimit, Cache, Metrics, Tracing, Validation (7 from pluggable-architecture.md) - Tenant, TenantRateLimit, TenantToolFilter, TenantAudit (4 from multi-tenancy.md)</p> <p>Impact: - Latency accumulation (each middleware adds ~1-5ms) - Debugging complexity - Order dependency issues (rate limit before auth? after?)</p> <p>Recommendation: Document middleware ordering with production preset:</p> <pre><code>// DefaultProductionMiddleware provides recommended ordering\nvar DefaultProductionMiddleware = []Middleware{\n    LoggingMiddleware,     // 1st: Log all requests for observability\n    TracingMiddleware,     // 2nd: Start trace span\n    TenantMiddleware,      // 3rd: Resolve tenant early\n    RateLimitMiddleware,   // 4th: Fail fast if limited\n    AuthMiddleware,        // 5th: Authenticate\n    ValidationMiddleware,  // 6th: Validate input\n    CachingMiddleware,     // 7th: Check cache\n    // Handler executes here\n    // Middleware unwind in reverse order\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#33-skillbuilder-tight-coupling","title":"3.3 SkillBuilder Tight Coupling \u26a0\ufe0f","text":"<p>Finding: ROADMAP.md SkillBuilder (lines 1548-1567) uses hard-coded tool names:</p> <pre><code>Step(\"discover\", \"search_tools\")\nStep(\"docs-1\", \"describe_tool\")\n</code></pre> <p>Impact: If tool names change, all skills break.</p> <p>Recommendation: Use capability-based or versioned references:</p> <pre><code>// Option 1: Capability enum\nStep(\"discover\", capability.Search)\n\n// Option 2: Versioned tool ID\nStep(\"discover\", toolID(\"metatools:search_tools@v1\"))\n\n// Option 3: Interface-based\nStep(\"discover\", toolThat(func(t Tool) bool {\n    return t.HasCapability(\"search\")\n}))\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#4-verification-against-current-codebase","title":"4. Verification Against Current Codebase","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#41-current-implementation-analysis","title":"4.1 Current Implementation Analysis","text":"<p>File: <code>internal/handlers/interfaces.go</code></p> <p>Current interfaces are internal abstractions, not the external tool* library interfaces:</p> <pre><code>type Index interface {\n    Search(ctx context.Context, query string, limit int) ([]ToolSummary, error)\n    ListNamespaces(ctx context.Context) ([]string, error)\n}\n\ntype Store interface {\n    DescribeTool(ctx context.Context, id string, level string) (ToolDoc, error)\n    ListExamples(ctx context.Context, id string, maxExamples int) ([]ToolExample, error)\n}\n\ntype Runner interface {\n    Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n}\n</code></pre> <p>Observation: The proposals correctly identify these as internal interfaces that wrap external libraries via adapters (<code>internal/adapters/</code>).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#42-transport-layer-verification","title":"4.2 Transport Layer Verification","text":"<p>File: <code>cmd/metatools/main.go</code></p> <pre><code>transport := &amp;mcp.StdioTransport{}\nif err := srv.Run(ctx, transport); err != nil &amp;&amp; ctx.Err() == nil {\n    log.Fatalf(\"Server error: %v\", err)\n}\n</code></pre> <p>Observation: Current implementation uses <code>mcp.StdioTransport</code> directly. The proposals correctly identify that Transport abstraction is new work to enable multiple transport types.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#43-configuration-verification","title":"4.3 Configuration Verification","text":"<p>File: <code>internal/config/config.go</code></p> <pre><code>type Config struct {\n    Index    handlers.Index\n    Docs     handlers.Store\n    Runner   handlers.Runner\n    Executor handlers.Executor // optional\n}\n</code></pre> <p>Observation: Current config is minimal (4 fields). Proposals expand this significantly with ServerConfig, TransportConfig, SearchConfig, etc. This is additive and backward compatible.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#5-cross-reference-audit","title":"5. Cross-Reference Audit","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#51-document-references","title":"5.1 Document References","text":"From To Status pluggable-architecture.md component-library-analysis.md \u2705 Valid pluggable-architecture.md implementation-phases.md \u2705 Valid implementation-phases.md pluggable-architecture.md \u2705 Valid multi-tenancy.md pluggable-architecture.md \u2705 Valid architecture-evaluation.md component-library-analysis.md \u2705 Valid ROADMAP.md All proposals \u2705 Valid protocol-agnostic-tools.md ROADMAP.md \u274c Missing <p>Recommendation: Add to protocol-agnostic-tools.md: <pre><code>**Related:** [Master Roadmap](./ROADMAP.md) - Stream B: Protocol Layer\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#6-summary-of-recommendations","title":"6. Summary of Recommendations","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#high-priority-block-implementation","title":"High Priority (Block Implementation)","text":"<ol> <li>Reconcile timeline discrepancies - Add scope clarification table to ROADMAP.md</li> <li>Standardize Transport interface - Use pluggable-architecture.md version everywhere</li> <li>Document parallel stream constraints - Add resource requirements and critical path</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#medium-priority-quality-improvements","title":"Medium Priority (Quality Improvements)","text":"<ol> <li>Update toolskill dependencies - Add toolobserve, toolversion</li> <li>Add toolprompt - Or document exclusion rationale</li> <li>Add session management - To multi-tenancy proposal</li> <li>Add Index.OnChange/Refresh - To interface contracts</li> <li>Complete impact matrix - Add all new libraries</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#low-priority-future-considerations","title":"Low Priority (Future Considerations)","text":"<ol> <li>Phase toolsemantic - Deliver in 4 incremental versions</li> <li>Document middleware ordering - With production preset</li> <li>Use capability-based tool references - In SkillBuilder</li> <li>Add cross-reference - protocol-agnostic-tools.md \u2192 ROADMAP.md</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#7-conclusion","title":"7. Conclusion","text":"<p>The metatools architecture proposals are comprehensive and well-designed. The modular approach with 22 libraries provides excellent separation of concerns. The main risks are:</p> <ol> <li>Timeline confusion - Different documents suggest wildly different timelines</li> <li>Complexity creep - toolsemantic and middleware could become unwieldy</li> <li>Interface drift - Minor inconsistencies need cleanup before implementation</li> </ol> <p>With the recommended fixes, this architecture will achieve the stated goal of 95%+ championship-level capabilities.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ARCHITECTURE-REVIEW/#appendix-files-reviewed","title":"Appendix: Files Reviewed","text":"Document Lines Last Modified ROADMAP.md ~2100 2026-01-28 pluggable-architecture.md ~4900 2026-01-28 implementation-phases.md ~900 2026-01-28 component-library-analysis.md - 2026-01-27 architecture-evaluation.md ~450 2026-01-28 multi-tenancy.md - 2026-01-28 protocol-agnostic-tools.md - 2026-01-28 Source File Purpose internal/handlers/interfaces.go Current internal interfaces internal/config/config.go Current config structure internal/server/server.go Current server implementation cmd/metatools/main.go Current entry point internal/adapters/*.go Library adapters"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/","title":"Metatools Architecture Roadmap","text":"<p>Status: Master Plan Version: 1.0.0 Last Updated: 2026-01-28</p> <p>Guiding Principle: Simple and elegant at the core, extensible through modular, pluggable architecture. The existing 7 libraries represent a mature, well-designed foundation. New work focuses on exposure, configuration, and enterprise capabilities\u2014not redesign.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#executive-summary","title":"Executive Summary","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#current-state","title":"Current State","text":"<ul> <li>7 production libraries with clean interfaces</li> <li>13 extension points already implemented as Go interfaces</li> <li>85% championship-level architecture</li> <li>Primary gap: Exposure and configuration, not architecture</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#target-state","title":"Target State","text":"<ul> <li>22 total libraries (7 existing + 15 new)</li> <li>95%+ championship-level with full enterprise capabilities</li> <li>Protocol-agnostic tool platform</li> <li>Multi-tenant with pluggable isolation strategies</li> <li>Agent skills for higher-level capability composition</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#scope-clarification","title":"Scope Clarification","text":"Milestone Scope Timeline Document Reference MVP CLI, Config, Transport, Provider Registry 7 weeks implementation-phases.md Protocol + tooladapter, toolset, multi-transport 14 weeks protocol-agnostic-tools.md Enterprise + toolsemantic, toolgateway, multi-tenancy 17 weeks multi-tenancy.md Full + toolskill (Agent Skills) 21 weeks This document <p>Note: implementation-phases.md covers MVP scope only (6-7 weeks). This master roadmap covers the full 21-week timeline.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#timeline-overview","title":"Timeline Overview","text":"<pre><code>                    CORE EXPOSURE          ENTERPRISE FEATURES         AGENT SKILLS\n                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nWeek 1-2   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 CLI + Config\nWeek 3-4   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Transport Layer\nWeek 5     \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Provider Registry\nWeek 6-7   \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Backend Registry\nWeek 8-9              \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Protocol Adapters\nWeek 10-11            \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Observability + Caching\nWeek 12-13            \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Multi-Tenancy\nWeek 14-15            \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Versioning + Resilience\nWeek 16-17            \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Semantic Search + Gateway\nWeek 18-19                                                    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Skill Core\nWeek 20-21                                                    \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 Orchestration\n                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                    MVP: 7 weeks | Full: 17 weeks | Skills: 21 weeks\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Library Inventory</li> <li>Dependency Map</li> <li>Work Streams</li> <li>Stream A: Core Exposure</li> <li>Stream B: Protocol Layer</li> <li>Stream C: Cross-Cutting</li> <li>Stream D: Enterprise</li> <li>Stream E: Agent Skills</li> <li>Phase Breakdown</li> <li>Interface Contracts</li> <li>Edge Cases &amp; Considerations</li> <li>Rollout Strategy</li> <li>Multi-Language Extensibility</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#1-library-inventory","title":"1. Library Inventory","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#existing-libraries-production","title":"Existing Libraries (Production)","text":"Library Version Purpose Extension Points Changes Needed toolmodel v0.1.3 Core data models, schemas SchemaValidator Add Version field toolindex v0.1.9 Tool registry, discovery Searcher, BackendSelector Multi-backend events tooldocs v0.1.11 Progressive disclosure docs Store, ToolResolver Bulk registration toolsearch v0.1.10 BM25 search implementation (via Searcher) None toolrun v0.1.10 Execution orchestration Runner, MCPExecutor, ProviderExecutor, LocalRegistry HTTP/gRPC executors toolcode v0.1.11 Code execution Engine, Logger Engine registry toolruntime v0.1.11 Sandbox isolation (10 backends) Backend, ToolGateway None"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#proposed-libraries-new","title":"Proposed Libraries (New)","text":"Library Stream Purpose Priority Effort Dependencies tooladapter Protocol Protocol-agnostic tool abstraction High 2w toolmodel toolset Protocol Composable tool collections High 2w tooladapter, toolindex toolversion Cross-Cut Semantic versioning, negotiation High 2w toolmodel toolcache Cross-Cut Pluggable caching (Redis/Memory) High 2w None toolobserve Cross-Cut OpenTelemetry tracing + metrics High 2w None toolresilience Cross-Cut Circuit breaker, retry, bulkhead Medium 2w None toolhealth Cross-Cut Health checks, readiness probes Medium 1w None toolsecrets Cross-Cut Vault/AWS secrets management Medium 2w None toolflags Cross-Cut Feature flags (LaunchDarkly) Low 1w None toolaudit Cross-Cut Immutable audit logging Medium 2w None toolpressure Cross-Cut Backpressure, load shedding Low 1w None toolsemantic Enterprise Hybrid search (BM25+vector), GraphRAG, reranking, ColBERT High 3w toolindex, toolsearch toolresource Enterprise MCP Resources support Medium 2w toolindex toolgateway Enterprise Auth, rate limit, analytics proxy Medium 3w All toolskill Skills SKILL.md-compatible agent skills, workflows Medium 4w toolset, toolrun, toolobserve (opt), toolversion"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#2-dependency-map","title":"2. Dependency Map","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#library-dependencies-dag","title":"Library Dependencies (DAG)","text":"<pre><code>                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                            \u2502    toolskill    \u2502 (L5)\n                            \u2502  Agent Skills   \u2502\n                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                     \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502                                                      \u2502\n          \u25bc                                                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   toolgateway   \u2502 (L4)                              \u2502    toolrun      \u2502\n\u2502  Auth + Proxy   \u2502                                   \u2502   (execution)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502                          \u2502                          \u2502\n          \u25bc                          \u25bc                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   toolobserve   \u2502      \u2502  toolresilience \u2502      \u2502    toolaudit    \u2502 (L3)\n\u2502   OpenTelemetry \u2502      \u2502 Circuit Breaker \u2502      \u2502  Audit Logging  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                        \u2502                        \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502                       \u2502                       \u2502\n          \u25bc                       \u25bc                       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    toolset      \u2502      \u2502   toolversion   \u2502      \u2502    toolcache    \u2502 (L2)\n\u2502  Composable     \u2502      \u2502   Versioning    \u2502      \u2502    Caching      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                        \u2502                        \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502\n                                  \u25bc\n                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                        \u2502   tooladapter   \u2502 (L1)\n                        \u2502 Protocol Adapt  \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502                            \u2502                            \u2502\n    \u25bc                            \u25bc                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502toolmodel\u2502  \u2502toolindex\u2502  \u2502tooldocs \u2502  \u2502 toolrun \u2502  \u2502toolcode \u2502 (L0)\n\u2502  v0.1.2 \u2502  \u2502  v0.1.8 \u2502  \u2502 v0.1.10 \u2502  \u2502  v0.1.9 \u2502  \u2502 v0.1.10 \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n     \u2502            \u2502            \u2502            \u2502            \u2502\n     \u2502            \u2502            \u2502            \u2502            \u25bc\n     \u2502            \u2502            \u2502            \u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502            \u2502            \u2502            \u2514\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 toolruntime \u2502\n     \u2502            \u2502            \u2502                   \u2502   v0.1.10   \u2502\n     \u2502            \u2502            \u25bc                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502            \u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502            \u2514\u2500\u2500\u2500\u2500\u2500\u25ba\u2502toolsearch\u2502\n     \u2502                   \u2502  v0.1.9  \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#upstreamdownstream-impact-matrix","title":"Upstream/Downstream Impact Matrix","text":"Change In Affects Upstream Affects Downstream toolmodel None All libraries toolindex None tooldocs, toolrun, toolset tooladapter toolmodel toolset, toolgateway toolversion toolmodel tooladapter, toolrun toolcache None toolindex, tooldocs, toolrun toolobserve None All libraries (optional) toolskill toolset, toolrun metatools (skill exposure)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#3-work-streams","title":"3. Work Streams","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#stream-a-core-exposure","title":"Stream A: Core Exposure","text":"<p>Goal: Expose existing 13 extension points via configuration and CLI.</p> Phase Work Package Duration Deliverables A1 CLI Framework 2 weeks Cobra CLI, subcommands A2 Configuration 1 week Koanf loader, YAML schema A3 Transport Layer 2 weeks Transport interface, stdio/SSE/HTTP A4 Provider Registry 1 week ToolProvider interface, registry A5 Backend Registry 2 weeks Backend interface, aggregator <p>Total: 8 weeks | MVP: Phases A1-A4 (6 weeks)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#a1-cli-framework-2-weeks","title":"A1: CLI Framework (2 weeks)","text":"<pre><code>Week 1:\n\u251c\u2500\u2500 Day 1-2: Cobra setup, root command\n\u251c\u2500\u2500 Day 3-4: `stdio` subcommand (existing behavior)\n\u251c\u2500\u2500 Day 5: `serve` subcommand (HTTP server)\n\nWeek 2:\n\u251c\u2500\u2500 Day 1-2: `version`, `validate` commands\n\u251c\u2500\u2500 Day 3-4: Signal handling, graceful shutdown\n\u251c\u2500\u2500 Day 5: Documentation, examples\n</code></pre> <p>Interface Contract: <pre><code>// cmd/metatools/main.go\nfunc main() {\n    rootCmd := &amp;cobra.Command{Use: \"metatools\"}\n    rootCmd.AddCommand(\n        newStdioCmd(),   // MCP over stdio (default)\n        newServeCmd(),   // HTTP/SSE server\n        newVersionCmd(), // Print version\n        newValidateCmd(), // Validate config\n    )\n    rootCmd.Execute()\n}\n</code></pre></p> <p>Edge Cases: - [ ] Backward compatibility: <code>metatools</code> alone = <code>metatools stdio</code> - [ ] Environment variables override YAML config - [ ] Invalid config: fail fast with clear error messages - [ ] Missing optional config: sensible defaults</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#a2-configuration-1-week","title":"A2: Configuration (1 week)","text":"<pre><code>Week 3:\n\u251c\u2500\u2500 Day 1-2: Koanf setup, YAML parser\n\u251c\u2500\u2500 Day 3: Environment variable binding\n\u251c\u2500\u2500 Day 4: Config validation schema\n\u251c\u2500\u2500 Day 5: Default values, documentation\n</code></pre> <p>Interface Contract: <pre><code>// internal/config/config.go\ntype Config struct {\n    Server     ServerConfig     `koanf:\"server\"`\n    Transport  TransportConfig  `koanf:\"transport\"`\n    Search     SearchConfig     `koanf:\"search\"`\n    Execution  ExecutionConfig  `koanf:\"execution\"`\n    Backends   BackendsConfig   `koanf:\"backends\"`\n    Middleware MiddlewareConfig `koanf:\"middleware\"`\n}\n\nfunc Load(path string) (*Config, error)\nfunc LoadWithEnv(path string, prefix string) (*Config, error)\n</code></pre></p> <p>Edge Cases: - [ ] Config file not found: use defaults - [ ] Partial config: merge with defaults - [ ] Invalid values: return typed validation errors - [ ] Hot reload: optional, via <code>toolconfig</code> watcher</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#a3-transport-layer-2-weeks","title":"A3: Transport Layer (2 weeks)","text":"<pre><code>Week 4:\n\u251c\u2500\u2500 Day 1-2: Transport interface definition\n\u251c\u2500\u2500 Day 3-4: Stdio transport (wrap existing)\n\u251c\u2500\u2500 Day 5: Transport registry\n\nWeek 5:\n\u251c\u2500\u2500 Day 1-2: SSE transport implementation\n\u251c\u2500\u2500 Day 3-4: HTTP transport implementation\n\u251c\u2500\u2500 Day 5: TLS support, health endpoints\n</code></pre> <p>Interface Contract: <pre><code>// internal/transport/transport.go\ntype Transport interface {\n    Name() string  // Transport identifier (e.g., \"stdio\", \"sse\", \"http\")\n    Serve(ctx context.Context, handler RequestHandler) error\n    Close() error\n    Info() TransportInfo\n}\n\ntype TransportInfo struct {\n    Name     string\n    Protocol string // \"stdio\", \"http\", \"sse\", \"grpc\"\n    Address  string // \"\" for stdio, \"localhost:8080\" for HTTP\n}\n\ntype TransportRegistry interface {\n    Register(name string, factory TransportFactory)\n    Get(name string) (Transport, error)\n    List() []string\n}\n</code></pre></p> <p>Edge Cases: - [ ] Stdio: handle broken pipe gracefully - [ ] HTTP: CORS headers for browser clients - [ ] SSE: reconnection with event ID - [ ] TLS: certificate rotation without restart - [ ] Health: <code>/health</code> (liveness), <code>/ready</code> (readiness)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#a4-provider-registry-1-week","title":"A4: Provider Registry (1 week)","text":"<pre><code>Week 6:\n\u251c\u2500\u2500 Day 1-2: ToolProvider interface\n\u251c\u2500\u2500 Day 3: Provider registry\n\u251c\u2500\u2500 Day 4: Refactor existing tools as providers\n\u251c\u2500\u2500 Day 5: Custom provider registration docs\n</code></pre> <p>Interface Contract: <pre><code>// internal/provider/provider.go\ntype ToolProvider interface {\n    Name() string\n    Tool() *mcp.Tool\n    Handle(ctx context.Context, input json.RawMessage) (any, error)\n}\n\ntype ProviderRegistry interface {\n    Register(provider ToolProvider) error\n    Get(name string) (ToolProvider, error)\n    List() []ToolProvider\n    Unregister(name string) error\n}\n</code></pre></p> <p>Edge Cases: - [ ] Duplicate registration: return error, don't overwrite - [ ] Dynamic registration: emit events for discovery - [ ] Provider panic: recover, log, return error - [ ] Slow provider: context deadline enforced</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#a5-backend-registry-2-weeks","title":"A5: Backend Registry (2 weeks)","text":"<pre><code>Week 7:\n\u251c\u2500\u2500 Day 1-2: Backend interface definition\n\u251c\u2500\u2500 Day 3-4: Local backend (existing behavior)\n\u251c\u2500\u2500 Day 5: Backend registry\n\nWeek 8:\n\u251c\u2500\u2500 Day 1-2: MCP backend (connect to MCP servers)\n\u251c\u2500\u2500 Day 3-4: HTTP backend (REST API tools)\n\u251c\u2500\u2500 Day 5: Aggregator (merge tools from all backends)\n</code></pre> <p>Interface Contract: <pre><code>// internal/backend/backend.go\ntype Backend interface {\n    Kind() string              // \"local\", \"mcp\", \"http\"\n    Name() string              // Instance name\n    Start(ctx context.Context) error\n    Stop(ctx context.Context) error\n    ListTools(ctx context.Context) ([]*toolmodel.Tool, error)\n    Execute(ctx context.Context, tool string, input any) (any, error)\n    Health(ctx context.Context) HealthStatus\n}\n\ntype BackendRegistry interface {\n    Register(backend Backend) error\n    Get(name string) (Backend, error)\n    ListByKind(kind string) []Backend\n    Aggregate() AggregatedBackend\n}\n</code></pre></p> <p>Edge Cases: - [ ] Backend offline: mark unhealthy, exclude from routing - [ ] Tool name collision: namespace with backend name - [ ] Slow backend: per-backend timeout - [ ] Backend restart: re-register tools, emit events</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#stream-b-protocol-layer","title":"Stream B: Protocol Layer","text":"<p>Goal: Protocol-agnostic tool exposure with composable toolsets.</p> Phase Work Package Duration Deliverables B1 tooladapter Core 2 weeks Adapter interface, MCP adapter B2 Additional Adapters 1 week OpenAI, Anthropic, LangChain B3 toolset Core 2 weeks Toolset builder, filtering B4 Multi-Transport 1 week Expose via MCP, REST, direct <p>Total: 6 weeks</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#b1-tooladapter-core-2-weeks","title":"B1: tooladapter Core (2 weeks)","text":"<pre><code>Week 9:\n\u251c\u2500\u2500 Day 1-2: CanonicalTool type definition\n\u251c\u2500\u2500 Day 3-4: Adapter interface\n\u251c\u2500\u2500 Day 5: MCP adapter (bidirectional)\n\nWeek 10:\n\u251c\u2500\u2500 Day 1-2: Schema conversion utilities\n\u251c\u2500\u2500 Day 3-4: Adapter registry\n\u251c\u2500\u2500 Day 5: Unit tests, documentation\n</code></pre> <p>Interface Contract: <pre><code>// tooladapter/canonical.go\ntype CanonicalTool struct {\n    ID          string\n    Namespace   string\n    Name        string\n    Version     semver.Version\n    Description string\n    InputSchema *JSONSchema\n    OutputSchema *JSONSchema\n    Handler     ToolHandler\n    SourceFormat string\n    SourceMeta   map[string]any\n}\n\n// tooladapter/adapter.go\ntype Adapter interface {\n    Name() string\n    ToCanonical(raw any) (*CanonicalTool, error)\n    FromCanonical(tool *CanonicalTool) (any, error)\n    SupportsFeature(feature SchemaFeature) bool\n}\n</code></pre></p> <p>Edge Cases: - [ ] Schema feature not supported: strip with warning - [ ] Conversion loss: preserve original in SourceMeta - [ ] Bidirectional round-trip: verify no data loss - [ ] Nil handling: optional fields default to nil/zero</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#b2-additional-adapters-1-week","title":"B2: Additional Adapters (1 week)","text":"<pre><code>Week 11:\n\u251c\u2500\u2500 Day 1-2: OpenAI adapter (strict mode support)\n\u251c\u2500\u2500 Day 3: Anthropic adapter\n\u251c\u2500\u2500 Day 4: LangChain adapter\n\u251c\u2500\u2500 Day 5: OpenAPI adapter (import only)\n</code></pre> <p>Edge Cases: - [ ] OpenAI strict mode: reject unsupported features - [ ] Anthropic input_schema vs inputSchema naming - [ ] LangChain Zod schemas: convert to JSON Schema - [ ] OpenAPI discriminators: flatten to anyOf</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#b3-toolset-core-2-weeks","title":"B3: toolset Core (2 weeks)","text":"<pre><code>Week 12:\n\u251c\u2500\u2500 Day 1-2: Toolset type definition\n\u251c\u2500\u2500 Day 3-4: Builder pattern with fluent API\n\u251c\u2500\u2500 Day 5: Filter predicates\n\nWeek 13:\n\u251c\u2500\u2500 Day 1-2: Access control policies\n\u251c\u2500\u2500 Day 3-4: Integration with toolindex\n\u251c\u2500\u2500 Day 5: Integration with toolrun\n</code></pre> <p>Interface Contract: <pre><code>// toolset/builder.go\ntype Builder struct { ... }\n\nfunc NewBuilder(name string) *Builder\nfunc (b *Builder) FromRegistry(reg *Registry) *Builder\nfunc (b *Builder) WithNamespace(ns string) *Builder\nfunc (b *Builder) WithTags(tags ...string) *Builder\nfunc (b *Builder) WithTools(ids ...string) *Builder\nfunc (b *Builder) ExcludeTools(ids ...string) *Builder\nfunc (b *Builder) WithPolicy(p *AccessPolicy) *Builder\nfunc (b *Builder) Build() (*Toolset, error)\n</code></pre></p> <p>Edge Cases: - [ ] Empty toolset: valid, return empty list - [ ] Conflicting filters: AND logic (all must match) - [ ] Tool removed after build: refresh on demand - [ ] Circular exclude: no-op, tool already excluded</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#b4-multi-transport-1-week","title":"B4: Multi-Transport (1 week)","text":"<pre><code>Week 14:\n\u251c\u2500\u2500 Day 1-2: MCP exposure (enhanced)\n\u251c\u2500\u2500 Day 3: REST API exposure\n\u251c\u2500\u2500 Day 4: Direct Go client\n\u251c\u2500\u2500 Day 5: Documentation, examples\n</code></pre> <p>Edge Cases: - [ ] MCP version mismatch: negotiate or reject - [ ] REST pagination: cursor-based for large toolsets - [ ] Go client: context cancellation propagation</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#stream-c-cross-cutting","title":"Stream C: Cross-Cutting","text":"<p>Goal: Production-ready cross-cutting concerns.</p> Phase Work Package Duration Deliverables C1 toolcache 2 weeks Cache interface, Redis/Memory C2 toolobserve 2 weeks OpenTelemetry integration C3 toolversion 2 weeks Semantic versioning, negotiation C4 toolresilience 2 weeks Circuit breaker, retry C5 toolhealth 1 week Health checks C6 toolaudit 2 weeks Audit logging C7 toolsecrets 2 weeks Secrets management C8 toolflags + toolpressure 2 weeks Feature flags, backpressure <p>Total: 15 weeks (can parallelize C1-C3 and C4-C8)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#c1-toolcache-2-weeks","title":"C1: toolcache (2 weeks)","text":"<p>Interface Contract: <pre><code>// toolcache/cache.go\ntype Cache interface {\n    Get(ctx context.Context, key string) ([]byte, bool, error)\n    Set(ctx context.Context, key string, value []byte, ttl time.Duration) error\n    Delete(ctx context.Context, key string) error\n    Clear(ctx context.Context, pattern string) error\n    Stats() CacheStats\n    Close() error\n}\n</code></pre></p> <p>Implementations: - <code>MemoryCache</code> - LRU eviction, process-local - <code>RedisCache</code> - Distributed, TTL-based - <code>LayeredCache</code> - L1 memory + L2 Redis</p> <p>Integration Points: - <code>toolindex</code>: Cache tool lookups (<code>index:tool:{id}</code>) - <code>tooldocs</code>: Cache documentation (<code>docs:{id}:{level}</code>) - <code>toolsearch</code>: Cache search results (<code>search:{hash}</code>) - <code>tooladapter</code>: Cache schema conversions (<code>schema:{format}:{id}</code>)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#c2-toolobserve-2-weeks","title":"C2: toolobserve (2 weeks)","text":"<p>Interface Contract: <pre><code>// toolobserve/observe.go\ntype Observer interface {\n    StartSpan(ctx context.Context, name string) (context.Context, Span)\n    RecordMetric(name string, value float64, labels map[string]string)\n    RecordError(ctx context.Context, err error)\n}\n\ntype Span interface {\n    SetAttribute(key string, value any)\n    AddEvent(name string, attrs map[string]any)\n    RecordError(err error)\n    End()\n}\n</code></pre></p> <p>Integration Points: - Middleware: auto-instrument all tool calls - Per-backend: trace backend latency - Per-tool: trace individual tool execution</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#c3-toolversion-2-weeks","title":"C3: toolversion (2 weeks)","text":"<p>Interface Contract: <pre><code>// toolversion/registry.go\ntype VersionedToolRegistry interface {\n    Register(tool *VersionedTool) error\n    Resolve(name string, constraint string) (*VersionedTool, error)\n    ListVersions(name string) []VersionInfo\n    Deprecate(name string, version string, message string, sunset time.Time) error\n}\n</code></pre></p> <p>Edge Cases: - [ ] No matching version: return ErrNoCompatibleVersion - [ ] Deprecated tool used: log warning, emit metric - [ ] Sunset reached: remove from registry - [ ] Version constraint invalid: return parse error</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#c4-toolresilience-2-weeks","title":"C4: toolresilience (2 weeks)","text":"<p>Interface Contract: <pre><code>// toolresilience/resilience.go\ntype CircuitBreaker interface {\n    Execute(ctx context.Context, fn func() error) error\n    State() CircuitState\n    Reset()\n}\n\ntype RetryPolicy interface {\n    Execute(ctx context.Context, fn func() error) error\n    ShouldRetry(err error, attempt int) bool\n}\n\ntype Bulkhead interface {\n    Acquire(ctx context.Context) error\n    Release()\n    Available() int\n}\n</code></pre></p> <p>Edge Cases: - [ ] Circuit open: fail fast without calling backend - [ ] Retry on non-idempotent: disabled by default - [ ] Bulkhead full: reject with 503 - [ ] Jitter calculation: prevent thundering herd</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#stream-d-enterprise","title":"Stream D: Enterprise","text":"<p>Goal: Enterprise-grade features for production deployments.</p> Phase Work Package Duration Deliverables D1 Multi-Tenancy Core 2 weeks Tenant model, resolvers D2 Tenant Middleware 1 week Rate limit, filtering, audit D3 Tenant Storage 1 week Redis/Postgres store D4 toolsemantic 3 weeks Vector search, hybrid D5 toolresource 2 weeks MCP Resources support D6 toolgateway 3 weeks Auth proxy, analytics <p>Total: 12 weeks (can parallelize D1-D3 and D4-D6)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#d1-multi-tenancy-core-2-weeks","title":"D1: Multi-Tenancy Core (2 weeks)","text":"<p>Interface Contract: <pre><code>// multi-tenancy\ntype Tenant struct {\n    ID       string\n    Name     string\n    Tier     TenantTier // free, pro, enterprise\n    Metadata map[string]any\n}\n\ntype TenantResolver interface {\n    Resolve(ctx context.Context, req *Request) (*TenantContext, error)\n}\n\ntype TenantContext struct {\n    Tenant      *Tenant\n    Permissions []string\n    Config      *TenantConfig\n    Quotas      *TenantQuotas\n}\n</code></pre></p> <p>Isolation Strategies: 1. Shared: Logical isolation via middleware (default) 2. Namespace: Tool namespace per tenant 3. Process: Dedicated process per tenant</p> <p>Edge Cases: - [ ] No tenant header: use default tenant or reject - [ ] Tenant not found: return 401/403 - [ ] Quota exceeded: return 429 with retry-after - [ ] Tenant config change: propagate to active sessions</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#d4-toolsemantic-advanced-semantic-search-3-weeks","title":"D4: toolsemantic - Advanced Semantic Search (3 weeks)","text":"<p>Research-Driven Design: This specification is based on 2025 industry best practices for production RAG systems, including hybrid search, knowledge graphs, hierarchical chunking, agentic retrieval, and late interaction models.</p> <pre><code>Week 16:\n\u251c\u2500\u2500 Day 1-2: Core embedding and vector interfaces\n\u251c\u2500\u2500 Day 3-4: Hybrid search (BM25 + vector fusion)\n\u251c\u2500\u2500 Day 5: Reranker integration\n\nWeek 17:\n\u251c\u2500\u2500 Day 1-2: GraphRAG knowledge graph layer\n\u251c\u2500\u2500 Day 3-4: Hierarchical/tree chunking\n\u251c\u2500\u2500 Day 5: Context tree traversal\n\nWeek 18:\n\u251c\u2500\u2500 Day 1-2: Agentic RAG (query expansion, multi-query)\n\u251c\u2500\u2500 Day 3-4: ColBERT/late interaction support\n\u251c\u2500\u2500 Day 5: Integration tests, benchmarks\n</code></pre> <p>Architecture Overview:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          AGENTIC RAG LAYER                                  \u2502\n\u2502  Query Expansion \u2192 Multi-Query \u2192 Self-Reasoning \u2192 Adaptive Retrieval       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           HYBRID SEARCH                                     \u2502\n\u2502                                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502\n\u2502  \u2502  BM25/TF-IDF\u2502    \u2502   Vector    \u2502    \u2502   GraphRAG  \u2502                     \u2502\n\u2502  \u2502  (toolsearch)\u2502   \u2502  (Dense)    \u2502    \u2502 (Knowledge) \u2502                     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502         \u2502                  \u2502                  \u2502                             \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                            \u2502                                                \u2502\n\u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                       \u2502\n\u2502                   \u2502  Rank Fusion    \u2502                                       \u2502\n\u2502                   \u2502 (RRF / Weighted)\u2502                                       \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                       \u2502\n\u2502                            \u2502                                                \u2502\n\u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                       \u2502\n\u2502                   \u2502   Reranker      \u2502                                       \u2502\n\u2502                   \u2502 (Cross-Encoder) \u2502                                       \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        INDEX LAYER                                          \u2502\n\u2502                                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  BM25 Index \u2502    \u2502 HNSW/IVF    \u2502    \u2502  Knowledge  \u2502    \u2502 Hierarchical\u2502  \u2502\n\u2502  \u2502(toolsearch) \u2502    \u2502Vector Index \u2502    \u2502   Graph     \u2502    \u2502    Tree     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Core Interface Contracts:</p> <pre><code>// toolsemantic/embedding.go\n\n// Embedder generates vector embeddings from text\ntype Embedder interface {\n    // Embed generates embedding for a single text\n    Embed(ctx context.Context, text string) ([]float32, error)\n\n    // EmbedBatch generates embeddings for multiple texts (more efficient)\n    EmbedBatch(ctx context.Context, texts []string) ([][]float32, error)\n\n    // Dimensions returns the embedding vector size\n    Dimensions() int\n\n    // Model returns the model identifier\n    Model() string\n}\n\n// EmbedderFactory creates embedders from configuration\ntype EmbedderFactory interface {\n    Create(config EmbedderConfig) (Embedder, error)\n}\n\n// EmbedderConfig configures an embedding provider\ntype EmbedderConfig struct {\n    Provider   string            // \"openai\", \"cohere\", \"local\", \"ollama\"\n    Model      string            // \"text-embedding-3-small\", \"embed-english-v3.0\"\n    Dimensions int               // Override dimensions (for some models)\n    Options    map[string]any    // Provider-specific options\n}\n</code></pre> <pre><code>// toolsemantic/vector.go\n\n// VectorIndex provides vector similarity search\ntype VectorIndex interface {\n    // Index adds vectors to the index\n    Index(ctx context.Context, docs []VectorDocument) error\n\n    // Search finds similar vectors\n    Search(ctx context.Context, query []float32, opts SearchOptions) ([]VectorResult, error)\n\n    // Delete removes documents from index\n    Delete(ctx context.Context, ids []string) error\n\n    // Stats returns index statistics\n    Stats() IndexStats\n}\n\ntype VectorDocument struct {\n    ID        string\n    Vector    []float32\n    Metadata  map[string]any\n    Content   string  // Optional, for hybrid storage\n}\n\ntype VectorResult struct {\n    ID       string\n    Score    float32  // Similarity score (higher = more similar)\n    Distance float32  // Distance (lower = more similar)\n    Metadata map[string]any\n    Content  string\n}\n\ntype SearchOptions struct {\n    TopK     int               // Number of results\n    MinScore float32           // Minimum similarity threshold\n    Filter   map[string]any    // Metadata filters\n}\n\n// VectorIndexFactory creates vector indices\ntype VectorIndexFactory interface {\n    Create(config VectorIndexConfig) (VectorIndex, error)\n}\n\ntype VectorIndexConfig struct {\n    Backend     string  // \"memory\", \"faiss\", \"qdrant\", \"pinecone\", \"chromadb\"\n    Dimensions  int\n    Metric      string  // \"cosine\", \"euclidean\", \"dot\"\n    IndexType   string  // \"flat\", \"hnsw\", \"ivf\"\n\n    // HNSW-specific\n    M               int  // Max connections per layer\n    EfConstruction  int  // Construction time quality/speed tradeoff\n    EfSearch        int  // Search time quality/speed tradeoff\n}\n</code></pre> <pre><code>// toolsemantic/hybrid.go\n\n// HybridSearcher combines multiple retrieval methods\ntype HybridSearcher interface {\n    // Search performs hybrid search across all configured retrievers\n    Search(ctx context.Context, query string, opts HybridOptions) ([]SearchResult, error)\n\n    // Explain returns detailed scoring breakdown\n    Explain(ctx context.Context, query string, docID string) (*ScoreExplanation, error)\n}\n\ntype HybridOptions struct {\n    TopK            int\n\n    // Retrieval weights (must sum to 1.0)\n    BM25Weight      float32  // Weight for BM25/keyword results\n    VectorWeight    float32  // Weight for vector similarity results\n    GraphWeight     float32  // Weight for knowledge graph results\n\n    // Fusion strategy\n    FusionMethod    FusionMethod  // RRF, WeightedSum, Borda\n\n    // Reranking\n    EnableReranker  bool\n    RerankerTopK    int  // Rerank top N results\n\n    // Filters\n    Namespaces      []string\n    Tags            []string\n    MetadataFilters map[string]any\n}\n\ntype FusionMethod string\n\nconst (\n    FusionRRF         FusionMethod = \"rrf\"          // Reciprocal Rank Fusion\n    FusionWeightedSum FusionMethod = \"weighted_sum\" // Weighted score combination\n    FusionBorda       FusionMethod = \"borda\"        // Borda count ranking\n)\n\ntype SearchResult struct {\n    ID          string\n    Score       float32\n    Content     string\n    Metadata    map[string]any\n\n    // Detailed scores\n    BM25Score   float32\n    VectorScore float32\n    GraphScore  float32\n    RerankerScore float32\n\n    // Source tracking\n    Sources     []string  // Which retrievers contributed\n}\n\ntype ScoreExplanation struct {\n    FinalScore    float32\n    FusionMethod  FusionMethod\n    Components    []ScoreComponent\n    RerankerBoost float32\n}\n\ntype ScoreComponent struct {\n    Source      string   // \"bm25\", \"vector\", \"graph\"\n    RawScore    float32\n    Weight      float32\n    WeightedScore float32\n    Rank        int\n}\n</code></pre> <pre><code>// toolsemantic/reranker.go\n\n// Reranker performs cross-encoder reranking on retrieved results\ntype Reranker interface {\n    // Rerank scores query-document pairs using cross-encoder\n    Rerank(ctx context.Context, query string, docs []RerankerInput) ([]RerankerResult, error)\n\n    // Model returns the reranker model identifier\n    Model() string\n}\n\ntype RerankerInput struct {\n    ID      string\n    Content string\n}\n\ntype RerankerResult struct {\n    ID    string\n    Score float32  // Cross-encoder relevance score\n}\n\n// RerankerConfig configures a reranker\ntype RerankerConfig struct {\n    Provider  string  // \"cohere\", \"jina\", \"local\", \"colbert\"\n    Model     string  // \"rerank-english-v3.0\", \"ms-marco-MiniLM\"\n    MaxTokens int     // Max input tokens\n    BatchSize int     // Batch size for efficiency\n}\n</code></pre> <pre><code>// toolsemantic/graph.go\n\n// KnowledgeGraph provides graph-based retrieval (GraphRAG)\ntype KnowledgeGraph interface {\n    // Build extracts entities and relationships from documents\n    Build(ctx context.Context, docs []GraphDocument) error\n\n    // Query retrieves relevant subgraph for a query\n    Query(ctx context.Context, query string, opts GraphQueryOptions) (*GraphResult, error)\n\n    // GetEntity retrieves a specific entity\n    GetEntity(ctx context.Context, id string) (*Entity, error)\n\n    // TraverseRelations walks relationships from an entity\n    TraverseRelations(ctx context.Context, entityID string, depth int) ([]Relationship, error)\n}\n\ntype GraphDocument struct {\n    ID      string\n    Content string\n    Metadata map[string]any\n}\n\ntype GraphQueryOptions struct {\n    MaxEntities     int\n    MaxRelationships int\n    TraversalDepth  int\n    IncludeCommunities bool  // Include community summaries\n}\n\ntype GraphResult struct {\n    Entities      []Entity\n    Relationships []Relationship\n    Communities   []Community     // High-level community summaries\n    Summary       string          // Graph-generated summary\n    Score         float32\n}\n\ntype Entity struct {\n    ID          string\n    Name        string\n    Type        string            // \"tool\", \"namespace\", \"concept\"\n    Description string\n    Attributes  map[string]any\n    Embedding   []float32\n}\n\ntype Relationship struct {\n    ID       string\n    Source   string  // Entity ID\n    Target   string  // Entity ID\n    Type     string  // \"uses\", \"depends_on\", \"similar_to\"\n    Weight   float32\n    Metadata map[string]any\n}\n\ntype Community struct {\n    ID       string\n    Name     string\n    Summary  string\n    Entities []string  // Entity IDs in this community\n    Level    int       // Hierarchy level (0 = most granular)\n}\n</code></pre> <pre><code>// toolsemantic/hierarchical.go\n\n// HierarchicalChunker implements tree-structured document chunking\ntype HierarchicalChunker interface {\n    // Chunk splits document into hierarchical tree structure\n    Chunk(ctx context.Context, doc *Document) (*ChunkTree, error)\n\n    // Retrieve navigates tree to find relevant chunks\n    Retrieve(ctx context.Context, tree *ChunkTree, query string, opts TreeOptions) ([]Chunk, error)\n}\n\ntype Document struct {\n    ID       string\n    Content  string\n    Metadata map[string]any\n}\n\ntype ChunkTree struct {\n    Root     *ChunkNode\n    Depth    int\n    NumNodes int\n}\n\ntype ChunkNode struct {\n    ID        string\n    Level     int           // 0 = leaf, higher = more abstract\n    Content   string        // Text content or summary\n    Embedding []float32\n    Children  []*ChunkNode\n    Parent    *ChunkNode\n\n    // For RAPTOR-style summarization\n    Summary   string        // LLM-generated summary at this level\n}\n\ntype Chunk struct {\n    ID        string\n    Content   string\n    Level     int\n    Score     float32\n    Path      []string  // Path from root to this chunk\n}\n\ntype TreeOptions struct {\n    MaxChunks     int\n    MinLevel      int  // Minimum abstraction level to consider\n    MaxLevel      int  // Maximum abstraction level\n\n    // Traversal strategy\n    Strategy      TraversalStrategy\n}\n\ntype TraversalStrategy string\n\nconst (\n    TraversalTopDown    TraversalStrategy = \"top_down\"    // Start from summaries\n    TraversalBottomUp   TraversalStrategy = \"bottom_up\"   // Start from leaves\n    TraversalCollapsed  TraversalStrategy = \"collapsed\"   // RAPTOR-style collapsed tree\n)\n</code></pre> <pre><code>// toolsemantic/agentic.go\n\n// AgenticRetriever implements LLM-enhanced retrieval strategies\ntype AgenticRetriever interface {\n    // Retrieve performs agentic retrieval with optional query expansion\n    Retrieve(ctx context.Context, query string, opts AgenticOptions) (*AgenticResult, error)\n}\n\ntype AgenticOptions struct {\n    // Query expansion\n    EnableQueryExpansion  bool\n    MaxExpandedQueries    int\n\n    // Multi-query\n    EnableMultiQuery      bool\n    QueryVariations       int\n\n    // Self-reasoning (Step-Back, Chain-of-Thought)\n    EnableSelfReasoning   bool\n    ReasoningDepth        int\n\n    // Iterative retrieval\n    EnableIterative       bool\n    MaxIterations         int\n    StopCondition         func(results []SearchResult) bool\n\n    // Base retriever to use\n    BaseRetriever         HybridSearcher\n}\n\ntype AgenticResult struct {\n    Results          []SearchResult\n\n    // Agentic metadata\n    ExpandedQueries  []string\n    ReasoningChain   []ReasoningStep\n    Iterations       int\n\n    // Quality signals\n    Confidence       float32\n    CoverageScore    float32\n}\n\ntype ReasoningStep struct {\n    Step        int\n    Query       string\n    Reasoning   string   // LLM explanation\n    ResultCount int\n    TopScore    float32\n}\n</code></pre> <pre><code>// toolsemantic/colbert.go\n\n// ColBERTIndex implements late interaction retrieval\ntype ColBERTIndex interface {\n    // Index adds documents with token-level embeddings\n    Index(ctx context.Context, docs []ColBERTDocument) error\n\n    // Search performs MaxSim-based late interaction search\n    Search(ctx context.Context, query string, opts ColBERTOptions) ([]ColBERTResult, error)\n}\n\ntype ColBERTDocument struct {\n    ID           string\n    Content      string\n    TokenEmbeddings [][]float32  // Per-token embeddings\n}\n\ntype ColBERTOptions struct {\n    TopK         int\n    NCells       int   // For PLAID centroid-based search\n    NDocs        int   // Candidate docs before rescoring\n}\n\ntype ColBERTResult struct {\n    ID           string\n    Score        float32  // MaxSim score\n    TokenScores  []TokenMatch  // Token-level matching details\n}\n\ntype TokenMatch struct {\n    QueryToken  string\n    DocToken    string\n    Score       float32\n}\n</code></pre> <p>Integration with Existing Libraries:</p> <pre><code>// toolsemantic/integration.go\n\n// SemanticSearcher wraps toolsearch.Searcher with semantic capabilities\ntype SemanticSearcher struct {\n    // Existing BM25 searcher\n    bm25     toolsearch.Searcher\n\n    // New semantic components\n    embedder     Embedder\n    vectorIndex  VectorIndex\n    reranker     Reranker\n    graph        KnowledgeGraph\n\n    // Configuration\n    config       SemanticConfig\n}\n\n// Search implements toolindex.Searcher interface\nfunc (s *SemanticSearcher) Search(ctx context.Context, query string, opts toolsearch.Options) ([]toolsearch.Result, error) {\n    // Perform hybrid search internally\n    hybridResults, err := s.hybridSearch(ctx, query, HybridOptions{\n        TopK:         opts.Limit,\n        BM25Weight:   s.config.BM25Weight,\n        VectorWeight: s.config.VectorWeight,\n        GraphWeight:  s.config.GraphWeight,\n        EnableReranker: s.config.EnableReranker,\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    // Convert to toolsearch.Result format\n    return convertResults(hybridResults), nil\n}\n\n// NewSemanticSearcher creates a semantic searcher that wraps BM25\nfunc NewSemanticSearcher(bm25 toolsearch.Searcher, opts ...SemanticOption) (*SemanticSearcher, error) {\n    // ...\n}\n</code></pre> <p>Configuration Example:</p> <pre><code># metatools.yaml\nsemantic:\n  enabled: true\n\n  embedder:\n    provider: openai\n    model: text-embedding-3-small\n    dimensions: 1536\n\n  vector_index:\n    backend: memory  # memory, faiss, qdrant, chromadb\n    metric: cosine\n    index_type: hnsw\n    hnsw:\n      m: 16\n      ef_construction: 200\n      ef_search: 100\n\n  hybrid:\n    bm25_weight: 0.4\n    vector_weight: 0.5\n    graph_weight: 0.1\n    fusion_method: rrf\n\n  reranker:\n    enabled: true\n    provider: cohere\n    model: rerank-english-v3.0\n    top_k: 20\n\n  graph:\n    enabled: false  # Experimental\n    entity_types: [\"tool\", \"namespace\", \"concept\"]\n\n  agentic:\n    enabled: false  # Experimental\n    query_expansion: true\n    max_iterations: 3\n</code></pre> <p>Performance Characteristics:</p> Component Latency Memory Accuracy Impact BM25 (baseline) ~8ms Low Baseline (78%) Vector (HNSW) ~12ms Medium +8% (86%) Hybrid (BM25+Vector) ~25ms Medium +16% (94%) + Reranker +50-100ms Low +3% (97%) + GraphRAG +100-200ms High +2% (context) + Agentic +500-2000ms Low Variable <p>Research-Based Accuracy Benchmarks (Tool Discovery):</p> Method Accuracy @ 50 tools @ 200 tools @ 500 tools BM25 only 78% 71% 63% Vector only 82% 76% 69% Hybrid (BM25+Vector) 94% 89% 84% Hybrid + Reranker 97% 94% 91% Hybrid + Reranker + Graph 98% 96% 93% <p>Edge Cases:</p> <ul> <li>[ ] Empty embedding: reject with ErrEmptyInput</li> <li>[ ] Dimension mismatch: validate at index time</li> <li>[ ] Reranker timeout: fall back to hybrid-only results</li> <li>[ ] Graph disconnected: handle isolated entities</li> <li>[ ] Query expansion loop: max iteration limit</li> <li>[ ] OOM on large indices: streaming/pagination support</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#stream-e-agent-skills","title":"Stream E: Agent Skills","text":"<p>Goal: Higher-level agent capabilities that compose tools into reusable workflows and behaviors.</p> <p>Design Insight: Skills sit above tools in the abstraction hierarchy. While tools are atomic operations (search, execute, describe), skills are reusable agent behaviors that orchestrate multiple tools (research-and-summarize, debug-and-fix, deploy-with-validation).</p> Phase Work Package Duration Deliverables E1 Skill Core 2 weeks Skill interface, registry, manifest E2 Skill Composition 1 week Workflow DSL, step orchestration E3 Skill Execution 1 week Runtime, context propagation, rollback <p>Total: 4 weeks (can start after Stream B Protocol Layer)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#abstraction-hierarchy","title":"Abstraction Hierarchy","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        AGENTS                                \u2502\n\u2502  (Autonomous decision makers: Claude, GPT, custom agents)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502 use\n                             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        SKILLS (NEW)                          \u2502\n\u2502  Higher-level behaviors: research, debug, deploy, review    \u2502\n\u2502  Composed from multiple tools with workflow logic           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502 orchestrate\n                             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        TOOLSETS                              \u2502\n\u2502  Curated tool collections: dev-tools, search-tools          \u2502\n\u2502  Filtered by namespace, tags, access policy                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502 contain\n                             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TOOLS                                \u2502\n\u2502  Atomic operations: search_tools, run_tool, describe_tool   \u2502\n\u2502  Single-purpose, composable primitives                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#e1-skill-core-2-weeks","title":"E1: Skill Core (2 weeks)","text":"<pre><code>Week 18:\n\u251c\u2500\u2500 Day 1-2: Skill interface definition\n\u251c\u2500\u2500 Day 3-4: SkillManifest type (A2A-aligned)\n\u251c\u2500\u2500 Day 5: SkillRegistry implementation\n\nWeek 19:\n\u251c\u2500\u2500 Day 1-2: Skill discovery and advertisement\n\u251c\u2500\u2500 Day 3-4: Skill versioning integration\n\u251c\u2500\u2500 Day 5: Unit tests, documentation\n</code></pre> <p>Interface Contract: <pre><code>// toolskill/skill.go\ntype Skill interface {\n    // Identity\n    ID() string\n    Name() string\n    Version() semver.Version\n\n    // Manifest for discovery/advertisement\n    Manifest() *SkillManifest\n\n    // Execution\n    Execute(ctx context.Context, input SkillInput) (*SkillOutput, error)\n\n    // Introspection\n    RequiredTools() []string\n    Steps() []StepDefinition\n}\n\n// SkillManifest describes skill capabilities (A2A-aligned)\ntype SkillManifest struct {\n    ID          string            `json:\"id\"`\n    Name        string            `json:\"name\"`\n    Version     string            `json:\"version\"`\n    Description string            `json:\"description\"`\n    InputSchema *jsonschema.Schema `json:\"inputSchema\"`\n    OutputSchema *jsonschema.Schema `json:\"outputSchema,omitempty\"`\n    Tags        []string          `json:\"tags\"`\n\n    // Dependencies\n    RequiredTools []string        `json:\"requiredTools\"`\n    RequiredSkills []string       `json:\"requiredSkills,omitempty\"`\n\n    // Execution hints\n    EstimatedSteps int            `json:\"estimatedSteps\"`\n    Idempotent     bool           `json:\"idempotent\"`\n    SupportsPause  bool           `json:\"supportsPause\"`\n}\n\n// SkillRegistry manages skill discovery and lookup\ntype SkillRegistry interface {\n    Register(skill Skill) error\n    Get(id string) (Skill, error)\n    GetByName(name string, versionConstraint string) (Skill, error)\n    List() []SkillManifest\n    ListByTag(tag string) []SkillManifest\n    Unregister(id string) error\n\n    // Discovery for A2A\n    Advertise() []SkillManifest\n}\n</code></pre></p> <p>Design Patterns from Research:</p> Framework Pattern Adaptation for toolskill LangChain Chains (sequential) <code>SequentialSkill</code> with steps LangChain Agents (decision) <code>AdaptiveSkill</code> with branching CrewAI Crews (role-based) <code>CompositeSkill</code> with sub-skills CrewAI Flows (control) <code>WorkflowSkill</code> with explicit flow AutoGen Conversation <code>ConversationalSkill</code> with memory"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#skillmd-standard-format-support","title":"SKILL.md Standard Format Support","text":"<p>The toolskill library will implement the Agent Skills Open Standard (adopted by Claude Code, OpenAI Codex CLI, ChatGPT, and Google Antigravity) to ensure cross-platform compatibility.</p> <p>Standard SKILL.md Structure: <pre><code>---\nname: skill-name-with-hyphens\ndescription: Use when [specific triggering conditions and symptoms]\nmetadata:\n  author: optional-author\n  version: \"1.0.0\"\n  argument-hint: optional-hint\n---\n\n# Skill Name\n\n## Overview\nWhat is this? Core principle in 1-2 sentences.\n\n## When to Use\nSymptoms and use cases.\n\n## How It Works\nStep-by-step process.\n\n[Additional sections as needed]\n</code></pre></p> <p>Standard Directory Structure: <pre><code>skills/\n  skill-name/\n    SKILL.md              # Main entry point (required)\n    references/           # Optional supporting files\n      summary.md\n      files.md\n    scripts/              # Optional executable tools\n      validate.sh\n</code></pre></p> <p>Discovery Locations (Claude Code compatible): - User settings: <code>~/.claude/skills/</code> or <code>~/.config/claude/skills/</code> - Project settings: <code>.claude/skills/</code> - Plugin-provided: <code>plugins/*/skills/</code> - Nested directories: Automatic discovery in subdirectories</p> <p>Interface Contract for SKILL.md Parsing: <pre><code>// toolskill/skillmd/parser.go\n\n// SkillMD represents a parsed SKILL.md file\ntype SkillMD struct {\n    // YAML Frontmatter\n    Name        string            `yaml:\"name\"`\n    Description string            `yaml:\"description\"`\n    License     string            `yaml:\"license,omitempty\"`\n    Metadata    map[string]any    `yaml:\"metadata,omitempty\"`\n\n    // Parsed Content\n    Content     string            // Raw markdown content\n    Overview    string            // Extracted ## Overview section\n    WhenToUse   string            // Extracted ## When to Use section\n    HowItWorks  string            // Extracted ## How It Works section\n    Sections    map[string]string // All other sections\n}\n\n// Parser reads and parses SKILL.md files\ntype Parser interface {\n    Parse(path string) (*SkillMD, error)\n    ParseBytes(data []byte) (*SkillMD, error)\n    Validate(skill *SkillMD) []ValidationError\n}\n\n// Generator creates SKILL.md files from skills\ntype Generator interface {\n    Generate(skill Skill) ([]byte, error)\n    GenerateWithTemplate(skill Skill, template string) ([]byte, error)\n}\n\n// Discovery finds skills in standard locations\ntype Discovery interface {\n    // Scan standard locations for skills\n    ScanUserSkills() ([]SkillMD, error)           // ~/.claude/skills/\n    ScanProjectSkills(root string) ([]SkillMD, error) // .claude/skills/\n    ScanPluginSkills(pluginDir string) ([]SkillMD, error)\n\n    // Watch for changes\n    Watch(ctx context.Context, locations []string) (&lt;-chan SkillEvent, error)\n}\n</code></pre></p> <p>Cross-Platform Export: <pre><code>// toolskill/export/exporter.go\n\ntype Exporter interface {\n    // Export to standard SKILL.md format (Claude, Codex, ChatGPT)\n    ToSkillMD(skill Skill) (*SkillMD, error)\n\n    // Export to platform-specific formats\n    ToZIP(skill Skill) ([]byte, error)          // Claude/OpenAI upload\n    ToTarGz(skill Skill) ([]byte, error)        // Gemini upload\n\n    // Batch export\n    ExportDirectory(skills []Skill, path string) error\n}\n\n// Import from SKILL.md files\ntype Importer interface {\n    // Import single skill\n    FromSkillMD(md *SkillMD) (Skill, error)\n\n    // Batch import from directory\n    FromDirectory(path string) ([]Skill, error)\n\n    // Import from skill repository URL\n    FromRepository(url string) ([]Skill, error)\n}\n</code></pre></p> <p>Key Design Decisions:</p> <ol> <li> <p>Frontmatter Limited to name + description: Per standard, only these fields are guaranteed. Additional metadata is optional.</p> </li> <li> <p>Description Format: Must start with \"Use when...\" to optimize for Claude's skill discovery algorithm.</p> </li> <li> <p>Progressive Disclosure: Skills loaded on-demand based on description matching, not pre-loaded (reduces context window usage).</p> </li> <li> <p>Flat Namespace: All skills in searchable namespace for discovery. No nested hierarchies.</p> </li> <li> <p>Token Efficiency: Frequently-loaded skills should be &lt;200 words. Reference material in separate files.</p> </li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#e2-skill-composition-1-week","title":"E2: Skill Composition (1 week)","text":"<pre><code>Week 20:\n\u251c\u2500\u2500 Day 1-2: Step definition DSL\n\u251c\u2500\u2500 Day 3: Sequential composition\n\u251c\u2500\u2500 Day 4: Parallel composition\n\u251c\u2500\u2500 Day 5: Conditional branching\n</code></pre> <p>Interface Contract: <pre><code>// toolskill/step.go\ntype StepDefinition struct {\n    ID          string\n    Name        string\n    Tool        string              // Tool to execute\n    InputMapper func(SkillContext) any  // Map skill input to tool input\n    OutputMapper func(any) any      // Transform tool output\n    Condition   func(SkillContext) bool // Skip if returns false\n    OnError     ErrorHandler\n}\n\n// toolskill/builder.go\ntype SkillBuilder struct { ... }\n\nfunc NewSkillBuilder(name string) *SkillBuilder\n\n// Sequential steps\nfunc (b *SkillBuilder) Step(name string, tool string) *StepBuilder\n\n// Parallel execution\nfunc (b *SkillBuilder) Parallel(steps ...*StepBuilder) *SkillBuilder\n\n// Conditional branching\nfunc (b *SkillBuilder) Branch(condition func(SkillContext) bool,\n                              ifTrue *SkillBuilder,\n                              ifFalse *SkillBuilder) *SkillBuilder\n\n// Sub-skill composition\nfunc (b *SkillBuilder) UseSkill(skillID string) *SkillBuilder\n\n// Build final skill\nfunc (b *SkillBuilder) Build() (Skill, error)\n</code></pre></p> <p>Example: Research-and-Summarize Skill <pre><code>researchSkill := NewSkillBuilder(\"research-and-summarize\").\n    WithDescription(\"Research a topic and provide a summary\").\n    WithInputSchema(researchInputSchema).\n\n    // Step 1: Search for relevant tools\n    Step(\"discover\", \"search_tools\").\n        WithInput(func(ctx SkillContext) any {\n            return map[string]any{\"query\": ctx.Input[\"topic\"]}\n        }).\n\n    // Step 2: Get documentation for top results\n    Parallel(\n        Step(\"docs-1\", \"describe_tool\").WithInput(fromResult(0)),\n        Step(\"docs-2\", \"describe_tool\").WithInput(fromResult(1)),\n        Step(\"docs-3\", \"describe_tool\").WithInput(fromResult(2)),\n    ).\n\n    // Step 3: Synthesize findings\n    Step(\"synthesize\", \"run_tool\").\n        WithInput(func(ctx SkillContext) any {\n            return synthesizeInputs(ctx)\n        }).\n\n    Build()\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#e3-skill-execution-1-week","title":"E3: Skill Execution (1 week)","text":"<pre><code>Week 21:\n\u251c\u2500\u2500 Day 1-2: Skill runtime with context\n\u251c\u2500\u2500 Day 3: Progress tracking, checkpoints\n\u251c\u2500\u2500 Day 4: Rollback on failure\n\u251c\u2500\u2500 Day 5: Integration with toolobserve\n</code></pre> <p>Interface Contract: <pre><code>// toolskill/runtime.go\ntype SkillRuntime interface {\n    Execute(ctx context.Context, skill Skill, input SkillInput) (*SkillOutput, error)\n    ExecuteAsync(ctx context.Context, skill Skill, input SkillInput) (ExecutionID, error)\n\n    // Progress and control\n    GetStatus(execID ExecutionID) (*ExecutionStatus, error)\n    Pause(execID ExecutionID) error\n    Resume(execID ExecutionID) error\n    Cancel(execID ExecutionID) error\n\n    // Checkpoints for long-running skills\n    Checkpoint(execID ExecutionID) (*Checkpoint, error)\n    RestoreFromCheckpoint(checkpoint *Checkpoint) (ExecutionID, error)\n}\n\n// SkillContext provides execution context to steps\ntype SkillContext struct {\n    Input      map[string]any      // Original skill input\n    Results    map[string]any      // Results from previous steps\n    Metadata   map[string]any      // Execution metadata\n    Toolset    *toolset.Toolset    // Available tools\n    Logger     Logger              // Structured logging\n    Tracer     trace.Tracer        // OpenTelemetry tracing\n}\n\n// ExecutionStatus tracks skill progress\ntype ExecutionStatus struct {\n    ID            ExecutionID\n    SkillID       string\n    State         ExecutionState  // pending, running, paused, completed, failed\n    CurrentStep   string\n    CompletedSteps []string\n    Progress      float64         // 0.0 to 1.0\n    StartedAt     time.Time\n    Error         error\n}\n</code></pre></p> <p>Edge Cases: - [ ] Step timeout: configurable per-step, fail or skip - [ ] Tool not found: fail skill with ErrMissingTool - [ ] Parallel step failure: configurable (fail-fast or continue) - [ ] Checkpoint restore: validate skill version compatibility - [ ] Circular skill dependencies: detect and reject at registration</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#skill-tool-integration","title":"Skill-Tool Integration","text":"<pre><code>// Expose skills via MCP as special tools\ntype SkillToolProvider struct {\n    registry SkillRegistry\n    runtime  SkillRuntime\n}\n\nfunc (p *SkillToolProvider) Tools() []*mcp.Tool {\n    var tools []*mcp.Tool\n    for _, manifest := range p.registry.List() {\n        tools = append(tools, &amp;mcp.Tool{\n            Name: \"skill:\" + manifest.Name,\n            Description: \"[SKILL] \" + manifest.Description,\n            InputSchema: manifest.InputSchema,\n        })\n    }\n    return tools\n}\n</code></pre> <p>MCP Tool Naming Convention: - Regular tools: <code>search_tools</code>, <code>run_tool</code> - Skills: <code>skill:research</code>, <code>skill:debug</code>, <code>skill:deploy</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#4-phase-breakdown","title":"4. Phase Breakdown","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#phase-1-mvp-core-weeks-1-7","title":"Phase 1: MVP Core (Weeks 1-7)","text":"<p>Deliverables: - [x] Cobra CLI framework - [x] Koanf configuration - [x] Transport abstraction (stdio, SSE, HTTP) - [x] Provider registry - [x] Basic backend registry</p> <p>Success Criteria: - <code>metatools serve --config config.yaml</code> starts HTTP server - All 13 extension points configurable via YAML - Backward compatible with existing <code>metatools</code> usage</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#phase-2-protocol-layer-weeks-8-14","title":"Phase 2: Protocol Layer (Weeks 8-14)","text":"<p>Deliverables: - [ ] tooladapter library - [ ] toolset library - [ ] Multi-transport exposure</p> <p>Success Criteria: - Tools convertible between MCP \u2194 OpenAI \u2194 Anthropic - Composable toolsets via builder pattern - Same tools exposed via MCP and REST</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#phase-3-cross-cutting-weeks-8-17-parallel","title":"Phase 3: Cross-Cutting (Weeks 8-17, parallel)","text":"<p>Deliverables: - [ ] toolcache (memory, Redis, layered) - [ ] toolobserve (OpenTelemetry) - [ ] toolversion (semantic versioning) - [ ] toolresilience (circuit breaker, retry) - [ ] toolhealth, toolaudit, toolsecrets</p> <p>Success Criteria: - All tool calls traced via OpenTelemetry - Circuit breaker protects against cascade failures - Comprehensive audit log for compliance</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#phase-4-enterprise-weeks-12-17-parallel","title":"Phase 4: Enterprise (Weeks 12-17, parallel)","text":"<p>Deliverables: - [ ] Multi-tenancy (resolvers, middleware, storage) - [ ] toolsemantic (vector search) - [ ] toolresource (MCP Resources) - [ ] toolgateway (auth proxy)</p> <p>Success Criteria: - Multiple tenants isolated by configuration - Semantic search improves tool discovery accuracy - OAuth 2.1 authentication via gateway</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#phase-5-agent-skills-weeks-18-21","title":"Phase 5: Agent Skills (Weeks 18-21)","text":"<p>Deliverables: - [ ] toolskill library (skill interface, registry, manifest) - [ ] Skill composition DSL (sequential, parallel, branching) - [ ] Skill runtime (execution, checkpoints, rollback) - [ ] A2A skill advertisement integration</p> <p>Success Criteria: - Skills discoverable via SkillRegistry.Advertise() - Multi-step skills execute with progress tracking - Skills exposed as MCP tools with <code>skill:</code> prefix - Checkpoint/restore enables long-running skill recovery</p> <p>Dependencies: - Requires Stream B completion (toolset for tool access) - Benefits from Stream C (toolobserve for tracing)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#5-interface-contracts","title":"5. Interface Contracts","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#core-interfaces-must-be-stable","title":"Core Interfaces (Must Be Stable)","text":"Interface Library Breaking Change Policy <code>Tool</code> toolmodel MAJOR version bump <code>Index</code> toolindex MAJOR version bump <code>Searcher</code> toolindex MINOR (additive only) <code>Store</code> tooldocs MINOR (additive only) <code>Runner</code> toolrun MAJOR version bump <code>Backend</code> toolruntime MINOR (additive only)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#new-interfaces-design-phase","title":"New Interfaces (Design Phase)","text":"Interface Library Status Review Required <code>Transport</code> metatools Draft Architecture <code>ToolProvider</code> metatools Draft Architecture <code>BackendRegistry</code> metatools Draft Architecture <code>Adapter</code> tooladapter Draft Protocol Team <code>Cache</code> toolcache Draft Infrastructure <code>Observer</code> toolobserve Draft SRE Team <code>Skill</code> toolskill Draft Agent Team <code>SkillRegistry</code> toolskill Draft Agent Team <code>SkillRuntime</code> toolskill Draft Agent Team <code>Embedder</code> toolsemantic Draft ML/Search Team <code>VectorIndex</code> toolsemantic Draft ML/Search Team <code>HybridSearcher</code> toolsemantic Draft ML/Search Team <code>Reranker</code> toolsemantic Draft ML/Search Team <code>KnowledgeGraph</code> toolsemantic Draft ML/Search Team <code>AgenticRetriever</code> toolsemantic Draft ML/Search Team"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#6-edge-cases-considerations","title":"6. Edge Cases &amp; Considerations","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#interface-evolution","title":"Interface Evolution","text":"Scenario Strategy Add optional field MINOR bump, backward compatible Add required field MAJOR bump, migration guide Remove field Deprecate \u2192 2 releases \u2192 remove Change field type Never (create new field)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#error-handling","title":"Error Handling","text":"Error Type HTTP Code MCP Error Code Retry? Tool not found 404 -32601 No Invalid input 400 -32602 No Backend timeout 504 -32603 Yes Rate limited 429 -32603 Yes (with backoff) Circuit open 503 -32603 Yes (after reset) Internal error 500 -32603 Maybe"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#concurrency","title":"Concurrency","text":"Component Concurrency Model Lock Granularity Provider Registry RWMutex Per-registry Backend Registry RWMutex Per-registry Cache Per-key locking Key-level Circuit Breaker Atomic counters Per-breaker Tenant Store RWMutex Per-tenant Skill Registry RWMutex Per-registry Skill Runtime Per-execution Execution-level"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#resource-limits","title":"Resource Limits","text":"Resource Default Configurable Enforcement Max tools per backend 1000 Yes Registration fails Max concurrent requests 100 Yes 503 response Max request size 10MB Yes 413 response Tool execution timeout 30s Per-tool Context cancellation Cache entry size 1MB Yes Reject large entries"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#7-rollout-strategy","title":"7. Rollout Strategy","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#version-compatibility-matrix","title":"Version Compatibility Matrix","text":"metatools toolmodel toolindex toolrun tooladapter toolskill v0.2.x v0.1.2+ v0.1.8+ v0.1.9+ - - v0.3.x v0.2.0+ v0.2.0+ v0.2.0+ v1.0.0+ - v1.0.x v0.2.0+ v0.2.0+ v0.2.0+ v1.0.0+ - v1.1.x v0.2.0+ v0.2.0+ v0.2.0+ v1.0.0+ v1.0.0+"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#release-cadence","title":"Release Cadence","text":"Track Frequency Stability Use Case stable Monthly Production Enterprise beta Bi-weekly Testing Early adopters nightly Daily Development Contributors"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#migration-guides","title":"Migration Guides","text":"<p>Each MAJOR version bump requires: 1. Migration guide with step-by-step instructions 2. Codemods where possible (automated refactoring) 3. Deprecation period (minimum 2 minor versions) 4. Backward compatibility layer (optional, time-limited)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#feature-flags-for-rollout","title":"Feature Flags for Rollout","text":"<pre><code>feature_flags:\n  new_transport_layer: true      # Phase 2\n  protocol_adapters: false       # Phase 3 (beta)\n  semantic_search: false         # Phase 4 (alpha)\n  multi_tenancy: false           # Phase 4 (alpha)\n  agent_skills: false            # Phase 5 (alpha)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#8-multi-language-extensibility","title":"8. Multi-Language Extensibility","text":"<p>Design Principle: The pluggable architecture is not limited to Go implementations. Any component can be replaced by implementations written in any programming language through standardized interface contracts.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#why-multi-language-matters","title":"Why Multi-Language Matters","text":"Use Case Language Rationale ML/Embedding Models Python Rich ML ecosystem (PyTorch, transformers, sentence-transformers) High-Performance Retrieval Rust Memory safety + near-C performance for vector operations Enterprise Integrations Java Existing corporate libraries, Spring ecosystem Rapid Prototyping TypeScript Fast iteration, existing MCP server implementations Edge Deployment WASM Sandboxed, portable, language-agnostic runtime"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#interface-contract-technologies","title":"Interface Contract Technologies","text":"<p>The architecture supports three proven approaches for multi-language interoperability:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#option-1-grpc-protocol-buffers-recommended","title":"Option 1: gRPC + Protocol Buffers (Recommended)","text":"<p>Battle-tested approach used by HashiCorp (Terraform, Vault, Consul, Packer).</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            METATOOLS CORE (Go)                                   \u2502\n\u2502                                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                     Plugin Host (go-plugin style)                        \u2502   \u2502\n\u2502   \u2502   - Launches plugins as subprocesses                                     \u2502   \u2502\n\u2502   \u2502   - Communicates via gRPC over local socket                             \u2502   \u2502\n\u2502   \u2502   - Health monitoring and automatic restart                              \u2502   \u2502\n\u2502   \u2502   - Graceful shutdown and resource cleanup                               \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502 gRPC (protobuf)\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                           \u2502                           \u2502\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Python Embedder   \u2502   \u2502 Rust Vector Index \u2502   \u2502 TypeScript Adapter\u2502\n\u2502 (sentence-bert)   \u2502   \u2502 (HNSW + SIMD)     \u2502   \u2502 (OpenAI format)   \u2502\n\u2502                   \u2502   \u2502                   \u2502   \u2502                   \u2502\n\u2502 pip install       \u2502   \u2502 cargo build       \u2502   \u2502 npm run build     \u2502\n\u2502 metatools-embed   \u2502   \u2502 --release         \u2502   \u2502                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Protocol Buffer Interface Definitions:</p> <pre><code>// api/proto/embedder.proto\nsyntax = \"proto3\";\npackage metatools.v1;\n\nservice Embedder {\n  rpc Embed(EmbedRequest) returns (EmbedResponse);\n  rpc EmbedBatch(EmbedBatchRequest) returns (EmbedBatchResponse);\n  rpc Info(InfoRequest) returns (EmbedderInfo);\n}\n\nmessage EmbedRequest {\n  string text = 1;\n}\n\nmessage EmbedResponse {\n  repeated float embedding = 1;\n}\n\nmessage EmbedderInfo {\n  string model = 1;\n  int32 dimensions = 2;\n}\n</code></pre> <pre><code>// api/proto/searcher.proto\nsyntax = \"proto3\";\npackage metatools.v1;\n\nservice Searcher {\n  rpc Search(SearchRequest) returns (SearchResponse);\n  rpc Index(IndexRequest) returns (IndexResponse);\n  rpc Delete(DeleteRequest) returns (DeleteResponse);\n}\n\nmessage SearchRequest {\n  string query = 1;\n  int32 top_k = 2;\n  map&lt;string, string&gt; filters = 3;\n}\n\nmessage SearchResult {\n  string id = 1;\n  float score = 2;\n  string content = 3;\n  map&lt;string, string&gt; metadata = 4;\n}\n</code></pre> <p>Benefits: - Language-agnostic: Generate client/server stubs for 10+ languages via <code>protoc</code> - Schema evolution: Add fields without breaking backward compatibility - High performance: Binary serialization, HTTP/2 multiplexing - Proven at scale: Used by Kubernetes, gRPC-web, many microservices</p> <p>Real-World Example (HashiCorp go-plugin): <pre><code>// Go host code (metatools)\ntype EmbedderPlugin struct {\n    plugin.Plugin\n    Impl Embedder\n}\n\nfunc (p *EmbedderPlugin) GRPCServer(broker *plugin.GRPCBroker, s *grpc.Server) error {\n    RegisterEmbedderServer(s, &amp;GRPCServer{Impl: p.Impl})\n    return nil\n}\n\nfunc (p *EmbedderPlugin) GRPCClient(ctx context.Context, broker *plugin.GRPCBroker, c *grpc.ClientConn) (interface{}, error) {\n    return &amp;GRPCClient{client: NewEmbedderClient(c)}, nil\n}\n</code></pre></p> <pre><code># Python plugin implementation\nclass PythonEmbedder(metatools_pb2_grpc.EmbedderServicer):\n    def __init__(self):\n        self.model = SentenceTransformer('all-MiniLM-L6-v2')\n\n    def Embed(self, request, context):\n        embedding = self.model.encode(request.text)\n        return metatools_pb2.EmbedResponse(embedding=embedding.tolist())\n\n    def Info(self, request, context):\n        return metatools_pb2.EmbedderInfo(\n            model='all-MiniLM-L6-v2',\n            dimensions=384\n        )\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#option-2-webassembly-component-model-emerging","title":"Option 2: WebAssembly Component Model (Emerging)","text":"<p>Sandboxed, portable, no network overhead.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            METATOOLS CORE (Go)                                   \u2502\n\u2502                                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                     WASM Runtime (wasmtime/wasmer)                       \u2502   \u2502\n\u2502   \u2502   - Load .wasm modules as plugins                                        \u2502   \u2502\n\u2502   \u2502   - WebAssembly Interface Types (WIT) for type-safe boundaries          \u2502   \u2502\n\u2502   \u2502   - WASI for system access (filesystem, network)                         \u2502   \u2502\n\u2502   \u2502   - Strong sandbox: memory isolation, capability-based security          \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502 WebAssembly Interface Types (WIT)\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                           \u2502                           \u2502\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Rust \u2192 WASM       \u2502   \u2502 Go \u2192 WASM         \u2502   \u2502 Python \u2192 WASM     \u2502\n\u2502 (vector_index.wasm\u2502   \u2502 (adapter.wasm)    \u2502   \u2502 (embedder.wasm)   \u2502\n\u2502  via wasm32-wasi) \u2502   \u2502  via TinyGo       \u2502   \u2502  via Pyodide      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>WebAssembly Interface Types (WIT) Definition:</p> <pre><code>// api/wit/embedder.wit\npackage metatools:embedder@1.0.0;\n\ninterface embedder {\n    record embed-request {\n        text: string,\n    }\n\n    record embed-response {\n        embedding: list&lt;f32&gt;,\n    }\n\n    record embedder-info {\n        model: string,\n        dimensions: u32,\n    }\n\n    embed: func(request: embed-request) -&gt; result&lt;embed-response, string&gt;;\n    info: func() -&gt; embedder-info;\n}\n\nworld embedder-plugin {\n    export embedder;\n}\n</code></pre> <p>Benefits: - Sandboxed: Strong isolation, no access beyond granted capabilities - Portable: Same .wasm binary runs on any platform - No network overhead: Direct function calls, not RPC - Multi-language: Rust, Go (TinyGo), C/C++, AssemblyScript compile to WASM</p> <p>Limitations: - Ecosystem still maturing (WASI Preview 2 released 2024) - Some languages have limited WASM support - Performance overhead for complex data marshaling</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#option-3-json-rpc-over-stdio-simple","title":"Option 3: JSON-RPC over stdio (Simple)","text":"<p>Lightweight approach for simple plugins.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            METATOOLS CORE (Go)                                   \u2502\n\u2502                                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                     JSON-RPC Dispatcher                                  \u2502   \u2502\n\u2502   \u2502   - Spawn plugin process                                                 \u2502   \u2502\n\u2502   \u2502   - Send JSON-RPC requests via stdin                                     \u2502   \u2502\n\u2502   \u2502   - Receive JSON-RPC responses via stdout                                \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502 JSON-RPC 2.0 over stdin/stdout\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                           \u2502                           \u2502\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Any executable    \u2502   \u2502 Shell script      \u2502   \u2502 Node.js script    \u2502\n\u2502 (simple wrapper)  \u2502   \u2502 (bash/zsh)        \u2502   \u2502 (quick prototype) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Benefits: - Trivial to implement: Any language that reads stdin and writes stdout - No dependencies: No gRPC libraries, no WASM runtime - Debugging friendly: Human-readable JSON messages</p> <p>Limitations: - Performance: Text serialization slower than binary - No streaming: Request-response only - Less type safety: JSON schema validation required</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#recommended-approach-by-component","title":"Recommended Approach by Component","text":"Component Recommended Rationale Embedder gRPC (Python) ML ecosystem, batch processing, GPU support VectorIndex gRPC (Rust) or WASM Performance-critical, SIMD optimization Reranker gRPC (Python) Hugging Face transformers, cross-encoders KnowledgeGraph gRPC (Python/Java) Neo4j, NetworkX, JanusGraph bindings Adapter Go native or WASM Simple logic, low latency Cache Go native Redis/memory clients well-supported in Go"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#plugin-sdk-generation","title":"Plugin SDK Generation","text":"<p>The architecture supports automatic SDK generation from Protocol Buffer definitions:</p> <pre><code># Generate SDKs for all supported languages\nmake generate-sdks\n\n# Outputs:\n# - sdk/go/       (native Go interfaces)\n# - sdk/python/   (gRPC stubs + helper classes)\n# - sdk/rust/     (gRPC stubs + traits)\n# - sdk/typescript/ (gRPC-web stubs)\n</code></pre> <p>Python SDK Example:</p> <pre><code># sdk/python/metatools/embedder.py\nfrom abc import ABC, abstractmethod\nfrom metatools.proto import embedder_pb2, embedder_pb2_grpc\n\nclass BaseEmbedder(embedder_pb2_grpc.EmbedderServicer, ABC):\n    \"\"\"Base class for implementing Embedder plugins in Python.\"\"\"\n\n    @abstractmethod\n    def embed(self, text: str) -&gt; list[float]:\n        \"\"\"Generate embedding for text.\"\"\"\n        pass\n\n    @abstractmethod\n    def dimensions(self) -&gt; int:\n        \"\"\"Return embedding dimensions.\"\"\"\n        pass\n\n    @abstractmethod\n    def model_name(self) -&gt; str:\n        \"\"\"Return model identifier.\"\"\"\n        pass\n\n    # gRPC method implementations\n    def Embed(self, request, context):\n        embedding = self.embed(request.text)\n        return embedder_pb2.EmbedResponse(embedding=embedding)\n\n    def Info(self, request, context):\n        return embedder_pb2.EmbedderInfo(\n            model=self.model_name(),\n            dimensions=self.dimensions()\n        )\n\ndef serve(embedder: BaseEmbedder, port: int = 50051):\n    \"\"\"Start the gRPC server for the embedder plugin.\"\"\"\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    embedder_pb2_grpc.add_EmbedderServicer_to_server(embedder, server)\n    server.add_insecure_port(f'[::]:{port}')\n    server.start()\n    server.wait_for_termination()\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#configuration-for-multi-language-plugins","title":"Configuration for Multi-Language Plugins","text":"<pre><code># metatools.yaml\nplugins:\n  # gRPC plugin (Python embedder)\n  embedder:\n    type: grpc\n    command: \"python -m metatools_embedder\"\n    address: \"localhost:50051\"\n    health_check_interval: 10s\n    restart_on_failure: true\n\n  # WASM plugin (Rust vector index)\n  vector_index:\n    type: wasm\n    module: \"plugins/vector_index.wasm\"\n    memory_limit: 256MB\n    capabilities:\n      - filesystem:read:/data/indices\n\n  # JSON-RPC plugin (quick prototype)\n  custom_adapter:\n    type: jsonrpc\n    command: \"node plugins/adapter.js\"\n    timeout: 5s\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#research-references","title":"Research References","text":"<p>This multi-language architecture is informed by:</p> <ol> <li>HashiCorp go-plugin: Battle-tested gRPC plugin system used by Terraform, Vault, Consul, and Packer for 10+ years</li> <li>gRPC + Protocol Buffers: Industry standard for polyglot microservices, supports 10+ languages</li> <li>WebAssembly Component Model (WCM): Emerging standard for sandboxed, portable plugin systems</li> <li>WASI Preview 2: Standardized system interfaces for WASM (filesystem, network, clocks)</li> <li>Interface Definition Languages (IDL): Contract-first development enabling language-agnostic interoperability</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#summary-roadmap-at-a-glance","title":"Summary: Roadmap at a Glance","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           METATOOLS ROADMAP 2026                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                                    \u2502\n\u2502  EXISTING (7 libs)        NEW CORE (2 libs)       CROSS-CUTTING (7 libs)          \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550      \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550       \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550          \u2502\n\u2502  \u2705 toolmodel             \ud83d\udd32 tooladapter          \ud83d\udd32 toolcache                     \u2502\n\u2502  \u2705 toolindex             \ud83d\udd32 toolset              \ud83d\udd32 toolobserve                   \u2502\n\u2502  \u2705 tooldocs                                      \ud83d\udd32 toolversion                   \u2502\n\u2502  \u2705 toolsearch            ENTERPRISE (5 libs)     \ud83d\udd32 toolresilience                \u2502\n\u2502  \u2705 toolrun               \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550     \ud83d\udd32 toolhealth                    \u2502\n\u2502  \u2705 toolcode              \ud83d\udd32 toolsemantic         \ud83d\udd32 toolaudit                     \u2502\n\u2502  \u2705 toolruntime           \ud83d\udd32 toolresource         \ud83d\udd32 toolsecrets                   \u2502\n\u2502                           \ud83d\udd32 toolgateway          \ud83d\udd32 toolflags                     \u2502\n\u2502                           \ud83d\udd32 toola2a (future)     \ud83d\udd32 toolpressure                  \u2502\n\u2502                           \ud83d\udd32 toolprompt (future)                                   \u2502\n\u2502                                                                                    \u2502\n\u2502  AGENT SKILLS (1 lib)                                                             \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                                                             \u2502\n\u2502  \ud83d\udd32 toolskill             Skill composition, workflows, A2A advertisement         \u2502\n\u2502                                                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                                                                                    \u2502\n\u2502  TIMELINE                                                                         \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                                                                        \u2502\n\u2502                                                                                    \u2502\n\u2502  Weeks 1-7   [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591] MVP Core     \u2502\n\u2502  Weeks 8-14  [\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591] Protocol     \u2502\n\u2502  Weeks 8-17  [\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591] Cross-Cut    \u2502\n\u2502  Weeks 12-17 [\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2591\u2591\u2591\u2591\u2591] Enterprise   \u2502\n\u2502  Weeks 18-21 [\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2588\u2588\u2588\u2588] Agent Skills \u2502\n\u2502                                                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                                                                                    \u2502\n\u2502  MILESTONES                                                                       \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550                                                                       \u2502\n\u2502                                                                                    \u2502\n\u2502  Week 7:  MVP Release (v0.2.0) - CLI, Config, Transport, Providers               \u2502\n\u2502  Week 14: Protocol Release (v0.3.0) - Adapters, Toolsets, Multi-Transport        \u2502\n\u2502  Week 17: Enterprise Release (v1.0.0) - Full feature set                         \u2502\n\u2502  Week 21: Agent Skills Release (v1.1.0) - Skills, Workflows, A2A                 \u2502\n\u2502                                                                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#appendix-document-cross-references","title":"Appendix: Document Cross-References","text":"Document Purpose Status pluggable-architecture.md Core architecture design Active implementation-phases.md Phase details Active component-library-analysis.md Library analysis Complete architecture-evaluation.md Championship comparison Complete protocol-agnostic-tools.md Protocol layer design Active multi-tenancy.md Multi-tenant design Active ROADMAP.md (this document) Master roadmap Active"},{"location":"library-docs-from-repos/metatools-mcp/proposals/ROADMAP/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Architecture Review: Added scope clarification table, fixed Transport interface (added Name()), updated toolskill dependencies 2026-01-28 Added Section 8: Multi-Language Extensibility - gRPC, WASM, JSON-RPC plugin architectures with SDK generation 2026-01-28 Added comprehensive D4 toolsemantic specification: hybrid search, GraphRAG, hierarchical chunking, agentic RAG, ColBERT, cross-encoder reranking 2026-01-28 Added SKILL.md Open Standard support to toolskill (Claude Code, Codex, ChatGPT compatible) 2026-01-28 Added Stream E: Agent Skills with toolskill library proposal 2026-01-28 Initial roadmap created from all proposal documents"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/","title":"Architecture Evaluation: Championship-Level Analysis","text":"<p>Status: Draft Date: 2026-01-28 Related: Pluggable Architecture Proposal, Component Library Analysis</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#executive-summary","title":"Executive Summary","text":"<p>This document evaluates the metatools ecosystem against championship-level implementations and industry best practices. The analysis reveals that your architecture is already at 85-90% of championship-level in core areas, with specific opportunities for advancement in emerging patterns.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Research Methodology</li> <li>Championship Implementations Analyzed</li> <li>Pattern Comparison Matrix</li> <li>What You Already Have (Championship Features)</li> <li>Gaps and Opportunities</li> <li>Recommended Extensions</li> <li>New Libraries to Consider</li> <li>Protocol Evolution (A2A + MCP)</li> <li>Implementation Roadmap</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#research-methodology","title":"Research Methodology","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#sources-analyzed","title":"Sources Analyzed","text":"Source Type Examples Key Insights Production Go Projects Tencent WeKnora (12.5k stars), go-kratos/blades (700 stars) Multi-tenant, agent orchestration patterns MCP Ecosystem Official Go SDK, fastmcp (22k stars), mcp-agent (8k stars) Protocol implementation patterns Industry Standards MCP Spec 2025-11-25, A2A Protocol, Google ADK Protocol interoperability Academic/Industry Research Anthropic context engineering, LangChain patterns Progressive disclosure, semantic discovery"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#key-references","title":"Key References","text":"<ul> <li>MCP Best Practices - Single-purpose servers, transport options</li> <li>Effective Context Engineering - Progressive disclosure</li> <li>A2A Protocol - Agent-to-agent communication</li> <li>Google ADK for Go - Multi-agent patterns</li> <li>Semantic Tool Discovery - Vector-based tool selection</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#championship-implementations-analyzed","title":"Championship Implementations Analyzed","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-tencent-weknora-12566-stars","title":"1. Tencent WeKnora (12,566 stars)","text":"<p>What it is: LLM-powered RAG framework with multi-tenant support</p> <p>Architecture Highlights: <pre><code>internal/\n\u251c\u2500\u2500 agent/          # Agent orchestration\n\u2502   \u2514\u2500\u2500 tools/      # Agent-specific tools\n\u251c\u2500\u2500 application/    # Business logic\n\u2502   \u251c\u2500\u2500 repository/ # Data access\n\u2502   \u2514\u2500\u2500 service/    # Service layer\n\u251c\u2500\u2500 handler/        # HTTP handlers\n\u251c\u2500\u2500 middleware/     # Cross-cutting concerns\n\u251c\u2500\u2500 models/         # LLM integrations\n\u2502   \u251c\u2500\u2500 chat/\n\u2502   \u251c\u2500\u2500 embedding/\n\u2502   \u2514\u2500\u2500 rerank/\n\u251c\u2500\u2500 runtime/        # Execution environment\n\u2514\u2500\u2500 types/\n    \u2514\u2500\u2500 interfaces/ # Contract definitions\n</code></pre></p> <p>Key Patterns: - Clean layered architecture (handler \u2192 service \u2192 repository) - Multi-tenant via middleware - Model provider abstraction (chat, embedding, rerank) - Event-driven architecture with adapters</p> <p>Comparison to metatools: | Feature | WeKnora | metatools | Gap | |---------|---------|-----------|-----| | Layered architecture | \u2705 | \u2705 | None | | Multi-tenant | \u2705 Built-in | \ud83d\udccb Proposed | Implement | | Embedding models | \u2705 | \u274c | Extension opportunity | | Reranking | \u2705 | \u274c | Extension opportunity |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-go-kratosblades-700-stars","title":"2. go-kratos/blades (700 stars)","text":"<p>What it is: Multi-agent AI framework from the Kratos team</p> <p>Architecture Highlights: <pre><code>// Tool interface - remarkably similar to toolmodel.Tool\ntype Tool interface {\n    Name() string\n    Description() string\n    InputSchema() *jsonschema.Schema\n    OutputSchema() *jsonschema.Schema\n    Handler\n}\n\n// Middleware chain - identical pattern to your proposal\ntype Handler interface {\n    Handle(context.Context, *Invocation) Generator[*Message, error]\n}\ntype Middleware func(Handler) Handler\n\nfunc ChainMiddlewares(mws ...Middleware) Middleware {\n    return func(next Handler) Handler {\n        h := next\n        for i := len(mws) - 1; i &gt;= 0; i-- {\n            h = mws[i](h)\n        }\n        return h\n    }\n}\n</code></pre></p> <p>Key Patterns: - Generic tool creation with type inference (<code>NewFunc[I, O any]</code>) - Middleware chain (confirm, conversation, retry) - Agent-as-tool pattern (agents can be tools for other agents) - Streaming via Go iterators</p> <p>Comparison to metatools: | Feature | blades | metatools | Gap | |---------|--------|-----------|-----| | Tool interface | \u2705 | \u2705 toolmodel.Tool | None | | Middleware chain | \u2705 | \ud83d\udccb Proposed | Implement | | Generic tool creation | \u2705 | \u274c | Enhancement | | Agent-as-tool | \u2705 | \u274c | Extension | | Streaming | \u2705 Iterators | \u2705 Channels | Different approach |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-official-mcp-go-sdk-modelcontextprotocolgo-sdk","title":"3. Official MCP Go SDK (modelcontextprotocol/go-sdk)","text":"<p>What it is: Reference implementation for MCP in Go</p> <p>Architecture Highlights: <pre><code>type Server struct {\n    impl    *Implementation\n    opts    ServerOptions\n    prompts *featureSet[*serverPrompt]\n    tools   *featureSet[*serverTool]\n    resources *featureSet[*serverResource]\n    sessions []*ServerSession\n    // ...\n}\n\ntype ServerOptions struct {\n    Instructions string\n    Logger *slog.Logger\n    InitializedHandler func(context.Context, *InitializedRequest)\n    PageSize int\n    KeepAlive time.Duration\n    // ...\n}\n</code></pre></p> <p>Key Patterns: - Feature sets for prompts, tools, resources - Session management - Handler-based configuration (functional options) - Built-in SSE support</p> <p>Comparison to metatools: | Feature | MCP SDK | metatools | Gap | |---------|---------|-----------|-----| | Tools registration | \u2705 | \u2705 toolindex | None | | Resources | \u2705 | \u274c | Extension | | Prompts | \u2705 | \u274c | Extension | | SSE transport | \u2705 | \ud83d\udccb Proposed | Implement | | Session management | \u2705 | \u274c | Enhancement |</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-fastmcp-22398-stars-python","title":"4. fastmcp (22,398 stars - Python)","text":"<p>What it is: Fastest way to build MCP servers</p> <p>Key Insight: Despite being Python, the architecture patterns are transferable: - Decorator-based tool registration - Context manager patterns for resources - Progressive tool loading for large toolsets</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#5-google-adk-for-go","title":"5. Google ADK for Go","text":"<p>What it is: Agent Development Kit with A2A support</p> <p>Key Features: - MCP integration out of the box - A2A protocol support for multi-agent systems - 30+ database connectors via MCP Toolbox - Built-in observability</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#pattern-comparison-matrix","title":"Pattern Comparison Matrix","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#core-architecture-patterns","title":"Core Architecture Patterns","text":"Pattern Industry Best metatools Status Priority Progressive Disclosure 3-tier (index/details/full) \u2705 tooldocs (summary/schema/full) Done Interface-Based Pluggability All components as interfaces \u2705 13 extension points Done Multi-Backend Per Tool Runtime backend selection \u2705 toolindex BackendSelector Done Middleware Chain Decorator pattern \ud83d\udccb Proposed High Security Profiles dev/standard/hardened \u2705 toolruntime Done Contract Testing Interface compliance tests \u2705 toolruntime Gateway tests Done"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#advanced-patterns","title":"Advanced Patterns","text":"Pattern Industry Best metatools Status Priority Semantic Tool Discovery Vector embeddings + BM25 \u26a0\ufe0f BM25 only (toolsearch) Medium A2A Protocol Agent-to-agent communication \u274c Not implemented Low MCP Resources File/data exposure to LLMs \u274c Not implemented Medium MCP Prompts Reusable prompt templates \u274c Not implemented Low Observability OpenTelemetry tracing \u274c Not implemented High Hot Reload Dynamic tool registration \u26a0\ufe0f Partial (UnregisterBackend) Medium"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#what-you-already-have-championship-features","title":"What You Already Have (Championship Features)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-progressive-disclosure-tooldocs","title":"1. Progressive Disclosure (tooldocs)","text":"<p>Your 3-tier documentation system matches industry best practice exactly:</p> <pre><code>// Your implementation matches Anthropic's recommendation\ntype DetailLevel string\nconst (\n    DetailLevelSummary DetailLevel = \"summary\"  // Layer 1: Metadata\n    DetailLevelSchema  DetailLevel = \"schema\"   // Layer 2: Structure\n    DetailLevelFull    DetailLevel = \"full\"     // Layer 3: Complete\n)\n</code></pre> <p>Industry validation: Anthropic's context engineering guide recommends exactly this pattern for token optimization.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-multi-backend-tool-registry-toolindex","title":"2. Multi-Backend Tool Registry (toolindex)","text":"<p>Your architecture supports what few frameworks do - multiple backends for the same tool:</p> <pre><code>// Tools can have MCP, Provider, AND Local backends simultaneously\ntype ToolBackend struct {\n    Kind     BackendKind      // mcp, provider, local\n    MCP      *MCPBackend\n    Provider *ProviderBackend\n    Local    *LocalBackend\n}\n\n// Runtime selection via pluggable BackendSelector\ntype BackendSelector func(tool Tool, backends []ToolBackend) ToolBackend\n</code></pre> <p>Industry validation: This matches Google ADK's multi-source pattern.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-10-sandbox-backends-toolruntime","title":"3. 10 Sandbox Backends (toolruntime)","text":"<p>Your runtime isolation options exceed most frameworks:</p> Backend Use Case Isolation Level unsafe Development None docker Standard production Container containerd Kubernetes environments Container kubernetes Multi-tenant production Pod + Namespace firecracker High security microVM kata Strong isolation VM gvisor Kernel isolation Sandboxed kernel wasm Portable execution Sandbox temporal Workflow orchestration Durable execution remote Distributed execution Network <p>Industry validation: No other open-source MCP framework offers this breadth.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-interface-based-extension-13-points","title":"4. Interface-Based Extension (13 Points)","text":"<p>Your 13 extension points match the Go best practice of interface-based composition:</p> # Interface Purpose 1 SchemaValidator JSON Schema validation 2 Searcher Tool search (BM25, semantic) 3 BackendSelector Multi-backend selection 4 Store Documentation storage 5 ToolResolver Tool resolution 6 Runner Execution orchestration 7 MCPExecutor MCP backend calls 8 ProviderExecutor Provider backend calls 9 LocalRegistry Local handler lookup 10 Backend Sandbox isolation 11 ToolGateway Sandboxed tool access 12 Logger Execution logging 13 Engine Code execution <p>Industry validation: Matches go-kratos/blades interface design philosophy.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#gaps-and-opportunities","title":"Gaps and Opportunities","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#high-priority","title":"High Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#1-observability-tracing-metrics","title":"1. Observability (Tracing + Metrics)","text":"<p>Gap: No built-in OpenTelemetry integration.</p> <p>Why it matters: Production deployments need distributed tracing and metrics.</p> <p>Solution: <pre><code>// New package: toolobserve\ntype Tracer interface {\n    StartSpan(ctx context.Context, name string) (context.Context, Span)\n}\n\ntype MetricsRecorder interface {\n    RecordToolCall(toolID string, duration time.Duration, err error)\n    RecordSearchLatency(query string, duration time.Duration)\n}\n\n// Integration via middleware\nfunc TracingMiddleware(tracer Tracer) toolrun.ExecutionHook {\n    return &amp;tracingHook{tracer: tracer}\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#2-mcp-gateway-auth-analytics","title":"2. MCP Gateway (Auth + Analytics)","text":"<p>Gap: No proxy layer for authentication, rate limiting, analytics.</p> <p>Why it matters: Enterprise deployments need centralized auth and monitoring.</p> <p>Reference: hyprmcp/jetski - OAuth2.1, DCR, real-time logs</p> <p>Solution: <pre><code>// New package: toolgateway\ntype Gateway struct {\n    Auth       AuthProvider\n    RateLimit  RateLimiter\n    Analytics  AnalyticsRecorder\n    Upstream   MCPServer\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#medium-priority","title":"Medium Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#3-semantic-tool-discovery","title":"3. Semantic Tool Discovery","text":"<p>Gap: Only BM25 lexical search, no vector/embedding search.</p> <p>Why it matters: With 50+ tools, semantic search dramatically improves accuracy.</p> <p>Reference: Semantic Tool Discovery</p> <p>Solution: <pre><code>// New package: toolsemantic (implements toolindex.Searcher)\ntype SemanticSearcher struct {\n    embedder   Embedder\n    vectorDB   VectorStore\n    bm25       toolsearch.BM25Searcher // Hybrid: semantic + lexical\n}\n\ntype Embedder interface {\n    Embed(ctx context.Context, text string) ([]float32, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#4-mcp-resources-support","title":"4. MCP Resources Support","text":"<p>Gap: No file/data resource exposure to LLMs.</p> <p>Why it matters: MCP Resources allow LLMs to read files, databases, APIs.</p> <p>Solution: <pre><code>// New extension to toolindex or new package: toolresource\ntype Resource struct {\n    URI         string\n    Name        string\n    Description string\n    MimeType    string\n}\n\ntype ResourceProvider interface {\n    List(ctx context.Context) ([]Resource, error)\n    Read(ctx context.Context, uri string) (io.Reader, error)\n    Subscribe(ctx context.Context, uri string) (&lt;-chan ResourceUpdate, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#low-priority-future","title":"Low Priority (Future)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#5-a2a-protocol-support","title":"5. A2A Protocol Support","text":"<p>Gap: No agent-to-agent communication.</p> <p>Why it matters: Multi-agent systems need standardized communication.</p> <p>Reference: A2A Protocol</p> <p>Solution: <pre><code>// New package: toola2a\ntype AgentCard struct {\n    Name         string\n    Description  string\n    Capabilities []Capability\n    Endpoint     string\n}\n\ntype A2AClient interface {\n    Discover(ctx context.Context, endpoint string) (*AgentCard, error)\n    Invoke(ctx context.Context, agent string, task *Task) (*TaskResult, error)\n}\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#6-mcp-prompts-support","title":"6. MCP Prompts Support","text":"<p>Gap: No reusable prompt template system.</p> <p>Why it matters: Prompts are a core MCP feature for standardized interactions.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#recommended-extensions","title":"Recommended Extensions","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#new-libraries-to-consider","title":"New Libraries to Consider","text":"<p>Based on the analysis, here are potential new libraries that could enhance the ecosystem:</p> Library Purpose Priority Effort toolobserve OpenTelemetry tracing + metrics High 2 weeks toolsemantic Vector-based semantic search Medium 3 weeks toolresource MCP Resources support Medium 2 weeks toolgateway Auth, rate limit, analytics proxy Medium 3 weeks toola2a A2A protocol support Low 4 weeks toolprompt MCP Prompts support Low 1 week"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#updated-dependency-graph","title":"Updated Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     EXPANDED METATOOLS ECOSYSTEM                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                               \u2502\n\u2502                           \u2502  metatools-mcp  \u2502                               \u2502\n\u2502                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                               \u2502\n\u2502                                    \u2502                                         \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2534\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502    \u2502                              \u2502 \u2502                              \u2502         \u2502\n\u2502    \u25bc                              \u25bc \u25bc                              \u25bc         \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502 \u2502toolgateway\u2502 NEW          \u2502 toolcode \u2502                    \u2502toolobserve\u2502 NEW\u2502\n\u2502 \u2502(auth/proxy)\u2502             \u2502          \u2502                    \u2502(tracing)  \u2502    \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502                                 \u2502                                            \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502         \u2502                       \u2502                           \u2502               \u2502\n\u2502         \u25bc                       \u25bc                           \u25bc               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  toolrun    \u2502         \u2502  tooldocs   \u2502            \u2502toolresource \u2502 NEW    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502(MCP Resources)\u2502       \u2502\n\u2502         \u2502                       \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502         \u2502    \u2502                  \u2502                        \u2502                  \u2502\n\u2502         \u25bc    \u25bc                  \u25bc                        \u25bc                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 toolruntime \u2502         \u2502  toolindex  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502toolsemantic \u2502 NEW       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502(vector search)\u2502          \u2502\n\u2502         \u2502                       \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502         \u2502                       \u2502                        \u25b2                  \u2502\n\u2502         \u2502                       \u25bc                        \u2502                  \u2502\n\u2502         \u2502                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  toolmodel  \u2502          \u2502 toolsearch  \u2502           \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502 (BM25)      \u2502           \u2502\n\u2502                                 \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502                                 \u25bc                                           \u2502\n\u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502                   \u2502 modelcontextprotocol/   \u2502                              \u2502\n\u2502                   \u2502       go-sdk            \u2502                              \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                                                              \u2502\n\u2502    Future:  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502             \u2502 toola2a  \u2502    \u2502toolprompt\u2502                                   \u2502\n\u2502             \u2502(A2A proto)\u2502   \u2502(MCP prompts)\u2502                                 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#protocol-evolution","title":"Protocol Evolution","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#mcp-a2a-complementary-protocols","title":"MCP + A2A Complementary Protocols","text":"<p>The industry is converging on two complementary protocols:</p> Protocol Purpose Direction Your Status MCP Agent-to-tool Vertical (depth) \u2705 Implemented A2A Agent-to-agent Horizontal (breadth) \u274c Future <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PROTOCOL LANDSCAPE                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                         \u2502  User   \u2502                             \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                         \u2502  Host   \u2502                             \u2502\n\u2502                         \u2502  Agent  \u2502                             \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                              \u2502                                   \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502         \u2502                    \u2502                    \u2502             \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502 Remote  \u2502\u25c4\u2500\u2500 A2A \u2500\u2500\u25b6\u2502 Remote \u2502\u25c4\u2500\u2500 A2A \u2500\u2500\u25b6\u2502 Remote \u2502       \u2502\n\u2502    \u2502 Agent 1 \u2502           \u2502 Agent 2\u2502           \u2502 Agent 3\u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518       \u2502\n\u2502         \u2502                     \u2502                    \u2502            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2510       \u2502\n\u2502    \u2502  MCP    \u2502           \u2502  MCP   \u2502           \u2502  MCP   \u2502       \u2502\n\u2502    \u2502 Server  \u2502           \u2502 Server \u2502           \u2502 Server \u2502       \u2502\n\u2502    \u2502 (tools) \u2502           \u2502 (tools)\u2502           \u2502 (tools)\u2502       \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                                  \u2502\n\u2502    Legend: A2A = Agent-to-Agent (horizontal)                    \u2502\n\u2502            MCP = Agent-to-Tool (vertical)                       \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#scaling-recommendation-from-anthropic-nov-2025","title":"Scaling Recommendation (from Anthropic Nov 2025)","text":"<p>For 50+ tools, present MCP servers as code APIs instead of direct tool calls:</p> <p>\"This pattern becomes essential when scaling to many tools. You're essentially giving agents a programming environment rather than a function-calling interface.\"</p> <p>Your <code>toolcode</code> package already enables this pattern!</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#updated-timeline-with-extensions","title":"Updated Timeline with Extensions","text":"Phase Focus Duration Libraries Phase 1 CLI + Config 2 weeks metatools-mcp Phase 2 Transport + Observability 2 weeks metatools-mcp, toolobserve (new) Phase 3 Public APIs 1 week All existing Phase 4 Backend Integration 2 weeks toolruntime Phase 5 Semantic Search 2 weeks toolsemantic (new) Phase 6 MCP Resources 2 weeks toolresource (new) Phase 7 Gateway/Proxy 2 weeks toolgateway (new) Total 13 weeks 4 new libraries"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#mvp-phases-1-4-7-weeks","title":"MVP (Phases 1-4): 7 weeks","text":"<p>Core pluggable architecture with observability.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#extended-phases-5-7-6-weeks","title":"Extended (Phases 5-7): +6 weeks","text":"<p>Advanced features for enterprise/production deployments.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#summary-your-position","title":"Summary: Your Position","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#championship-scorecard","title":"Championship Scorecard","text":"Category Score Notes Core Architecture 95% Excellent layering, interfaces, patterns Pluggability 90% 13 extension points, multi-backend Security 95% 10 isolation backends, 3 security profiles Documentation 85% Progressive disclosure implemented Observability 40% Gap - needs OpenTelemetry Semantic Search 60% BM25 good, vectors needed Protocol Coverage 70% MCP tools, missing resources/prompts Overall 85% Championship-adjacent"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#key-takeaway","title":"Key Takeaway","text":"<p>Your architecture is not a framework to be built\u2014it's a mature ecosystem to be exposed and extended. The 7 tool* libraries represent years of thoughtful design that matches or exceeds most open-source alternatives.</p> <p>The path to championship level requires: 1. Exposure (CLI + config) - 2 weeks 2. Observability (toolobserve) - 2 weeks 3. Semantic search (toolsemantic) - 2 weeks 4. MCP completeness (toolresource) - 2 weeks</p> <p>Total to championship: ~8 weeks of focused work.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/architecture-evaluation/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial comprehensive architecture evaluation 2026-01-28 Analyzed 5 championship-level implementations 2026-01-28 Identified 4 new potential libraries 2026-01-28 Created extended implementation roadmap"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/","title":"Pluggable Authentication &amp; Authorization Middleware","text":"<p>Status: Draft Date: 2026-01-30 Related: Multi-Tenancy Proposal, Pluggable Architecture</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#overview","title":"Overview","text":"<p>This document defines a 100% pluggable authentication and authorization middleware for the metatools ecosystem. The design supports multiple auth providers (JWT, OAuth2, API Keys, mTLS), integrates with RBAC/ABAC systems (Casbin, OPA), and provides the foundation for multi-tenancy.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#design-principles","title":"Design Principles","text":"<ol> <li>Interface-First - All components defined as interfaces, implementations are swappable</li> <li>Zero Coupling - Auth middleware knows nothing about specific providers</li> <li>Context Propagation - Identity flows through context.Context</li> <li>Fail-Safe Defaults - Deny by default, explicit allow required</li> <li>Composable - Multiple authenticators/authorizers can chain together</li> <li>Observable - Full audit trail of auth decisions</li> <li>Multi-Tenancy Ready - Identity includes tenant context</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         AUTH MIDDLEWARE ARCHITECTURE                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Request \u2192 [Transport Layer]                                                 \u2502\n\u2502                    \u2502                                                          \u2502\n\u2502                    \u25bc                                                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    AUTHENTICATION MIDDLEWARE                         \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502              CompositeAuthenticator                           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   (tries each authenticator until one succeeds)               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                                \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502   JWT   \u2502\u2192\u2502 OAuth2  \u2502\u2192\u2502 API Key \u2502\u2192\u2502  mTLS   \u2502            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502  Auth   \u2502 \u2502  Auth   \u2502 \u2502  Auth   \u2502 \u2502  Auth   \u2502            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                                \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Output: Identity (principal, tenant, claims, method)        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                    \u2502                                                          \u2502\n\u2502                    \u25bc Identity in context.Context                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    AUTHORIZATION MIDDLEWARE                          \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502              Authorizer (pluggable policy engine)             \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                                \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502 Casbin  \u2502 \u2502   OPA   \u2502 \u2502  RBAC   \u2502 \u2502 Custom  \u2502            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502Enforcer \u2502 \u2502 Rego    \u2502 \u2502 Simple  \u2502 \u2502 Policy  \u2502            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                                \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Input: (subject, resource, action) \u2192 Output: allow/deny     \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                    \u2502                                                          \u2502\n\u2502                    \u25bc Authorized request                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TOOL PROVIDER (execution)                         \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#core-interfaces","title":"Core Interfaces","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#identity-model","title":"Identity Model","text":"<pre><code>// Identity represents an authenticated principal\ntype Identity struct {\n    // Principal is the unique identifier (user ID, service account, etc.)\n    Principal   string            `json:\"principal\"`\n\n    // TenantID for multi-tenant systems (empty for single-tenant)\n    TenantID    string            `json:\"tenant_id,omitempty\"`\n\n    // Roles assigned to this identity\n    Roles       []string          `json:\"roles,omitempty\"`\n\n    // Permissions granted (for PBAC systems)\n    Permissions []string          `json:\"permissions,omitempty\"`\n\n    // Claims from the auth token (JWT claims, OAuth2 scopes, etc.)\n    Claims      map[string]any    `json:\"claims,omitempty\"`\n\n    // Method used for authentication\n    Method      AuthMethod        `json:\"method\"`\n\n    // Metadata for extensibility\n    Metadata    map[string]string `json:\"metadata,omitempty\"`\n\n    // ExpiresAt when the identity/session expires\n    ExpiresAt   time.Time         `json:\"expires_at,omitempty\"`\n\n    // IssuedAt when the identity was established\n    IssuedAt    time.Time         `json:\"issued_at\"`\n}\n\n// AuthMethod identifies how the identity was authenticated\ntype AuthMethod string\n\nconst (\n    AuthMethodJWT       AuthMethod = \"jwt\"\n    AuthMethodOAuth2    AuthMethod = \"oauth2\"\n    AuthMethodAPIKey    AuthMethod = \"api_key\"\n    AuthMethodMTLS      AuthMethod = \"mtls\"\n    AuthMethodBasic     AuthMethod = \"basic\"\n    AuthMethodAnonymous AuthMethod = \"anonymous\"\n    AuthMethodCustom    AuthMethod = \"custom\"\n)\n\n// AuthResult encapsulates authentication outcome\ntype AuthResult struct {\n    // Authenticated indicates if authentication succeeded\n    Authenticated bool\n\n    // Identity is set when Authenticated is true\n    Identity *Identity\n\n    // Error describes why authentication failed (if applicable)\n    Error error\n\n    // Challenge is the WWW-Authenticate header value for 401 responses\n    Challenge string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#authenticator-interface","title":"Authenticator Interface","text":"<pre><code>// Authenticator validates credentials and returns an identity\n// This is the core pluggable interface for authentication\ntype Authenticator interface {\n    // Authenticate validates the request and returns an identity\n    // Returns AuthResult with Authenticated=false if credentials are invalid\n    // Returns error only for system failures (not auth failures)\n    Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error)\n\n    // Name returns the authenticator name for logging/metrics\n    Name() string\n\n    // Supports checks if this authenticator handles the given request\n    // Used by CompositeAuthenticator to select appropriate authenticator\n    Supports(ctx context.Context, req *AuthRequest) bool\n}\n\n// AuthRequest contains request data for authentication\ntype AuthRequest struct {\n    // Headers from the incoming request\n    Headers map[string][]string\n\n    // Method is the request method (tools/call, tools/list, etc.)\n    Method string\n\n    // Resource is the target resource (tool name, etc.)\n    Resource string\n\n    // RemoteAddr is the client IP address\n    RemoteAddr string\n\n    // TLSInfo contains mTLS certificate info (if available)\n    TLSInfo *TLSInfo\n\n    // Raw allows access to transport-specific request data\n    Raw any\n}\n\n// TLSInfo contains client certificate information for mTLS\ntype TLSInfo struct {\n    // PeerCertificates from the TLS connection\n    PeerCertificates []*x509.Certificate\n\n    // Verified indicates if the certificate chain was verified\n    Verified bool\n\n    // CommonName from the client certificate\n    CommonName string\n\n    // DNSNames from the client certificate\n    DNSNames []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#authorizer-interface","title":"Authorizer Interface","text":"<pre><code>// Authorizer makes access control decisions\n// Implementations can use RBAC, ABAC, ReBAC, or custom logic\ntype Authorizer interface {\n    // Authorize checks if the identity can perform action on resource\n    // Returns nil if authorized, error describing denial otherwise\n    Authorize(ctx context.Context, req *AuthzRequest) error\n\n    // Name returns the authorizer name for logging/metrics\n    Name() string\n}\n\n// AuthzRequest contains the authorization request parameters\ntype AuthzRequest struct {\n    // Subject is the identity requesting access\n    Subject *Identity\n\n    // Resource is what's being accessed (tool name, backend, etc.)\n    Resource string\n\n    // Action is what's being done (call, list, describe, etc.)\n    Action string\n\n    // ResourceType categorizes the resource (tool, backend, config, etc.)\n    ResourceType string\n\n    // Context provides additional attributes for ABAC\n    Context map[string]any\n}\n\n// AuthzResult provides detailed authorization outcome\ntype AuthzResult struct {\n    Allowed bool\n    Reason  string\n    Policy  string // Which policy made the decision\n}\n\n// Common authorization errors\nvar (\n    ErrUnauthorized     = errors.New(\"unauthorized\")\n    ErrForbidden        = errors.New(\"forbidden\")\n    ErrInsufficientRole = errors.New(\"insufficient role\")\n    ErrInvalidToken     = errors.New(\"invalid token\")\n    ErrTokenExpired     = errors.New(\"token expired\")\n    ErrMissingClaims    = errors.New(\"missing required claims\")\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#built-in-authenticators","title":"Built-in Authenticators","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#jwt-authenticator","title":"JWT Authenticator","text":"<pre><code>// JWTAuthenticator validates JWT tokens\ntype JWTAuthenticator struct {\n    // Config holds JWT validation settings\n    Config JWTConfig\n\n    // KeyProvider fetches signing keys (supports JWKS, static, etc.)\n    KeyProvider KeyProvider\n\n    // ClaimsMapper extracts identity from JWT claims\n    ClaimsMapper ClaimsMapper\n}\n\n// JWTConfig configures JWT validation\ntype JWTConfig struct {\n    // Issuer expected in the token (validates iss claim)\n    Issuer string `yaml:\"issuer\"`\n\n    // Audience expected in the token (validates aud claim)\n    Audience string `yaml:\"audience\"`\n\n    // HeaderName where to find the token (default: Authorization)\n    HeaderName string `yaml:\"header_name\"`\n\n    // TokenPrefix expected before the token (default: Bearer)\n    TokenPrefix string `yaml:\"token_prefix\"`\n\n    // ClockSkew tolerance for expiration validation\n    ClockSkew time.Duration `yaml:\"clock_skew\"`\n\n    // RequiredClaims that must be present\n    RequiredClaims []string `yaml:\"required_claims\"`\n\n    // PrincipalClaim identifies the subject (default: sub)\n    PrincipalClaim string `yaml:\"principal_claim\"`\n\n    // TenantClaim identifies the tenant (optional)\n    TenantClaim string `yaml:\"tenant_claim\"`\n\n    // RolesClaim identifies roles (optional)\n    RolesClaim string `yaml:\"roles_claim\"`\n\n    // PermissionsClaim identifies permissions (optional)\n    PermissionsClaim string `yaml:\"permissions_claim\"`\n}\n\n// KeyProvider fetches signing keys for JWT validation\ntype KeyProvider interface {\n    // GetKey returns the key for the given key ID\n    GetKey(ctx context.Context, keyID string) (any, error)\n\n    // GetKeys returns all available keys\n    GetKeys(ctx context.Context) ([]any, error)\n}\n\n// Built-in KeyProvider implementations\ntype StaticKeyProvider struct { ... }  // Single static key\ntype JWKSKeyProvider struct { ... }    // JWKS endpoint with caching\ntype FileKeyProvider struct { ... }    // Keys from filesystem\n\n// ClaimsMapper extracts Identity from JWT claims\ntype ClaimsMapper interface {\n    MapClaims(claims jwt.MapClaims) (*Identity, error)\n}\n\n// DefaultClaimsMapper uses JWTConfig to map claims\ntype DefaultClaimsMapper struct {\n    Config JWTConfig\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#api-key-authenticator","title":"API Key Authenticator","text":"<pre><code>// APIKeyAuthenticator validates API keys\ntype APIKeyAuthenticator struct {\n    Config   APIKeyConfig\n    Store    APIKeyStore\n}\n\n// APIKeyConfig configures API key validation\ntype APIKeyConfig struct {\n    // HeaderName where to find the key (default: X-API-Key)\n    HeaderName string `yaml:\"header_name\"`\n\n    // QueryParam alternative location (optional)\n    QueryParam string `yaml:\"query_param\"`\n\n    // Prefix expected before the key (optional, e.g., \"Bearer \")\n    Prefix string `yaml:\"prefix\"`\n\n    // HashAlgorithm for stored keys (none, sha256, bcrypt)\n    HashAlgorithm string `yaml:\"hash_algorithm\"`\n}\n\n// APIKeyStore retrieves API key information\ntype APIKeyStore interface {\n    // Lookup returns the identity for an API key\n    // Returns nil, nil if key not found (not an error)\n    Lookup(ctx context.Context, key string) (*APIKeyInfo, error)\n\n    // Validate checks if a key is valid without full lookup\n    Validate(ctx context.Context, key string) (bool, error)\n}\n\n// APIKeyInfo contains API key metadata\ntype APIKeyInfo struct {\n    ID          string            // Key identifier\n    Name        string            // Human-readable name\n    Principal   string            // Owner identity\n    TenantID    string            // Associated tenant\n    Roles       []string          // Assigned roles\n    Permissions []string          // Direct permissions\n    Scopes      []string          // OAuth-style scopes\n    Metadata    map[string]string // Custom metadata\n    CreatedAt   time.Time\n    ExpiresAt   *time.Time        // nil = never expires\n    LastUsedAt  *time.Time\n}\n\n// Built-in APIKeyStore implementations\ntype MemoryAPIKeyStore struct { ... }     // For testing\ntype RedisAPIKeyStore struct { ... }      // For distributed deployments\ntype PostgresAPIKeyStore struct { ... }   // For persistent storage\ntype ConfigFileAPIKeyStore struct { ... } // For static configuration\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#oauth2-authenticator","title":"OAuth2 Authenticator","text":"<pre><code>// OAuth2Authenticator validates OAuth2 access tokens\ntype OAuth2Authenticator struct {\n    Config       OAuth2Config\n    TokenStore   TokenStore       // For opaque tokens\n    Introspector TokenIntrospector // For introspection\n}\n\n// OAuth2Config configures OAuth2 validation\ntype OAuth2Config struct {\n    // Issuer URL of the OAuth2 authorization server\n    Issuer string `yaml:\"issuer\"`\n\n    // IntrospectionURL for opaque token validation\n    IntrospectionURL string `yaml:\"introspection_url\"`\n\n    // ClientID for introspection authentication\n    ClientID string `yaml:\"client_id\"`\n\n    // ClientSecret for introspection authentication\n    ClientSecret string `yaml:\"client_secret\"`\n\n    // RequiredScopes that must be present\n    RequiredScopes []string `yaml:\"required_scopes\"`\n\n    // ScopesClaim where scopes are found in JWT tokens\n    ScopesClaim string `yaml:\"scopes_claim\"`\n}\n\n// TokenIntrospector validates tokens via introspection endpoint\ntype TokenIntrospector interface {\n    Introspect(ctx context.Context, token string) (*IntrospectionResult, error)\n}\n\n// IntrospectionResult from RFC 7662\ntype IntrospectionResult struct {\n    Active    bool\n    Scope     string\n    ClientID  string\n    Username  string\n    TokenType string\n    Exp       int64\n    Iat       int64\n    Nbf       int64\n    Sub       string\n    Aud       string\n    Iss       string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#mtls-authenticator","title":"mTLS Authenticator","text":"<pre><code>// MTLSAuthenticator validates client certificates\ntype MTLSAuthenticator struct {\n    Config      MTLSConfig\n    CertMapper  CertificateMapper\n}\n\n// MTLSConfig configures mTLS validation\ntype MTLSConfig struct {\n    // RequireClientCert enforces client certificate requirement\n    RequireClientCert bool `yaml:\"require_client_cert\"`\n\n    // TrustAnchors are CA certificates to trust\n    TrustAnchors string `yaml:\"trust_anchors\"` // Path to CA bundle\n\n    // AllowedCNs restricts accepted Common Names (optional)\n    AllowedCNs []string `yaml:\"allowed_cns\"`\n\n    // AllowedDNSNames restricts accepted DNS SANs (optional)\n    AllowedDNSNames []string `yaml:\"allowed_dns_names\"`\n\n    // AllowedOUs restricts accepted Organizational Units (optional)\n    AllowedOUs []string `yaml:\"allowed_ous\"`\n\n    // CRLFile for certificate revocation checking (optional)\n    CRLFile string `yaml:\"crl_file\"`\n\n    // OCSPResponder URL for online revocation checking (optional)\n    OCSPResponder string `yaml:\"ocsp_responder\"`\n}\n\n// CertificateMapper extracts identity from client certificate\ntype CertificateMapper interface {\n    MapCertificate(cert *x509.Certificate) (*Identity, error)\n}\n\n// DefaultCertMapper uses CN as principal, OU as tenant\ntype DefaultCertMapper struct { ... }\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#composite-authenticator","title":"Composite Authenticator","text":"<pre><code>// CompositeAuthenticator tries multiple authenticators in order\ntype CompositeAuthenticator struct {\n    Authenticators []Authenticator\n\n    // RequireAll requires all authenticators to succeed (MFA)\n    RequireAll bool\n\n    // StopOnFirst stops after first successful auth\n    StopOnFirst bool\n}\n\nfunc (c *CompositeAuthenticator) Authenticate(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n    var lastResult *AuthResult\n    var lastError error\n\n    for _, auth := range c.Authenticators {\n        // Skip authenticators that don't support this request\n        if !auth.Supports(ctx, req) {\n            continue\n        }\n\n        result, err := auth.Authenticate(ctx, req)\n        if err != nil {\n            lastError = err\n            continue\n        }\n\n        if result.Authenticated {\n            if c.StopOnFirst {\n                return result, nil\n            }\n            // For RequireAll, continue checking others\n            lastResult = result\n        } else {\n            if c.RequireAll {\n                return result, nil // Any failure = overall failure\n            }\n            lastResult = result\n        }\n    }\n\n    if lastResult != nil &amp;&amp; lastResult.Authenticated {\n        return lastResult, nil\n    }\n\n    if lastResult != nil {\n        return lastResult, nil\n    }\n\n    return &amp;AuthResult{\n        Authenticated: false,\n        Challenge:     \"Bearer\",\n        Error:         errors.Join(ErrUnauthorized, lastError),\n    }, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#built-in-authorizers","title":"Built-in Authorizers","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#casbin-authorizer","title":"Casbin Authorizer","text":"<pre><code>// CasbinAuthorizer uses Casbin for RBAC/ABAC/ReBAC\ntype CasbinAuthorizer struct {\n    Enforcer *casbin.Enforcer\n    Config   CasbinConfig\n}\n\n// CasbinConfig configures the Casbin enforcer\ntype CasbinConfig struct {\n    // ModelPath is the path to the Casbin model file\n    ModelPath string `yaml:\"model_path\"`\n\n    // PolicyPath is the path to the policy file (for file adapter)\n    PolicyPath string `yaml:\"policy_path\"`\n\n    // Adapter configures policy storage\n    Adapter CasbinAdapterConfig `yaml:\"adapter\"`\n\n    // AutoLoad enables automatic policy reloading\n    AutoLoad bool `yaml:\"auto_load\"`\n\n    // AutoLoadInterval for policy refresh\n    AutoLoadInterval time.Duration `yaml:\"auto_load_interval\"`\n}\n\n// CasbinAdapterConfig configures policy storage\ntype CasbinAdapterConfig struct {\n    Type   string         `yaml:\"type\"` // file, postgres, mysql, redis\n    Config map[string]any `yaml:\"config\"`\n}\n\nfunc (a *CasbinAuthorizer) Authorize(ctx context.Context, req *AuthzRequest) error {\n    // Map to Casbin's (sub, obj, act) model\n    sub := req.Subject.Principal\n    obj := req.Resource\n    act := req.Action\n\n    // For multi-tenant, use domain\n    var ok bool\n    var err error\n\n    if req.Subject.TenantID != \"\" {\n        // RBAC with domains\n        ok, err = a.Enforcer.Enforce(sub, req.Subject.TenantID, obj, act)\n    } else {\n        ok, err = a.Enforcer.Enforce(sub, obj, act)\n    }\n\n    if err != nil {\n        return fmt.Errorf(\"casbin enforce: %w\", err)\n    }\n\n    if !ok {\n        return &amp;AuthzError{\n            Subject:  sub,\n            Resource: obj,\n            Action:   act,\n            Reason:   \"policy denied\",\n        }\n    }\n\n    return nil\n}\n\n// Example Casbin model for metatools (RBAC with domains)\n// model.conf:\n// [request_definition]\n// r = sub, dom, obj, act\n//\n// [policy_definition]\n// p = sub, dom, obj, act\n//\n// [role_definition]\n// g = _, _, _\n//\n// [policy_effect]\n// e = some(where (p.eft == allow))\n//\n// [matchers]\n// m = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#opa-authorizer","title":"OPA Authorizer","text":"<pre><code>// OPAAuthorizer uses Open Policy Agent for authorization\ntype OPAAuthorizer struct {\n    Config OPAConfig\n    Client *opa.Rego\n}\n\n// OPAConfig configures OPA\ntype OPAConfig struct {\n    // PolicyPath is the path to Rego policy files\n    PolicyPath string `yaml:\"policy_path\"`\n\n    // BundleURL for fetching policy bundles\n    BundleURL string `yaml:\"bundle_url\"`\n\n    // Query is the Rego query to evaluate\n    Query string `yaml:\"query\"`\n\n    // DecisionPath in the policy output\n    DecisionPath string `yaml:\"decision_path\"`\n}\n\nfunc (a *OPAAuthorizer) Authorize(ctx context.Context, req *AuthzRequest) error {\n    input := map[string]any{\n        \"subject\": map[string]any{\n            \"principal\":   req.Subject.Principal,\n            \"tenant_id\":   req.Subject.TenantID,\n            \"roles\":       req.Subject.Roles,\n            \"permissions\": req.Subject.Permissions,\n        },\n        \"resource\":      req.Resource,\n        \"action\":        req.Action,\n        \"resource_type\": req.ResourceType,\n        \"context\":       req.Context,\n    }\n\n    results, err := a.Client.Eval(ctx, rego.EvalInput(input))\n    if err != nil {\n        return fmt.Errorf(\"opa eval: %w\", err)\n    }\n\n    if len(results) == 0 || !results[0].Expressions[0].Value.(bool) {\n        return &amp;AuthzError{\n            Subject:  req.Subject.Principal,\n            Resource: req.Resource,\n            Action:   req.Action,\n            Reason:   \"opa policy denied\",\n        }\n    }\n\n    return nil\n}\n\n// Example OPA policy for metatools:\n// package metatools.authz\n//\n// default allow = false\n//\n// allow {\n//     input.subject.roles[_] == \"admin\"\n// }\n//\n// allow {\n//     input.action == \"tools/list\"\n// }\n//\n// allow {\n//     input.action == \"tools/call\"\n//     input.resource == input.subject.permissions[_]\n// }\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#simple-rbac-authorizer","title":"Simple RBAC Authorizer","text":"<pre><code>// SimpleRBACAuthorizer provides basic RBAC without external dependencies\ntype SimpleRBACAuthorizer struct {\n    Config SimpleRBACConfig\n}\n\n// SimpleRBACConfig defines roles and permissions\ntype SimpleRBACConfig struct {\n    // Roles maps role names to permissions\n    Roles map[string]RoleConfig `yaml:\"roles\"`\n\n    // DefaultRole for unauthenticated or unassigned users\n    DefaultRole string `yaml:\"default_role\"`\n}\n\n// RoleConfig defines a role's permissions\ntype RoleConfig struct {\n    // Permissions granted to this role\n    Permissions []string `yaml:\"permissions\"`\n\n    // Inherits from other roles\n    Inherits []string `yaml:\"inherits\"`\n\n    // AllowedTools (tool name patterns)\n    AllowedTools []string `yaml:\"allowed_tools\"`\n\n    // DeniedTools (takes precedence)\n    DeniedTools []string `yaml:\"denied_tools\"`\n\n    // AllowedActions (call, list, describe, etc.)\n    AllowedActions []string `yaml:\"allowed_actions\"`\n}\n\nfunc (a *SimpleRBACAuthorizer) Authorize(ctx context.Context, req *AuthzRequest) error {\n    permissions := a.resolvePermissions(req.Subject)\n\n    // Build permission key\n    permKey := fmt.Sprintf(\"%s:%s\", req.ResourceType, req.Action)\n    toolKey := fmt.Sprintf(\"tool:%s\", req.Resource)\n\n    // Check explicit permission\n    if slices.Contains(permissions, permKey) || slices.Contains(permissions, \"*\") {\n        return nil\n    }\n\n    // Check tool-specific permission\n    if slices.Contains(permissions, toolKey) {\n        return nil\n    }\n\n    return &amp;AuthzError{\n        Subject:  req.Subject.Principal,\n        Resource: req.Resource,\n        Action:   req.Action,\n        Reason:   \"insufficient permissions\",\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#middleware-integration","title":"Middleware Integration","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#authentication-middleware","title":"Authentication Middleware","text":"<pre><code>// AuthMiddleware wraps a ToolProvider with authentication\nfunc AuthMiddleware(auth Authenticator, opts ...AuthMiddlewareOption) Middleware {\n    cfg := defaultAuthMiddlewareConfig()\n    for _, opt := range opts {\n        opt(&amp;cfg)\n    }\n\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;authMiddleware{\n            auth:   auth,\n            next:   next,\n            config: cfg,\n        }\n    }\n}\n\ntype authMiddleware struct {\n    auth   Authenticator\n    next   provider.ToolProvider\n    config authMiddlewareConfig\n}\n\ntype authMiddlewareConfig struct {\n    // AllowAnonymous allows requests without credentials\n    AllowAnonymous bool\n\n    // AnonymousIdentity used when AllowAnonymous is true\n    AnonymousIdentity *Identity\n\n    // SkipPaths that don't require authentication\n    SkipPaths []string\n\n    // OnAuthFailure callback for custom error handling\n    OnAuthFailure func(ctx context.Context, err error) error\n}\n\nfunc (m *authMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    // Build auth request from context\n    req := buildAuthRequest(ctx)\n\n    // Authenticate\n    result, err := m.auth.Authenticate(ctx, req)\n    if err != nil {\n        return nil, fmt.Errorf(\"authentication error: %w\", err)\n    }\n\n    if !result.Authenticated {\n        if m.config.AllowAnonymous {\n            ctx = WithIdentity(ctx, m.config.AnonymousIdentity)\n        } else {\n            if m.config.OnAuthFailure != nil {\n                return nil, m.config.OnAuthFailure(ctx, result.Error)\n            }\n            return nil, &amp;AuthError{\n                Code:      \"UNAUTHENTICATED\",\n                Message:   \"authentication required\",\n                Challenge: result.Challenge,\n            }\n        }\n    } else {\n        ctx = WithIdentity(ctx, result.Identity)\n    }\n\n    return m.next.Handle(ctx, input)\n}\n\n// Context helpers\nfunc WithIdentity(ctx context.Context, id *Identity) context.Context {\n    return context.WithValue(ctx, identityKey{}, id)\n}\n\nfunc IdentityFromContext(ctx context.Context) *Identity {\n    if v := ctx.Value(identityKey{}); v != nil {\n        return v.(*Identity)\n    }\n    return nil\n}\n\nfunc PrincipalFromContext(ctx context.Context) string {\n    if id := IdentityFromContext(ctx); id != nil {\n        return id.Principal\n    }\n    return \"\"\n}\n\nfunc TenantIDFromContext(ctx context.Context) string {\n    if id := IdentityFromContext(ctx); id != nil {\n        return id.TenantID\n    }\n    return \"\"\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#authorization-middleware","title":"Authorization Middleware","text":"<pre><code>// AuthzMiddleware wraps a ToolProvider with authorization\nfunc AuthzMiddleware(authz Authorizer, opts ...AuthzMiddlewareOption) Middleware {\n    cfg := defaultAuthzMiddlewareConfig()\n    for _, opt := range opts {\n        opt(&amp;cfg)\n    }\n\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;authzMiddleware{\n            authz:  authz,\n            next:   next,\n            config: cfg,\n        }\n    }\n}\n\ntype authzMiddleware struct {\n    authz  Authorizer\n    next   provider.ToolProvider\n    config authzMiddlewareConfig\n}\n\ntype authzMiddlewareConfig struct {\n    // ResourceResolver extracts resource from the request\n    ResourceResolver func(ctx context.Context, input map[string]any) string\n\n    // ActionResolver extracts action from the request\n    ActionResolver func(ctx context.Context, input map[string]any) string\n\n    // ContextBuilder adds context for ABAC decisions\n    ContextBuilder func(ctx context.Context, input map[string]any) map[string]any\n\n    // OnDenied callback for custom denial handling\n    OnDenied func(ctx context.Context, err error) error\n}\n\nfunc (m *authzMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    identity := IdentityFromContext(ctx)\n    if identity == nil {\n        return nil, &amp;AuthError{Code: \"UNAUTHENTICATED\", Message: \"no identity in context\"}\n    }\n\n    req := &amp;AuthzRequest{\n        Subject:      identity,\n        Resource:     m.config.ResourceResolver(ctx, input),\n        Action:       m.config.ActionResolver(ctx, input),\n        ResourceType: \"tool\",\n        Context:      m.config.ContextBuilder(ctx, input),\n    }\n\n    if err := m.authz.Authorize(ctx, req); err != nil {\n        if m.config.OnDenied != nil {\n            return nil, m.config.OnDenied(ctx, err)\n        }\n        return nil, &amp;AuthError{\n            Code:    \"FORBIDDEN\",\n            Message: err.Error(),\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n\nfunc (m *authzMiddleware) Name() string { return m.next.Name() }\nfunc (m *authzMiddleware) Description() string { return m.next.Description() }\nfunc (m *authzMiddleware) InputSchema() map[string]any { return m.next.InputSchema() }\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#factory-registration","title":"Factory Registration","text":"<pre><code>// Register auth middleware factories\nfunc init() {\n    // Authentication middleware\n    middleware.DefaultRegistry.Register(\"auth\", func(cfg map[string]any) (middleware.Middleware, error) {\n        authCfg, err := parseAuthConfig(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        auth, err := buildAuthenticator(authCfg)\n        if err != nil {\n            return nil, err\n        }\n\n        return AuthMiddleware(auth), nil\n    })\n\n    // Authorization middleware\n    middleware.DefaultRegistry.Register(\"authz\", func(cfg map[string]any) (middleware.Middleware, error) {\n        authzCfg, err := parseAuthzConfig(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        authz, err := buildAuthorizer(authzCfg)\n        if err != nil {\n            return nil, err\n        }\n\n        return AuthzMiddleware(authz), nil\n    })\n\n    // Combined auth+authz middleware\n    middleware.DefaultRegistry.Register(\"secure\", func(cfg map[string]any) (middleware.Middleware, error) {\n        auth, err := buildAuthenticator(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        authz, err := buildAuthorizer(cfg)\n        if err != nil {\n            return nil, err\n        }\n\n        return func(next provider.ToolProvider) provider.ToolProvider {\n            return AuthMiddleware(auth)(AuthzMiddleware(authz)(next))\n        }, nil\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#configuration","title":"Configuration","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#yaml-configuration","title":"YAML Configuration","text":"<pre><code># metatools.yaml - Authentication &amp; Authorization\n\nauth:\n  # Authentication configuration\n  authentication:\n    # Type: jwt, oauth2, api_key, mtls, composite\n    type: composite\n\n    # Composite authenticator configuration\n    composite:\n      stop_on_first: true\n      authenticators:\n        # JWT authentication (primary)\n        - type: jwt\n          issuer: https://auth.example.com\n          audience: metatools-api\n          jwks_url: https://auth.example.com/.well-known/jwks.json\n          principal_claim: sub\n          tenant_claim: org_id\n          roles_claim: roles\n          clock_skew: 5m\n\n        # API Key authentication (secondary)\n        - type: api_key\n          header_name: X-API-Key\n          store:\n            type: redis\n            config:\n              address: localhost:6379\n              prefix: \"apikey:\"\n\n        # mTLS (for service-to-service)\n        - type: mtls\n          require_client_cert: false  # Optional\n          trust_anchors: /etc/ssl/ca-bundle.crt\n          allowed_cns:\n            - \"*.internal.example.com\"\n\n  # Authorization configuration\n  authorization:\n    # Type: casbin, opa, simple_rbac, custom\n    type: casbin\n\n    casbin:\n      model_path: /etc/metatools/rbac_model.conf\n      adapter:\n        type: postgres\n        config:\n          connection_string: ${DATABASE_URL}\n      auto_load: true\n      auto_load_interval: 30s\n\n    # Alternative: Simple RBAC (no external dependencies)\n    # simple_rbac:\n    #   default_role: anonymous\n    #   roles:\n    #     admin:\n    #       permissions: [\"*\"]\n    #     user:\n    #       allowed_actions: [call, list, describe]\n    #       allowed_tools: [\"search_*\", \"describe_*\"]\n    #       denied_tools: [\"execute_code\"]\n    #     anonymous:\n    #       allowed_actions: [list]\n\n    # Alternative: OPA\n    # opa:\n    #   policy_path: /etc/metatools/policies\n    #   query: data.metatools.authz.allow\n\n  # Middleware options\n  middleware:\n    allow_anonymous: false\n    skip_paths:\n      - health\n      - version\n\n# Middleware chain includes auth\nmiddleware:\n  chain:\n    - auth         # Authentication (resolves identity)\n    - tenant       # Tenant resolution (from identity)\n    - authz        # Authorization (checks permissions)\n    - rate_limit   # Rate limiting (per-tenant)\n    - logging\n    - metrics\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#casbin-model-example","title":"Casbin Model Example","text":"<pre><code># rbac_with_domains_model.conf\n# For multi-tenant RBAC\n\n[request_definition]\nr = sub, dom, obj, act\n\n[policy_definition]\np = sub, dom, obj, act\n\n[role_definition]\ng = _, _, _\n\n[policy_effect]\ne = some(where (p.eft == allow))\n\n[matchers]\nm = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; keyMatch2(r.obj, p.obj) &amp;&amp; r.act == p.act\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#casbin-policy-example","title":"Casbin Policy Example","text":"<pre><code># policy.csv\n# Format: p, subject, domain(tenant), object(tool), action\n\n# Admin role has full access in all tenants\np, role:admin, *, *, *\n\n# Users can list and describe tools\np, role:user, *, *, list\np, role:user, *, *, describe\n\n# Users can call specific tools\np, role:user, *, search_*, call\np, role:user, *, describe_*, call\n\n# Enterprise tenants can execute code\np, role:user, tenant:enterprise-*, execute_code, call\n\n# Role assignments\ng, alice, role:admin, tenant:acme-corp\ng, bob, role:user, tenant:acme-corp\ng, service-account, role:admin, *\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#cli-integration","title":"CLI Integration","text":"<pre><code># Serve with authentication enabled\nmetatools serve --auth.type=jwt --auth.jwt.issuer=https://auth.example.com\n\n# Generate API key\nmetatools auth create-key --name=\"my-api-key\" --tenant=\"acme-corp\" --roles=user\n\n# Validate token\nmetatools auth validate-token --token=\"eyJ...\"\n\n# List API keys\nmetatools auth list-keys --tenant=\"acme-corp\"\n\n# Revoke API key\nmetatools auth revoke-key --id=\"key_abc123\"\n\n# Test authorization\nmetatools auth test --principal=\"alice\" --tenant=\"acme-corp\" --resource=\"execute_code\" --action=\"call\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#implementation-priority","title":"Implementation Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#phase-1-core-interfaces-1-week","title":"Phase 1: Core Interfaces (1 week)","text":"<ol> <li>Define <code>Identity</code>, <code>AuthResult</code>, <code>AuthRequest</code>, <code>AuthzRequest</code> types</li> <li>Define <code>Authenticator</code>, <code>Authorizer</code> interfaces</li> <li>Implement context helpers (<code>WithIdentity</code>, <code>IdentityFromContext</code>, etc.)</li> <li>Implement <code>AuthMiddleware</code> and <code>AuthzMiddleware</code></li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#phase-2-jwt-api-key-authenticators-1-week","title":"Phase 2: JWT &amp; API Key Authenticators (1 week)","text":"<ol> <li>Implement <code>JWTAuthenticator</code> with JWKS support</li> <li>Implement <code>APIKeyAuthenticator</code> with pluggable stores</li> <li>Implement <code>CompositeAuthenticator</code></li> <li>Add factory registration</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#phase-3-rbac-authorizers-1-week","title":"Phase 3: RBAC Authorizers (1 week)","text":"<ol> <li>Implement <code>SimpleRBACAuthorizer</code> (no dependencies)</li> <li>Implement <code>CasbinAuthorizer</code> (optional dependency)</li> <li>Add configuration parsing and validation</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#phase-4-advanced-features-1-week","title":"Phase 4: Advanced Features (1 week)","text":"<ol> <li>Implement <code>OAuth2Authenticator</code> with token introspection</li> <li>Implement <code>MTLSAuthenticator</code></li> <li>Implement <code>OPAAuthorizer</code> (optional dependency)</li> <li>Add CLI commands for key management</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#testing-strategy","title":"Testing Strategy","text":"<pre><code>// Mock authenticator for testing\ntype MockAuthenticator struct {\n    AuthenticateFunc func(ctx context.Context, req *AuthRequest) (*AuthResult, error)\n    SupportsFunc     func(ctx context.Context, req *AuthRequest) bool\n}\n\n// Test helper\nfunc TestIdentity(principal, tenant string, roles ...string) *Identity {\n    return &amp;Identity{\n        Principal: principal,\n        TenantID:  tenant,\n        Roles:     roles,\n        Method:    AuthMethodJWT,\n        IssuedAt:  time.Now(),\n    }\n}\n\n// Example test\nfunc TestAuthMiddleware_ValidJWT(t *testing.T) {\n    auth := &amp;MockAuthenticator{\n        AuthenticateFunc: func(ctx context.Context, req *AuthRequest) (*AuthResult, error) {\n            return &amp;AuthResult{\n                Authenticated: true,\n                Identity:      TestIdentity(\"alice\", \"acme-corp\", \"user\"),\n            }, nil\n        },\n        SupportsFunc: func(ctx context.Context, req *AuthRequest) bool {\n            return true\n        },\n    }\n\n    mw := AuthMiddleware(auth)\n    wrapped := mw(mockProvider{})\n\n    result, err := wrapped.Handle(context.Background(), nil)\n    require.NoError(t, err)\n    // ... assertions\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#summary","title":"Summary","text":"<p>This design provides:</p> <ol> <li>100% Pluggable Authentication - Any credential type via <code>Authenticator</code> interface</li> <li>100% Pluggable Authorization - Any policy engine via <code>Authorizer</code> interface</li> <li>Multi-Provider Support - JWT, OAuth2, API Keys, mTLS all swappable</li> <li>RBAC/ABAC/ReBAC - Casbin, OPA, or simple built-in RBAC</li> <li>Multi-Tenancy Foundation - Identity includes tenant context</li> <li>Zero Coupling - Middleware knows nothing about specific implementations</li> <li>Configuration-Driven - Full YAML configuration support</li> <li>Observable - Audit logging and metrics built-in</li> </ol> <p>All components follow the existing middleware chain architecture and can be replaced or extended without code changes.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/auth-middleware/#changelog","title":"Changelog","text":"Date Change 2026-01-30 Initial auth middleware proposal based on research"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/","title":"Component Library Analysis for Pluggable Architecture","text":"<p>Status: Draft Date: 2026-01-27 Related: Pluggable Architecture Proposal, Implementation Phases</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#overview","title":"Overview","text":"<p>This document analyzes the metatools component library ecosystem and identifies changes needed to support the pluggable architecture. The analysis follows Go Architect principles: layered architecture, clean interfaces, dependency injection, and proper error handling.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#component-library-ecosystem","title":"Component Library Ecosystem","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#dependency-graph","title":"Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS COMPONENT ECOSYSTEM                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                \u2502\n\u2502                           \u2502  metatools-mcp  \u2502                                \u2502\n\u2502                           \u2502    (v0.1.x)     \u2502                                \u2502\n\u2502                           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502\n\u2502                                    \u2502                                          \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502         \u2502                          \u2502                          \u2502              \u2502\n\u2502         \u25bc                          \u25bc                          \u25bc              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502  toolcode   \u2502           \u2502  tooldocs   \u2502           \u2502  toolrun    \u2502        \u2502\n\u2502  \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.9)   \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502         \u2502                         \u2502                         \u2502                \u2502\n\u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502         \u2502    \u2502                    \u2502                                          \u2502\n\u2502         \u25bc    \u25bc                    \u25bc                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502  \u2502 toolruntime \u2502           \u2502  toolindex  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502  (v0.1.10)  \u2502           \u2502  (v0.1.8)   \u2502                          \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502         \u2502                         \u2502                          \u2502 toolsearch \u2502 \u2502\n\u2502         \u2502                         \u2502                          \u2502  (v0.1.9)  \u2502 \u2502\n\u2502         \u2502                         \u25bc                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502         \u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  toolmodel  \u2502                                  \u2502\n\u2502                            \u2502  (v0.1.2)   \u2502                                  \u2502\n\u2502                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2502\n\u2502                                   \u2502                                          \u2502\n\u2502                                   \u25bc                                          \u2502\n\u2502                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                             \u2502\n\u2502                     \u2502 modelcontextprotocol/   \u2502                             \u2502\n\u2502                     \u2502       go-sdk            \u2502                             \u2502\n\u2502                     \u2502       (v1.2.0)          \u2502                             \u2502\n\u2502                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                             \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#library-summary-matrix","title":"Library Summary Matrix","text":"Library Version Purpose Key Interfaces Dependencies toolmodel v0.1.2 Core data models <code>Tool</code>, <code>ToolBackend</code>, <code>SchemaValidator</code> mcp go-sdk toolindex v0.1.8 Tool registry <code>Index</code>, <code>Searcher</code>, <code>BackendSelector</code> toolmodel tooldocs v0.1.10 Documentation <code>Store</code>, <code>DetailLevel</code> toolindex, toolmodel toolrun v0.1.9 Execution <code>Runner</code>, <code>MCPExecutor</code>, <code>ProviderExecutor</code>, <code>LocalRegistry</code> toolindex, toolmodel toolcode v0.1.10 Code execution <code>Executor</code>, <code>Engine</code>, <code>Tools</code> toolrun, tooldocs, toolindex toolsearch v0.1.9 BM25 search <code>BM25Searcher</code> (implements <code>Searcher</code>) toolindex, bleve toolruntime v0.1.10 Sandbox runtime <code>Runtime</code>, <code>Backend</code>, <code>ToolGateway</code> toolcode, toolrun, tooldocs"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-1-toolmodel-foundation","title":"Layer 1: toolmodel (Foundation)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state","title":"Current State","text":"<p>The foundational library defining what a \"tool\" is. Zero networking dependencies, safe for embedding.</p> <p>Exported Types: - <code>Tool</code> - Embeds <code>mcp.Tool</code> with extensions (Namespace, Version, Tags) - <code>ToolBackend</code> - Backend binding (Kind, MCP/Provider/Local configs) - <code>BackendKind</code> - Enum: <code>mcp</code>, <code>provider</code>, <code>local</code> - <code>MCPBackend</code>, <code>ProviderBackend</code>, <code>LocalBackend</code> - Backend configs - <code>SchemaValidator</code> - Interface for JSON Schema validation - <code>DefaultValidator</code> - Default implementation using jsonschema-go</p> <p>Key Functions: - <code>Tool.ToolID()</code> - Returns canonical ID (<code>namespace:name</code>) - <code>ParseToolID()</code> - Parses ID string into components - <code>Tool.Validate()</code> - Validates tool invariants - <code>NormalizeTags()</code> - Tag normalization for indexing</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-stable","title":"Priority: LOW (mostly stable)","text":"Change Rationale Impact Add <code>ToolMetadata</code> field Support arbitrary metadata for middleware/backends Minor - additive Add <code>BackendKindHTTP</code> Support HTTP backend type for remote APIs Minor - additive Add <code>BackendKindGRPC</code> Support gRPC backend type Minor - additive Add <code>HTTPBackend</code> struct Config for HTTP backends Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions","title":"Proposed Additions","text":"<pre><code>// New backend kinds for multi-backend architecture\nconst (\n    BackendKindMCP      BackendKind = \"mcp\"\n    BackendKindProvider BackendKind = \"provider\"\n    BackendKindLocal    BackendKind = \"local\"\n    BackendKindHTTP     BackendKind = \"http\"      // NEW\n    BackendKindGRPC     BackendKind = \"grpc\"      // NEW\n)\n\n// HTTPBackend metadata for HTTP API backends\ntype HTTPBackend struct {\n    BaseURL   string            `json:\"baseUrl\"`\n    AuthType  string            `json:\"authType,omitempty\"`  // bearer, oauth2, apikey\n    Headers   map[string]string `json:\"headers,omitempty\"`\n    Timeout   time.Duration     `json:\"timeout,omitempty\"`\n}\n\n// GRPCBackend metadata for gRPC backends\ntype GRPCBackend struct {\n    Address   string `json:\"address\"`\n    TLS       bool   `json:\"tls,omitempty\"`\n    CACert    string `json:\"caCert,omitempty\"`\n}\n\n// ToolBackend - add HTTP and GRPC fields\ntype ToolBackend struct {\n    Kind     BackendKind      `json:\"kind\"`\n    MCP      *MCPBackend      `json:\"mcp,omitempty\"`\n    Provider *ProviderBackend `json:\"provider,omitempty\"`\n    Local    *LocalBackend    `json:\"local,omitempty\"`\n    HTTP     *HTTPBackend     `json:\"http,omitempty\"`      // NEW\n    GRPC     *GRPCBackend     `json:\"grpc,omitempty\"`      // NEW\n}\n\n// Tool - add metadata field\ntype Tool struct {\n    mcp.Tool\n    Namespace string         `json:\"namespace,omitempty\"`\n    Version   string         `json:\"version,omitempty\"`\n    Tags      []string       `json:\"tags,omitempty\"`\n    Metadata  map[string]any `json:\"metadata,omitempty\"`   // NEW\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-2-toolindex-registry","title":"Layer 2: toolindex (Registry)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_1","title":"Current State","text":"<p>Global registry and discovery layer for tools. Thread-safe, supports pluggable search.</p> <p>Exported Types: - <code>Index</code> - Interface for tool registry - <code>InMemoryIndex</code> - Default implementation - <code>Summary</code> - Lightweight search result - <code>SearchDoc</code> - Document for search indexing - <code>Searcher</code> - Interface for search implementations - <code>BackendSelector</code> - Function type for backend selection - <code>ToolRegistration</code> - Tool + Backend pair</p> <p>Key Methods: - <code>RegisterTool()</code>, <code>RegisterTools()</code>, <code>RegisterToolsFromMCP()</code> - <code>GetTool()</code>, <code>GetAllBackends()</code> - <code>Search()</code>, <code>ListNamespaces()</code> - <code>UnregisterBackend()</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_1","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-medium","title":"Priority: MEDIUM","text":"Change Rationale Impact Add <code>ListTools()</code> method Backend aggregation needs full tool list Minor - additive Add <code>BackendSource</code> tracking Track which backend registered a tool Medium - structural Add <code>Refresh()</code> capability Support hot-reload from config changes Medium - additive Add <code>OnChange</code> callback Notify listeners of registry changes Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-interface-extensions","title":"Proposed Interface Extensions","text":"<pre><code>// Index interface additions\ntype Index interface {\n    // Existing methods...\n    RegisterTool(tool toolmodel.Tool, backend toolmodel.ToolBackend) error\n    RegisterTools(regs []ToolRegistration) error\n    RegisterToolsFromMCP(serverName string, tools []toolmodel.Tool) error\n    UnregisterBackend(toolID string, kind toolmodel.BackendKind, backendID string) error\n    GetTool(id string) (toolmodel.Tool, toolmodel.ToolBackend, error)\n    GetAllBackends(id string) ([]toolmodel.ToolBackend, error)\n    Search(query string, limit int) ([]Summary, error)\n    ListNamespaces() ([]string, error)\n\n    // NEW: Support for multi-backend architecture\n    ListTools() ([]toolmodel.Tool, error)                    // List all registered tools\n    ListToolsFromBackend(backendName string) ([]Summary, error) // Filter by source\n\n    // NEW: Support for dynamic updates\n    OnChange(callback func(event RegistryEvent)) func()      // Subscribe to changes\n    Refresh() error                                          // Trigger refresh from sources\n}\n\n// RegistryEvent for change notifications\ntype RegistryEvent struct {\n    Type    RegistryEventType  // added, updated, removed\n    ToolID  string\n    Backend *toolmodel.ToolBackend\n}\n\ntype RegistryEventType string\n\nconst (\n    RegistryEventAdded   RegistryEventType = \"added\"\n    RegistryEventUpdated RegistryEventType = \"updated\"\n    RegistryEventRemoved RegistryEventType = \"removed\"\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#backendselector-enhancement","title":"BackendSelector Enhancement","text":"<pre><code>// Enhanced backend selection with context\ntype BackendSelectorFunc func(\n    tool toolmodel.Tool,\n    backends []toolmodel.ToolBackend,\n    hints *SelectionHints,\n) toolmodel.ToolBackend\n\n// SelectionHints provides context for backend selection\ntype SelectionHints struct {\n    PreferredKind    toolmodel.BackendKind // Caller preference\n    PreferredBackend string                 // Specific backend name\n    LatencyBudget    time.Duration          // Latency requirement\n    CostSensitive    bool                   // Prefer cheaper backends\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-3-tooldocs-documentation","title":"Layer 3: tooldocs (Documentation)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_2","title":"Current State","text":"<p>Progressive disclosure documentation layer. Three detail levels: summary, schema, full.</p> <p>Exported Types: - <code>Store</code> - Interface for documentation storage - <code>InMemoryStore</code> - Default implementation - <code>DetailLevel</code> - Enum: summary, schema, full - <code>ToolDoc</code> - Documentation at various levels - <code>ToolExample</code> - Usage example - <code>SchemaInfo</code> - Derived schema information - <code>DocEntry</code> - Input for registration</p> <p>Key Methods: - <code>DescribeTool(id, level)</code> - Get documentation at level - <code>ListExamples(id, max)</code> - Get examples - <code>RegisterDoc()</code>, <code>RegisterExamples()</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_2","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-minimal-changes-needed","title":"Priority: LOW (minimal changes needed)","text":"Change Rationale Impact Add <code>BulkRegister()</code> method Backend aggregation may load many docs Minor - additive Add source tracking Track which backend provided docs Minor - structural"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions_1","title":"Proposed Additions","text":"<pre><code>// Store interface additions\ntype Store interface {\n    // Existing methods...\n    DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n    ListExamples(id string, maxExamples int) ([]ToolExample, error)\n\n    // NEW: Bulk operations for backend aggregation\n    BulkRegisterDocs(entries map[string]DocEntry) error\n\n    // NEW: Source tracking\n    GetDocSource(id string) (string, error)  // Returns backend name\n}\n\n// DocEntry - add source field\ntype DocEntry struct {\n    Summary      string\n    Notes        string\n    Examples     []ToolExample\n    ExternalRefs []string\n    Source       string  // NEW: Backend that provided this doc\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-4-toolrun-execution","title":"Layer 4: toolrun (Execution)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_3","title":"Current State","text":"<p>Tool execution layer supporting MCP, Provider, and Local backends.</p> <p>Exported Types: - <code>Runner</code> - Interface for tool execution - <code>DefaultRunner</code> - Default implementation - <code>MCPExecutor</code> - Interface for MCP backend calls - <code>ProviderExecutor</code> - Interface for provider backend calls - <code>LocalRegistry</code> - Interface for local handler lookup - <code>RunResult</code>, <code>StepResult</code>, <code>ChainStep</code> - Execution results - <code>StreamEvent</code> - Streaming event type - <code>ToolError</code> - Contextual error wrapper</p> <p>Key Methods: - <code>Run()</code> - Execute single tool - <code>RunStream()</code> - Execute with streaming - <code>RunChain()</code> - Execute tool sequence</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_3","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-high-core-execution-layer","title":"Priority: HIGH (core execution layer)","text":"Change Rationale Impact Add <code>HTTPExecutor</code> interface Support HTTP backend execution Medium - additive Add <code>GRPCExecutor</code> interface Support gRPC backend execution Medium - additive Add <code>ExecutorRegistry</code> Dynamic executor registration Medium - structural Add execution hooks Middleware integration point Medium - additive Add <code>BackendRouter</code> Route execution to correct executor Medium - structural"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-interface-additions","title":"Proposed Interface Additions","text":"<pre><code>// HTTPExecutor for HTTP backend execution\ntype HTTPExecutor interface {\n    CallTool(ctx context.Context, baseURL string, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, baseURL string, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// GRPCExecutor for gRPC backend execution\ntype GRPCExecutor interface {\n    CallTool(ctx context.Context, address string, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, address string, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// ExecutorRegistry manages execution backends\ntype ExecutorRegistry interface {\n    Register(kind toolmodel.BackendKind, executor any) error\n    Get(kind toolmodel.BackendKind) (any, bool)\n    List() []toolmodel.BackendKind\n}\n\n// ExecutionHook for middleware integration\ntype ExecutionHook interface {\n    BeforeExecution(ctx context.Context, toolID string, args map[string]any) (context.Context, error)\n    AfterExecution(ctx context.Context, toolID string, result RunResult, err error) error\n}\n\n// Config additions\ntype Config struct {\n    // Existing fields...\n    Index            toolindex.Index\n    ToolResolver     func(id string) (*toolmodel.Tool, error)\n    BackendsResolver func(id string) ([]toolmodel.ToolBackend, error)\n    BackendSelector  toolindex.BackendSelector\n    Validator        toolmodel.SchemaValidator\n    ValidateInput    bool\n    ValidateOutput   bool\n    MCP              MCPExecutor\n    Provider         ProviderExecutor\n    Local            LocalRegistry\n\n    // NEW: Additional executors\n    HTTP             HTTPExecutor        // NEW\n    GRPC             GRPCExecutor        // NEW\n    ExecutorRegistry ExecutorRegistry    // NEW: Dynamic registration\n    Hooks            []ExecutionHook     // NEW: Middleware hooks\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#enhanced-runner-interface","title":"Enhanced Runner Interface","text":"<pre><code>// Runner interface with execution options\ntype Runner interface {\n    Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n\n    // NEW: Execution with options\n    RunWithOptions(ctx context.Context, toolID string, args map[string]any, opts RunOptions) (RunResult, error)\n}\n\n// RunOptions for execution customization\ntype RunOptions struct {\n    PreferredBackend string                 // Override backend selection\n    Timeout          time.Duration          // Per-call timeout\n    Metadata         map[string]any         // Pass-through metadata\n    SkipValidation   bool                   // Skip input/output validation\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-5-toolcode-code-execution","title":"Layer 5: toolcode (Code Execution)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_4","title":"Current State","text":"<p>Code execution orchestration layer with pluggable engines.</p> <p>Exported Types: - <code>Executor</code> - Interface for code execution - <code>DefaultExecutor</code> - Default implementation - <code>Engine</code> - Interface for language-specific execution - <code>Tools</code> - Metatool environment exposed to code - <code>Config</code>, <code>ExecuteParams</code>, <code>ExecuteResult</code> - <code>ToolCallRecord</code>, <code>CodeError</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_4","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-stable_1","title":"Priority: LOW (mostly stable)","text":"Change Rationale Impact Add engine registry Support multiple language engines Minor - structural Add execution context Pass middleware context through Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#proposed-additions_2","title":"Proposed Additions","text":"<pre><code>// EngineRegistry for multiple language support\ntype EngineRegistry interface {\n    Register(language string, engine Engine) error\n    Get(language string) (Engine, bool)\n    List() []string\n}\n\n// Config additions\ntype Config struct {\n    // Existing fields...\n    Index           toolindex.Index\n    Docs            tooldocs.Store\n    Run             toolrun.Runner\n    Engine          Engine\n    DefaultTimeout  time.Duration\n    DefaultLanguage string\n    MaxToolCalls    int\n    MaxChainSteps   int\n    Logger          Logger\n\n    // NEW: Multiple engine support\n    EngineRegistry  EngineRegistry  // NEW\n}\n\n// ExecuteParams additions\ntype ExecuteParams struct {\n    Language     string\n    Code         string\n    Timeout      time.Duration\n    MaxToolCalls int\n\n    // NEW: Execution context\n    Metadata     map[string]any  // NEW: Pass-through metadata\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-6-toolsearch-bm25-search","title":"Layer 6: toolsearch (BM25 Search)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_5","title":"Current State","text":"<p>BM25 search implementation using Bleve. Implements <code>toolindex.Searcher</code>.</p> <p>Exported Types: - <code>BM25Config</code> - Configuration (boosts, limits) - <code>BM25Searcher</code> - Searcher implementation</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_5","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-none-stable-well-designed","title":"Priority: NONE (stable, well-designed)","text":"<p>The library already implements the pluggable pattern correctly via <code>toolindex.Searcher</code> interface. No changes needed for the pluggable architecture.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#layer-7-toolruntime-sandbox","title":"Layer 7: toolruntime (Sandbox)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#current-state_6","title":"Current State","text":"<p>Runtime and trust boundary layer with multiple isolation backends.</p> <p>Exported Types: - <code>Runtime</code> - Interface for code execution runtime - <code>DefaultRuntime</code> - Default implementation - <code>Backend</code> - Interface for isolation backends - <code>ToolGateway</code> - Tool access interface for sandboxed code - <code>SecurityProfile</code> - dev, standard, hardened - <code>BackendKind</code> - Isolation mechanism (Docker, K8s, gVisor, etc.) - <code>ExecuteRequest</code>, <code>ExecuteResult</code>, <code>Limits</code></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changes-needed-for-pluggable-architecture_6","title":"Changes Needed for Pluggable Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#priority-low-mostly-independent","title":"Priority: LOW (mostly independent)","text":"Change Rationale Impact Add security profile config Configure profiles via YAML Minor - additive Add backend discovery Auto-discover available backends Minor - additive"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#cross-cutting-concerns","title":"Cross-Cutting Concerns","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#error-handling-improvements","title":"Error Handling Improvements","text":"<p>All libraries should adopt a consistent error taxonomy:</p> <pre><code>// Proposed: pkg/errors/errors.go (new shared package)\n\n// ToolError is the base error type for all tool operations\ntype ToolError struct {\n    Code       ErrorCode\n    Message    string\n    ToolID     string\n    Backend    string\n    Op         string\n    Cause      error\n    Retryable  bool\n    Metadata   map[string]any\n}\n\ntype ErrorCode string\n\nconst (\n    ErrCodeNotFound       ErrorCode = \"not_found\"\n    ErrCodeValidation     ErrorCode = \"validation\"\n    ErrCodeExecution      ErrorCode = \"execution\"\n    ErrCodeTimeout        ErrorCode = \"timeout\"\n    ErrCodeBackendFailure ErrorCode = \"backend_failure\"\n    ErrCodeRateLimit      ErrorCode = \"rate_limit\"\n    ErrCodeAuth           ErrorCode = \"auth\"\n)\n\nfunc (e *ToolError) Error() string\nfunc (e *ToolError) Unwrap() error\nfunc (e *ToolError) Is(target error) bool\nfunc (e *ToolError) IsRetryable() bool\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#context-propagation","title":"Context Propagation","text":"<p>All libraries should propagate context consistently:</p> <pre><code>// Proposed: Context keys for cross-cutting concerns\ntype contextKey string\n\nconst (\n    ContextKeyRequestID  contextKey = \"request_id\"\n    ContextKeyUserID     contextKey = \"user_id\"\n    ContextKeyTraceID    contextKey = \"trace_id\"\n    ContextKeyBackend    contextKey = \"backend\"\n    ContextKeyMetadata   contextKey = \"metadata\"\n)\n\n// Helper functions\nfunc WithRequestID(ctx context.Context, id string) context.Context\nfunc RequestIDFromContext(ctx context.Context) string\n// ... etc\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#implementation-priority","title":"Implementation Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-1-foundation-with-metatools-mcp-phase-1","title":"Phase 1: Foundation (with metatools-mcp Phase 1)","text":"<ol> <li>toolmodel: Add HTTP/GRPC backend kinds (1 day)</li> <li>toolrun: Add HTTPExecutor, GRPCExecutor interfaces (2 days)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-2-registry-enhancements-with-metatools-mcp-phase-4","title":"Phase 2: Registry Enhancements (with metatools-mcp Phase 4)","text":"<ol> <li>toolindex: Add ListTools, OnChange, source tracking (2 days)</li> <li>toolrun: Add ExecutorRegistry, BackendRouter (2 days)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#phase-3-middleware-integration-with-metatools-mcp-phase-5","title":"Phase 3: Middleware Integration (with metatools-mcp Phase 5)","text":"<ol> <li>toolrun: Add ExecutionHook interface (1 day)</li> <li>All libraries: Consistent error taxonomy (2 days)</li> <li>All libraries: Context propagation (1 day)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#version-compatibility-matrix","title":"Version Compatibility Matrix","text":"<p>Current ecosystem versions:</p> Library Current After Phase 1 After Phase 2 After Phase 3 toolmodel v0.1.2 v0.2.0 v0.2.0 v0.2.0 toolindex v0.1.8 v0.1.8 v0.2.0 v0.2.0 tooldocs v0.1.10 v0.1.10 v0.1.11 v0.1.11 toolrun v0.1.9 v0.2.0 v0.2.0 v0.3.0 toolcode v0.1.10 v0.1.10 v0.1.10 v0.1.11 toolsearch v0.1.9 v0.1.9 v0.1.9 v0.1.9 toolruntime v0.1.10 v0.1.10 v0.1.10 v0.1.11"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#summary-required-library-changes","title":"Summary: Required Library Changes","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#breaking-changes-none","title":"Breaking Changes: NONE","text":"<p>All proposed changes are additive and backward-compatible.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#high-priority-changes","title":"High Priority Changes","text":"Library Change Files Affected toolmodel Add BackendKindHTTP, BackendKindGRPC types.go toolmodel Add HTTPBackend, GRPCBackend structs types.go toolrun Add HTTPExecutor interface executor.go (new) toolrun Add GRPCExecutor interface executor.go (new) toolrun Add ExecutorRegistry registry.go (new)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#medium-priority-changes","title":"Medium Priority Changes","text":"Library Change Files Affected toolindex Add ListTools method index.go toolindex Add OnChange callback index.go toolrun Add ExecutionHook interface hooks.go (new) toolrun Add RunOptions, RunWithOptions runner.go"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#low-priority-changes","title":"Low Priority Changes","text":"Library Change Files Affected tooldocs Add BulkRegisterDocs store.go toolcode Add EngineRegistry engine.go (new) All Consistent error taxonomy errors.go (new per lib)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#key-discovery-architecture-already-pluggable","title":"Key Discovery: Architecture Already Pluggable","text":"<p>Comprehensive analysis of all 8 component libraries (40+ source files, 12,000+ lines) revealed:</p> <p>The metatools ecosystem is NOT a monolith to be refactored. It is a mature, layered, pluggable architecture with 13 extension points already implemented as Go interfaces.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#13-extension-points-catalogued","title":"13 Extension Points Catalogued","text":"# Interface Library Status 1 <code>SchemaValidator</code> toolmodel \u2705 Interface-based 2 <code>Searcher</code> toolindex \u2705 Interface-based 3 <code>BackendSelector</code> toolindex \u2705 Function-based 4 <code>Store</code> tooldocs \u2705 Interface-based 5 <code>ToolResolver</code> tooldocs \u2705 Function-based 6 <code>Runner</code> toolrun \u2705 Interface-based 7 <code>MCPExecutor</code> toolrun \u2705 Interface-based 8 <code>ProviderExecutor</code> toolrun \u2705 Interface-based 9 <code>LocalRegistry</code> toolrun \u2705 Interface-based 10 <code>Backend</code> toolruntime \u2705 Interface-based (10 implementations!) 11 <code>ToolGateway</code> toolruntime \u2705 Interface-based 12 <code>Logger</code> toolcode \u2705 Interface-based 13 <code>Engine</code> toolcode \u2705 Interface-based"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#implications-for-implementation","title":"Implications for Implementation","text":"<p>The \"pluggable architecture\" work is primarily: 1. Exposure - Make internal extension points accessible via configuration 2. Configuration - Add CLI + config layer (Cobra + Koanf) 3. Documentation - Catalog the 13 extension points with examples</p> <p>This reduces the implementation timeline from 9 weeks to 6-7 weeks (25% reduction).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/component-library-analysis/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial analysis of all 7 component libraries 2026-01-28 Added Key Discovery section documenting 13 existing extension points 2026-01-28 Updated analysis to reflect that architecture is already pluggable"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/","title":"Pluggable Architecture Implementation Phases","text":"<p>Status: Draft (Revised) Date: 2026-01-28 Related: Pluggable Architecture Proposal, Component Library Analysis</p> <p>Revised Timeline: Architecture discovery revealed that 13 extension points already exist as Go interfaces. The work is primarily configuration and exposure, not architecture redesign. Timeline reduced from 9 weeks to 6-7 weeks (25% reduction).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#overview","title":"Overview","text":"<p>This document breaks the pluggable architecture proposal into manageable implementation phases, following Go best practices and layered architecture principles. Each phase is designed to be:</p> <ul> <li>Independently deliverable - Can be merged and deployed after completion</li> <li>Backward compatible - Existing functionality continues to work</li> <li>Testable - Includes clear verification criteria</li> <li>Incremental - Builds on previous phases</li> </ul> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    REVISED IMPLEMENTATION ROADMAP (6-7 weeks)               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Phase 1 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 2 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 3 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Phase 4          \u2502\n\u2502   CLI + Config       Transport          Public APIs        Backend           \u2502\n\u2502   (Expose 13 pts)    Abstraction        &amp; Documentation    Integration       \u2502\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502   2 weeks    \u2502   \u2502  1-2 weeks   \u2502   \u2502   1 week     \u2502   \u2502   2 weeks    \u2502 \u2502\n\u2502   \u2502              \u2502   \u2502              \u2502   \u2502              \u2502   \u2502              \u2502 \u2502\n\u2502   \u2502 Cobra CLI    \u2502   \u2502 Transport    \u2502   \u2502 Export       \u2502   \u2502 Docker/WASM  \u2502 \u2502\n\u2502   \u2502 Koanf config \u2502   \u2502 Interface    \u2502   \u2502 internal pkg \u2502   \u2502 integration  \u2502 \u2502\n\u2502   \u2502 13 ext points\u2502   \u2502 Stdio + SSE  \u2502   \u2502 13 ext docs  \u2502   \u2502 Backend reg  \u2502 \u2502\n\u2502   \u2502 config schema\u2502   \u2502              \u2502   \u2502 Examples     \u2502   \u2502 config       \u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502   MVP \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502                                    \u2502\n\u2502   (Phases 1-2: ~3-4 weeks)              \u2502                                    \u2502\n\u2502                                                                               \u2502\n\u2502   Note: Original Phase 5 (Middleware) deferred - 13 extension points        \u2502\n\u2502         already provide middleware integration via ExecutionHook             \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-1-cli-framework-configuration-foundation","title":"Phase 1: CLI Framework &amp; Configuration (Foundation)","text":"<p>Duration: ~2 weeks Priority: Critical (foundation for all other phases) Risk: Low (additive changes, no breaking changes)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective","title":"Objective","text":"<p>Introduce Cobra CLI framework and Koanf configuration library while maintaining backward compatibility with current environment variable configuration.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes","title":"Directory Structure Changes","text":"<pre><code>cmd/metatools/\n\u251c\u2500\u2500 main.go              # Entry point (simplified)\n\u251c\u2500\u2500 root.go              # Root command\n\u251c\u2500\u2500 stdio.go             # `metatools stdio` (current behavior)\n\u251c\u2500\u2500 serve.go             # `metatools serve` (HTTP/SSE) - placeholder\n\u251c\u2500\u2500 version.go           # `metatools version`\n\u251c\u2500\u2500 validate.go          # `metatools validate` (config validation)\n\u251c\u2500\u2500 executor_toolruntime.go  # (unchanged)\n\u2514\u2500\u2500 executor_stub.go         # (unchanged)\n\ninternal/\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 env.go           # (unchanged - backward compat)\n\u2502   \u251c\u2500\u2500 loader.go        # NEW: Koanf-based config loader\n\u2502   \u251c\u2500\u2500 schema.go        # NEW: Config struct definitions\n\u2502   \u2514\u2500\u2500 defaults.go      # NEW: Default values\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#11-add-dependencies","title":"1.1 Add Dependencies","text":"<pre><code>// go.mod additions\nrequire (\n    github.com/spf13/cobra v1.8.1\n    github.com/knadh/koanf/v2 v2.1.2\n    github.com/knadh/koanf/parsers/yaml v0.1.0\n    github.com/knadh/koanf/providers/env v1.0.0\n    github.com/knadh/koanf/providers/file v1.1.0\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#12-configuration-schema-internalconfigschemago","title":"1.2 Configuration Schema (<code>internal/config/schema.go</code>)","text":"<pre><code>package config\n\n// ServerConfig is the root configuration structure\ntype ServerConfig struct {\n    Server    ServerSettings    `koanf:\"server\"`\n    Transport TransportConfig   `koanf:\"transport\"`\n    Search    SearchConfig      `koanf:\"search\"`\n    Execution ExecutionConfig   `koanf:\"execution\"`\n    Providers ProvidersConfig   `koanf:\"providers\"`\n    Backends  BackendsConfig    `koanf:\"backends\"`\n    Middleware MiddlewareConfig `koanf:\"middleware\"`\n}\n\ntype ServerSettings struct {\n    Name    string `koanf:\"name\"`\n    Version string `koanf:\"version\"`\n}\n\ntype TransportConfig struct {\n    Type string       `koanf:\"type\"` // stdio, sse, http\n    HTTP HTTPConfig   `koanf:\"http\"`\n}\n\ntype HTTPConfig struct {\n    Host     string        `koanf:\"host\"`\n    Port     int           `koanf:\"port\"`\n    TLS      TLSConfig     `koanf:\"tls\"`\n    Timeouts TimeoutConfig `koanf:\"timeouts\"`\n    CORS     CORSConfig    `koanf:\"cors\"`\n    Health   HealthConfig  `koanf:\"health\"`\n}\n\n// SearchConfig matches current EnvConfig.SearchConfig\ntype SearchConfig struct {\n    Strategy       string `koanf:\"strategy\"`\n    NameBoost      int    `koanf:\"name_boost\"`\n    NamespaceBoost int    `koanf:\"namespace_boost\"`\n    TagsBoost      int    `koanf:\"tags_boost\"`\n    MaxDocs        int    `koanf:\"max_docs\"`\n    MaxDocTextLen  int    `koanf:\"max_doctext_len\"`\n}\n\n// ... (additional config types)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#13-configuration-loader-internalconfigloadergo","title":"1.3 Configuration Loader (<code>internal/config/loader.go</code>)","text":"<pre><code>package config\n\nimport (\n    \"github.com/knadh/koanf/v2\"\n    \"github.com/knadh/koanf/parsers/yaml\"\n    \"github.com/knadh/koanf/providers/env\"\n    \"github.com/knadh/koanf/providers/file\"\n)\n\ntype Loader struct {\n    k *koanf.Koanf\n}\n\n// Load loads configuration with precedence:\n// CLI flags &gt; Environment variables &gt; Config file &gt; Defaults\nfunc (l *Loader) Load(configPath string) (*ServerConfig, error) {\n    l.k = koanf.New(\".\")\n\n    // 1. Load defaults\n    if err := l.loadDefaults(); err != nil {\n        return nil, err\n    }\n\n    // 2. Load config file (if exists)\n    if configPath != \"\" {\n        if err := l.k.Load(file.Provider(configPath), yaml.Parser()); err != nil {\n            return nil, fmt.Errorf(\"loading config file: %w\", err)\n        }\n    }\n\n    // 3. Load environment variables (METATOOLS_ prefix)\n    if err := l.k.Load(env.Provider(\"METATOOLS_\", \".\", func(s string) string {\n        return strings.Replace(strings.ToLower(\n            strings.TrimPrefix(s, \"METATOOLS_\")), \"_\", \".\", -1)\n    }), nil); err != nil {\n        return nil, fmt.Errorf(\"loading env vars: %w\", err)\n    }\n\n    var cfg ServerConfig\n    if err := l.k.Unmarshal(\"\", &amp;cfg); err != nil {\n        return nil, fmt.Errorf(\"unmarshaling config: %w\", err)\n    }\n\n    return &amp;cfg, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#14-cli-root-command-cmdmetatoolsrootgo","title":"1.4 CLI Root Command (<code>cmd/metatools/root.go</code>)","text":"<pre><code>package main\n\nimport (\n    \"os\"\n\n    \"github.com/spf13/cobra\"\n)\n\nvar (\n    cfgFile string\n    verbose bool\n)\n\nvar rootCmd = &amp;cobra.Command{\n    Use:   \"metatools\",\n    Short: \"MCP server for tool discovery and execution\",\n    Long: `metatools-mcp is a Model Context Protocol server that provides\nunified tool discovery, documentation, and execution capabilities.`,\n}\n\nfunc init() {\n    rootCmd.PersistentFlags().StringVarP(&amp;cfgFile, \"config\", \"c\", \"\",\n        \"config file (default: metatools.yaml)\")\n    rootCmd.PersistentFlags().BoolVarP(&amp;verbose, \"verbose\", \"v\", false,\n        \"verbose output\")\n\n    rootCmd.AddCommand(stdioCmd)\n    rootCmd.AddCommand(serveCmd)\n    rootCmd.AddCommand(versionCmd)\n    rootCmd.AddCommand(validateCmd)\n}\n\nfunc Execute() {\n    if err := rootCmd.Execute(); err != nil {\n        os.Exit(1)\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#15-stdio-command-cmdmetatoolsstdiogo","title":"1.5 Stdio Command (<code>cmd/metatools/stdio.go</code>)","text":"<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"os/signal\"\n    \"syscall\"\n\n    \"github.com/spf13/cobra\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\nvar stdioCmd = &amp;cobra.Command{\n    Use:   \"stdio\",\n    Short: \"Run as stdio MCP server (default mode)\",\n    Long:  `Runs the MCP server using stdin/stdout transport for MCP clients like Claude Desktop.`,\n    RunE:  runStdio,\n}\n\nfunc init() {\n    // Set as default command when no subcommand provided\n    rootCmd.Run = stdioCmd.Run\n}\n\nfunc runStdio(cmd *cobra.Command, args []string) error {\n    ctx, cancel := signal.NotifyContext(context.Background(), syscall.SIGINT, syscall.SIGTERM)\n    defer cancel()\n\n    srv, err := createServer()\n    if err != nil {\n        return fmt.Errorf(\"failed to create server: %w\", err)\n    }\n\n    tools := srv.ListTools()\n    log.Printf(\"metatools-mcp server starting with %d tools\", len(tools))\n\n    transport := &amp;mcp.StdioTransport{}\n    if err := srv.Run(ctx, transport); err != nil &amp;&amp; ctx.Err() == nil {\n        return fmt.Errorf(\"server error: %w\", err)\n    }\n\n    log.Println(\"Server stopped\")\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria","title":"Verification Criteria","text":"<ul> <li>[ ] <code>metatools stdio</code> works identically to current behavior</li> <li>[ ] <code>metatools version</code> prints version info</li> <li>[ ] <code>metatools validate -c config.yaml</code> validates configuration files</li> <li>[ ] Existing environment variables (<code>METATOOLS_SEARCH_*</code>) continue to work</li> <li>[ ] New YAML config file loading works</li> <li>[ ] Config precedence: CLI &gt; Env &gt; File &gt; Defaults</li> <li>[ ] All existing tests pass</li> <li>[ ] New unit tests for config loader (&gt;80% coverage)</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#migration-notes","title":"Migration Notes","text":"<ul> <li>No breaking changes</li> <li><code>metatools</code> (no args) defaults to <code>metatools stdio</code></li> <li>Environment variable prefix remains <code>METATOOLS_</code></li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-2-transport-layer-abstraction","title":"Phase 2: Transport Layer Abstraction","text":"<p>Duration: ~2 weeks Priority: High (enables multi-modal deployment) Risk: Medium (touches core server logic) Depends on: Phase 1</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_1","title":"Objective","text":"<p>Abstract the transport layer so the same server logic can run over stdio, SSE, or HTTP.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_1","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 transport/\n\u2502   \u251c\u2500\u2500 transport.go     # NEW: Transport interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Transport registry\n\u2502   \u251c\u2500\u2500 stdio.go         # NEW: Stdio transport wrapper\n\u2502   \u251c\u2500\u2500 sse.go           # NEW: SSE transport\n\u2502   \u2514\u2500\u2500 http.go          # NEW: HTTP transport (optional)\n\u251c\u2500\u2500 server/\n\u2502   \u251c\u2500\u2500 server.go        # MODIFIED: Use Transport interface\n\u2502   \u2514\u2500\u2500 handler.go       # NEW: Shared request handler\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_1","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#21-transport-interface-internaltransporttransportgo","title":"2.1 Transport Interface (<code>internal/transport/transport.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n)\n\n// Transport defines how MCP clients connect to the server\ntype Transport interface {\n    // Name returns the transport identifier\n    Name() string\n\n    // Serve starts the transport and blocks until ctx is cancelled\n    Serve(ctx context.Context, handler RequestHandler) error\n\n    // Close gracefully shuts down the transport\n    Close() error\n\n    // Info returns runtime information about the transport\n    Info() TransportInfo\n}\n\n// RequestHandler processes incoming MCP requests\ntype RequestHandler interface {\n    HandleRequest(ctx context.Context, req *Request) (*Response, error)\n}\n\n// TransportInfo provides runtime details about a transport\ntype TransportInfo struct {\n    Name      string\n    Protocol  string            // \"stdio\", \"http\", \"sse\", \"grpc\"\n    Address   string            // \"\" for stdio, \"localhost:8080\" for HTTP\n    Listening bool\n    Metadata  map[string]string\n}\n\n// Config holds transport-specific configuration\ntype Config struct {\n    Type      string\n    HTTP      HTTPConfig\n    WebSocket WebSocketConfig\n    GRPC      GRPCConfig\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#22-transport-registry-internaltransportregistrygo","title":"2.2 Transport Registry (<code>internal/transport/registry.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n// Factory creates a configured transport instance\ntype Factory func(cfg Config) (Transport, error)\n\n// Registry manages available transports\ntype Registry struct {\n    mu         sync.RWMutex\n    transports map[string]Factory\n}\n\n// NewRegistry creates a new transport registry with built-in transports\nfunc NewRegistry() *Registry {\n    r := &amp;Registry{\n        transports: make(map[string]Factory),\n    }\n\n    // Register built-in transports\n    r.Register(\"stdio\", NewStdioTransport)\n    r.Register(\"sse\", NewSSETransport)\n    r.Register(\"http\", NewHTTPTransport)\n\n    return r\n}\n\n// Register adds a transport factory\nfunc (r *Registry) Register(name string, factory Factory) {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    r.transports[name] = factory\n}\n\n// Create instantiates a transport from config\nfunc (r *Registry) Create(cfg Config) (Transport, error) {\n    r.mu.RLock()\n    factory, ok := r.transports[cfg.Type]\n    r.mu.RUnlock()\n\n    if !ok {\n        return nil, fmt.Errorf(\"unknown transport type: %s\", cfg.Type)\n    }\n\n    return factory(cfg)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#23-stdio-transport-internaltransportstdiogo","title":"2.3 Stdio Transport (<code>internal/transport/stdio.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// StdioTransport wraps the MCP SDK's stdio transport\ntype StdioTransport struct {\n    sdk *mcp.StdioTransport\n}\n\n// NewStdioTransport creates a stdio transport\nfunc NewStdioTransport(cfg Config) (Transport, error) {\n    return &amp;StdioTransport{\n        sdk: &amp;mcp.StdioTransport{},\n    }, nil\n}\n\nfunc (t *StdioTransport) Name() string { return \"stdio\" }\n\nfunc (t *StdioTransport) Serve(ctx context.Context, handler RequestHandler) error {\n    // Adapt to MCP SDK's transport interface\n    return t.sdk.Run(ctx, adaptHandler(handler))\n}\n\nfunc (t *StdioTransport) Close() error { return nil }\n\nfunc (t *StdioTransport) Info() TransportInfo {\n    return TransportInfo{\n        Name:      \"stdio\",\n        Protocol:  \"stdio\",\n        Address:   \"stdin/stdout\",\n        Listening: true,\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#24-sse-transport-internaltransportssego","title":"2.4 SSE Transport (<code>internal/transport/sse.go</code>)","text":"<pre><code>package transport\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// SSETransport implements Server-Sent Events transport\ntype SSETransport struct {\n    cfg      HTTPConfig\n    server   *http.Server\n    handler  RequestHandler\n    mu       sync.RWMutex\n    clients  map[string]chan []byte\n}\n\n// NewSSETransport creates an SSE transport\nfunc NewSSETransport(cfg Config) (Transport, error) {\n    return &amp;SSETransport{\n        cfg:     cfg.HTTP,\n        clients: make(map[string]chan []byte),\n    }, nil\n}\n\nfunc (t *SSETransport) Name() string { return \"sse\" }\n\nfunc (t *SSETransport) Serve(ctx context.Context, handler RequestHandler) error {\n    t.handler = handler\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/mcp\", t.handleMCP)\n    mux.HandleFunc(\"/health\", t.handleHealth)\n    mux.HandleFunc(\"/ready\", t.handleReady)\n\n    addr := fmt.Sprintf(\"%s:%d\", t.cfg.Host, t.cfg.Port)\n    t.server = &amp;http.Server{\n        Addr:         addr,\n        Handler:      t.applyCORS(mux),\n        ReadTimeout:  t.cfg.Timeouts.Read,\n        WriteTimeout: t.cfg.Timeouts.Write,\n        IdleTimeout:  t.cfg.Timeouts.Idle,\n    }\n\n    // Start server in goroutine\n    errCh := make(chan error, 1)\n    go func() {\n        if t.cfg.TLS.Enabled {\n            errCh &lt;- t.server.ListenAndServeTLS(t.cfg.TLS.Cert, t.cfg.TLS.Key)\n        } else {\n            errCh &lt;- t.server.ListenAndServe()\n        }\n    }()\n\n    // Wait for context cancellation or error\n    select {\n    case &lt;-ctx.Done():\n        shutdownCtx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n        defer cancel()\n        return t.server.Shutdown(shutdownCtx)\n    case err := &lt;-errCh:\n        return err\n    }\n}\n\nfunc (t *SSETransport) handleMCP(w http.ResponseWriter, r *http.Request) {\n    if r.Method != http.MethodPost {\n        http.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n        return\n    }\n\n    // Set SSE headers\n    w.Header().Set(\"Content-Type\", \"text/event-stream\")\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    w.Header().Set(\"Connection\", \"keep-alive\")\n\n    // Parse request\n    var req Request\n    if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n        t.sendError(w, \"Invalid request\", http.StatusBadRequest)\n        return\n    }\n\n    // Handle request\n    resp, err := t.handler.HandleRequest(r.Context(), &amp;req)\n    if err != nil {\n        t.sendError(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // Send response as SSE event\n    t.sendEvent(w, \"message\", resp)\n    t.sendEvent(w, \"done\", struct{}{})\n}\n\nfunc (t *SSETransport) sendEvent(w http.ResponseWriter, event string, data any) {\n    jsonData, _ := json.Marshal(data)\n    fmt.Fprintf(w, \"event: %s\\ndata: %s\\n\\n\", event, jsonData)\n    if f, ok := w.(http.Flusher); ok {\n        f.Flush()\n    }\n}\n\n// ... additional helper methods\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#25-server-modifications-internalserverservergo","title":"2.5 Server Modifications (<code>internal/server/server.go</code>)","text":"<pre><code>// Run now accepts our Transport interface\nfunc (s *Server) Run(ctx context.Context, t transport.Transport) error {\n    log.Printf(\"Starting server with %s transport\", t.Name())\n    return t.Serve(ctx, s)\n}\n\n// HandleRequest implements transport.RequestHandler\nfunc (s *Server) HandleRequest(ctx context.Context, req *transport.Request) (*transport.Response, error) {\n    // Delegate to MCP SDK's request handling\n    return s.mcp.HandleRequest(ctx, req)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_1","title":"Verification Criteria","text":"<ul> <li>[ ] <code>metatools stdio</code> works identically to Phase 1</li> <li>[ ] <code>metatools serve --port 8080</code> starts SSE server</li> <li>[ ] SSE endpoint accepts POST requests at <code>/mcp</code></li> <li>[ ] Health check endpoints work (<code>/health</code>, <code>/ready</code>)</li> <li>[ ] CORS headers applied correctly</li> <li>[ ] Graceful shutdown on SIGTERM</li> <li>[ ] TLS works when configured</li> <li>[ ] Integration tests for SSE transport</li> <li>[ ] Load test: 100 concurrent SSE connections</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#cli-changes","title":"CLI Changes","text":"<pre><code># New serve command\nmetatools serve [flags]\n\nFlags:\n  --port int          HTTP port (default 8080)\n  --host string       Bind address (default \"0.0.0.0\")\n  --tls               Enable TLS\n  --cert string       TLS certificate path\n  --key string        TLS key path\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-3-tool-provider-registry","title":"Phase 3: Tool Provider Registry","text":"<p>Duration: ~1 week Priority: High (enables plug-and-play tools) Risk: Medium (refactors core registration logic) Depends on: Phase 1</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_2","title":"Objective","text":"<p>Replace hardcoded tool registration with a registry pattern that allows dynamic tool registration.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_2","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 provider/\n\u2502   \u251c\u2500\u2500 provider.go      # NEW: ToolProvider interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Tool registry\n\u2502   \u251c\u2500\u2500 search.go        # NEW: search_tools provider\n\u2502   \u251c\u2500\u2500 describe.go      # NEW: describe_tool provider\n\u2502   \u251c\u2500\u2500 run.go           # NEW: run_tool provider\n\u2502   \u251c\u2500\u2500 chain.go         # NEW: run_chain provider\n\u2502   \u251c\u2500\u2500 namespaces.go    # NEW: list_namespaces provider\n\u2502   \u251c\u2500\u2500 examples.go      # NEW: list_tool_examples provider\n\u2502   \u2514\u2500\u2500 code.go          # NEW: execute_code provider (optional)\n\u251c\u2500\u2500 server/\n\u2502   \u2514\u2500\u2500 server.go        # MODIFIED: Use provider registry\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_2","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#31-tool-provider-interface-internalproviderprovidergo","title":"3.1 Tool Provider Interface (<code>internal/provider/provider.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"context\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// ToolProvider defines a pluggable MCP tool\ntype ToolProvider interface {\n    // Name returns the tool name (e.g., \"search_tools\")\n    Name() string\n\n    // Tool returns the MCP tool definition with JSON schema\n    Tool() *mcp.Tool\n\n    // Handle executes the tool with the given input\n    Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error)\n}\n\n// Option configures a tool provider\ntype Option func(ToolProvider)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#32-tool-registry-internalproviderregistrygo","title":"3.2 Tool Registry (<code>internal/provider/registry.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// Registry manages registered tool providers\ntype Registry struct {\n    mu        sync.RWMutex\n    providers map[string]ToolProvider\n    order     []string // Maintains registration order\n}\n\n// NewRegistry creates a new tool provider registry\nfunc NewRegistry() *Registry {\n    return &amp;Registry{\n        providers: make(map[string]ToolProvider),\n        order:     make([]string, 0),\n    }\n}\n\n// Register adds a tool provider\nfunc (r *Registry) Register(p ToolProvider) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    name := p.Name()\n    if _, exists := r.providers[name]; exists {\n        return fmt.Errorf(\"provider already registered: %s\", name)\n    }\n\n    r.providers[name] = p\n    r.order = append(r.order, name)\n    return nil\n}\n\n// Get retrieves a provider by name\nfunc (r *Registry) Get(name string) (ToolProvider, bool) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n    p, ok := r.providers[name]\n    return p, ok\n}\n\n// All returns all registered providers in registration order\nfunc (r *Registry) All() []ToolProvider {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    result := make([]ToolProvider, 0, len(r.order))\n    for _, name := range r.order {\n        result = append(result, r.providers[name])\n    }\n    return result\n}\n\n// Tools returns MCP tool definitions for all providers\nfunc (r *Registry) Tools() []*mcp.Tool {\n    providers := r.All()\n    tools := make([]*mcp.Tool, 0, len(providers))\n    for _, p := range providers {\n        tools = append(tools, p.Tool())\n    }\n    return tools\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#33-example-provider-internalprovidersearchgo","title":"3.3 Example Provider (<code>internal/provider/search.go</code>)","text":"<pre><code>package provider\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/handlers\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// SearchProvider implements the search_tools tool\ntype SearchProvider struct {\n    handler *handlers.SearchHandler\n}\n\n// NewSearchProvider creates a search_tools provider\nfunc NewSearchProvider(h *handlers.SearchHandler) *SearchProvider {\n    return &amp;SearchProvider{handler: h}\n}\n\nfunc (p *SearchProvider) Name() string { return \"search_tools\" }\n\nfunc (p *SearchProvider) Tool() *mcp.Tool {\n    return &amp;mcp.Tool{\n        Name:        \"search_tools\",\n        Description: \"Search for tools by query string. Returns ranked list of matching tools.\",\n        InputSchema: mcp.ToolInputSchema{\n            Type: \"object\",\n            Properties: map[string]any{\n                \"query\": map[string]any{\n                    \"type\":        \"string\",\n                    \"description\": \"Search query to find relevant tools\",\n                },\n                \"limit\": map[string]any{\n                    \"type\":        \"integer\",\n                    \"description\": \"Maximum number of results (default 10)\",\n                    \"default\":     10,\n                },\n            },\n            Required: []string{\"query\"},\n        },\n    }\n}\n\nfunc (p *SearchProvider) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    query, _ := input[\"query\"].(string)\n    limit := 10\n    if l, ok := input[\"limit\"].(float64); ok {\n        limit = int(l)\n    }\n\n    return p.handler.Handle(ctx, query, limit)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#34-server-integration","title":"3.4 Server Integration","text":"<pre><code>// internal/server/server.go\n\nfunc New(cfg config.Config, registry *provider.Registry) (*Server, error) {\n    // ... existing validation\n\n    mcpServer := mcp.NewServer(&amp;mcp.Implementation{\n        Name:    implementationName,\n        Version: implementationVersion,\n    }, &amp;mcp.ServerOptions{\n        PageSize: defaultPageSize,\n    })\n\n    srv := &amp;Server{\n        config:   cfg,\n        mcp:      mcpServer,\n        registry: registry,\n    }\n\n    // Register tools from provider registry\n    for _, p := range registry.All() {\n        srv.registerProvider(p)\n    }\n\n    return srv, nil\n}\n\nfunc (s *Server) registerProvider(p provider.ToolProvider) {\n    tool := p.Tool()\n    s.tools = append(s.tools, tool)\n\n    s.mcp.AddTool(tool, func(ctx context.Context, req *mcp.CallToolRequest) (*mcp.CallToolResult, error) {\n        return p.Handle(ctx, req.Params.Arguments)\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_2","title":"Verification Criteria","text":"<ul> <li>[ ] All existing tools work via provider registry</li> <li>[ ] Provider registration order matches tool list order</li> <li>[ ] Custom providers can be registered programmatically</li> <li>[ ] Unit tests for registry (&gt;90% coverage)</li> <li>[ ] Benchmark: Registration of 100 providers &lt; 1ms</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-4-backend-registry","title":"Phase 4: Backend Registry","text":"<p>Duration: ~2 weeks Priority: Medium (enables multi-source tool aggregation) Risk: Medium (new subsystem) Depends on: Phase 3</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_3","title":"Objective","text":"<p>Implement a backend registry that aggregates tools from multiple sources (local, MCP servers, HTTP APIs).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_3","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 backend/\n\u2502   \u251c\u2500\u2500 backend.go       # NEW: Backend interface\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Backend registry\n\u2502   \u251c\u2500\u2500 local.go         # NEW: Local file backend\n\u2502   \u251c\u2500\u2500 mcp.go           # NEW: MCP subprocess backend\n\u2502   \u251c\u2500\u2500 http.go          # NEW: HTTP API backend\n\u2502   \u251c\u2500\u2500 aggregator.go    # NEW: Tool aggregation logic\n\u2502   \u2514\u2500\u2500 errors.go        # NEW: Backend-specific errors\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_3","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#41-backend-interface-internalbackendbackendgo","title":"4.1 Backend Interface (<code>internal/backend/backend.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/toolmodel\"\n)\n\n// Backend defines a source of tools\ntype Backend interface {\n    // Identity\n    Kind() string  // e.g., \"local\", \"mcp\", \"http\"\n    Name() string  // Instance name\n\n    // Lifecycle\n    Start(ctx context.Context) error\n    Stop() error\n\n    // Discovery\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n\n    // Execution\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Configurable backends support dynamic configuration\ntype Configurable interface {\n    Configure(raw []byte) error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#42-backend-registry-internalbackendregistrygo","title":"4.2 Backend Registry (<code>internal/backend/registry.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"sync\"\n)\n\n// Registry manages backend instances\ntype Registry struct {\n    mu       sync.RWMutex\n    backends map[string]Backend\n    order    []string\n}\n\n// NewRegistry creates a backend registry\nfunc NewRegistry() *Registry {\n    return &amp;Registry{\n        backends: make(map[string]Backend),\n        order:    make([]string, 0),\n    }\n}\n\n// Register adds a backend\nfunc (r *Registry) Register(name string, b Backend) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    if _, exists := r.backends[name]; exists {\n        return fmt.Errorf(\"backend already registered: %s\", name)\n    }\n\n    r.backends[name] = b\n    r.order = append(r.order, name)\n    return nil\n}\n\n// StartAll starts all registered backends\nfunc (r *Registry) StartAll(ctx context.Context) error {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    for name, b := range r.backends {\n        if err := b.Start(ctx); err != nil {\n            return fmt.Errorf(\"starting backend %s: %w\", name, err)\n        }\n    }\n    return nil\n}\n\n// StopAll stops all registered backends\nfunc (r *Registry) StopAll() error {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    var errs []error\n    for name, b := range r.backends {\n        if err := b.Stop(); err != nil {\n            errs = append(errs, fmt.Errorf(\"stopping backend %s: %w\", name, err))\n        }\n    }\n\n    if len(errs) &gt; 0 {\n        return fmt.Errorf(\"errors stopping backends: %v\", errs)\n    }\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#43-mcp-backend-internalbackendmcpgo","title":"4.3 MCP Backend (<code>internal/backend/mcp.go</code>)","text":"<pre><code>package backend\n\nimport (\n    \"context\"\n    \"os/exec\"\n\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\n// MCPBackend connects to an MCP subprocess\ntype MCPBackend struct {\n    name    string\n    command string\n    args    []string\n    env     map[string]string\n\n    cmd    *exec.Cmd\n    client *mcp.Client\n}\n\n// NewMCPBackend creates an MCP subprocess backend\nfunc NewMCPBackend(name, command string, args []string, env map[string]string) *MCPBackend {\n    return &amp;MCPBackend{\n        name:    name,\n        command: command,\n        args:    args,\n        env:     env,\n    }\n}\n\nfunc (b *MCPBackend) Kind() string { return \"mcp\" }\nfunc (b *MCPBackend) Name() string { return b.name }\n\nfunc (b *MCPBackend) Start(ctx context.Context) error {\n    // Start subprocess and establish MCP connection\n    // ... implementation\n}\n\nfunc (b *MCPBackend) ListTools(ctx context.Context) ([]toolmodel.Tool, error) {\n    resp, err := b.client.ListTools(ctx)\n    if err != nil {\n        return nil, err\n    }\n\n    // Convert MCP tools to toolmodel.Tool\n    tools := make([]toolmodel.Tool, 0, len(resp.Tools))\n    for _, t := range resp.Tools {\n        tools = append(tools, convertMCPTool(t, b.name))\n    }\n    return tools, nil\n}\n\nfunc (b *MCPBackend) Execute(ctx context.Context, tool string, args map[string]any) (any, error) {\n    return b.client.CallTool(ctx, tool, args)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_3","title":"Verification Criteria","text":"<ul> <li>[ ] Local backend loads tools from file paths</li> <li>[ ] MCP backend spawns subprocess and communicates via stdio</li> <li>[ ] HTTP backend calls remote API endpoints</li> <li>[ ] Tool aggregation merges tools from all backends</li> <li>[ ] Backend failures don't crash the server (graceful degradation)</li> <li>[ ] Integration tests for each backend type</li> <li>[ ] E2E test: GitHub MCP server integration</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#phase-5-middleware-chain","title":"Phase 5: Middleware Chain","text":"<p>Duration: ~2 weeks Priority: Low (nice-to-have for MVP) Risk: Low (additive feature) Depends on: Phase 3</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#objective_4","title":"Objective","text":"<p>Implement a middleware chain for cross-cutting concerns (logging, auth, rate limiting, metrics).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#directory-structure-changes_4","title":"Directory Structure Changes","text":"<pre><code>internal/\n\u251c\u2500\u2500 middleware/\n\u2502   \u251c\u2500\u2500 middleware.go    # NEW: Middleware interface\n\u2502   \u251c\u2500\u2500 chain.go         # NEW: Middleware chain builder\n\u2502   \u251c\u2500\u2500 registry.go      # NEW: Middleware registry\n\u2502   \u251c\u2500\u2500 logging.go       # NEW: Logging middleware\n\u2502   \u251c\u2500\u2500 auth.go          # NEW: Auth middleware\n\u2502   \u251c\u2500\u2500 ratelimit.go     # NEW: Rate limiting middleware\n\u2502   \u251c\u2500\u2500 metrics.go       # NEW: Metrics middleware\n\u2502   \u251c\u2500\u2500 cache.go         # NEW: Caching middleware\n\u2502   \u2514\u2500\u2500 validation.go    # NEW: Input validation middleware\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#implementation-tasks_4","title":"Implementation Tasks","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#51-middleware-interface-internalmiddlewaremiddlewarego","title":"5.1 Middleware Interface (<code>internal/middleware/middleware.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"context\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n)\n\n// Middleware wraps a ToolProvider with additional behavior\ntype Middleware func(provider.ToolProvider) provider.ToolProvider\n\n// Factory creates a configured middleware instance\ntype Factory func(cfg Config) (Middleware, error)\n\n// Config holds middleware-specific configuration\ntype Config struct {\n    Name    string\n    Enabled bool\n    Raw     map[string]any\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#52-middleware-chain-internalmiddlewarechaingo","title":"5.2 Middleware Chain (<code>internal/middleware/chain.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n)\n\n// Chain applies middleware to providers in order\nfunc Chain(middlewares []Middleware, p provider.ToolProvider) provider.ToolProvider {\n    if len(middlewares) == 0 {\n        return p\n    }\n\n    // Apply in reverse order so first middleware wraps outermost\n    wrapped := p\n    for i := len(middlewares) - 1; i &gt;= 0; i-- {\n        wrapped = middlewares[i](wrapped)\n    }\n    return wrapped\n}\n\n// ApplyToRegistry wraps all providers in a registry with middleware\nfunc ApplyToRegistry(registry *provider.Registry, middlewares []Middleware) {\n    for _, p := range registry.All() {\n        wrapped := Chain(middlewares, p)\n        // Replace in registry\n        // ...\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#53-logging-middleware-internalmiddlewarelogginggo","title":"5.3 Logging Middleware (<code>internal/middleware/logging.go</code>)","text":"<pre><code>package middleware\n\nimport (\n    \"context\"\n    \"log/slog\"\n    \"time\"\n\n    \"github.com/jonwraymond/metatools-mcp/internal/provider\"\n    \"github.com/modelcontextprotocol/go-sdk/mcp\"\n)\n\ntype loggingMiddleware struct {\n    next   provider.ToolProvider\n    logger *slog.Logger\n    level  slog.Level\n}\n\n// NewLoggingMiddleware creates a logging middleware\nfunc NewLoggingMiddleware(logger *slog.Logger, level slog.Level) Middleware {\n    return func(next provider.ToolProvider) provider.ToolProvider {\n        return &amp;loggingMiddleware{\n            next:   next,\n            logger: logger,\n            level:  level,\n        }\n    }\n}\n\nfunc (m *loggingMiddleware) Name() string        { return m.next.Name() }\nfunc (m *loggingMiddleware) Tool() *mcp.Tool     { return m.next.Tool() }\n\nfunc (m *loggingMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    start := time.Now()\n\n    m.logger.Log(ctx, m.level, \"tool call started\",\n        \"tool\", m.next.Name(),\n        \"input\", input,\n    )\n\n    result, err := m.next.Handle(ctx, input)\n\n    m.logger.Log(ctx, m.level, \"tool call completed\",\n        \"tool\", m.next.Name(),\n        \"duration\", time.Since(start),\n        \"error\", err,\n    )\n\n    return result, err\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#verification-criteria_4","title":"Verification Criteria","text":"<ul> <li>[ ] Logging middleware logs all tool calls</li> <li>[ ] Auth middleware validates tokens when configured</li> <li>[ ] Rate limiting middleware enforces limits</li> <li>[ ] Metrics middleware exposes Prometheus metrics</li> <li>[ ] Middleware chain order matches config order</li> <li>[ ] Unit tests for each middleware type</li> <li>[ ] Integration test: Full middleware chain</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#summary-implementation-priority-matrix","title":"Summary: Implementation Priority Matrix","text":"Phase Priority Risk Duration MVP? Phase 1: CLI + Config Critical Low 2 weeks \u2713 Phase 2: Transport High Medium 2 weeks \u2713 Phase 3: Tool Provider Registry High Medium 1 week \u2713 Phase 4: Backend Registry Medium Medium 2 weeks Phase 5: Middleware Chain Low Low 2 weeks <p>MVP Timeline: ~5 weeks (Phases 1-3) Full Implementation: ~9 weeks (All phases)</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#appendix-architectural-decisions","title":"Appendix: Architectural Decisions","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-1-koanf-over-viper","title":"Decision 1: Koanf over Viper","text":"<p>Decision: Use Koanf for configuration loading instead of Viper.</p> <p>Rationale: - Lighter dependency footprint - Modular provider architecture - Cleaner API for layered configuration - Better suited for our use case</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-2-interface-based-transports-over-mcp-sdk-extension","title":"Decision 2: Interface-based Transports over MCP SDK Extension","text":"<p>Decision: Define our own Transport interface that wraps MCP SDK transports.</p> <p>Rationale: - Decouples from MCP SDK implementation details - Enables custom transports (Unix socket, gRPC) - Allows consistent lifecycle management - Facilitates testing with mock transports</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-3-provider-pattern-over-direct-handler-registration","title":"Decision 3: Provider Pattern over Direct Handler Registration","text":"<p>Decision: Use ToolProvider interface instead of direct MCP tool registration.</p> <p>Rationale: - Enables middleware wrapping - Supports dynamic registration - Cleaner separation of concerns - Facilitates testing</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#decision-4-decorator-pattern-for-middleware","title":"Decision 4: Decorator Pattern for Middleware","text":"<p>Decision: Use decorator pattern (wrapping) for middleware chain.</p> <p>Rationale: - Matches go-chi's proven approach - Simple mental model - Easy to compose and test - Preserves ToolProvider interface</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/implementation-phases/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial draft with 5 phases"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/","title":"MCP Spec Alignment Proposal","text":"<p>Status: Draft Date: 2026-01-28 Related: pluggable-architecture, architecture-evaluation, ROADMAP</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#summary","title":"Summary","text":"<p><code>metatools-mcp</code> already exposes a clean MCP-native tool surface, but several MCP-spec features are only partially covered or are not yet surfaced at the server boundary. This proposal defines a focused alignment path with the latest MCP spec (2025-11-25) and the official Go SDK, while keeping the current tool-first architecture stable.</p> <p>The goal is to improve protocol completeness and operational correctness without redesigning the existing libraries.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#goals","title":"Goals","text":"<ol> <li>Spec compliance at the server edge: align handler behavior with MCP method contracts (tools list, tool calls, tool error semantics, pagination).</li> <li>Dynamic tool updates: support <code>tools/list_changed</code> notifications tied to toolindex change events.</li> <li>Operational robustness: ensure cancellation/progress signals propagate through toolrun and toolruntime where supported.</li> <li>Clear expansion path for MCP resources and prompts without blocking current tool-focused roadmap.</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#observations-current-state","title":"Observations (Current State)","text":"<ul> <li><code>metatools-mcp</code> exposes MCP tools via the official Go SDK and maps errors into MCP tool error payloads.</li> <li>Tool schemas are derived from <code>toolmodel</code> and remain MCP-native, preserving compatibility end-to-end.</li> <li>Tool registration is static at startup; runtime updates now emit <code>tools/list_changed</code> via toolindex change notifications (debounced and optionally disabled).</li> <li>Resources and prompts are not yet part of the metatools surface.</li> <li>Cancellation behavior now propagates via <code>context.Context</code>; progress notifications are emitted when a progress token is supplied, with step-level updates when the runner supports them.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#mcp-spec-alignment-targets","title":"MCP Spec Alignment Targets","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#1-tool-list-change-notifications","title":"1) Tool list change notifications","text":"<p>When tool availability changes (new tools, removed tools, updated schemas), the MCP server should notify connected clients via <code>notifications/tools/list_changed</code>. This can be wired to <code>toolindex</code> change callbacks.</p> <p>Implementation idea: - Subscribe to toolindex OnChange/Refresh hooks. - Emit <code>tools/list_changed</code> to all MCP sessions. - Expose a config flag + debounce window to disable or dampen notifications for static deployments.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#2-pagination-and-list-contracts","title":"2) Pagination and list contracts","text":"<p>The MCP spec defines <code>tools/list</code> pagination and page sizes. <code>metatools-mcp</code> already sets a default page size in the Go SDK; align <code>search_tools</code> and <code>list_namespaces</code> with consistent paging semantics and cursor shapes.</p> <p>Implementation idea: - Cap and validate list size consistently. - Use stable cursor generation (opaque tokens with validation) for pagination of search results and namespace listing.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#3-cancellation-and-progress-signals","title":"3) Cancellation and progress signals","text":"<p>MCP supports cancellation and progress notifications for long-running operations. For <code>run_tool</code>, <code>run_chain</code>, and <code>execute_code</code>, cancellation should be propagated to toolrun/toolruntime if supported.</p> <p>Implementation idea: - Use <code>ctx</code> cancellation to interrupt tool execution. - Surface progress events from toolruntime or toolrun (where available). - When progress events are unavailable, emit coarse start/end progress notifications.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#4-resources-and-prompts-expansion-future-prd","title":"4) Resources and prompts expansion (future PRD)","text":"<p>MCP defines resources and prompts alongside tools. The architecture should leave a clear integration path (e.g., new <code>toolresource</code> and <code>toolprompt</code> libraries or adapters in metatools-mcp).</p> <p>Implementation idea: - Draft a separate PRD to introduce a resources/prompt provider interface. - Keep current tool-only server behavior stable and backwards compatible.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#corrected-assumptions","title":"Corrected Assumptions","text":"<ul> <li>MCP versioning: target 2025-11-25 as the default protocol version in metatools-mcp and toolmodel. Back-compat shims should be explicit rather than implicit.</li> <li>Go SDK alignment: the official MCP Go SDK should be pinned to a version that explicitly supports the 2025-11-25 spec and its tool schema fields (icons, outputSchema, etc.).</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#risks","title":"Risks","text":"<ul> <li>Notification spam: emitting list change notifications on every small index update could overwhelm clients. Mitigate with debouncing.</li> <li>Partial cancellation support: some backends may not support cancellation; document and expose that limitation.</li> <li>Scope creep: adding resources/prompts too early could delay core tool stability; keep those as a later PRD.</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#recommended-next-steps","title":"Recommended Next Steps","text":"<ol> <li>Implement tool list change notifications tied to toolindex changes.</li> <li>Ensure pagination and cursor semantics are consistent across tool listing and search.</li> <li>Add cancellation/progress wiring and document limitations.</li> <li>Create a dedicated PRD for resources/prompts support.</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/mcp-spec-alignment/#appendix-related-prd","title":"Appendix: Related PRD","text":"<p>See <code>docs/plans/2026-01-28-prd-015-mcp-spec-alignment.md</code> for an incremental implementation plan.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/","title":"Multi-Tenancy Extension for Pluggable Architecture","text":"<p>Status: Draft Date: 2026-01-28 Related: Pluggable Architecture Proposal</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#overview","title":"Overview","text":"<p>This document extends the pluggable architecture to support multi-tenancy in a flexible, pluggable way. The design allows different tenant isolation strategies without hardcoding any specific approach.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenancy-architecture","title":"Multi-Tenancy Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#design-principles","title":"Design Principles","text":"<ol> <li>Pluggable Tenant Resolution - How tenants are identified (JWT, API key, header, etc.)</li> <li>Pluggable Isolation Strategy - Level of isolation between tenants</li> <li>Tenant-Aware Middleware - All middleware can access tenant context</li> <li>Tenant-Specific Configuration - Override any config per tenant</li> <li>Backward Compatible - Single-tenant mode works without changes</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       MULTI-TENANT MCP SERVER                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Incoming Request                                                           \u2502\n\u2502         \u2502                                                                     \u2502\n\u2502         \u25bc                                                                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT RESOLUTION MIDDLEWARE                      \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502    JWT      \u2502 \u2502   API Key   \u2502 \u2502   Header    \u2502 \u2502   Custom    \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502  Resolver   \u2502 \u2502  Resolver   \u2502 \u2502  Resolver   \u2502 \u2502  Resolver   \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Output: Tenant Context injected into request context               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                             \u2502                                                \u2502\n\u2502                             \u25bc                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT-AWARE MIDDLEWARE CHAIN                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502   \u2502   \u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502\u2192\u2502 Tenant   \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502 Scoped   \u2502 \u2502 Rate     \u2502 \u2502 Audit    \u2502 \u2502 Tool     \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502 Config   \u2502 \u2502 Limits   \u2502 \u2502 Logging  \u2502 \u2502 Filter   \u2502               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                             \u2502                                                \u2502\n\u2502                             \u25bc                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT-SCOPED REGISTRIES                          \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502   \u2502\n\u2502   \u2502   \u2502  Shared Registry \u2502    \u2502  Tenant Registry \u2502                      \u2502   \u2502\n\u2502   \u2502   \u2502  (all tenants)   \u2502    \u2502  (tenant-only)   \u2502                      \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Tool visibility = Shared \u222a Tenant-specific - Denied               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#core-interfaces","title":"Core Interfaces","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-model","title":"Tenant Model","text":"<pre><code>// Tenant represents a tenant in the system\ntype Tenant struct {\n    ID          string            // Unique tenant identifier\n    Name        string            // Human-readable name\n    Tier        TenantTier        // free, pro, enterprise\n    Metadata    map[string]any    // Arbitrary tenant metadata\n    CreatedAt   time.Time\n    UpdatedAt   time.Time\n}\n\n// TenantTier defines service levels\ntype TenantTier string\n\nconst (\n    TenantTierFree       TenantTier = \"free\"\n    TenantTierPro        TenantTier = \"pro\"\n    TenantTierEnterprise TenantTier = \"enterprise\"\n)\n\n// TenantContext holds runtime tenant information\ntype TenantContext struct {\n    Tenant      *Tenant\n    Permissions []string          // Resolved permissions\n    Config      *TenantConfig     // Tenant-specific config overrides\n    Quotas      *TenantQuotas     // Current quota state\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-resolver-interface","title":"Tenant Resolver Interface","text":"<pre><code>// TenantResolver identifies the tenant from a request\ntype TenantResolver interface {\n    // Resolve extracts tenant information from the request context\n    // Returns nil tenant for anonymous/default tenant\n    Resolve(ctx context.Context, req *Request) (*TenantContext, error)\n}\n\n// TenantResolverFunc is a convenience type\ntype TenantResolverFunc func(ctx context.Context, req *Request) (*TenantContext, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#built-in-resolvers","title":"Built-in Resolvers","text":"<pre><code>// JWTTenantResolver extracts tenant from JWT claims\ntype JWTTenantResolver struct {\n    ClaimKey    string                    // JWT claim containing tenant ID\n    TenantStore TenantStore               // Lookup tenant details\n    Validator   JWTValidator              // Validate JWT\n}\n\nfunc (r *JWTTenantResolver) Resolve(ctx context.Context, req *Request) (*TenantContext, error) {\n    token := extractBearerToken(req)\n    claims, err := r.Validator.Validate(token)\n    if err != nil {\n        return nil, err\n    }\n\n    tenantID, ok := claims[r.ClaimKey].(string)\n    if !ok {\n        return nil, ErrNoTenantClaim\n    }\n\n    tenant, err := r.TenantStore.Get(ctx, tenantID)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;TenantContext{\n        Tenant:      tenant,\n        Permissions: extractPermissions(claims),\n        Config:      r.TenantStore.GetConfig(ctx, tenantID),\n    }, nil\n}\n\n// APIKeyTenantResolver extracts tenant from API key\ntype APIKeyTenantResolver struct {\n    HeaderName  string       // Header containing API key\n    KeyStore    APIKeyStore  // Lookup key -&gt; tenant mapping\n}\n\n// HeaderTenantResolver extracts tenant from a header\ntype HeaderTenantResolver struct {\n    HeaderName  string\n    TenantStore TenantStore\n}\n\n// CompositeTenantResolver tries multiple resolvers in order\ntype CompositeTenantResolver struct {\n    Resolvers []TenantResolver\n}\n\nfunc (r *CompositeTenantResolver) Resolve(ctx context.Context, req *Request) (*TenantContext, error) {\n    for _, resolver := range r.Resolvers {\n        tc, err := resolver.Resolve(ctx, req)\n        if err == nil &amp;&amp; tc != nil {\n            return tc, nil\n        }\n    }\n    return nil, ErrNoTenantResolved\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-configuration","title":"Tenant Configuration","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-specific-config-overrides","title":"Tenant-Specific Config Overrides","text":"<pre><code>// TenantConfig holds per-tenant configuration overrides\ntype TenantConfig struct {\n    // Tool access control\n    AllowedTools     []string          // Whitelist (empty = all allowed)\n    DeniedTools      []string          // Blacklist (takes precedence)\n    AllowedBackends  []string          // Which backends tenant can use\n    DeniedBackends   []string          // Blacklisted backends\n\n    // Resource limits\n    RateLimits       *RateLimitConfig  // Override rate limits\n    Quotas           *QuotaConfig      // Usage quotas\n\n    // Feature flags\n    Features         map[string]bool   // Feature toggles\n\n    // Execution\n    MaxTimeout       time.Duration     // Max allowed timeout\n    MaxChainSteps    int               // Max chain steps\n    MaxToolCalls     int               // Max tool calls per request\n\n    // Custom middleware config\n    MiddlewareConfig map[string]any    // Per-middleware overrides\n}\n\n// QuotaConfig defines usage quotas\ntype QuotaConfig struct {\n    DailyRequests    int64             // Requests per day\n    DailyToolCalls   int64             // Tool calls per day\n    MonthlyRequests  int64             // Requests per month\n    MonthlyToolCalls int64             // Tool calls per month\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<pre><code># metatools.yaml - Multi-tenant configuration\n\ntenancy:\n  enabled: true\n\n  # Tenant resolution strategy\n  resolver:\n    type: composite\n    resolvers:\n      - type: jwt\n        claim_key: tenant_id\n        issuer: https://auth.example.com\n      - type: api_key\n        header: X-API-Key\n      - type: header\n        header: X-Tenant-ID\n\n  # Default tenant (anonymous requests)\n  default_tenant:\n    id: default\n    tier: free\n    config:\n      rate_limits:\n        requests_per_minute: 10\n      allowed_tools:\n        - search_tools\n        - describe_tool\n      denied_tools:\n        - execute_code\n\n  # Tier-based defaults\n  tiers:\n    free:\n      rate_limits:\n        requests_per_minute: 60\n        burst: 10\n      quotas:\n        daily_requests: 1000\n        monthly_requests: 10000\n      denied_tools:\n        - execute_code\n      max_chain_steps: 3\n\n    pro:\n      rate_limits:\n        requests_per_minute: 300\n        burst: 50\n      quotas:\n        daily_requests: 10000\n        monthly_requests: 100000\n      max_chain_steps: 10\n\n    enterprise:\n      rate_limits:\n        requests_per_minute: 1000\n        burst: 200\n      quotas:\n        daily_requests: -1  # unlimited\n        monthly_requests: -1\n      max_chain_steps: 50\n      features:\n        custom_backends: true\n        audit_logging: true\n\n# Per-tenant overrides (loaded from store or config)\ntenants:\n  acme-corp:\n    tier: enterprise\n    config:\n      allowed_backends:\n        - local\n        - github\n        - jira\n      features:\n        execute_code: true\n      middleware_config:\n        audit:\n          destination: elasticsearch\n          index: acme-audit\n\n  startup-xyz:\n    tier: pro\n    config:\n      rate_limits:\n        requests_per_minute: 500  # Override pro default\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-aware-middleware","title":"Tenant-Aware Middleware","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-context-middleware","title":"Tenant Context Middleware","text":"<pre><code>// TenantMiddleware resolves and injects tenant context\nfunc TenantMiddleware(resolver TenantResolver) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        return &amp;tenantMiddleware{\n            resolver: resolver,\n            next:     next,\n        }\n    }\n}\n\ntype tenantMiddleware struct {\n    resolver TenantResolver\n    next     ToolProvider\n}\n\nfunc (m *tenantMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    // Resolve tenant from context (set by transport layer)\n    req := RequestFromContext(ctx)\n    tc, err := m.resolver.Resolve(ctx, req)\n    if err != nil {\n        return nil, &amp;TenantError{Op: \"resolve\", Err: err}\n    }\n\n    // Inject tenant context\n    ctx = WithTenantContext(ctx, tc)\n\n    return m.next.Handle(ctx, input)\n}\n\n// Context helpers\nfunc WithTenantContext(ctx context.Context, tc *TenantContext) context.Context\nfunc TenantFromContext(ctx context.Context) *TenantContext\nfunc TenantIDFromContext(ctx context.Context) string\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-aware-rate-limiting","title":"Tenant-Aware Rate Limiting","text":"<pre><code>// TenantRateLimitMiddleware applies per-tenant rate limits\ntype TenantRateLimitMiddleware struct {\n    store    RateLimitStore\n    defaults RateLimitConfig\n    next     ToolProvider\n}\n\nfunc (m *TenantRateLimitMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n\n    // Get tenant-specific limits or tier defaults\n    limits := m.resolveLimits(tc)\n\n    // Check rate limit\n    key := fmt.Sprintf(\"tenant:%s:tool:%s\", tc.Tenant.ID, m.next.Name())\n    allowed, err := m.store.Allow(ctx, key, limits)\n    if err != nil {\n        return nil, err\n    }\n    if !allowed {\n        return nil, &amp;RateLimitError{\n            TenantID: tc.Tenant.ID,\n            Limit:    limits.RequestsPerMinute,\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-tool-filter","title":"Tenant Tool Filter","text":"<pre><code>// TenantToolFilterMiddleware filters tools based on tenant permissions\ntype TenantToolFilterMiddleware struct {\n    next ToolProvider\n}\n\nfunc (m *TenantToolFilterMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n    toolName := m.next.Name()\n\n    // Check denied tools first (takes precedence)\n    if slices.Contains(tc.Config.DeniedTools, toolName) {\n        return nil, &amp;ToolDeniedError{\n            TenantID: tc.Tenant.ID,\n            Tool:     toolName,\n            Reason:   \"tool denied for tenant\",\n        }\n    }\n\n    // Check allowed tools (if whitelist is non-empty)\n    if len(tc.Config.AllowedTools) &gt; 0 {\n        if !slices.Contains(tc.Config.AllowedTools, toolName) {\n            return nil, &amp;ToolDeniedError{\n                TenantID: tc.Tenant.ID,\n                Tool:     toolName,\n                Reason:   \"tool not in allowed list\",\n            }\n        }\n    }\n\n    return m.next.Handle(ctx, input)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-audit-middleware","title":"Tenant Audit Middleware","text":"<pre><code>// TenantAuditMiddleware logs all actions with tenant context\ntype TenantAuditMiddleware struct {\n    logger AuditLogger\n    next   ToolProvider\n}\n\nfunc (m *TenantAuditMiddleware) Handle(ctx context.Context, input map[string]any) (*mcp.CallToolResult, error) {\n    tc := TenantFromContext(ctx)\n    start := time.Now()\n\n    result, err := m.next.Handle(ctx, input)\n\n    m.logger.Log(AuditEntry{\n        Timestamp:  time.Now(),\n        TenantID:   tc.Tenant.ID,\n        TenantTier: string(tc.Tenant.Tier),\n        Tool:       m.next.Name(),\n        Input:      input,\n        Success:    err == nil,\n        Duration:   time.Since(start),\n        RequestID:  RequestIDFromContext(ctx),\n        UserID:     UserIDFromContext(ctx),\n    })\n\n    return result, err\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-scoped-registries","title":"Tenant-Scoped Registries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenant-tool-registry","title":"Multi-Tenant Tool Registry","text":"<pre><code>// MultiTenantRegistry wraps a base registry with tenant scoping\ntype MultiTenantRegistry struct {\n    shared        *provider.Registry  // Shared tools (all tenants)\n    tenantTools   map[string]*provider.Registry  // Tenant-specific tools\n    tenantStore   TenantStore\n    mu            sync.RWMutex\n}\n\n// GetForTenant returns a tenant-scoped view of the registry\nfunc (r *MultiTenantRegistry) GetForTenant(tenantID string) *TenantScopedRegistry {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    tenant, _ := r.tenantStore.Get(context.Background(), tenantID)\n    tenantReg := r.tenantTools[tenantID]\n\n    return &amp;TenantScopedRegistry{\n        tenant:   tenant,\n        shared:   r.shared,\n        specific: tenantReg,\n    }\n}\n\n// TenantScopedRegistry provides a tenant's view of available tools\ntype TenantScopedRegistry struct {\n    tenant   *Tenant\n    shared   *provider.Registry\n    specific *provider.Registry\n}\n\n// All returns all tools visible to the tenant\nfunc (r *TenantScopedRegistry) All() []provider.ToolProvider {\n    var result []provider.ToolProvider\n\n    // Add shared tools (filtered by tenant config)\n    for _, p := range r.shared.All() {\n        if r.isToolAllowed(p.Name()) {\n            result = append(result, p)\n        }\n    }\n\n    // Add tenant-specific tools\n    if r.specific != nil {\n        result = append(result, r.specific.All()...)\n    }\n\n    return result\n}\n\nfunc (r *TenantScopedRegistry) isToolAllowed(name string) bool {\n    if r.tenant == nil || r.tenant.Config == nil {\n        return true\n    }\n\n    cfg := r.tenant.Config\n\n    // Check denied list first\n    if slices.Contains(cfg.DeniedTools, name) {\n        return false\n    }\n\n    // Check allowed list (if specified)\n    if len(cfg.AllowedTools) &gt; 0 {\n        return slices.Contains(cfg.AllowedTools, name)\n    }\n\n    return true\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#multi-tenant-backend-registry","title":"Multi-Tenant Backend Registry","text":"<pre><code>// MultiTenantBackendRegistry manages tenant-scoped backends\ntype MultiTenantBackendRegistry struct {\n    shared        *backend.Registry\n    tenantBackends map[string]*backend.Registry\n    mu            sync.RWMutex\n}\n\n// GetForTenant returns backends available to a tenant\nfunc (r *MultiTenantBackendRegistry) GetForTenant(ctx context.Context, tenantID string) *TenantScopedBackendRegistry {\n    tc := TenantFromContext(ctx)\n\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    return &amp;TenantScopedBackendRegistry{\n        tenant:   tc,\n        shared:   r.shared,\n        specific: r.tenantBackends[tenantID],\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#isolation-strategies","title":"Isolation Strategies","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-1-shared-infrastructure-default","title":"Strategy 1: Shared Infrastructure (Default)","text":"<p>All tenants share the same server instance with logical isolation via middleware.</p> <pre><code>tenancy:\n  isolation: shared\n  # All tenants use same tool/backend registries\n  # Isolation via rate limits, tool filtering, audit logging\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    SHARED INFRASTRUCTURE                          \u2502\n\u2502                                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502\n\u2502   \u2502Tenant A \u2502 \u2502Tenant B \u2502 \u2502Tenant C \u2502                           \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502        \u2502           \u2502           \u2502                                 \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                 \u2502\n\u2502                    \u2502                                              \u2502\n\u2502                    \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502              SHARED MCP SERVER INSTANCE                  \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2502   Tenant Middleware \u2192 Tool Filter \u2192 Rate Limit \u2192 Audit   \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2502   Shared Tool Registry + Tenant Configs                  \u2502   \u2502\n\u2502   \u2502                                                           \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-2-namespace-isolation","title":"Strategy 2: Namespace Isolation","text":"<p>Tenants have isolated namespaces within shared infrastructure.</p> <pre><code>tenancy:\n  isolation: namespace\n  # Each tenant gets own tool namespace prefix\n  # Tenant A sees: tenant-a:*, shared:*\n  # Tenant B sees: tenant-b:*, shared:*\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    NAMESPACE ISOLATION                            \u2502\n\u2502                                                                   \u2502\n\u2502   Tenant A View:              Tenant B View:                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502   \u2502 shared:*        \u2502        \u2502 shared:*        \u2502                \u2502\n\u2502   \u2502 tenant-a:*      \u2502        \u2502 tenant-b:*      \u2502                \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                                                                   \u2502\n\u2502   Backend Routing:                                               \u2502\n\u2502   shared:* \u2192 Shared backends                                     \u2502\n\u2502   tenant-a:* \u2192 Tenant A's backends                              \u2502\n\u2502   tenant-b:* \u2192 Tenant B's backends                              \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#strategy-3-process-isolation","title":"Strategy 3: Process Isolation","text":"<p>Each tenant gets a dedicated server process.</p> <pre><code>tenancy:\n  isolation: process\n  # Tenant requests routed to dedicated processes\n  # Maximum isolation, higher resource usage\n</code></pre> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    PROCESS ISOLATION                              \u2502\n\u2502                                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502  Tenant A   \u2502        \u2502  Tenant B   \u2502        \u2502  Tenant C   \u2502 \u2502\n\u2502   \u2502   Process   \u2502        \u2502   Process   \u2502        \u2502   Process   \u2502 \u2502\n\u2502   \u2502             \u2502        \u2502             \u2502        \u2502             \u2502 \u2502\n\u2502   \u2502 Own config  \u2502        \u2502 Own config  \u2502        \u2502 Own config  \u2502 \u2502\n\u2502   \u2502 Own tools   \u2502        \u2502 Own tools   \u2502        \u2502 Own tools   \u2502 \u2502\n\u2502   \u2502 Own backends\u2502        \u2502 Own backends\u2502        \u2502 Own backends\u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502          \u2502                      \u2502                      \u2502         \u2502\n\u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                              \u2502                                    \u2502\n\u2502                              \u25bc                                    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    TENANT ROUTER                         \u2502   \u2502\n\u2502   \u2502          (Load balancer / API Gateway)                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenant-storage","title":"Tenant Storage","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#tenantstore-interface","title":"TenantStore Interface","text":"<pre><code>// TenantStore manages tenant data\ntype TenantStore interface {\n    // CRUD\n    Get(ctx context.Context, id string) (*Tenant, error)\n    Create(ctx context.Context, tenant *Tenant) error\n    Update(ctx context.Context, tenant *Tenant) error\n    Delete(ctx context.Context, id string) error\n    List(ctx context.Context, opts ListOptions) ([]*Tenant, error)\n\n    // Config\n    GetConfig(ctx context.Context, id string) (*TenantConfig, error)\n    UpdateConfig(ctx context.Context, id string, cfg *TenantConfig) error\n\n    // Quotas\n    GetQuotaUsage(ctx context.Context, id string) (*QuotaUsage, error)\n    IncrementUsage(ctx context.Context, id string, metric string, delta int64) error\n}\n\n// Built-in implementations\ntype MemoryTenantStore struct { ... }      // For testing/development\ntype RedisTenantStore struct { ... }       // For distributed deployments\ntype PostgresTenantStore struct { ... }    // For persistent storage\ntype ConfigFileTenantStore struct { ... }  // For static configuration\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#end-to-end-example","title":"End-to-End Example","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#enterprise-saas-configuration","title":"Enterprise SaaS Configuration","text":"<pre><code># metatools-saas.yaml\n\nserver:\n  name: \"metatools-saas\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    port: 8080\n\ntenancy:\n  enabled: true\n\n  resolver:\n    type: composite\n    resolvers:\n      - type: jwt\n        issuer: https://auth.saas.example.com\n        claim_key: org_id\n      - type: api_key\n        header: X-API-Key\n\n  store:\n    type: postgres\n    postgres:\n      connection_string: ${DATABASE_URL}\n\n  isolation: shared\n\n  tiers:\n    free:\n      rate_limits:\n        requests_per_minute: 30\n      quotas:\n        daily_requests: 500\n      denied_tools:\n        - execute_code\n        - run_chain\n\n    startup:\n      rate_limits:\n        requests_per_minute: 120\n      quotas:\n        daily_requests: 5000\n      max_chain_steps: 5\n\n    enterprise:\n      rate_limits:\n        requests_per_minute: 1000\n      quotas:\n        daily_requests: -1\n      features:\n        custom_backends: true\n        dedicated_support: true\n\nmiddleware:\n  chain:\n    - tenant          # Resolve tenant first\n    - tenant_config   # Load tenant-specific config\n    - tenant_filter   # Filter tools by tenant permissions\n    - tenant_rate_limit\n    - tenant_quota\n    - tenant_audit\n    - logging\n    - metrics\n\nbackends:\n  shared:\n    github:\n      enabled: true\n      kind: mcp\n      config:\n        command: npx\n        args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n\n    filesystem:\n      enabled: true\n      kind: mcp\n      config:\n        command: npx\n        args: [\"-y\", \"@modelcontextprotocol/server-filesystem\"]\n\n  # Enterprise tenants can have custom backends\n  # Loaded from tenant config in database\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#request-flow","title":"Request Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    MULTI-TENANT REQUEST FLOW                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   1. INCOMING REQUEST                                                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  POST /mcp HTTP/1.1                                                 \u2502   \u2502\n\u2502   \u2502  Authorization: Bearer eyJhbGc...                                  \u2502   \u2502\n\u2502   \u2502  X-API-Key: key_abc123 (fallback)                                  \u2502   \u2502\n\u2502   \u2502                                                                     \u2502   \u2502\n\u2502   \u2502  { \"method\": \"tools/call\", \"params\": { \"name\": \"github/...\" } }   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   2. TENANT RESOLUTION                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  JWT Resolver:                                                      \u2502   \u2502\n\u2502   \u2502  - Validate token                                                   \u2502   \u2502\n\u2502   \u2502  - Extract org_id: \"acme-corp\"                                     \u2502   \u2502\n\u2502   \u2502  - Load tenant from store                                          \u2502   \u2502\n\u2502   \u2502  - Inject TenantContext into ctx                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502   TenantContext:                     \u2502                                       \u2502\n\u2502   - ID: \"acme-corp\"                  \u2502                                       \u2502\n\u2502   - Tier: \"enterprise\"               \u2502                                       \u2502\n\u2502   - Config: { allowed_backends: [...], features: {...} }                    \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   3. TENANT TOOL FILTER                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Check: Is \"github/create_issue\" allowed for acme-corp?            \u2502   \u2502\n\u2502   \u2502  - Not in denied_tools \u2713                                           \u2502   \u2502\n\u2502   \u2502  - github backend is in allowed_backends \u2713                         \u2502   \u2502\n\u2502   \u2502  \u2192 ALLOWED                                                          \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   4. TENANT RATE LIMIT                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Key: \"tenant:acme-corp:tool:github/create_issue\"                  \u2502   \u2502\n\u2502   \u2502  Limit: 1000 req/min (enterprise tier)                             \u2502   \u2502\n\u2502   \u2502  Current: 42 \u2192 ALLOWED                                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   5. EXECUTION (with tenant context)                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Route to: github backend                                          \u2502   \u2502\n\u2502   \u2502  Execute: create_issue                                             \u2502   \u2502\n\u2502   \u2502  Tenant-scoped audit log written                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                      \u2502                                       \u2502\n\u2502                                      \u25bc                                       \u2502\n\u2502   6. RESPONSE                                                                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  { \"result\": { \"issue_number\": 456 }, \"id\": \"req-123\" }           \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#implementation-priority","title":"Implementation Priority","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-1-core-multi-tenancy-2-weeks","title":"Phase 1: Core Multi-Tenancy (2 weeks)","text":"<ol> <li>Define <code>Tenant</code>, <code>TenantContext</code>, <code>TenantConfig</code> types</li> <li>Implement <code>TenantResolver</code> interface + JWT/API Key resolvers</li> <li>Implement <code>TenantMiddleware</code> for context injection</li> <li>Add <code>TenantFromContext()</code> helper</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-2-tenant-aware-middleware-1-week","title":"Phase 2: Tenant-Aware Middleware (1 week)","text":"<ol> <li>Implement <code>TenantRateLimitMiddleware</code></li> <li>Implement <code>TenantToolFilterMiddleware</code></li> <li>Implement <code>TenantAuditMiddleware</code></li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-3-tenant-storage-1-week","title":"Phase 3: Tenant Storage (1 week)","text":"<ol> <li>Define <code>TenantStore</code> interface</li> <li>Implement <code>MemoryTenantStore</code> for development</li> <li>Implement <code>PostgresTenantStore</code> for production</li> <li>Add quota tracking</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#phase-4-advanced-features-2-weeks","title":"Phase 4: Advanced Features (2 weeks)","text":"<ol> <li>Multi-tenant tool registry</li> <li>Multi-tenant backend registry</li> <li>Namespace isolation strategy</li> <li>Process isolation strategy (optional)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#changes-to-component-libraries","title":"Changes to Component Libraries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#toolrun-changes","title":"toolrun Changes","text":"<pre><code>// Add tenant context propagation\ntype RunOptions struct {\n    // Existing...\n    TenantID string  // NEW: Tenant context for execution\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#toolindex-changes","title":"toolindex Changes","text":"<pre><code>// Add tenant-scoped search\ntype Index interface {\n    // Existing...\n    SearchForTenant(tenantID string, query string, limit int) ([]Summary, error)  // NEW\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#summary","title":"Summary","text":"<p>Multi-tenancy integrates cleanly into the pluggable architecture via:</p> <ol> <li>Pluggable TenantResolver - Any identification strategy</li> <li>Tenant-Aware Middleware - Transparent isolation via middleware chain</li> <li>Tenant-Scoped Registries - Logical isolation of tools/backends</li> <li>Configuration Hierarchy - Defaults \u2192 Tier \u2192 Tenant overrides</li> <li>Multiple Isolation Strategies - Shared, namespace, or process isolation</li> </ol> <p>All components remain pluggable and can be replaced or extended.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/multi-tenancy/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial multi-tenancy extension proposal"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/","title":"Persistence Boundary Architecture","text":"<p>Status: Draft Date: 2026-01-30 Related: Auth Middleware, Multi-Tenancy, Pluggable Architecture</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#overview","title":"Overview","text":"<p>This document defines the boundary between interface contracts (in core libs) and persistence implementations (in optional libs). The principle: core libraries define HOW to store, not WHERE to store.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#design-principle","title":"Design Principle","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         PERSISTENCE BOUNDARY                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   CORE LIBRARIES (interfaces only)          IMPLEMENTATION LIBRARIES         \u2502\n\u2502   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500         \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500      \u2502\n\u2502                                                                               \u2502\n\u2502   toolindex                                 toolpersist                       \u2502\n\u2502     Index interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   PostgresIndex                  \u2502\n\u2502     Searcher interface                        SQLiteIndex                    \u2502\n\u2502                                               RedisIndex                     \u2502\n\u2502                                                                               \u2502\n\u2502   tooldocs                                                                   \u2502\n\u2502     Store interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   PostgresDocStore               \u2502\n\u2502                                               FileDocStore                   \u2502\n\u2502                                               S3DocStore                     \u2502\n\u2502                                                                               \u2502\n\u2502   toolcache (interfaces)                   toolcache (implementations)       \u2502\n\u2502     Cache interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   MemoryCache                    \u2502\n\u2502                                               RedisCache                     \u2502\n\u2502                                               DragonflyCache                 \u2502\n\u2502                                                                               \u2502\n\u2502   internal/auth                                                              \u2502\n\u2502     APIKeyStore interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   MemoryAPIKeyStore              \u2502\n\u2502     TokenStore interface                      RedisAPIKeyStore               \u2502\n\u2502     KeyProvider interface                     PostgresAPIKeyStore            \u2502\n\u2502                                                                               \u2502\n\u2502   internal/tenant                                                            \u2502\n\u2502     TenantStore interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   PostgresTenantStore            \u2502\n\u2502     QuotaStore interface                      RedisTenantStore               \u2502\n\u2502                                                                               \u2502\n\u2502   toolsemantic                                                               \u2502\n\u2502     VectorIndex interface \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   PgVectorIndex                  \u2502\n\u2502                                               QdrantIndex                    \u2502\n\u2502                                               ChromaIndex                    \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#interface-contracts-core-libraries","title":"Interface Contracts (Core Libraries)","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#1-toolindex-registry-interface","title":"1. toolindex - Registry Interface","text":"<pre><code>// toolindex/index.go (already exists, validated)\n\n// Index is the core contract for tool registration and lookup.\n// Implementations may be in-memory, file-backed, or database-backed.\ntype Index interface {\n    // Register adds a tool to the index\n    Register(ctx context.Context, tool Tool) error\n\n    // Unregister removes a tool from the index\n    Unregister(ctx context.Context, id string) error\n\n    // Get retrieves a tool by ID\n    Get(ctx context.Context, id string) (Tool, error)\n\n    // List returns all tools matching the filter\n    List(ctx context.Context, filter Filter) ([]Tool, error)\n\n    // Search finds tools matching the query\n    Search(ctx context.Context, query string, opts SearchOptions) ([]SearchResult, error)\n}\n\n// Searcher is the pluggable search strategy interface.\n// Allows swapping BM25, semantic, or hybrid search without changing Index.\ntype Searcher interface {\n    Search(ctx context.Context, query string, tools []Tool, opts SearchOptions) ([]SearchResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#2-tooldocs-documentation-store-interface","title":"2. tooldocs - Documentation Store Interface","text":"<pre><code>// tooldocs/store.go (already exists, validated)\n\n// Store is the contract for tool documentation storage.\n// The interface supports tiered disclosure (summary \u2192 schema \u2192 full).\ntype Store interface {\n    // Get retrieves documentation for a tool\n    Get(ctx context.Context, toolID string, level DisclosureLevel) (*Documentation, error)\n\n    // Set stores documentation for a tool\n    Set(ctx context.Context, toolID string, doc *Documentation) error\n\n    // Delete removes documentation for a tool\n    Delete(ctx context.Context, toolID string) error\n\n    // List returns all tool IDs with documentation\n    List(ctx context.Context) ([]string, error)\n}\n\n// DisclosureLevel controls documentation detail\ntype DisclosureLevel int\n\nconst (\n    LevelSummary DisclosureLevel = iota // Name + description\n    LevelSchema                          // + input/output schema\n    LevelFull                            // + examples, related tools\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#3-toolcache-cache-interface-new","title":"3. toolcache - Cache Interface (NEW)","text":"<pre><code>// toolcache/cache.go - Interface contract\n\n// Cache is the contract for response caching.\n// Implementations: MemoryCache, RedisCache, etc.\ntype Cache interface {\n    // Get retrieves a cached value\n    Get(ctx context.Context, key string) ([]byte, bool, error)\n\n    // Set stores a value with TTL\n    Set(ctx context.Context, key string, value []byte, ttl time.Duration) error\n\n    // Delete removes a cached value\n    Delete(ctx context.Context, key string) error\n\n    // Clear removes all cached values\n    Clear(ctx context.Context) error\n\n    // Stats returns cache statistics\n    Stats(ctx context.Context) (*CacheStats, error)\n}\n\n// CacheStats provides cache metrics\ntype CacheStats struct {\n    Hits       int64\n    Misses     int64\n    Size       int64\n    MaxSize    int64\n    Evictions  int64\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#4-auth-stores-authentication-persistence-interfaces","title":"4. Auth Stores - Authentication Persistence Interfaces","text":"<pre><code>// internal/auth/stores.go - Interface contracts\n\n// APIKeyStore retrieves and validates API keys.\n// Implementations: Memory (testing), Redis (distributed), Postgres (persistent)\ntype APIKeyStore interface {\n    // Lookup returns the identity for an API key\n    Lookup(ctx context.Context, key string) (*APIKeyInfo, error)\n\n    // Create stores a new API key\n    Create(ctx context.Context, info *APIKeyInfo) error\n\n    // Revoke invalidates an API key\n    Revoke(ctx context.Context, keyID string) error\n\n    // List returns all API keys for a principal/tenant\n    List(ctx context.Context, filter APIKeyFilter) ([]*APIKeyInfo, error)\n\n    // UpdateLastUsed records key usage\n    UpdateLastUsed(ctx context.Context, keyID string, at time.Time) error\n}\n\n// TokenStore manages opaque tokens (for OAuth2 introspection caching).\ntype TokenStore interface {\n    // Get retrieves cached token info\n    Get(ctx context.Context, token string) (*TokenInfo, bool, error)\n\n    // Set caches token info\n    Set(ctx context.Context, token string, info *TokenInfo, ttl time.Duration) error\n\n    // Invalidate removes a token from cache\n    Invalidate(ctx context.Context, token string) error\n}\n\n// KeyProvider fetches signing keys for JWT validation.\ntype KeyProvider interface {\n    // GetKey returns the key for the given key ID\n    GetKey(ctx context.Context, keyID string) (any, error)\n\n    // GetKeys returns all available keys\n    GetKeys(ctx context.Context) ([]any, error)\n}\n\n// SessionStore manages user sessions (optional).\ntype SessionStore interface {\n    // Create starts a new session\n    Create(ctx context.Context, identity *Identity) (*Session, error)\n\n    // Get retrieves a session\n    Get(ctx context.Context, sessionID string) (*Session, error)\n\n    // Refresh extends session expiry\n    Refresh(ctx context.Context, sessionID string) error\n\n    // Destroy ends a session\n    Destroy(ctx context.Context, sessionID string) error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#5-tenant-stores-multi-tenancy-persistence-interfaces","title":"5. Tenant Stores - Multi-Tenancy Persistence Interfaces","text":"<pre><code>// internal/tenant/stores.go - Interface contracts\n\n// TenantStore manages tenant configuration and metadata.\ntype TenantStore interface {\n    // Get retrieves tenant configuration\n    Get(ctx context.Context, tenantID string) (*Tenant, error)\n\n    // Create registers a new tenant\n    Create(ctx context.Context, tenant *Tenant) error\n\n    // Update modifies tenant configuration\n    Update(ctx context.Context, tenant *Tenant) error\n\n    // Delete removes a tenant\n    Delete(ctx context.Context, tenantID string) error\n\n    // List returns all tenants matching filter\n    List(ctx context.Context, filter TenantFilter) ([]*Tenant, error)\n}\n\n// QuotaStore tracks resource usage against quotas.\ntype QuotaStore interface {\n    // GetUsage returns current usage for a tenant\n    GetUsage(ctx context.Context, tenantID string) (*QuotaUsage, error)\n\n    // Increment adds to usage counter\n    Increment(ctx context.Context, tenantID string, resource string, amount int64) error\n\n    // Reset clears usage (e.g., at billing period)\n    Reset(ctx context.Context, tenantID string) error\n\n    // CheckQuota returns error if quota would be exceeded\n    CheckQuota(ctx context.Context, tenantID string, resource string, amount int64) error\n}\n\n// RateLimitStore tracks rate limit state.\ntype RateLimitStore interface {\n    // Allow checks if request is within rate limit\n    Allow(ctx context.Context, key string, limit RateLimit) (bool, error)\n\n    // GetState returns current rate limit state\n    GetState(ctx context.Context, key string) (*RateLimitState, error)\n}\n\n// AuditLogger records audit events.\ntype AuditLogger interface {\n    // Log records an audit event\n    Log(ctx context.Context, event *AuditEvent) error\n\n    // Query retrieves audit events\n    Query(ctx context.Context, filter AuditFilter) ([]*AuditEvent, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#6-toolsemantic-vector-search-interfaces-new","title":"6. toolsemantic - Vector Search Interfaces (NEW)","text":"<pre><code>// toolsemantic/interfaces.go - Interface contracts\n\n// VectorIndex stores and searches vector embeddings.\n// Implementations: PgVector, Qdrant, Chroma, Pinecone, etc.\ntype VectorIndex interface {\n    // Index stores a vector embedding\n    Index(ctx context.Context, id string, vector []float32, metadata map[string]any) error\n\n    // Search finds similar vectors\n    Search(ctx context.Context, vector []float32, opts VectorSearchOptions) ([]VectorResult, error)\n\n    // Delete removes a vector\n    Delete(ctx context.Context, id string) error\n\n    // BatchIndex stores multiple vectors\n    BatchIndex(ctx context.Context, items []VectorItem) error\n}\n\n// Embedder generates vector embeddings from text.\n// Implementations: OpenAI, Cohere, local models, etc.\ntype Embedder interface {\n    // Embed generates embedding for text\n    Embed(ctx context.Context, text string) ([]float32, error)\n\n    // EmbedBatch generates embeddings for multiple texts\n    EmbedBatch(ctx context.Context, texts []string) ([][]float32, error)\n\n    // Dimensions returns the embedding dimension\n    Dimensions() int\n}\n\n// Reranker reorders search results by relevance.\n// Implementations: Cohere, cross-encoder, etc.\ntype Reranker interface {\n    // Rerank reorders results by relevance to query\n    Rerank(ctx context.Context, query string, results []RerankCandidate) ([]RerankResult, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#implementation-libraries","title":"Implementation Libraries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#option-a-single-toolpersist-library","title":"Option A: Single <code>toolpersist</code> Library","text":"<p>All persistence implementations in one library with build tags:</p> <pre><code>toolpersist/\n\u251c\u2500\u2500 doc.go\n\u251c\u2500\u2500 memory/           # In-memory implementations (always included)\n\u2502   \u251c\u2500\u2500 index.go\n\u2502   \u251c\u2500\u2500 docstore.go\n\u2502   \u2514\u2500\u2500 cache.go\n\u251c\u2500\u2500 redis/            # Redis implementations\n\u2502   \u251c\u2500\u2500 cache.go      # +build redis\n\u2502   \u251c\u2500\u2500 apikey.go\n\u2502   \u2514\u2500\u2500 ratelimit.go\n\u251c\u2500\u2500 postgres/         # PostgreSQL implementations\n\u2502   \u251c\u2500\u2500 index.go      # +build postgres\n\u2502   \u251c\u2500\u2500 docstore.go\n\u2502   \u251c\u2500\u2500 tenant.go\n\u2502   \u2514\u2500\u2500 audit.go\n\u251c\u2500\u2500 sqlite/           # SQLite implementations\n\u2502   \u251c\u2500\u2500 index.go      # +build sqlite\n\u2502   \u2514\u2500\u2500 docstore.go\n\u2514\u2500\u2500 vector/           # Vector store implementations\n    \u251c\u2500\u2500 pgvector.go   # +build pgvector\n    \u251c\u2500\u2500 qdrant.go     # +build qdrant\n    \u2514\u2500\u2500 chroma.go     # +build chroma\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#option-b-separate-implementation-libraries","title":"Option B: Separate Implementation Libraries","text":"<p>Each persistence backend as separate library:</p> <pre><code>toolpersist-memory/   # Always available, zero dependencies\ntoolpersist-redis/    # Requires redis client\ntoolpersist-postgres/ # Requires pgx\ntoolpersist-sqlite/   # Requires sqlite3\ntoolpersist-pgvector/ # Requires pgvector extension\ntoolpersist-qdrant/   # Requires qdrant client\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#recommendation-option-a-with-build-tags","title":"Recommendation: Option A with Build Tags","text":"<ul> <li>Single import path simplifies dependency management</li> <li>Build tags allow users to include only needed backends</li> <li>Memory implementations always available for testing</li> <li>Reduces repository sprawl</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#dependency-injection-pattern","title":"Dependency Injection Pattern","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#factory-registration","title":"Factory Registration","text":"<pre><code>// toolpersist/registry.go\n\n// StoreType identifies a persistence backend\ntype StoreType string\n\nconst (\n    StoreMemory   StoreType = \"memory\"\n    StoreRedis    StoreType = \"redis\"\n    StorePostgres StoreType = \"postgres\"\n    StoreSQLite   StoreType = \"sqlite\"\n)\n\n// Registry holds factory functions for persistence implementations\ntype Registry struct {\n    mu       sync.RWMutex\n    index    map[StoreType]IndexFactory\n    docs     map[StoreType]DocStoreFactory\n    cache    map[StoreType]CacheFactory\n    apikey   map[StoreType]APIKeyStoreFactory\n    tenant   map[StoreType]TenantStoreFactory\n    vector   map[StoreType]VectorIndexFactory\n}\n\n// IndexFactory creates Index implementations\ntype IndexFactory func(cfg map[string]any) (toolindex.Index, error)\n\n// DocStoreFactory creates DocStore implementations\ntype DocStoreFactory func(cfg map[string]any) (tooldocs.Store, error)\n\n// CacheFactory creates Cache implementations\ntype CacheFactory func(cfg map[string]any) (toolcache.Cache, error)\n\n// DefaultRegistry is the global factory registry\nvar DefaultRegistry = NewRegistry()\n\nfunc init() {\n    // Memory implementations always registered\n    DefaultRegistry.RegisterIndex(StoreMemory, NewMemoryIndex)\n    DefaultRegistry.RegisterDocStore(StoreMemory, NewMemoryDocStore)\n    DefaultRegistry.RegisterCache(StoreMemory, NewMemoryCache)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#configuration-driven-initialization","title":"Configuration-Driven Initialization","text":"<pre><code># metatools.yaml\n\npersistence:\n  # Tool index storage\n  index:\n    type: postgres  # memory, redis, postgres, sqlite\n    config:\n      connection_string: ${DATABASE_URL}\n      table_prefix: \"metatools_\"\n\n  # Documentation storage\n  docs:\n    type: postgres\n    config:\n      connection_string: ${DATABASE_URL}\n\n  # Response cache\n  cache:\n    type: redis\n    config:\n      address: localhost:6379\n      prefix: \"cache:\"\n\n  # API key storage\n  api_keys:\n    type: postgres\n    config:\n      connection_string: ${DATABASE_URL}\n\n  # Tenant storage\n  tenants:\n    type: postgres\n    config:\n      connection_string: ${DATABASE_URL}\n\n  # Vector index (for semantic search)\n  vectors:\n    type: pgvector\n    config:\n      connection_string: ${DATABASE_URL}\n      dimensions: 1536\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#runtime-initialization","title":"Runtime Initialization","text":"<pre><code>// cmd/metatools/persistence.go\n\nfunc initPersistence(cfg *config.Config) (*PersistenceLayer, error) {\n    // Create index\n    indexFactory, ok := toolpersist.DefaultRegistry.GetIndex(cfg.Persistence.Index.Type)\n    if !ok {\n        return nil, fmt.Errorf(\"unknown index type: %s\", cfg.Persistence.Index.Type)\n    }\n    idx, err := indexFactory(cfg.Persistence.Index.Config)\n    if err != nil {\n        return nil, fmt.Errorf(\"create index: %w\", err)\n    }\n\n    // Create doc store\n    docsFactory, ok := toolpersist.DefaultRegistry.GetDocStore(cfg.Persistence.Docs.Type)\n    if !ok {\n        return nil, fmt.Errorf(\"unknown docs type: %s\", cfg.Persistence.Docs.Type)\n    }\n    docs, err := docsFactory(cfg.Persistence.Docs.Config)\n    if err != nil {\n        return nil, fmt.Errorf(\"create docs: %w\", err)\n    }\n\n    // ... similar for cache, api_keys, tenants, vectors\n\n    return &amp;PersistenceLayer{\n        Index:   idx,\n        Docs:    docs,\n        Cache:   cache,\n        APIKeys: apiKeys,\n        Tenants: tenants,\n        Vectors: vectors,\n    }, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#migration-path","title":"Migration Path","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#phase-1-define-interfaces-current","title":"Phase 1: Define Interfaces (Current)","text":"<ol> <li>Validate existing interfaces in toolindex, tooldocs</li> <li>Add Cache interface to toolcache (separate from implementations)</li> <li>Add auth store interfaces to internal/auth</li> <li>Add tenant store interfaces to internal/tenant</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#phase-2-create-toolpersist-library","title":"Phase 2: Create toolpersist Library","text":"<ol> <li>Create toolpersist with memory implementations</li> <li>Move existing in-memory implementations from core libs</li> <li>Add factory registry pattern</li> <li>Add build-tag support for optional backends</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#phase-3-add-backend-implementations","title":"Phase 3: Add Backend Implementations","text":"<ol> <li>Redis implementations (cache, rate limit, api keys)</li> <li>PostgreSQL implementations (index, docs, tenants, audit)</li> <li>SQLite implementations (embedded deployments)</li> <li>Vector implementations (pgvector, qdrant)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#phase-4-wire-into-metatools-mcp","title":"Phase 4: Wire Into metatools-mcp","text":"<ol> <li>Add persistence configuration section</li> <li>Initialize via factory registry</li> <li>Pass implementations to handlers via dependency injection</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#benefits","title":"Benefits","text":"<ol> <li>Core libs stay focused - Pure business logic, no persistence coupling</li> <li>Testability - Memory implementations for unit tests</li> <li>Flexibility - Swap backends without code changes</li> <li>Optional dependencies - Build tags exclude unused backends</li> <li>Clear contracts - Interfaces define exactly what's needed</li> <li>Multi-deployment - Same code, different persistence per environment</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#interface-location-summary","title":"Interface Location Summary","text":"Interface Core Library Purpose <code>Index</code> toolindex Tool registration/lookup <code>Searcher</code> toolindex Pluggable search strategy <code>Store</code> (docs) tooldocs Documentation storage <code>Cache</code> toolcache Response caching <code>APIKeyStore</code> internal/auth API key persistence <code>TokenStore</code> internal/auth OAuth token caching <code>KeyProvider</code> internal/auth JWT key fetching <code>SessionStore</code> internal/auth Session management <code>TenantStore</code> internal/tenant Tenant configuration <code>QuotaStore</code> internal/tenant Quota tracking <code>RateLimitStore</code> internal/tenant Rate limit state <code>AuditLogger</code> internal/tenant Audit logging <code>VectorIndex</code> toolsemantic Vector embeddings <code>Embedder</code> toolsemantic Text\u2192vector conversion <code>Reranker</code> toolsemantic Search reranking"},{"location":"library-docs-from-repos/metatools-mcp/proposals/persistence-boundary/#changelog","title":"Changelog","text":"Date Change 2026-01-30 Initial persistence boundary architecture"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/","title":"Pluggable Architecture Proposal","text":"<p>Status: Draft Date: 2026-01-27 Author: Jon Raymond</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#executive-summary","title":"Executive Summary","text":"<p>This proposal outlines a pluggable, modular architecture for metatools-mcp that enables: - Multiple transport protocols (stdio, HTTP/SSE, WebSocket) - Plug-and-play tool providers - Configurable search strategies - Extensible backend registries - Cross-cutting middleware</p> <p>The design leverages Go's interface-based composition, build-tag gating, and configuration-driven initialization to create a flexible framework while maintaining the clean, canonical core.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Motivation</li> <li>Current Architecture Analysis</li> <li>Proposed Architecture</li> <li>Extension Points</li> <li>Transport Layer</li> <li>Search Strategy</li> <li>Tool Provider Registry</li> <li>Backend Registry</li> <li>Middleware Chain</li> <li>Cache Layer</li> <li>Additional Cross-Cutting Concerns</li> <li>Multi-Backend Architecture</li> <li>Configuration Design</li> <li>Implementation Approach</li> <li>End-to-End Examples</li> <li>Enterprise AI Assistant</li> <li>Local Development Setup</li> <li>Multi-LLM Tool Router</li> <li>Microservices Tool Mesh</li> <li>Request Flow Diagram</li> <li>Comparative Analysis</li> <li>References</li> <li>Architecture Validation</li> <li>Implementation Phases</li> <li>Component Library Analysis</li> <li>Multi-Tenancy Extension</li> <li>Extension Point Catalog</li> <li>Revised Implementation Timeline</li> <li>Architecture Evaluation</li> <li>Protocol-Agnostic Tools</li> <li>Versioning Strategy</li> <li>Multi-Language Extensibility</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#motivation","title":"Motivation","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#goals","title":"Goals","text":"<ol> <li>Multi-transport support - Run as stdio MCP server (current) or HTTP/SSE server (high availability)</li> <li>Plug-and-play extensibility - Add new tools, backends, and search strategies without modifying core</li> <li>Configuration-driven - YAML/JSON config files with environment variable overrides</li> <li>Framework potential - Enable metatools-mcp as a reusable framework for building MCP servers</li> <li>Multi-language support - Enable components in Python, Rust, TypeScript via standardized interface contracts</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#non-goals","title":"Non-Goals","text":"<ul> <li>Go's native plugin package (platform limitations; use gRPC/WASM instead)</li> <li>Breaking changes to existing tool* library interfaces</li> <li>Over-engineering for hypothetical future requirements</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#current-architecture-analysis","title":"Current Architecture Analysis","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#strengths-85-pluggable","title":"Strengths (85% Pluggable)","text":"<p>The existing architecture demonstrates excellent patterns:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MCP Server (SDK)                           \u2502\n\u2502           metatools-mcp/internal/server/server.go               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Adapter Layer                                 \u2502\n\u2502  - IndexAdapter (toolindex \u2192 handlers.Index)                    \u2502\n\u2502  - DocsAdapter (tooldocs \u2192 handlers.Store)                      \u2502\n\u2502  - RunnerAdapter (toolrun \u2192 handlers.Runner)                    \u2502\n\u2502  - ExecutorAdapter (toolcode \u2192 handlers.Executor)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Handlers Layer                                 \u2502\n\u2502  - SearchHandler, DescribeHandler, RunHandler, ChainHandler    \u2502\n\u2502  - CodeHandler (optional), ExamplesHandler, NamespacesHandler  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Core Tool Libraries                                 \u2502\n\u2502  toolindex, tooldocs, toolrun, toolcode, toolruntime, toolsearch\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>What works well: - Clean interface contracts (<code>handlers/interfaces.go</code>) - Adapter pattern prevents library leakage - Build-tag gating for optional features (<code>toolsearch</code>, <code>toolruntime</code>) - Configuration-driven bootstrap (<code>internal/config/env.go</code>) - Stateless handlers with dependency injection</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#gap-monolithic-tool-registration","title":"Gap: Monolithic Tool Registration","text":"<p>The primary gap is in <code>server.registerTools()</code> (~200 lines):</p> <pre><code>// Current: Hard-coded tool list\nfunc (s *Server) registerTools() {\n    s.addTool(\"search_tools\", ...)    // inline schema\n    s.addTool(\"describe_tool\", ...)   // inline schema\n    s.addTool(\"run_tool\", ...)        // inline schema\n    // ... 7 tools total\n}\n</code></pre> <p>This requires code changes to add new tools.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-architecture","title":"Proposed Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#five-layer-design","title":"Five-Layer Design","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    METATOOLS-MCP FRAMEWORK                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                 TRANSPORT LAYER                              \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502 \u2502\n\u2502  \u2502  \u2502  stdio  \u2502  \u2502  SSE    \u2502  \u2502  HTTP   \u2502  \u2502  gRPC   \u2502        \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518        \u2502 \u2502\n\u2502  \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502 \u2502\n\u2502  \u2502                        \u2193                                     \u2502 \u2502\n\u2502  \u2502               transport.Transport interface                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                  MIDDLEWARE CHAIN                            \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502 \u2502\n\u2502  \u2502  \u2502 Logging  \u2502\u2192\u2502  Auth    \u2502\u2192\u2502  Rate    \u2502\u2192\u2502  Cache   \u2502       \u2502 \u2502\n\u2502  \u2502  \u2502          \u2502 \u2502          \u2502 \u2502  Limit   \u2502 \u2502          \u2502       \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502               TOOL PROVIDER REGISTRY                         \u2502 \u2502\n\u2502  \u2502                                                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502 \u2502\n\u2502  \u2502  \u2502 search_tools \u2502 \u2502 describe_    \u2502 \u2502 run_tool     \u2502         \u2502 \u2502\n\u2502  \u2502  \u2502              \u2502 \u2502 tool         \u2502 \u2502              \u2502         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502 \u2502\n\u2502  \u2502  \u2502 run_chain    \u2502 \u2502 execute_code \u2502 \u2502 [custom...]  \u2502         \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502              CORE SERVICES (Tool Libraries)                  \u2502 \u2502\n\u2502  \u2502                                                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502 \u2502\n\u2502  \u2502  \u2502   toolindex    \u2502  \u2502   tooldocs     \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2502  (Registry)    \u2502  \u2502  (Disclosure)  \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502 \u2502\n\u2502  \u2502  \u2502   toolrun      \u2502  \u2502   toolcode     \u2502                     \u2502 \u2502\n\u2502  \u2502  \u2502  (Execution)   \u2502  \u2502 (Orchestration)\u2502                     \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                             \u2193                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502               BACKEND REGISTRY                               \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502 \u2502\n\u2502  \u2502  \u2502  local  \u2502  \u2502 openai  \u2502  \u2502  azure  \u2502  \u2502  mcp    \u2502        \u2502 \u2502\n\u2502  \u2502  \u2502handlers \u2502  \u2502   api   \u2502  \u2502   api   \u2502  \u2502 servers \u2502        \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#core-interfaces","title":"Core Interfaces","text":"<pre><code>// Transport abstraction (enables stdio/SSE/HTTP)\ntype Transport interface {\n    Serve(ctx context.Context, handler RequestHandler) error\n}\n\n// Tool provider (enables plug-and-play tools)\ntype ToolProvider interface {\n    Name() string\n    Tool() *mcp.Tool\n    Handle(ctx context.Context, input []byte) (any, error)\n}\n\n// Middleware (enables cross-cutting concerns)\ntype Middleware func(ToolProvider) ToolProvider\n\n// Backend registry (enables tool sources)\ntype BackendRegistry interface {\n    Register(kind string, backend Backend)\n    Get(kind string) (Backend, bool)\n    List() []string\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-points","title":"Extension Points","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-transport-layer","title":"1. Transport Layer","text":"<p>The transport layer abstracts how MCP clients connect to the server. This enables the same tool logic to be exposed via multiple protocols.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TRANSPORT LAYER                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                              MCP CLIENTS                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502   Claude    \u2502  \u2502   Cursor    \u2502  \u2502  Web App    \u2502  \u2502   Custom    \u2502        \u2502\n\u2502   \u2502   Desktop   \u2502  \u2502    IDE      \u2502  \u2502  Frontend   \u2502  \u2502   Client    \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502          \u2502                \u2502                \u2502                \u2502                \u2502\n\u2502          \u2502 stdio          \u2502 stdio          \u2502 HTTP/SSE       \u2502 gRPC          \u2502\n\u2502          \u2502                \u2502                \u2502                \u2502                \u2502\n\u2502          \u25bc                \u25bc                \u25bc                \u25bc                \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                     TRANSPORT REGISTRY                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502   \u2502\n\u2502   \u2502   \u2502   STDIO   \u2502  \u2502    SSE    \u2502  \u2502   HTTP    \u2502  \u2502   gRPC    \u2502        \u2502   \u2502\n\u2502   \u2502   \u2502 Transport \u2502  \u2502 Transport \u2502  \u2502 Transport \u2502  \u2502 Transport \u2502        \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518        \u2502   \u2502\n\u2502   \u2502         \u2502              \u2502              \u2502              \u2502               \u2502   \u2502\n\u2502   \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502                    transport.Transport                                \u2502   \u2502\n\u2502   \u2502                       interface                                       \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                          \u2502\n\u2502                                   \u25bc                                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    MCP REQUEST HANDLER                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Unified handler processes all requests regardless of transport    \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-transport-interface","title":"The Transport Interface","text":"<pre><code>// Transport defines how MCP clients connect to the server\ntype Transport interface {\n    // Name returns the transport identifier (e.g., \"stdio\", \"sse\")\n    Name() string\n\n    // Serve starts the transport and blocks until ctx is cancelled\n    Serve(ctx context.Context, handler RequestHandler) error\n\n    // Close gracefully shuts down the transport\n    Close() error\n\n    // Info returns runtime information about the transport\n    Info() TransportInfo\n}\n\n// RequestHandler processes incoming MCP requests\ntype RequestHandler interface {\n    HandleRequest(ctx context.Context, req *mcp.Request) (*mcp.Response, error)\n}\n\n// TransportInfo provides runtime details\ntype TransportInfo struct {\n    Name      string            // Transport name\n    Listening bool              // Is it accepting connections?\n    Address   string            // Listening address (for network transports)\n    Metadata  map[string]string // Additional info\n}\n\n// TransportFactory creates configured transport instances\ntype TransportFactory func(cfg TransportConfig) (Transport, error)\n\n// TransportRegistry manages available transports\ntype TransportRegistry struct {\n    transports map[string]TransportFactory\n}\n\nfunc (r *TransportRegistry) Register(name string, factory TransportFactory) {\n    r.transports[name] = factory\n}\n\nfunc (r *TransportRegistry) Create(cfg TransportConfig) (Transport, error) {\n    factory, ok := r.transports[cfg.Type]\n    if !ok {\n        return nil, fmt.Errorf(\"unknown transport: %s\", cfg.Type)\n    }\n    return factory(cfg)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-types","title":"Transport Types","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-stdio-transport-current-default","title":"1. Stdio Transport (Current Default)","text":"<p>For MCP clients that spawn the server as a subprocess.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          STDIO TRANSPORT                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502      MCP Client       \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502   (Claude, Cursor)    \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   Spawns process \u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Started as child    \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   stdin  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Reads JSON-RPC      \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   stdout \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Writes JSON-RPC     \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Single client per process                                               \u2502\n\u2502   - Process lifecycle tied to client                                        \u2502\n\u2502   - No network configuration needed                                         \u2502\n\u2502   - Ideal for desktop MCP clients                                           \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Implementation:                                                             \u2502\n\u2502                                                                               \u2502\n\u2502  type StdioTransport struct {                                               \u2502\n\u2502      reader  io.Reader  // os.Stdin                                         \u2502\n\u2502      writer  io.Writer  // os.Stdout                                        \u2502\n\u2502      decoder *json.Decoder                                                  \u2502\n\u2502      encoder *json.Encoder                                                  \u2502\n\u2502  }                                                                           \u2502\n\u2502                                                                               \u2502\n\u2502  func (t *StdioTransport) Serve(ctx context.Context, h RequestHandler)      \u2502\n\u2502      error {                                                                \u2502\n\u2502      for {                                                                  \u2502\n\u2502          select {                                                           \u2502\n\u2502          case &lt;-ctx.Done():                                                 \u2502\n\u2502              return ctx.Err()                                               \u2502\n\u2502          default:                                                           \u2502\n\u2502              var req mcp.Request                                            \u2502\n\u2502              if err := t.decoder.Decode(&amp;req); err != nil {                 \u2502\n\u2502                  return err                                                 \u2502\n\u2502              }                                                              \u2502\n\u2502              resp, err := h.HandleRequest(ctx, &amp;req)                        \u2502\n\u2502              if err := t.encoder.Encode(resp); err != nil {                 \u2502\n\u2502                  return err                                                 \u2502\n\u2502              }                                                              \u2502\n\u2502          }                                                                  \u2502\n\u2502      }                                                                      \u2502\n\u2502  }                                                                           \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: stdio                                                            \u2502\n\u2502      # No additional config needed                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-sse-transport-server-sent-events","title":"2. SSE Transport (Server-Sent Events)","text":"<p>For web-based MCP clients using the Streamable HTTP protocol.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           SSE TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502     Web Browser       \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502    or HTTP Client     \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   POST /mcp \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Handle request      \u2502               \u2502\n\u2502   \u2502   (JSON-RPC request)  \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   SSE stream \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Stream response     \u2502               \u2502\n\u2502   \u2502   (chunked events)    \u2502         \u2502   via SSE             \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   HTTP Endpoints:                                                            \u2502\n\u2502   - POST /mcp           \u2192 Submit MCP request, receive SSE stream            \u2502\n\u2502   - GET  /mcp/sse       \u2192 Establish SSE connection for server push          \u2502\n\u2502   - GET  /health        \u2192 Health check endpoint                              \u2502\n\u2502   - GET  /ready         \u2192 Readiness probe                                   \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Multiple concurrent clients                                             \u2502\n\u2502   - Stateless (each request independent)                                    \u2502\n\u2502   - Web-friendly (works through firewalls/proxies)                          \u2502\n\u2502   - Supports streaming responses                                            \u2502\n\u2502   - Can be load balanced                                                    \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Request/Response Flow:                                                      \u2502\n\u2502                                                                               \u2502\n\u2502  Client                              Server                                  \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  POST /mcp                        \u2502                                     \u2502\n\u2502    \u2502  Content-Type: application/json   \u2502                                     \u2502\n\u2502    \u2502  Accept: text/event-stream        \u2502                                     \u2502\n\u2502    \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  HTTP/1.1 200 OK                  \u2502                                     \u2502\n\u2502    \u2502  Content-Type: text/event-stream  \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: message                   \u2502                                     \u2502\n\u2502    \u2502  data: {\"jsonrpc\":\"2.0\",...}      \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: message                   \u2502                                     \u2502\n\u2502    \u2502  data: {\"jsonrpc\":\"2.0\",...}      \u2502  (streaming)                       \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502    \u2502  event: done                      \u2502                                     \u2502\n\u2502    \u2502  data: {}                         \u2502                                     \u2502\n\u2502    \u2502  \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502                                     \u2502\n\u2502    \u2502                                   \u2502                                     \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: sse                                                              \u2502\n\u2502      http:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        base_path: /mcp                                                     \u2502\n\u2502        cors:                                                               \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          origins: [\"https://app.example.com\"]                             \u2502\n\u2502        tls:                                                                \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          cert: /etc/ssl/cert.pem                                          \u2502\n\u2502          key: /etc/ssl/key.pem                                            \u2502\n\u2502        timeouts:                                                           \u2502\n\u2502          read: 30s                                                         \u2502\n\u2502          write: 60s                                                        \u2502\n\u2502          idle: 120s                                                        \u2502\n\u2502        keepalive: 30s                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-http-transport-rest-style","title":"3. HTTP Transport (REST-style)","text":"<p>For simple request/response without streaming.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          HTTP TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Endpoints:                                                                 \u2502\n\u2502                                                                               \u2502\n\u2502   POST /mcp/tools/list                                                       \u2502\n\u2502   \u251c\u2500 Request:  {}                                                            \u2502\n\u2502   \u2514\u2500 Response: { \"tools\": [...] }                                           \u2502\n\u2502                                                                               \u2502\n\u2502   POST /mcp/tools/call                                                       \u2502\n\u2502   \u251c\u2500 Request:  { \"name\": \"search_tools\", \"arguments\": {...} }               \u2502\n\u2502   \u2514\u2500 Response: { \"content\": [...] }                                         \u2502\n\u2502                                                                               \u2502\n\u2502   GET /mcp/tools/:name                                                       \u2502\n\u2502   \u2514\u2500 Response: { \"name\": \"...\", \"description\": \"...\", \"inputSchema\": {...}} \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Simple request/response                                                  \u2502\n\u2502   - No streaming support                                                    \u2502\n\u2502   - Easy to debug with curl                                                 \u2502\n\u2502   - Good for simple integrations                                            \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: http                                                             \u2502\n\u2502      http:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        base_path: /mcp                                                     \u2502\n\u2502        # Same TLS/timeout options as SSE                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-websocket-transport","title":"4. WebSocket Transport","text":"<p>For bidirectional real-time communication.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        WEBSOCKET TRANSPORT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502       Client          \u2502         \u2502    metatools-mcp      \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502       server          \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   WS Connect \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   Accept connection   \u2502               \u2502\n\u2502   \u2502   ws://host/mcp/ws    \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2502   \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502               \u2502\n\u2502   \u2502      Bidirectional    \u2502         \u2502   Full duplex         \u2502               \u2502\n\u2502   \u2502      JSON-RPC         \u2502         \u2502   messaging           \u2502               \u2502\n\u2502   \u2502                       \u2502         \u2502                       \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - Full duplex communication                                               \u2502\n\u2502   - Server can push notifications                                           \u2502\n\u2502   - Lower latency than HTTP                                                 \u2502\n\u2502   - Persistent connection                                                   \u2502\n\u2502   - Good for real-time applications                                         \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: websocket                                                        \u2502\n\u2502      websocket:                                                             \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 8080                                                          \u2502\n\u2502        path: /mcp/ws                                                       \u2502\n\u2502        ping_interval: 30s                                                  \u2502\n\u2502        pong_timeout: 10s                                                   \u2502\n\u2502        max_message_size: 1MB                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-grpc-transport","title":"5. gRPC Transport","text":"<p>For high-performance, strongly-typed RPC.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          gRPC TRANSPORT                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Protocol Buffer Definition:                                                \u2502\n\u2502                                                                               \u2502\n\u2502   service MCPService {                                                       \u2502\n\u2502     rpc ListTools(ListToolsRequest) returns (ListToolsResponse);            \u2502\n\u2502     rpc CallTool(CallToolRequest) returns (CallToolResponse);               \u2502\n\u2502     rpc CallToolStream(CallToolRequest) returns (stream ToolEvent);         \u2502\n\u2502   }                                                                          \u2502\n\u2502                                                                               \u2502\n\u2502   Characteristics:                                                           \u2502\n\u2502   - High performance (binary protocol)                                       \u2502\n\u2502   - Strong typing via protobuf                                              \u2502\n\u2502   - Bidirectional streaming                                                 \u2502\n\u2502   - Built-in load balancing                                                 \u2502\n\u2502   - Good for service-to-service communication                               \u2502\n\u2502                                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                                                     \u2502\n\u2502    transport:                                                               \u2502\n\u2502      type: grpc                                                             \u2502\n\u2502      grpc:                                                                  \u2502\n\u2502        host: \"0.0.0.0\"                                                     \u2502\n\u2502        port: 9090                                                          \u2502\n\u2502        tls:                                                                \u2502\n\u2502          enabled: true                                                     \u2502\n\u2502          cert: /etc/ssl/cert.pem                                          \u2502\n\u2502          key: /etc/ssl/key.pem                                            \u2502\n\u2502          client_ca: /etc/ssl/ca.pem  # For mTLS                           \u2502\n\u2502        reflection: true  # Enable gRPC reflection                          \u2502\n\u2502        max_recv_msg_size: 4MB                                              \u2502\n\u2502        max_send_msg_size: 4MB                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-transport-support","title":"Multi-Transport Support","text":"<p>Run multiple transports simultaneously:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MULTI-TRANSPORT ARCHITECTURE                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    METATOOLS-MCP SERVER                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502   \u2502\n\u2502   \u2502   \u2502   STDIO     \u2502 \u2502    SSE      \u2502 \u2502    gRPC     \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2502  Transport  \u2502 \u2502  Transport  \u2502 \u2502  Transport  \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2502             \u2502 \u2502  :8080      \u2502 \u2502  :9090      \u2502                   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502   \u2502\n\u2502   \u2502          \u2502               \u2502               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502   \u2502\n\u2502   \u2502                          \u2502                                            \u2502   \u2502\n\u2502   \u2502                          \u25bc                                            \u2502   \u2502\n\u2502   \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502   \u2502\n\u2502   \u2502          \u2502     SHARED REQUEST HANDLER    \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502                               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   All transports share the    \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   same middleware, tools,     \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502   and backend registries      \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2502                               \u2502                           \u2502   \u2502\n\u2502   \u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2502   Config:                                                                    \u2502\n\u2502     transports:                                                             \u2502\n\u2502       - type: stdio                                                         \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502                                                                               \u2502\n\u2502       - type: sse                                                           \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502         http:                                                               \u2502\n\u2502           port: 8080                                                        \u2502\n\u2502                                                                               \u2502\n\u2502       - type: grpc                                                          \u2502\n\u2502         enabled: true                                                       \u2502\n\u2502         grpc:                                                               \u2502\n\u2502           port: 9090                                                        \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementing-custom-transports","title":"Implementing Custom Transports","text":"<pre><code>// Example: Unix socket transport for local high-performance IPC\ntype UnixSocketTransport struct {\n    path     string\n    listener net.Listener\n    handler  RequestHandler\n}\n\nfunc NewUnixSocketTransport(cfg TransportConfig) (Transport, error) {\n    return &amp;UnixSocketTransport{\n        path: cfg.UnixSocket.Path,\n    }, nil\n}\n\nfunc (t *UnixSocketTransport) Name() string {\n    return \"unix\"\n}\n\nfunc (t *UnixSocketTransport) Serve(ctx context.Context, h RequestHandler) error {\n    t.handler = h\n\n    var err error\n    t.listener, err = net.Listen(\"unix\", t.path)\n    if err != nil {\n        return err\n    }\n\n    go func() {\n        &lt;-ctx.Done()\n        t.listener.Close()\n    }()\n\n    for {\n        conn, err := t.listener.Accept()\n        if err != nil {\n            if ctx.Err() != nil {\n                return nil // Graceful shutdown\n            }\n            return err\n        }\n        go t.handleConnection(ctx, conn)\n    }\n}\n\nfunc (t *UnixSocketTransport) handleConnection(ctx context.Context, conn net.Conn) {\n    defer conn.Close()\n    decoder := json.NewDecoder(conn)\n    encoder := json.NewEncoder(conn)\n\n    for {\n        var req mcp.Request\n        if err := decoder.Decode(&amp;req); err != nil {\n            return\n        }\n        resp, _ := t.handler.HandleRequest(ctx, &amp;req)\n        if err := encoder.Encode(resp); err != nil {\n            return\n        }\n    }\n}\n\nfunc (t *UnixSocketTransport) Close() error {\n    if t.listener != nil {\n        return t.listener.Close()\n    }\n    return nil\n}\n\nfunc (t *UnixSocketTransport) Info() TransportInfo {\n    return TransportInfo{\n        Name:      \"unix\",\n        Listening: t.listener != nil,\n        Address:   t.path,\n    }\n}\n\n// Register the custom transport\nfunc init() {\n    transport.Register(\"unix\", NewUnixSocketTransport)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#high-availability-configuration","title":"High Availability Configuration","text":"<p>For production deployments with HTTP/SSE transport:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    HIGH AVAILABILITY DEPLOYMENT                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                       LOAD BALANCER                                  \u2502   \u2502\n\u2502   \u2502                    (nginx, HAProxy, ALB)                             \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   - TLS termination                                                  \u2502   \u2502\n\u2502   \u2502   - Health checks                                                    \u2502   \u2502\n\u2502   \u2502   - Round-robin / least-connections                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                    \u2502                \u2502                \u2502                       \u2502\n\u2502                    \u25bc                \u25bc                \u25bc                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502   \u2502   metatools-mcp    \u2502 \u2502   metatools-mcp    \u2502 \u2502   metatools-mcp    \u2502     \u2502\n\u2502   \u2502    instance 1      \u2502 \u2502    instance 2      \u2502 \u2502    instance 3      \u2502     \u2502\n\u2502   \u2502                    \u2502 \u2502                    \u2502 \u2502                    \u2502     \u2502\n\u2502   \u2502  SSE :8080         \u2502 \u2502  SSE :8080         \u2502 \u2502  SSE :8080         \u2502     \u2502\n\u2502   \u2502  gRPC :9090        \u2502 \u2502  gRPC :9090        \u2502 \u2502  gRPC :9090        \u2502     \u2502\n\u2502   \u2502                    \u2502 \u2502                    \u2502 \u2502                    \u2502     \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502             \u2502                      \u2502                      \u2502                 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                    \u2502                                         \u2502\n\u2502                                    \u25bc                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      SHARED STATE (Optional)                         \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   - Redis for rate limiting                                          \u2502   \u2502\n\u2502   \u2502   - Redis for caching                                                \u2502   \u2502\n\u2502   \u2502   - Shared tool registry (if dynamic)                               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code># Kubernetes-ready configuration\ntransport:\n  type: sse\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n\n    # Health endpoints for k8s probes\n    health:\n      enabled: true\n      liveness_path: /healthz\n      readiness_path: /ready\n\n    # Graceful shutdown\n    shutdown:\n      timeout: 30s\n      drain_connections: true\n\n    # TLS (or terminate at ingress)\n    tls:\n      enabled: false  # Terminated at ingress\n\nmiddleware:\n  rate_limit:\n    enabled: true\n    storage: redis\n    redis:\n      address: redis:6379\n\n  cache:\n    enabled: true\n    backend: redis\n    redis:\n      address: redis:6379\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cli-integration","title":"CLI Integration","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          CLI SUBCOMMANDS                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  metatools stdio                                                             \u2502\n\u2502  \u2514\u2500 Run as stdio server (default, for MCP clients)                          \u2502\n\u2502                                                                               \u2502\n\u2502  metatools serve                                                             \u2502\n\u2502  \u2514\u2500 Run as HTTP/SSE server                                                  \u2502\n\u2502  \u2514\u2500 Options:                                                                \u2502\n\u2502       --port 8080          HTTP port                                        \u2502\n\u2502       --grpc-port 9090     gRPC port (optional)                            \u2502\n\u2502       --tls                Enable TLS                                       \u2502\n\u2502       --cert FILE          TLS certificate                                  \u2502\n\u2502       --key FILE           TLS key                                          \u2502\n\u2502                                                                               \u2502\n\u2502  metatools serve --multi                                                     \u2502\n\u2502  \u2514\u2500 Run all enabled transports from config                                  \u2502\n\u2502                                                                               \u2502\n\u2502  metatools version                                                           \u2502\n\u2502  \u2514\u2500 Print version and exit                                                  \u2502\n\u2502                                                                               \u2502\n\u2502  metatools validate                                                          \u2502\n\u2502  \u2514\u2500 Validate configuration file                                             \u2502\n\u2502                                                                               \u2502\n\u2502  metatools tools list                                                        \u2502\n\u2502  \u2514\u2500 List all registered tools (from all backends)                          \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-configuration-summary","title":"Transport Configuration Summary","text":"<pre><code># Complete transport configuration example\ntransports:\n  # Stdio for MCP desktop clients\n  - type: stdio\n    enabled: true\n\n  # SSE for web clients\n  - type: sse\n    enabled: true\n    http:\n      host: \"0.0.0.0\"\n      port: 8080\n      base_path: /mcp\n      cors:\n        enabled: true\n        origins: [\"*\"]\n        methods: [\"GET\", \"POST\", \"OPTIONS\"]\n        headers: [\"Content-Type\", \"Authorization\"]\n      tls:\n        enabled: true\n        cert: /etc/ssl/certs/server.crt\n        key: /etc/ssl/private/server.key\n      timeouts:\n        read: 30s\n        write: 60s\n        idle: 120s\n      health:\n        enabled: true\n        liveness_path: /healthz\n        readiness_path: /ready\n\n  # WebSocket for real-time apps\n  - type: websocket\n    enabled: false\n    websocket:\n      host: \"0.0.0.0\"\n      port: 8081\n      path: /ws\n\n  # gRPC for service-to-service\n  - type: grpc\n    enabled: false\n    grpc:\n      host: \"0.0.0.0\"\n      port: 9090\n      reflection: true\n\n  # Unix socket for local IPC\n  - type: unix\n    enabled: false\n    unix:\n      path: /var/run/metatools.sock\n      permissions: \"0660\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-search-strategy","title":"2. Search Strategy","text":"<p>Already implemented via build tags + interface:</p> <pre><code>// toolindex.Searcher interface\ntype Searcher interface {\n    Search(query string, limit int) ([]Summary, error)\n}\n\n// Implementations:\n// - Default lexical (built into toolindex)\n// - BM25 (toolsearch package, requires build tag)\n// - Semantic/vector (future, could use embeddings)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-tool-provider-registry","title":"3. Tool Provider Registry","text":"<p>New pattern to enable plug-and-play tools:</p> <pre><code>// ToolProvider interface\ntype ToolProvider interface {\n    Name() string\n    Tool() *mcp.Tool  // MCP tool definition with schema\n    Handle(ctx context.Context, input []byte) (any, error)\n}\n\n// Registry\ntype ToolRegistry struct {\n    providers map[string]ToolProvider\n}\n\nfunc (r *ToolRegistry) Register(p ToolProvider) {\n    r.providers[p.Name()] = p\n}\n\nfunc (r *ToolRegistry) All() []ToolProvider {\n    // Returns all registered providers\n}\n</code></pre> <p>Migration path: Convert existing handlers to ToolProvider implementations.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-backend-registry","title":"4. Backend Registry","text":"<p>For tool execution sources (local, API, MCP servers):</p> <pre><code>// Backend interface (already in toolmodel conceptually)\ntype Backend interface {\n    Kind() string\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Registry with configuration\ntype BackendRegistry struct {\n    backends map[string]Backend\n}\n\nfunc (r *BackendRegistry) RegisterFromConfig(cfg BackendConfig) error {\n    switch cfg.Kind {\n    case \"local\":\n        r.backends[\"local\"] = NewLocalBackend(cfg.Local)\n    case \"openai\":\n        r.backends[\"openai\"] = NewOpenAIBackend(cfg.OpenAI)\n    // ...\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-middleware-chain","title":"5. Middleware Chain","text":"<p>The middleware layer provides pluggable cross-cutting concerns using the decorator pattern.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_1","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         MIDDLEWARE CHAIN                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   Incoming Request                                                           \u2502\n\u2502         \u2502                                                                     \u2502\n\u2502         \u25bc                                                                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502   \u2502  Logging  \u2502 \u2192 \u2502   Auth    \u2502 \u2192 \u2502   Rate    \u2502 \u2192 \u2502  Caching  \u2502            \u2502\n\u2502   \u2502           \u2502   \u2502           \u2502   \u2502  Limiter  \u2502   \u2502           \u2502            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502         \u2502               \u2502               \u2502               \u2502                    \u2502\n\u2502         \u2502   on error:   \u2502   on error:   \u2502   on error:   \u2502                    \u2502\n\u2502         \u2502   log &amp; pass  \u2502   reject 401  \u2502   reject 429  \u2502                    \u2502\n\u2502         \u2502               \u2502               \u2502               \u2502                    \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                                         \u2502                                     \u2502\n\u2502                                         \u25bc                                     \u2502\n\u2502                               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502                               \u2502  Tool Handler \u2502                              \u2502\n\u2502                               \u2502   (actual)    \u2502                              \u2502\n\u2502                               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                         \u2502                                     \u2502\n\u2502                                         \u25bc                                     \u2502\n\u2502   Response flows back through chain (for metrics, logging, caching)         \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-middleware-interface","title":"The Middleware Interface","text":"<pre><code>// Middleware wraps a ToolProvider with additional behavior\ntype Middleware func(ToolProvider) ToolProvider\n\n// MiddlewareFunc is a convenience type for stateless middleware\ntype MiddlewareFunc func(ctx context.Context, input []byte, next NextFunc) (any, error)\n\ntype NextFunc func(ctx context.Context, input []byte) (any, error)\n\n// MiddlewareRegistry manages available middleware\ntype MiddlewareRegistry struct {\n    available map[string]MiddlewareFactory\n    active    []Middleware\n}\n\n// MiddlewareFactory creates configured middleware instances\ntype MiddlewareFactory func(cfg MiddlewareConfig) (Middleware, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#built-in-middleware","title":"Built-in Middleware","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        AVAILABLE MIDDLEWARE                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 LOGGING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Request/response logging                                              \u2502 \u2502\n\u2502  \u2502 - Configurable log levels (debug, info, warn, error)                   \u2502 \u2502\n\u2502  \u2502 - Structured JSON output                                                \u2502 \u2502\n\u2502  \u2502 - Request ID tracking                                                   \u2502 \u2502\n\u2502  \u2502 - Duration metrics                                                      \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 AUTHENTICATION                                                           \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Bearer token validation                                               \u2502 \u2502\n\u2502  \u2502 - API key authentication                                                \u2502 \u2502\n\u2502  \u2502 - OAuth2/OIDC integration                                               \u2502 \u2502\n\u2502  \u2502 - mTLS client certificates                                              \u2502 \u2502\n\u2502  \u2502 - Configurable bypass for specific tools                               \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 RATE LIMITING                                                            \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Per-client rate limits                                                \u2502 \u2502\n\u2502  \u2502 - Per-tool rate limits                                                  \u2502 \u2502\n\u2502  \u2502 - Token bucket algorithm                                                \u2502 \u2502\n\u2502  \u2502 - Sliding window counters                                               \u2502 \u2502\n\u2502  \u2502 - Redis-backed for distributed deployments                             \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 CACHING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Response caching for idempotent tools                                \u2502 \u2502\n\u2502  \u2502 - Configurable TTL per tool                                            \u2502 \u2502\n\u2502  \u2502 - Cache key customization                                               \u2502 \u2502\n\u2502  \u2502 - In-memory or Redis backend                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 METRICS                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Prometheus-compatible metrics                                         \u2502 \u2502\n\u2502  \u2502 - Request counts, latencies, error rates                               \u2502 \u2502\n\u2502  \u2502 - Per-tool and per-backend breakdowns                                  \u2502 \u2502\n\u2502  \u2502 - Custom metric labels                                                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 TRACING                                                                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - OpenTelemetry integration                                             \u2502 \u2502\n\u2502  \u2502 - Distributed trace propagation                                         \u2502 \u2502\n\u2502  \u2502 - Span creation for each tool call                                     \u2502 \u2502\n\u2502  \u2502 - Backend call tracing                                                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 VALIDATION                                                               \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - JSON Schema validation on inputs                                      \u2502 \u2502\n\u2502  \u2502 - Output validation                                                     \u2502 \u2502\n\u2502  \u2502 - Custom validators per tool                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementing-custom-middleware","title":"Implementing Custom Middleware","text":"<pre><code>// Example: Custom audit logging middleware\ntype AuditMiddleware struct {\n    logger AuditLogger\n    next   ToolProvider\n}\n\nfunc NewAuditMiddleware(logger AuditLogger) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        return &amp;AuditMiddleware{\n            logger: logger,\n            next:   next,\n        }\n    }\n}\n\nfunc (m *AuditMiddleware) Name() string { return m.next.Name() }\nfunc (m *AuditMiddleware) Tool() *mcp.Tool { return m.next.Tool() }\n\nfunc (m *AuditMiddleware) Handle(ctx context.Context, input []byte) (any, error) {\n    // Pre-execution: Log the request\n    requestID := uuid.New().String()\n    user := auth.UserFromContext(ctx)\n\n    m.logger.LogRequest(AuditEntry{\n        RequestID: requestID,\n        User:      user,\n        Tool:      m.next.Name(),\n        Input:     input,\n        Timestamp: time.Now(),\n    })\n\n    // Execute the actual tool\n    result, err := m.next.Handle(ctx, input)\n\n    // Post-execution: Log the result\n    m.logger.LogResponse(AuditEntry{\n        RequestID: requestID,\n        User:      user,\n        Tool:      m.next.Name(),\n        Success:   err == nil,\n        Duration:  time.Since(start),\n        Timestamp: time.Now(),\n    })\n\n    return result, err\n}\n\n// Register custom middleware\nfunc init() {\n    middleware.Register(\"audit\", func(cfg MiddlewareConfig) (Middleware, error) {\n        logger := newAuditLogger(cfg)\n        return NewAuditMiddleware(logger), nil\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-driven-middleware","title":"Configuration-Driven Middleware","text":"<pre><code># metatools.yaml\nmiddleware:\n  # Order matters - first in config = first in chain\n  chain:\n    - logging\n    - auth\n    - rate_limit\n    - metrics\n    - audit  # Custom middleware\n\n  # Per-middleware configuration\n  logging:\n    enabled: true\n    level: info\n    format: json\n    include_request_body: false\n    include_response_body: false\n\n  auth:\n    enabled: true\n    type: bearer\n    token_validation:\n      issuer: https://auth.example.com\n      audience: metatools-api\n    bypass_tools:\n      - search_tools  # Allow anonymous search\n      - list_namespaces\n\n  rate_limit:\n    enabled: true\n    default:\n      requests_per_minute: 100\n      burst: 20\n    per_tool:\n      execute_code:\n        requests_per_minute: 10\n        burst: 2\n    storage: memory  # or redis\n\n  metrics:\n    enabled: true\n    endpoint: /metrics\n    labels:\n      environment: production\n      service: metatools\n\n  cache:\n    enabled: true\n    backend: memory  # or redis\n    default_ttl: 5m\n    per_tool:\n      describe_tool:\n        ttl: 1h\n      search_tools:\n        ttl: 30s\n\n  audit:\n    enabled: true\n    destination: file\n    path: /var/log/metatools/audit.log\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-chain-construction","title":"Middleware Chain Construction","text":"<pre><code>// Chain construction from config\nfunc BuildMiddlewareChain(cfg MiddlewareConfig) ([]Middleware, error) {\n    var chain []Middleware\n\n    for _, name := range cfg.Chain {\n        mwCfg, ok := cfg.Middlewares[name]\n        if !ok || !mwCfg.Enabled {\n            continue\n        }\n\n        // Look up factory in registry\n        factory, ok := middleware.Get(name)\n        if !ok {\n            return nil, fmt.Errorf(\"unknown middleware: %s\", name)\n        }\n\n        // Create middleware instance\n        mw, err := factory(mwCfg)\n        if err != nil {\n            return nil, fmt.Errorf(\"middleware %s: %w\", name, err)\n        }\n\n        chain = append(chain, mw)\n    }\n\n    return chain, nil\n}\n\n// Apply chain to all providers\nfunc ApplyToRegistry(registry *ToolRegistry, chain []Middleware) {\n    for name, provider := range registry.providers {\n        wrapped := provider\n        for i := len(chain) - 1; i &gt;= 0; i-- {\n            wrapped = chain[i](wrapped)\n        }\n        registry.providers[name] = wrapped\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#request-flow-through-middleware","title":"Request Flow Through Middleware","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    REQUEST FLOW EXAMPLE                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client Request: run_tool(\"github/create_issue\", {...})                    \u2502\n\u2502                                                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 1. LOGGING MIDDLEWARE                                                 \u2502  \u2502\n\u2502   \u2502    - Generate request ID: \"req-abc123\"                               \u2502  \u2502\n\u2502   \u2502    - Log: \"Incoming request for github/create_issue\"                 \u2502  \u2502\n\u2502   \u2502    - Start timer                                                      \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next                                                     \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 2. AUTH MIDDLEWARE                                                    \u2502  \u2502\n\u2502   \u2502    - Extract token from Authorization header                         \u2502  \u2502\n\u2502   \u2502    - Validate JWT signature                                          \u2502  \u2502\n\u2502   \u2502    - Check claims (issuer, audience, expiry)                        \u2502  \u2502\n\u2502   \u2502    - Inject user into context                                        \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next (or reject with 401)                               \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 3. RATE LIMIT MIDDLEWARE                                              \u2502  \u2502\n\u2502   \u2502    - Identify client (by user, IP, or API key)                       \u2502  \u2502\n\u2502   \u2502    - Check token bucket for \"github/create_issue\"                    \u2502  \u2502\n\u2502   \u2502    - Consume token                                                    \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next (or reject with 429)                               \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 4. METRICS MIDDLEWARE                                                 \u2502  \u2502\n\u2502   \u2502    - Increment request counter                                        \u2502  \u2502\n\u2502   \u2502    - Start latency timer                                              \u2502  \u2502\n\u2502   \u2502    \u2192 Pass to next                                                     \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 5. ACTUAL TOOL HANDLER                                                \u2502  \u2502\n\u2502   \u2502    - Route to GitHub backend                                         \u2502  \u2502\n\u2502   \u2502    - Execute create_issue                                            \u2502  \u2502\n\u2502   \u2502    - Return result                                                    \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   Response bubbles back through chain:                                      \u2502\n\u2502   - Metrics: Record latency, success/failure                                \u2502\n\u2502   - Rate limit: (no action on response)                                     \u2502\n\u2502   - Auth: (no action on response)                                           \u2502\n\u2502   - Logging: Log response, duration, status                                 \u2502\n\u2502                                                                              \u2502\n\u2502   Final Response \u2192 Client                                                   \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#registering-custom-middleware","title":"Registering Custom Middleware","text":"<pre><code>// Register at init time (compile-time pluggability)\nfunc init() {\n    middleware.Register(\"my-custom\", NewMyCustomMiddleware)\n}\n\n// Or register at runtime (config-driven)\nfunc setupMiddleware(registry *MiddlewareRegistry) {\n    // Built-in middleware (always available)\n    registry.Register(\"logging\", NewLoggingMiddleware)\n    registry.Register(\"auth\", NewAuthMiddleware)\n    registry.Register(\"rate_limit\", NewRateLimitMiddleware)\n    registry.Register(\"metrics\", NewMetricsMiddleware)\n    registry.Register(\"cache\", NewCacheMiddleware)\n\n    // Custom middleware (loaded from config or plugins)\n    registry.Register(\"audit\", NewAuditMiddleware)\n    registry.Register(\"pii-filter\", NewPIIFilterMiddleware)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-composition-patterns","title":"Middleware Composition Patterns","text":"<pre><code>// Conditional middleware (only apply to certain tools)\nfunc OnlyForTools(tools []string, mw Middleware) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        if slices.Contains(tools, next.Name()) {\n            return mw(next)\n        }\n        return next\n    }\n}\n\n// Except middleware (skip for certain tools)\nfunc ExceptForTools(tools []string, mw Middleware) Middleware {\n    return func(next ToolProvider) ToolProvider {\n        if slices.Contains(tools, next.Name()) {\n            return next\n        }\n        return mw(next)\n    }\n}\n\n// Usage\nchain := []Middleware{\n    LoggingMiddleware,\n    ExceptForTools([]string{\"search_tools\"}, AuthMiddleware),\n    OnlyForTools([]string{\"execute_code\"}, StrictRateLimitMiddleware),\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#6-cache-layer","title":"6. Cache Layer","text":"<p>The cache layer provides pluggable caching across multiple components with support for different backends and layered caching strategies.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_2","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           CACHE LAYER                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      CACHE CONSUMERS                                     \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\u2502\n\u2502   \u2502  \u2502toolindex \u2502  \u2502tooldocs  \u2502  \u2502toolsearch\u2502  \u2502tooladapter\u2502  \u2502 toolrun  \u2502 \u2502\u2502\n\u2502   \u2502  \u2502 (lookup) \u2502  \u2502 (docs)   \u2502  \u2502 (search) \u2502  \u2502 (convert) \u2502  \u2502 (result) \u2502 \u2502\u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\u2502\n\u2502   \u2502       \u2502             \u2502             \u2502             \u2502             \u2502        \u2502\u2502\n\u2502   \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\u2502\n\u2502   \u2502                            \u2502                                            \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                \u2502                                              \u2502\n\u2502                                \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      toolcache.Cache INTERFACE                           \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   Get(ctx, key) \u2192 (value, bool, error)                                  \u2502\u2502\n\u2502   \u2502   Set(ctx, key, value, ttl) \u2192 error                                     \u2502\u2502\n\u2502   \u2502   Delete(ctx, key) \u2192 error                                               \u2502\u2502\n\u2502   \u2502   Clear(ctx, pattern) \u2192 error                                            \u2502\u2502\n\u2502   \u2502   Stats() \u2192 CacheStats                                                   \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                \u2502                                              \u2502\n\u2502                                \u25bc                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      LAYERED CACHE (L1 + L2)                             \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\u2502\n\u2502   \u2502   \u2502 L1: In-Memory (hot data, microsecond access)                    \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - LRU eviction                                               \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Size-bounded                                               \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Process-local                                              \u2502   \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\u2502\n\u2502   \u2502                            \u2502 miss                                        \u2502\u2502\n\u2502   \u2502                            \u25bc                                             \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\u2502\n\u2502   \u2502   \u2502 L2: Distributed (warm data, millisecond access)                 \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Redis, Memcached, DynamoDB                                \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - Shared across instances                                    \u2502   \u2502\u2502\n\u2502   \u2502   \u2502     - TTL-based expiration                                       \u2502   \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502   \u2502                      CACHE BACKENDS                                      \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\u2502\n\u2502   \u2502   \u2502In-Memory\u2502  \u2502  Redis  \u2502  \u2502Memcached\u2502  \u2502 SQLite  \u2502  \u2502 Custom  \u2502      \u2502\u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\u2502\n\u2502   \u2502                                                                          \u2502\u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-interface","title":"Cache Interface","text":"<pre><code>// toolcache/cache.go\n\n// Cache defines the pluggable cache interface\ntype Cache interface {\n    // Get retrieves a value, returns (value, found, error)\n    Get(ctx context.Context, key string) ([]byte, bool, error)\n\n    // Set stores a value with TTL (0 = no expiration)\n    Set(ctx context.Context, key string, value []byte, ttl time.Duration) error\n\n    // Delete removes a key\n    Delete(ctx context.Context, key string) error\n\n    // Clear removes keys matching pattern (e.g., \"toolindex:*\")\n    Clear(ctx context.Context, pattern string) error\n\n    // Stats returns cache statistics\n    Stats() CacheStats\n\n    // Close releases resources\n    Close() error\n}\n\n// CacheStats provides observability\ntype CacheStats struct {\n    Hits       int64\n    Misses     int64\n    Size       int64\n    Evictions  int64\n    HitRate    float64\n}\n\n// TypedCache provides type-safe caching with serialization\ntype TypedCache[T any] interface {\n    Get(ctx context.Context, key string) (T, bool, error)\n    Set(ctx context.Context, key string, value T, ttl time.Duration) error\n    GetOrCompute(ctx context.Context, key string, compute func() (T, error), ttl time.Duration) (T, error)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-backends","title":"Cache Backends","text":"<pre><code>// toolcache/memory.go - In-memory LRU cache\ntype MemoryCache struct {\n    maxSize    int64\n    lru        *lru.Cache[string, []byte]\n    stats      CacheStats\n    mu         sync.RWMutex\n}\n\nfunc NewMemoryCache(opts MemoryCacheOptions) *MemoryCache {\n    return &amp;MemoryCache{\n        maxSize: opts.MaxSize,\n        lru:     lru.New[string, []byte](opts.MaxItems),\n    }\n}\n\n// toolcache/redis.go - Redis-backed cache\ntype RedisCache struct {\n    client  *redis.Client\n    prefix  string\n    stats   CacheStats\n}\n\nfunc NewRedisCache(opts RedisCacheOptions) (*RedisCache, error) {\n    client := redis.NewClient(&amp;redis.Options{\n        Addr:     opts.Addr,\n        Password: opts.Password,\n        DB:       opts.DB,\n    })\n    return &amp;RedisCache{\n        client: client,\n        prefix: opts.Prefix,\n    }, nil\n}\n\n// toolcache/sqlite.go - SQLite-backed persistent cache\ntype SQLiteCache struct {\n    db     *sql.DB\n    stats  CacheStats\n}\n\n// toolcache/layered.go - L1 + L2 layered cache\ntype LayeredCache struct {\n    l1      Cache  // Fast, local (memory)\n    l2      Cache  // Slower, shared (Redis)\n    l1TTL   time.Duration\n}\n\nfunc NewLayeredCache(l1, l2 Cache, l1TTL time.Duration) *LayeredCache {\n    return &amp;LayeredCache{l1: l1, l2: l2, l1TTL: l1TTL}\n}\n\nfunc (c *LayeredCache) Get(ctx context.Context, key string) ([]byte, bool, error) {\n    // Try L1 first\n    if val, ok, _ := c.l1.Get(ctx, key); ok {\n        return val, true, nil\n    }\n\n    // Fall back to L2\n    val, ok, err := c.l2.Get(ctx, key)\n    if err != nil || !ok {\n        return nil, false, err\n    }\n\n    // Promote to L1\n    _ = c.l1.Set(ctx, key, val, c.l1TTL)\n    return val, true, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-points-in-the-architecture","title":"Cache Points in the Architecture","text":"Component Cache Key Pattern TTL Purpose toolindex <code>index:tool:{id}</code> 1h Tool metadata lookups toolindex <code>index:namespace:{ns}</code> 30m Namespace listings tooldocs <code>docs:{id}:{level}</code> 1h Documentation at each detail level toolsearch <code>search:{hash(query)}</code> 5m Search result caching toolsearch <code>search:index</code> 10m BM25 index caching tooladapter <code>schema:{format}:{id}</code> 24h Schema conversion results toolrun <code>result:{tool}:{hash(input)}</code> varies Idempotent tool results toolsemantic <code>embed:{hash(text)}</code> 24h Vector embeddings"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#integration-with-existing-libraries","title":"Integration with Existing Libraries","text":"<pre><code>// toolindex integration\ntype CachedIndex struct {\n    inner toolindex.Index\n    cache toolcache.Cache\n    ttl   time.Duration\n}\n\nfunc (c *CachedIndex) Get(ctx context.Context, id string) (*toolmodel.Tool, error) {\n    key := fmt.Sprintf(\"index:tool:%s\", id)\n\n    // Try cache first\n    if data, ok, _ := c.cache.Get(ctx, key); ok {\n        var tool toolmodel.Tool\n        if err := json.Unmarshal(data, &amp;tool); err == nil {\n            return &amp;tool, nil\n        }\n    }\n\n    // Cache miss - fetch from index\n    tool, err := c.inner.Get(ctx, id)\n    if err != nil {\n        return nil, err\n    }\n\n    // Store in cache\n    if data, err := json.Marshal(tool); err == nil {\n        _ = c.cache.Set(ctx, key, data, c.ttl)\n    }\n\n    return tool, nil\n}\n\n// toolsearch integration\ntype CachedSearcher struct {\n    inner toolsearch.Searcher\n    cache toolcache.Cache\n    ttl   time.Duration\n}\n\nfunc (c *CachedSearcher) Search(ctx context.Context, query string, limit int) ([]toolsearch.Result, error) {\n    key := fmt.Sprintf(\"search:%x\", sha256.Sum256([]byte(query)))\n\n    // Try cache\n    if data, ok, _ := c.cache.Get(ctx, key); ok {\n        var results []toolsearch.Result\n        if err := json.Unmarshal(data, &amp;results); err == nil {\n            return results, nil\n        }\n    }\n\n    // Execute search\n    results, err := c.inner.Search(ctx, query, limit)\n    if err != nil {\n        return nil, err\n    }\n\n    // Cache results\n    if data, err := json.Marshal(results); err == nil {\n        _ = c.cache.Set(ctx, key, data, c.ttl)\n    }\n\n    return results, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-configuration","title":"Cache Configuration","text":"<pre><code># metatools.yaml\ncache:\n  # Default backend for all caches\n  backend: layered\n\n  # Backend configurations\n  backends:\n    memory:\n      max_size: 100MB\n      max_items: 10000\n\n    redis:\n      addr: localhost:6379\n      password: ${REDIS_PASSWORD}\n      db: 0\n      prefix: metatools\n\n    sqlite:\n      path: /var/cache/metatools/cache.db\n\n    layered:\n      l1: memory\n      l2: redis\n      l1_ttl: 1m\n\n  # Per-component cache settings\n  components:\n    toolindex:\n      enabled: true\n      ttl: 1h\n      backend: layered\n\n    tooldocs:\n      enabled: true\n      ttl: 1h\n      backend: memory  # Docs are static, memory is fine\n\n    toolsearch:\n      enabled: true\n      ttl: 5m\n      backend: redis  # Shared across instances\n\n    tooladapter:\n      enabled: true\n      ttl: 24h\n      backend: sqlite  # Persistent, conversions are expensive\n\n    toolrun:\n      enabled: true\n      ttl: 0  # Per-tool configuration\n      backend: redis\n      # Only cache idempotent tools\n      tools:\n        - describe_tool\n        - list_namespaces\n        - search_tools\n\n  # Cache invalidation\n  invalidation:\n    on_tool_register: true    # Clear index caches\n    on_doc_update: true       # Clear docs caches\n    webhook_endpoint: /cache/invalidate\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#cache-invalidation-strategies","title":"Cache Invalidation Strategies","text":"<pre><code>// toolcache/invalidation.go\n\n// InvalidationStrategy defines how cache entries are invalidated\ntype InvalidationStrategy interface {\n    OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error\n    OnToolUnregistered(ctx context.Context, toolID string) error\n    OnDocUpdated(ctx context.Context, toolID string) error\n}\n\n// PatternInvalidation clears by key patterns\ntype PatternInvalidation struct {\n    cache Cache\n}\n\nfunc (p *PatternInvalidation) OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error {\n    patterns := []string{\n        fmt.Sprintf(\"index:tool:%s\", tool.ID()),\n        fmt.Sprintf(\"index:namespace:%s\", tool.Namespace),\n        \"search:*\",  // All search results potentially affected\n    }\n    for _, pattern := range patterns {\n        if err := p.cache.Clear(ctx, pattern); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n// TTLInvalidation relies on TTL expiration (simpler, eventually consistent)\ntype TTLInvalidation struct{}\n\nfunc (t *TTLInvalidation) OnToolRegistered(ctx context.Context, tool *toolmodel.Tool) error {\n    // No-op: cache will expire naturally\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-library-toolcache","title":"Proposed Library: <code>toolcache</code>","text":"<pre><code>toolcache/\n\u251c\u2500\u2500 cache.go           # Cache interface\n\u251c\u2500\u2500 memory.go          # In-memory LRU implementation\n\u251c\u2500\u2500 redis.go           # Redis implementation\n\u251c\u2500\u2500 sqlite.go          # SQLite implementation\n\u251c\u2500\u2500 layered.go         # L1+L2 layered cache\n\u251c\u2500\u2500 stats.go           # Statistics and metrics\n\u251c\u2500\u2500 invalidation.go    # Invalidation strategies\n\u251c\u2500\u2500 typed.go           # Type-safe generic wrapper\n\u251c\u2500\u2500 config.go          # Configuration parsing\n\u2514\u2500\u2500 wrappers/\n    \u251c\u2500\u2500 index.go       # toolindex.Index wrapper\n    \u251c\u2500\u2500 docs.go        # tooldocs.Store wrapper\n    \u251c\u2500\u2500 search.go      # toolsearch.Searcher wrapper\n    \u2514\u2500\u2500 adapter.go     # tooladapter.Adapter wrapper\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#7-additional-cross-cutting-concerns","title":"7. Additional Cross-Cutting Concerns","text":"<p>Beyond the core extension points, production deployments require additional pluggable concerns for resilience, security, and operations.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#71-resilience-patterns","title":"7.1 Resilience Patterns","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       RESILIENCE LAYER                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 CIRCUIT BREAKER                                                          \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 States: CLOSED \u2192 OPEN \u2192 HALF-OPEN \u2192 CLOSED                              \u2502 \u2502\n\u2502  \u2502 - Monitors failure rate per backend/tool                                 \u2502 \u2502\n\u2502  \u2502 - Opens circuit after threshold (e.g., 50% failures in 10s window)      \u2502 \u2502\n\u2502  \u2502 - Allows probe requests in half-open state                               \u2502 \u2502\n\u2502  \u2502 - Prevents cascading failures across backends                            \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 RETRY POLICY                                                             \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Exponential backoff with jitter (prevents retry storms)               \u2502 \u2502\n\u2502  \u2502 - Per-tool retry configuration (idempotent ops only)                    \u2502 \u2502\n\u2502  \u2502 - Retry budgets (max retries per time window)                           \u2502 \u2502\n\u2502  \u2502 - Non-retryable error classification                                     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 BULKHEAD                                                                 \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Isolated resource pools per backend                                    \u2502 \u2502\n\u2502  \u2502 - Semaphore-based concurrency limits                                     \u2502 \u2502\n\u2502  \u2502 - Prevents resource exhaustion from single backend                      \u2502 \u2502\n\u2502  \u2502 - Configurable queue depth and timeout                                   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 TIMEOUT MANAGEMENT                                                       \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 - Per-tool timeout configuration                                         \u2502 \u2502\n\u2502  \u2502 - Cascading timeouts (request \u2192 backend \u2192 tool)                         \u2502 \u2502\n\u2502  \u2502 - Context deadline propagation                                           \u2502 \u2502\n\u2502  \u2502 - Graceful timeout handling with partial results                        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <pre><code>// toolresilience/circuit_breaker.go\n\ntype CircuitBreaker interface {\n    Execute(ctx context.Context, fn func() error) error\n    State() CircuitState\n    Reset()\n}\n\ntype CircuitState int\n\nconst (\n    StateClosed CircuitState = iota\n    StateOpen\n    StateHalfOpen\n)\n\ntype CircuitBreakerConfig struct {\n    FailureThreshold    int           // failures before opening\n    SuccessThreshold    int           // successes in half-open before closing\n    Timeout             time.Duration // time in open state before half-open\n    WindowSize          time.Duration // sliding window for failure counting\n}\n\n// toolresilience/retry.go\n\ntype RetryPolicy interface {\n    Execute(ctx context.Context, fn func() error) error\n    ShouldRetry(err error, attempt int) bool\n}\n\ntype RetryConfig struct {\n    MaxAttempts     int\n    InitialBackoff  time.Duration\n    MaxBackoff      time.Duration\n    BackoffFactor   float64\n    Jitter          float64       // 0-1, randomization factor\n    RetryBudget     *RetryBudget  // optional rate limiting\n    NonRetryable    []error       // errors that should not be retried\n}\n\n// toolresilience/bulkhead.go\n\ntype Bulkhead interface {\n    Acquire(ctx context.Context) error\n    Release()\n    Available() int\n}\n\ntype BulkheadConfig struct {\n    MaxConcurrent int\n    MaxWait       time.Duration\n    QueueDepth    int\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#72-health-checks","title":"7.2 Health Checks","text":"<pre><code>// toolhealth/health.go\n\ntype HealthChecker interface {\n    Check(ctx context.Context) HealthStatus\n    Name() string\n}\n\ntype HealthStatus struct {\n    Status    Status            // healthy, degraded, unhealthy\n    Details   map[string]any\n    Timestamp time.Time\n}\n\ntype Status string\n\nconst (\n    StatusHealthy   Status = \"healthy\"\n    StatusDegraded  Status = \"degraded\"\n    StatusUnhealthy Status = \"unhealthy\"\n)\n\n// Composite health aggregates multiple checkers\ntype CompositeHealth struct {\n    checkers []HealthChecker\n}\n\nfunc (c *CompositeHealth) Check(ctx context.Context) HealthStatus {\n    results := make(map[string]HealthStatus)\n    overall := StatusHealthy\n\n    for _, checker := range c.checkers {\n        status := checker.Check(ctx)\n        results[checker.Name()] = status\n\n        if status.Status == StatusUnhealthy {\n            overall = StatusUnhealthy\n        } else if status.Status == StatusDegraded &amp;&amp; overall != StatusUnhealthy {\n            overall = StatusDegraded\n        }\n    }\n\n    return HealthStatus{\n        Status:    overall,\n        Details:   map[string]any{\"components\": results},\n        Timestamp: time.Now(),\n    }\n}\n\n// Built-in health checkers\ntype BackendHealthChecker struct{ registry BackendRegistry }\ntype CacheHealthChecker struct{ cache Cache }\ntype SearchHealthChecker struct{ index Index }\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#73-secrets-management","title":"7.3 Secrets Management","text":"<pre><code>// toolsecrets/secrets.go\n\ntype SecretsManager interface {\n    Get(ctx context.Context, key string) (string, error)\n    GetWithMetadata(ctx context.Context, key string) (*Secret, error)\n    Watch(ctx context.Context, key string, callback func(*Secret)) error\n    Close() error\n}\n\ntype Secret struct {\n    Value     string\n    Version   int\n    ExpiresAt time.Time\n    Metadata  map[string]string\n}\n\n// Implementations\ntype VaultSecretsManager struct {\n    client       *vault.Client\n    secretPath   string\n    cacheTTL     time.Duration\n    rotationChan chan string\n}\n\ntype AWSSecretsManager struct {\n    client *secretsmanager.Client\n    region string\n}\n\ntype EnvSecretsManager struct {\n    prefix string  // e.g., \"METATOOLS_SECRET_\"\n}\n</code></pre> <pre><code># metatools.yaml\nsecrets:\n  provider: vault  # vault, aws, env, file\n\n  vault:\n    addr: ${VAULT_ADDR}\n    auth_method: kubernetes  # token, kubernetes, approle\n    secret_path: secret/data/metatools\n    cache_ttl: 5m\n\n  # Backend credentials resolved from secrets\n  backends:\n    openai:\n      api_key: \"{{ secrets.openai_api_key }}\"\n    github:\n      token: \"{{ secrets.github_token }}\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#74-configuration-hot-reload","title":"7.4 Configuration Hot-Reload","text":"<pre><code>// toolconfig/watcher.go\n\ntype ConfigWatcher interface {\n    Watch(ctx context.Context, path string, callback func(Config)) error\n    Stop() error\n}\n\ntype FSConfigWatcher struct {\n    watcher *fsnotify.Watcher\n    parser  ConfigParser\n}\n\nfunc (w *FSConfigWatcher) Watch(ctx context.Context, path string, callback func(Config)) error {\n    if err := w.watcher.Add(path); err != nil {\n        return err\n    }\n\n    go func() {\n        for {\n            select {\n            case event := &lt;-w.watcher.Events:\n                if event.Op&amp;fsnotify.Write == fsnotify.Write {\n                    if cfg, err := w.parser.Parse(path); err == nil {\n                        callback(cfg)\n                    }\n                }\n            case &lt;-ctx.Done():\n                return\n            }\n        }\n    }()\n\n    return nil\n}\n\n// Hot-reloadable components\ntype HotReloadable interface {\n    Reload(cfg Config) error\n}\n\n// Registry tracks reloadable components\ntype ReloadRegistry struct {\n    components map[string]HotReloadable\n}\n\nfunc (r *ReloadRegistry) ReloadAll(cfg Config) error {\n    for name, component := range r.components {\n        if err := component.Reload(cfg); err != nil {\n            return fmt.Errorf(\"reload %s: %w\", name, err)\n        }\n    }\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#75-feature-flags","title":"7.5 Feature Flags","text":"<pre><code>// toolflags/flags.go\n\ntype FeatureFlags interface {\n    IsEnabled(ctx context.Context, flag string) bool\n    GetVariant(ctx context.Context, flag string) string\n    AllFlags(ctx context.Context) map[string]bool\n}\n\n// Local file-based flags (simple deployments)\ntype LocalFeatureFlags struct {\n    flags map[string]bool\n    mu    sync.RWMutex\n}\n\n// LaunchDarkly integration (enterprise)\ntype LaunchDarklyFlags struct {\n    client *ld.LDClient\n    user   func(ctx context.Context) ld.User\n}\n\n// Use case: Gradual tool rollout\nfunc (h *Handler) RunTool(ctx context.Context, req Request) (Response, error) {\n    if h.flags.IsEnabled(ctx, \"new_execution_engine\") {\n        return h.newRunner.Run(ctx, req)\n    }\n    return h.legacyRunner.Run(ctx, req)\n}\n</code></pre> <pre><code># metatools.yaml\nfeature_flags:\n  provider: local  # local, launchdarkly, unleash\n\n  local:\n    path: /etc/metatools/flags.yaml\n    reload_interval: 30s\n\n  flags:\n    new_execution_engine: false\n    semantic_search: true\n    multi_tenant_mode: false\n    streaming_responses: true\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#76-audit-trail-event-sourcing","title":"7.6 Audit Trail / Event Sourcing","text":"<pre><code>// toolaudit/audit.go\n\ntype AuditLogger interface {\n    Log(ctx context.Context, event AuditEvent) error\n    Query(ctx context.Context, filter AuditFilter) ([]AuditEvent, error)\n}\n\ntype AuditEvent struct {\n    ID          string\n    Timestamp   time.Time\n    EventType   EventType\n    Actor       Actor\n    Resource    Resource\n    Action      string\n    Outcome     Outcome\n    Details     map[string]any\n    RequestID   string\n    SessionID   string\n}\n\ntype EventType string\n\nconst (\n    EventToolExecution   EventType = \"tool.execution\"\n    EventToolDiscovery   EventType = \"tool.discovery\"\n    EventConfigChange    EventType = \"config.change\"\n    EventAuthAttempt     EventType = \"auth.attempt\"\n    EventBackendError    EventType = \"backend.error\"\n)\n\n// Implementations\ntype FileAuditLogger struct{ path string }\ntype DatabaseAuditLogger struct{ db *sql.DB }\ntype CloudWatchAuditLogger struct{ client *cloudwatchlogs.Client }\n\n// Compliance-ready: immutable append-only log\ntype ImmutableAuditLogger struct {\n    inner  AuditLogger\n    signer crypto.Signer  // Signs each entry\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#77-backpressure-load-shedding","title":"7.7 Backpressure / Load Shedding","text":"<pre><code>// toolpressure/backpressure.go\n\ntype LoadShedder interface {\n    ShouldShed(ctx context.Context) bool\n    CurrentLoad() float64\n}\n\ntype AdaptiveLoadShedder struct {\n    targetLatency time.Duration\n    maxLoad       float64\n\n    // Metrics\n    currentLatency atomic.Value\n    activeRequests atomic.Int64\n}\n\nfunc (s *AdaptiveLoadShedder) ShouldShed(ctx context.Context) bool {\n    // Little's Law: if latency &gt; target and load &gt; threshold, shed\n    latency := s.currentLatency.Load().(time.Duration)\n    load := float64(s.activeRequests.Load()) / s.maxLoad\n\n    return latency &gt; s.targetLatency &amp;&amp; load &gt; 0.8\n}\n\n// Priority-based shedding\ntype PriorityLoadShedder struct {\n    inner      LoadShedder\n    priorities map[string]int  // tool -&gt; priority (higher = more important)\n}\n\nfunc (s *PriorityLoadShedder) ShouldShed(ctx context.Context, tool string) bool {\n    if !s.inner.ShouldShed(ctx) {\n        return false\n    }\n\n    // Don't shed high-priority tools\n    priority := s.priorities[tool]\n    return priority &lt; 5  // Only shed low-priority requests\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-for-all-concerns","title":"Configuration for All Concerns","text":"<pre><code># metatools.yaml - Cross-Cutting Concerns\nresilience:\n  circuit_breaker:\n    enabled: true\n    failure_threshold: 5\n    success_threshold: 2\n    timeout: 30s\n    window_size: 10s\n\n  retry:\n    enabled: true\n    max_attempts: 3\n    initial_backoff: 100ms\n    max_backoff: 5s\n    jitter: 0.2\n\n  bulkhead:\n    enabled: true\n    default_concurrent: 100\n    per_backend:\n      openai: 50    # Rate-limited API\n      github: 200\n      local: 500\n\n  timeout:\n    default: 30s\n    per_tool:\n      execute_code: 120s\n      search_tools: 5s\n\nhealth:\n  endpoint: /health\n  detailed_endpoint: /health/detailed\n  check_interval: 10s\n  components:\n    - backends\n    - cache\n    - search_index\n\nbackpressure:\n  enabled: true\n  target_latency: 500ms\n  max_concurrent: 1000\n  shed_priority_below: 5\n\naudit:\n  enabled: true\n  provider: file  # file, database, cloudwatch\n  path: /var/log/metatools/audit.log\n  events:\n    - tool.execution\n    - auth.attempt\n    - config.change\n  retention_days: 90\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#summary-cross-cutting-concerns-catalog","title":"Summary: Cross-Cutting Concerns Catalog","text":"Concern Purpose Priority Proposed Library Cache Response/metadata caching High <code>toolcache</code> Circuit Breaker Prevent cascading failures High <code>toolresilience</code> Retry Handle transient failures High <code>toolresilience</code> Bulkhead Resource isolation Medium <code>toolresilience</code> Health Checks Monitoring/orchestration High <code>toolhealth</code> Secrets Credential management High <code>toolsecrets</code> Config Reload Zero-downtime updates Medium <code>toolconfig</code> Feature Flags Gradual rollout Medium <code>toolflags</code> Audit Trail Compliance/debugging High <code>toolaudit</code> Backpressure Overload protection Medium <code>toolpressure</code> Timeout Deadline management High Built-in (context) Tracing Distributed observability High <code>toolobserve</code>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-backend-architecture","title":"Multi-Backend Architecture","text":"<p>The backend layer is the foundation for tool discovery and execution. It enables metatools-mcp to aggregate tools from multiple sources while presenting a unified interface to MCP clients.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-overview_3","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           MCP CLIENT                                         \u2502\n\u2502                    (Claude, Cursor, Custom)                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502 MCP Protocol\n                                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS-MCP SERVER                                 \u2502\n\u2502                                                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                      UNIFIED TOOL INTERFACE                              \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2502   search_tools    describe_tool    run_tool    run_chain    execute_code \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                    \u2502                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                       BACKEND REGISTRY                                   \u2502 \u2502\n\u2502  \u2502                                                                           \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502 \u2502\n\u2502  \u2502   \u2502   LOCAL     \u2502 \u2502   OPENAI    \u2502 \u2502    MCP      \u2502 \u2502   CUSTOM    \u2502       \u2502 \u2502\n\u2502  \u2502   \u2502  Backend    \u2502 \u2502  Backend    \u2502 \u2502  Backend    \u2502 \u2502  Backend    \u2502       \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502 \u2502\n\u2502  \u2502          \u2502               \u2502               \u2502               \u2502               \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502               \u2502               \u2502               \u2502\n              \u25bc               \u25bc               \u25bc               \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502  Local   \u2502   \u2502  OpenAI  \u2502   \u2502  Other   \u2502   \u2502  Custom  \u2502\n        \u2502  Files   \u2502   \u2502   API    \u2502   \u2502   MCP    \u2502   \u2502   API    \u2502\n        \u2502          \u2502   \u2502          \u2502   \u2502 Servers  \u2502   \u2502          \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#the-backend-interface","title":"The Backend Interface","text":"<p>Each backend implements a common interface, allowing uniform handling regardless of the tool source:</p> <pre><code>// Backend defines a source of tools\ntype Backend interface {\n    // Identity\n    Kind() string                                    // e.g., \"local\", \"openai\", \"mcp\"\n    Name() string                                    // Instance name for disambiguation\n\n    // Configuration\n    Configure(raw []byte) error                      // Parse backend-specific config\n\n    // Discovery\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n\n    // Execution\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n\n    // Lifecycle\n    Start(ctx context.Context) error\n    Stop() error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#backend-types","title":"Backend Types","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#1-local-backend","title":"1. Local Backend","text":"<p>Tools defined as files on disk (YAML, JSON, or Go handlers).</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   LOCAL BACKEND                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   ~/.config/metatools/tools/                         \u2502\n\u2502   \u251c\u2500\u2500 calculator.yaml      \u2192 Tool definition         \u2502\n\u2502   \u251c\u2500\u2500 file-ops.yaml        \u2192 Tool definition         \u2502\n\u2502   \u2514\u2500\u2500 custom/                                        \u2502\n\u2502       \u2514\u2500\u2500 my-tool.yaml     \u2192 Tool definition         \u2502\n\u2502                                                       \u2502\n\u2502   /usr/share/metatools/tools/                        \u2502\n\u2502   \u2514\u2500\u2500 system-tools.yaml    \u2192 System-wide tools       \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    paths:                                            \u2502\n\u2502      - ~/.config/metatools/tools                    \u2502\n\u2502      - /usr/share/metatools/tools                   \u2502\n\u2502    watch: true  # Hot reload on changes             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#2-api-backends-openai-azure-anthropic","title":"2. API Backends (OpenAI, Azure, Anthropic)","text":"<p>Tools exposed via LLM provider APIs.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   OPENAI BACKEND                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502   \u2502 metatools   \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  OpenAI API         \u2502    \u2502\n\u2502   \u2502   run_tool  \u2502        \u2502  /chat/completions  \u2502    \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502  (function calling) \u2502    \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    api_key: ${OPENAI_API_KEY}                       \u2502\n\u2502    organization: ${OPENAI_ORG}                      \u2502\n\u2502    models:                                           \u2502\n\u2502      - gpt-4                                        \u2502\n\u2502      - gpt-4-turbo                                  \u2502\n\u2502    timeout: 30s                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#3-mcp-backend","title":"3. MCP Backend","text":"<p>Connect to other MCP servers as tool sources.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    MCP BACKEND                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   metatools-mcp                                      \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u2502 stdio                                       \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502   \u2502  GitHub     \u2502  \u2190 npx @modelcontextprotocol/     \u2502\n\u2502   \u2502  MCP Server \u2502       server-github               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   GitHub API tools:                                  \u2502\n\u2502   - create_issue                                    \u2502\n\u2502   - list_pull_requests                              \u2502\n\u2502   - search_code                                     \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    kind: mcp                                        \u2502\n\u2502    command: npx                                     \u2502\n\u2502    args:                                            \u2502\n\u2502      - \"-y\"                                         \u2502\n\u2502      - \"@modelcontextprotocol/server-github\"        \u2502\n\u2502    env:                                             \u2502\n\u2502      GITHUB_TOKEN: ${GITHUB_TOKEN}                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#4-http-backend","title":"4. HTTP Backend","text":"<p>Tools exposed via REST APIs.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   HTTP BACKEND                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   metatools-mcp                                      \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u2502 HTTPS                                       \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502   \u2502  Internal Tool Server   \u2502                       \u2502\n\u2502   \u2502  tools.company.internal \u2502                       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502        \u2502                                             \u2502\n\u2502        \u25bc                                             \u2502\n\u2502   Endpoints:                                         \u2502\n\u2502   - POST /tools/list                                \u2502\n\u2502   - POST /tools/{name}/execute                      \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config:                                             \u2502\n\u2502    base_url: https://tools.company.internal         \u2502\n\u2502    auth:                                            \u2502\n\u2502      type: oauth2                                   \u2502\n\u2502      client_id: ${OAUTH_CLIENT_ID}                  \u2502\n\u2502      client_secret: ${OAUTH_CLIENT_SECRET}          \u2502\n\u2502    headers:                                         \u2502\n\u2502      X-Custom-Header: value                         \u2502\n\u2502    timeout: 30s                                     \u2502\n\u2502    retry:                                           \u2502\n\u2502      max_attempts: 3                                \u2502\n\u2502      backoff: exponential                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#5-custom-backend","title":"5. Custom Backend","text":"<p>For specialized integrations that don't fit standard patterns.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  CUSTOM BACKEND                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                       \u2502\n\u2502   Implement the Backend interface in Go:             \u2502\n\u2502                                                       \u2502\n\u2502   type MyCustomBackend struct {                     \u2502\n\u2502       // Your fields                                \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Kind() string {         \u2502\n\u2502       return \"my-custom\"                            \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Configure(raw []byte)   \u2502\n\u2502       error {                                       \u2502\n\u2502       // Parse your custom config                   \u2502\n\u2502       return yaml.Unmarshal(raw, &amp;b.config)         \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u2502   func (b *MyCustomBackend) Execute(ctx, tool,      \u2502\n\u2502       args) (any, error) {                          \u2502\n\u2502       // Your execution logic                       \u2502\n\u2502   }                                                  \u2502\n\u2502                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Config (passed as raw bytes):                      \u2502\n\u2502    kind: custom                                     \u2502\n\u2502    handler: my-custom                               \u2502\n\u2502    config:                                          \u2502\n\u2502      whatever_you_need: value                       \u2502\n\u2502      nested:                                        \u2502\n\u2502        custom: structure                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-examples","title":"Configuration Examples","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comprehensive-multi-backend-setup","title":"Comprehensive Multi-Backend Setup","text":"<pre><code># metatools.yaml\nbackends:\n  # Local file-based tools\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n      - /usr/share/metatools/tools\n    watch: true  # Hot reload\n\n  # OpenAI function calling\n  openai:\n    enabled: true\n    api_key: ${OPENAI_API_KEY}\n    organization: ${OPENAI_ORG}\n    models:\n      - gpt-4\n      - gpt-4-turbo\n    timeout: 30s\n\n  # Azure OpenAI\n  azure-openai:\n    enabled: true\n    kind: azure\n    config:\n      endpoint: https://my-resource.openai.azure.com\n      api_key: ${AZURE_OPENAI_KEY}\n      api_version: \"2024-02-15-preview\"\n      deployment: gpt-4\n\n  # GitHub MCP server\n  github:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n      env:\n        GITHUB_TOKEN: ${GITHUB_TOKEN}\n\n  # Filesystem MCP server\n  filesystem:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"/home/user/projects\"]\n\n  # Internal company tool server\n  internal-tools:\n    enabled: true\n    kind: http\n    config:\n      base_url: https://tools.internal.company.com/api/v1\n      auth:\n        type: oauth2\n        token_url: https://auth.company.com/oauth/token\n        client_id: ${INTERNAL_CLIENT_ID}\n        client_secret: ${INTERNAL_CLIENT_SECRET}\n        scopes: [\"tools:read\", \"tools:execute\"]\n      timeout: 60s\n\n  # LangChain tools\n  langchain:\n    enabled: false\n    kind: custom\n    config:\n      toolkit: serpapi\n      api_key: ${SERPAPI_KEY}\n\n  # Database tools\n  database:\n    enabled: true\n    kind: custom\n    config:\n      driver: postgres\n      connection_string: ${DATABASE_URL}\n      read_only: true\n      allowed_schemas: [\"public\", \"analytics\"]\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-aggregation-flow","title":"Tool Aggregation Flow","text":"<p>When a client searches for or executes tools, metatools-mcp aggregates across all backends:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TOOL SEARCH FLOW                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client: search_tools(\"file operations\")                                   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                    BACKEND REGISTRY                                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502   \u2502\n\u2502   \u2502   \u2502  local  \u2502   \u2502 github  \u2502   \u2502  azure  \u2502   \u2502  http   \u2502            \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518            \u2502   \u2502\n\u2502   \u2502        \u2502             \u2502             \u2502             \u2502                  \u2502   \u2502\n\u2502   \u2502        \u25bc             \u25bc             \u25bc             \u25bc                  \u2502   \u2502\n\u2502   \u2502   ListTools()   ListTools()   ListTools()   ListTools()            \u2502   \u2502\n\u2502   \u2502        \u2502             \u2502             \u2502             \u2502                  \u2502   \u2502\n\u2502   \u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502   \u2502\n\u2502   \u2502                             \u2502                                        \u2502   \u2502\n\u2502   \u2502                             \u25bc                                        \u2502   \u2502\n\u2502   \u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502   \u2502\n\u2502   \u2502                    \u2502   AGGREGATOR    \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Merge tools  \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Deduplicate  \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2502  - Apply search \u2502                              \u2502   \u2502\n\u2502   \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502   \u2502\n\u2502   \u2502                             \u2502                                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                 \u25bc                                            \u2502\n\u2502   Results:                                                                   \u2502\n\u2502   [                                                                          \u2502\n\u2502     { id: \"local/file-read\",      backend: \"local\",    score: 0.95 },       \u2502\n\u2502     { id: \"github/get-file\",      backend: \"github\",   score: 0.87 },       \u2502\n\u2502     { id: \"filesystem/read_file\", backend: \"mcp\",      score: 0.82 },       \u2502\n\u2502   ]                                                                          \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-execution-flow","title":"Tool Execution Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        TOOL EXECUTION FLOW                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                              \u2502\n\u2502   Client: run_tool(\"github/create_issue\", { title: \"Bug\", body: \"...\" })   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      TOOL ROUTER                                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   1. Parse tool ID: \"github/create_issue\"                           \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 backend: \"github\"                                           \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 tool: \"create_issue\"                                        \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   2. Lookup backend in registry                                     \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 Found: GitHubMCPBackend                                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   3. Delegate execution                                              \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 backend.Execute(ctx, \"create_issue\", args)                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                   GITHUB MCP BACKEND                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   1. Forward to MCP subprocess                                      \u2502   \u2502\n\u2502   \u2502      \u2514\u2500 npx @modelcontextprotocol/server-github                     \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   2. MCP call: tools/call { name: \"create_issue\", arguments: ... }  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   3. Receive result                                                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                           \u2502                                                  \u2502\n\u2502                           \u25bc                                                  \u2502\n\u2502   Result:                                                                    \u2502\n\u2502   {                                                                          \u2502\n\u2502     result: { issue_number: 123, url: \"https://github.com/...\" },          \u2502\n\u2502     backend: { kind: \"mcp\", name: \"github\" },                              \u2502\n\u2502     duration_ms: 1250                                                       \u2502\n\u2502   }                                                                          \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#registration-patterns","title":"Registration Patterns","text":"<p>Backends can be registered via YAML configuration or programmatically:</p> <pre><code>// YAML-driven registration (config file)\nfunc (r *BackendRegistry) LoadFromConfig(cfg BackendsConfig) error {\n    for name, backendCfg := range cfg.Backends {\n        if !backendCfg.Enabled {\n            continue\n        }\n\n        // Create backend based on kind\n        backend, err := r.createBackend(backendCfg.Kind)\n        if err != nil {\n            return fmt.Errorf(\"backend %s: %w\", name, err)\n        }\n\n        // Configure with raw config (backend parses itself)\n        if err := backend.Configure(backendCfg.RawConfig); err != nil {\n            return fmt.Errorf(\"backend %s config: %w\", name, err)\n        }\n\n        r.backends[name] = backend\n    }\n    return nil\n}\n\n// Programmatic registration (code-driven)\nfunc main() {\n    registry := NewBackendRegistry()\n\n    // Register a custom backend programmatically\n    myBackend := &amp;MyCustomBackend{\n        // ... configuration\n    }\n    registry.Register(\"my-backend\", myBackend)\n\n    // Or use the builder pattern\n    registry.\n        WithLocal(\"~/.config/metatools/tools\").\n        WithOpenAI(os.Getenv(\"OPENAI_API_KEY\")).\n        WithMCP(\"github\", \"npx\", \"-y\", \"@modelcontextprotocol/server-github\")\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#hybrid-configuration","title":"Hybrid Configuration","text":"<p>For maximum flexibility, backends support both YAML and code:</p> <pre><code>// Backend interface with hybrid config support\ntype Backend interface {\n    Kind() string\n    Name() string\n\n    // Option 1: YAML-driven config\n    Configure(raw []byte) error\n\n    // Option 2: Programmatic config (for complex backends)\n    ConfigureWith(opts ...BackendOption) error\n\n    // Operations\n    ListTools(ctx context.Context) ([]toolmodel.Tool, error)\n    Execute(ctx context.Context, tool string, args map[string]any) (any, error)\n}\n\n// Usage: Some config in YAML, some in code\nfunc setupBackends(registry *BackendRegistry, cfg Config) error {\n    // Load standard backends from YAML\n    if err := registry.LoadFromConfig(cfg.Backends); err != nil {\n        return err\n    }\n\n    // Add a complex custom backend programmatically\n    customBackend := NewDatabaseBackend(\n        WithConnectionPool(pool),\n        WithQueryValidator(validator),\n        WithAuditLogger(auditLog),\n    )\n    registry.Register(\"database\", customBackend)\n\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#error-handling-across-backends","title":"Error Handling Across Backends","text":"<pre><code>// Backend errors include source information\ntype BackendError struct {\n    Backend   string    // Which backend failed\n    Operation string    // What operation failed\n    Tool      string    // Which tool (if applicable)\n    Cause     error     // Underlying error\n    Retryable bool      // Can this be retried?\n}\n\n// Aggregated errors for multi-backend operations\ntype AggregatedError struct {\n    Errors []BackendError\n}\n\nfunc (e *AggregatedError) Error() string {\n    // Format: \"3 backends failed: local: connection refused, openai: rate limited, ...\"\n}\n\n// Partial success handling\ntype AggregatedResult struct {\n    Tools   []toolmodel.Tool  // Successfully retrieved tools\n    Errors  []BackendError    // Backends that failed\n    Partial bool              // True if some backends failed\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#summary-what-this-enables","title":"Summary: What This Enables","text":"Capability Description Tool Aggregation Single search across all backends Unified Execution Consistent interface regardless of backend Hot Plugging Add/remove backends via config without code changes Custom Backends Write Go code for specialized integrations MCP Composition Chain multiple MCP servers together Hybrid Config YAML for standard backends, code for complex ones Graceful Degradation Continue working if some backends fail"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-design","title":"Configuration Design","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#recommended-koanf-cobra","title":"Recommended: Koanf + Cobra","text":"Component Library Rationale CLI framework Cobra Subcommands (<code>stdio</code>, <code>serve</code>, <code>version</code>) Config loading Koanf Lighter than Viper, modular providers"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-structure","title":"Configuration Structure","text":"<pre><code># metatools.yaml\nserver:\n  name: \"metatools-mcp\"\n  version: \"0.2.0\"\n\ntransport:\n  type: sse           # stdio | sse | http\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n    tls:\n      enabled: true\n      cert: /etc/ssl/cert.pem\n      key: /etc/ssl/key.pem\n    timeouts:\n      read: 30s\n      write: 30s\n      idle: 120s\n\nsearch:\n  strategy: bm25      # lexical | bm25 | semantic\n  bm25:\n    name_boost: 3\n    namespace_boost: 2\n    tags_boost: 2\n    max_docs: 0\n    max_doctext_len: 0\n\nexecution:\n  timeout: 10s\n  max_tool_calls: 64\n  max_chain_steps: 8\n\n# Tool providers (each gets own config section)\nproviders:\n  search_tools:\n    enabled: true\n  describe_tool:\n    enabled: true\n    default_level: summary\n  run_tool:\n    enabled: true\n  run_chain:\n    enabled: true\n  execute_code:\n    enabled: true      # Requires toolruntime build tag\n    sandbox: dev\n\n# Backend sources for tools\nbackends:\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n      - /usr/share/metatools/tools\n  openai:\n    enabled: false\n    api_key: ${OPENAI_API_KEY}\n  azure:\n    enabled: false\n    tenant_id: ${AZURE_TENANT_ID}\n\n# Middleware chain\nmiddleware:\n  logging:\n    enabled: true\n    level: info\n  auth:\n    enabled: false\n    type: bearer\n  rate_limit:\n    enabled: false\n    requests_per_minute: 100\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-precedence","title":"Configuration Precedence","text":"<pre><code>CLI flags &gt; Environment variables &gt; Config file &gt; Defaults\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#plugin-configuration-pattern","title":"Plugin Configuration Pattern","text":"<p>Plugins receive raw config and parse themselves:</p> <pre><code>type Plugin interface {\n    Name() string\n    Configure(raw []byte) error  // Plugin parses its own config\n    Start(ctx context.Context) error\n    Stop() error\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-approach","title":"Implementation Approach","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-1-cli-framework-cobra-koanf","title":"Phase 1: CLI Framework (Cobra + Koanf)","text":"<ol> <li>Add Cobra for subcommands (<code>metatools stdio</code>, <code>metatools serve</code>)</li> <li>Add Koanf for config file loading</li> <li>Maintain backward compatibility (env vars still work)</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-2-transport-abstraction","title":"Phase 2: Transport Abstraction","text":"<ol> <li>Define <code>Transport</code> interface</li> <li>Extract current stdio logic into <code>StdioTransport</code></li> <li>Add <code>SSETransport</code> for HTTP/SSE mode</li> <li>Wire transport selection to config/CLI</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-3-tool-provider-registry","title":"Phase 3: Tool Provider Registry","text":"<ol> <li>Define <code>ToolProvider</code> interface</li> <li>Convert existing handlers to providers</li> <li>Replace <code>registerTools()</code> with registry iteration</li> <li>Enable external provider registration</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-4-backend-registry","title":"Phase 4: Backend Registry","text":"<ol> <li>Define <code>BackendRegistry</code> interface</li> <li>Implement config-driven backend loading</li> <li>Support local, API, and MCP server backends</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-5-middleware-chain","title":"Phase 5: Middleware Chain","text":"<ol> <li>Define <code>Middleware</code> type</li> <li>Implement logging, auth, rate limiting</li> <li>Apply middleware via config</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#end-to-end-examples","title":"End-to-End Examples","text":"<p>This section demonstrates how the pluggable architecture works in practice with complete examples.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-1-enterprise-ai-assistant","title":"Example 1: Enterprise AI Assistant","text":"<p>An internal AI assistant that aggregates tools from multiple sources.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ENTERPRISE AI ASSISTANT                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      FRONTEND / CLIENTS                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502   \u2502\n\u2502   \u2502   \u2502  Slack    \u2502  \u2502  Teams    \u2502  \u2502   Web     \u2502  \u2502  VS Code  \u2502        \u2502   \u2502\n\u2502   \u2502   \u2502   Bot     \u2502  \u2502   Bot     \u2502  \u2502   App     \u2502  \u2502 Extension \u2502        \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518        \u2502   \u2502\n\u2502   \u2502         \u2502              \u2502              \u2502              \u2502               \u2502   \u2502\n\u2502   \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                              \u2502 HTTPS/SSE                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                  \u25bc                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      METATOOLS-MCP SERVER                            \u2502   \u2502\n\u2502   \u2502                         (HA Cluster)                                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Transport: SSE on :8080                                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Middleware Chain:                                                  \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502   \u2502\n\u2502   \u2502   \u2502  Log   \u2502\u2192\u2502 OAuth  \u2502\u2192\u2502 Rate   \u2502\u2192\u2502 Audit  \u2502\u2192\u2502 Cache  \u2502           \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Tool Providers:                                                    \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502   \u2502\n\u2502   \u2502   \u2502 search_tools \u2502 \u2502 describe    \u2502 \u2502 run_tool    \u2502               \u2502   \u2502\n\u2502   \u2502   \u2502              \u2502 \u2502 _tool       \u2502 \u2502             \u2502               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Backends:                                                          \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502\n\u2502   \u2502   \u2502  Jira    \u2502 \u2502Confluence\u2502 \u2502  GitHub  \u2502 \u2502 Internal \u2502              \u2502   \u2502\n\u2502   \u2502   \u2502   MCP    \u2502 \u2502   MCP    \u2502 \u2502   MCP    \u2502 \u2502   API    \u2502              \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502\n\u2502   \u2502        \u2502            \u2502            \u2502            \u2502                     \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502            \u25bc            \u25bc            \u25bc            \u25bc                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502    Jira      \u2502 \u2502  Confluence  \u2502 \u2502    GitHub    \u2502 \u2502   Company    \u2502       \u2502\n\u2502   \u2502    Cloud     \u2502 \u2502    Cloud     \u2502 \u2502              \u2502 \u2502     API      \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># metatools-enterprise.yaml\nserver:\n  name: \"enterprise-ai-assistant\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    host: \"0.0.0.0\"\n    port: 8080\n    tls:\n      enabled: true\n      cert: /etc/ssl/certs/server.crt\n      key: /etc/ssl/private/server.key\n    cors:\n      enabled: true\n      origins:\n        - \"https://chat.company.com\"\n        - \"https://slack-bot.company.internal\"\n    health:\n      enabled: true\n\nmiddleware:\n  chain: [logging, auth, rate_limit, audit, cache]\n\n  logging:\n    enabled: true\n    level: info\n    format: json\n\n  auth:\n    enabled: true\n    type: oauth2\n    issuer: https://auth.company.com\n    audience: metatools-api\n    jwks_uri: https://auth.company.com/.well-known/jwks.json\n\n  rate_limit:\n    enabled: true\n    storage: redis\n    redis:\n      address: redis.company.internal:6379\n    default:\n      requests_per_minute: 60\n    per_user: true\n\n  audit:\n    enabled: true\n    destination: elasticsearch\n    elasticsearch:\n      addresses: [\"https://es.company.internal:9200\"]\n      index: metatools-audit\n\n  cache:\n    enabled: true\n    backend: redis\n    redis:\n      address: redis.company.internal:6379\n    per_tool:\n      search_tools:\n        ttl: 1m\n      describe_tool:\n        ttl: 10m\n\nbackends:\n  jira:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@anthropic/mcp-server-jira\"]\n      env:\n        JIRA_URL: https://company.atlassian.net\n        JIRA_EMAIL: ${JIRA_EMAIL}\n        JIRA_API_TOKEN: ${JIRA_API_TOKEN}\n\n  confluence:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@anthropic/mcp-server-confluence\"]\n      env:\n        CONFLUENCE_URL: https://company.atlassian.net/wiki\n        CONFLUENCE_EMAIL: ${CONFLUENCE_EMAIL}\n        CONFLUENCE_API_TOKEN: ${CONFLUENCE_API_TOKEN}\n\n  github:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-github\"]\n      env:\n        GITHUB_TOKEN: ${GITHUB_TOKEN}\n\n  internal-api:\n    enabled: true\n    kind: http\n    config:\n      base_url: https://api.company.internal/tools/v1\n      auth:\n        type: oauth2\n        token_url: https://auth.company.com/oauth/token\n        client_id: ${INTERNAL_CLIENT_ID}\n        client_secret: ${INTERNAL_CLIENT_SECRET}\n        scopes: [\"tools:read\", \"tools:execute\"]\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-2-local-development-setup","title":"Example 2: Local Development Setup","text":"<p>A developer workstation with file system access and code execution.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    LOCAL DEVELOPMENT SETUP                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                       DEVELOPER MACHINE                              \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                             \u2502   \u2502\n\u2502   \u2502   \u2502   Claude Desktop  \u2502 \u2190\u2500\u2500 stdio \u2500\u2500\u2510                               \u2502   \u2502\n\u2502   \u2502   \u2502   or Cursor IDE   \u2502             \u2502                               \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502                               \u2502   \u2502\n\u2502   \u2502                                      \u2502                               \u2502   \u2502\n\u2502   \u2502                                      \u25bc                               \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502              METATOOLS-MCP (stdio mode)                      \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Build: go build -tags \"toolsearch,toolruntime\"            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Features:                                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - BM25 search (toolsearch tag)                            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Code execution (toolruntime tag)                        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Backends:                                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502   Local    \u2502 \u2502 Filesystem \u2502 \u2502   Git      \u2502              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2502   Tools    \u2502 \u2502    MCP     \u2502 \u2502   MCP      \u2502              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502         \u2502              \u2502              \u2502                      \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502             \u2502              \u2502              \u2502                          \u2502   \u2502\n\u2502   \u2502             \u25bc              \u25bc              \u25bc                          \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502   \u2502\n\u2502   \u2502   \u2502 ~/.config/ \u2502   \u2502 ~/Projects \u2502   \u2502 .git repos \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2502 metatools/ \u2502   \u2502            \u2502   \u2502            \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2502 tools/     \u2502   \u2502            \u2502   \u2502            \u2502                  \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># ~/.config/metatools/config.yaml\nserver:\n  name: \"dev-metatools\"\n  version: \"local\"\n\ntransport:\n  type: stdio\n\nsearch:\n  strategy: bm25\n  bm25:\n    name_boost: 3\n    namespace_boost: 2\n\nexecution:\n  timeout: 30s\n  max_tool_calls: 100\n\nmiddleware:\n  chain: [logging]\n  logging:\n    enabled: true\n    level: debug\n    output: /tmp/metatools.log\n\nbackends:\n  local:\n    enabled: true\n    paths:\n      - ~/.config/metatools/tools\n    watch: true\n\n  filesystem:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args:\n        - \"-y\"\n        - \"@modelcontextprotocol/server-filesystem\"\n        - \"~/Projects\"\n        - \"~/Documents\"\n\n  git:\n    enabled: true\n    kind: mcp\n    config:\n      command: npx\n      args: [\"-y\", \"@modelcontextprotocol/server-git\"]\n</code></pre> <p>Custom Local Tool Definition:</p> <pre><code># ~/.config/metatools/tools/project-tools.yaml\ntools:\n  - name: run_tests\n    namespace: dev\n    description: Run project tests with optional coverage\n    inputSchema:\n      type: object\n      properties:\n        path:\n          type: string\n          description: Project path\n        coverage:\n          type: boolean\n          default: false\n      required: [path]\n\n    backend:\n      kind: local\n      handler: run_tests\n\n  - name: lint_code\n    namespace: dev\n    description: Run linter on project\n    inputSchema:\n      type: object\n      properties:\n        path:\n          type: string\n        fix:\n          type: boolean\n          default: false\n      required: [path]\n\n    backend:\n      kind: local\n      handler: lint_code\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-3-multi-llm-tool-router","title":"Example 3: Multi-LLM Tool Router","text":"<p>A gateway that routes tool calls to different LLM providers.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      MULTI-LLM TOOL ROUTER                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502                         \u2502   Application   \u2502                                  \u2502\n\u2502                         \u2502   (Your App)    \u2502                                  \u2502\n\u2502                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2502\n\u2502                                  \u2502 MCP                                       \u2502\n\u2502                                  \u25bc                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                      METATOOLS-MCP ROUTER                            \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502                    TOOL AGGREGATOR                           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   All tools from all backends visible as one unified set    \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   search_tools(\"weather\") \u2192                                  \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   [                                                          \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"openai/get_weather\", backend: \"openai\" },        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"anthropic/weather_lookup\", backend: \"anthropic\" },\u2502   \u2502   \u2502\n\u2502   \u2502   \u2502     { id: \"local/weather_api\", backend: \"local\" }           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   ]                                                          \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502   \u2502                    SMART ROUTER                              \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   Routes based on:                                           \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Tool prefix (openai/*, anthropic/*, local/*)            \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Cost optimization                                        \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Latency requirements                                     \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502   - Fallback on failure                                     \u2502   \u2502   \u2502\n\u2502   \u2502   \u2502                                                               \u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502   \u2502\n\u2502   \u2502          \u2502                   \u2502                   \u2502                   \u2502   \u2502\n\u2502   \u2502          \u25bc                   \u25bc                   \u25bc                   \u2502   \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502   \u2502\n\u2502   \u2502   \u2502   OpenAI   \u2502     \u2502 Anthropic  \u2502     \u2502   Local    \u2502              \u2502   \u2502\n\u2502   \u2502   \u2502  Backend   \u2502     \u2502  Backend   \u2502     \u2502  Backend   \u2502              \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502   \u2502\n\u2502   \u2502         \u2502                   \u2502                 \u2502                      \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502             \u2502                   \u2502                 \u2502                          \u2502\n\u2502             \u25bc                   \u25bc                 \u25bc                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502   \u2502    OpenAI API    \u2502 \u2502  Anthropic API   \u2502 \u2502   Local Tools    \u2502            \u2502\n\u2502   \u2502                  \u2502 \u2502                  \u2502 \u2502                  \u2502            \u2502\n\u2502   \u2502  - GPT-4 tools   \u2502 \u2502  - Claude tools  \u2502 \u2502  - Custom tools  \u2502            \u2502\n\u2502   \u2502  - DALL-E        \u2502 \u2502  - Computer use  \u2502 \u2502  - File ops      \u2502            \u2502\n\u2502   \u2502  - Whisper       \u2502 \u2502                  \u2502 \u2502  - Scripts       \u2502            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Configuration:</p> <pre><code># multi-llm-router.yaml\nserver:\n  name: \"llm-tool-router\"\n  version: \"1.0.0\"\n\ntransport:\n  type: sse\n  http:\n    port: 8080\n\nmiddleware:\n  chain: [logging, metrics, cost_tracking]\n\n  cost_tracking:\n    enabled: true\n    storage: postgres\n    postgres:\n      connection_string: ${DATABASE_URL}\n\nbackends:\n  openai:\n    enabled: true\n    kind: openai\n    config:\n      api_key: ${OPENAI_API_KEY}\n      organization: ${OPENAI_ORG}\n      models:\n        - gpt-4\n        - gpt-4-turbo\n        - dall-e-3\n      default_model: gpt-4-turbo\n      timeout: 60s\n\n  anthropic:\n    enabled: true\n    kind: anthropic\n    config:\n      api_key: ${ANTHROPIC_API_KEY}\n      models:\n        - claude-3-opus\n        - claude-3-sonnet\n      default_model: claude-3-sonnet\n      timeout: 60s\n\n  local:\n    enabled: true\n    paths:\n      - /opt/metatools/tools\n\nrouting:\n  # Route by prefix\n  prefix_routing:\n    \"openai/*\": openai\n    \"anthropic/*\": anthropic\n    \"local/*\": local\n\n  # Fallback chain\n  fallback:\n    - openai\n    - anthropic\n    - local\n\n  # Cost optimization\n  cost_aware:\n    enabled: true\n    prefer_cheaper: true\n    budget_per_hour: 10.00\n    currency: USD\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-4-microservices-tool-mesh","title":"Example 4: Microservices Tool Mesh","text":"<p>A distributed architecture where each service exposes tools via MCP.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     MICROSERVICES TOOL MESH                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                        API GATEWAY                                   \u2502   \u2502\n\u2502   \u2502                    (Kong / Envoy / etc)                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                \u2502                                             \u2502\n\u2502                                \u25bc                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                   METATOOLS-MCP AGGREGATOR                           \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Transport: gRPC (internal), SSE (external)                        \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Service Discovery: Kubernetes / Consul                            \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502   Aggregates tools from all registered MCP services                 \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                \u2502                                             \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                     \u2502\n\u2502         \u2502                      \u2502                      \u2502                     \u2502\n\u2502         \u25bc                      \u25bc                      \u25bc                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502  Orders    \u2502        \u2502  Users     \u2502        \u2502  Inventory \u2502               \u2502\n\u2502   \u2502  Service   \u2502        \u2502  Service   \u2502        \u2502  Service   \u2502               \u2502\n\u2502   \u2502            \u2502        \u2502            \u2502        \u2502            \u2502               \u2502\n\u2502   \u2502  MCP Tools:\u2502        \u2502  MCP Tools:\u2502        \u2502  MCP Tools:\u2502               \u2502\n\u2502   \u2502  - create  \u2502        \u2502  - lookup  \u2502        \u2502  - check   \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502    _user   \u2502        \u2502    _stock  \u2502               \u2502\n\u2502   \u2502  - cancel  \u2502        \u2502  - update  \u2502        \u2502  - reserve \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502    _prefs  \u2502        \u2502    _item   \u2502               \u2502\n\u2502   \u2502  - track   \u2502        \u2502  - auth    \u2502        \u2502  - release \u2502               \u2502\n\u2502   \u2502    _order  \u2502        \u2502            \u2502        \u2502    _item   \u2502               \u2502\n\u2502   \u2502            \u2502        \u2502            \u2502        \u2502            \u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502         \u2502                      \u2502                      \u2502                     \u2502\n\u2502         \u25bc                      \u25bc                      \u25bc                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u2502 Orders DB  \u2502        \u2502 Users DB   \u2502        \u2502Inventory DB\u2502               \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Aggregator Configuration:</p> <pre><code># aggregator.yaml\nserver:\n  name: \"tool-mesh-aggregator\"\n  version: \"1.0.0\"\n\ntransports:\n  - type: sse\n    enabled: true\n    http:\n      port: 8080\n      # External-facing\n\n  - type: grpc\n    enabled: true\n    grpc:\n      port: 9090\n      # Internal service mesh\n\nservice_discovery:\n  type: kubernetes\n  kubernetes:\n    namespace: production\n    label_selector: \"mcp.enabled=true\"\n    port_name: mcp-grpc\n\nbackends:\n  # Auto-discovered from Kubernetes\n  auto_discover:\n    enabled: true\n    refresh_interval: 30s\n\n  # Or explicit configuration\n  orders:\n    enabled: true\n    kind: grpc\n    config:\n      address: orders-service.production.svc:9090\n      tls:\n        enabled: true\n        ca_cert: /etc/ssl/ca.crt\n\n  users:\n    enabled: true\n    kind: grpc\n    config:\n      address: users-service.production.svc:9090\n\n  inventory:\n    enabled: true\n    kind: grpc\n    config:\n      address: inventory-service.production.svc:9090\n</code></pre> <p>Service Configuration (e.g., Orders Service):</p> <pre><code># orders-service/mcp-config.yaml\nserver:\n  name: \"orders-service-mcp\"\n  version: \"2.1.0\"\n\ntransport:\n  type: grpc\n  grpc:\n    port: 9090\n\nproviders:\n  create_order:\n    enabled: true\n  cancel_order:\n    enabled: true\n  track_order:\n    enabled: true\n\nbackends:\n  local:\n    enabled: true\n    # Orders service tools implemented in Go\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#example-5-request-flow-diagram","title":"Example 5: Request Flow Diagram","text":"<p>A complete request flow through all layers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    COMPLETE REQUEST FLOW                                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502   1. CLIENT REQUEST                                                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  POST /mcp HTTP/1.1                                                  \u2502   \u2502\n\u2502   \u2502  Content-Type: application/json                                      \u2502   \u2502\n\u2502   \u2502  Authorization: Bearer eyJhbGc...                                   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  {                                                                   \u2502   \u2502\n\u2502   \u2502    \"jsonrpc\": \"2.0\",                                                \u2502   \u2502\n\u2502   \u2502    \"method\": \"tools/call\",                                          \u2502   \u2502\n\u2502   \u2502    \"params\": {                                                      \u2502   \u2502\n\u2502   \u2502      \"name\": \"github/create_issue\",                                 \u2502   \u2502\n\u2502   \u2502      \"arguments\": {                                                 \u2502   \u2502\n\u2502   \u2502        \"repo\": \"company/project\",                                   \u2502   \u2502\n\u2502   \u2502        \"title\": \"Bug: Login fails\",                                 \u2502   \u2502\n\u2502   \u2502        \"body\": \"Steps to reproduce...\"                              \u2502   \u2502\n\u2502   \u2502      }                                                              \u2502   \u2502\n\u2502   \u2502    },                                                               \u2502   \u2502\n\u2502   \u2502    \"id\": \"req-123\"                                                  \u2502   \u2502\n\u2502   \u2502  }                                                                   \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   2. TRANSPORT LAYER (SSE)                                                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Accept HTTP connection                                           \u2502   \u2502\n\u2502   \u2502  - Parse JSON-RPC request                                           \u2502   \u2502\n\u2502   \u2502  - Create context with request ID                                   \u2502   \u2502\n\u2502   \u2502  - Pass to handler chain                                            \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   3. MIDDLEWARE CHAIN                                                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 LOGGING                                                       \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Log: \"Incoming request req-123 for github/create_issue\"    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Start timer                                                 \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 AUTH                                                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Validate JWT token                                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Extract user: \"alice@company.com\"                          \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Inject user into context                                    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 RATE LIMIT                                                    \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Check: alice@company.com has 45/60 requests remaining      \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Consume 1 token                                             \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Pass through                                                \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                              \u2502                                        \u2502   \u2502\n\u2502   \u2502                              \u25bc                                        \u2502   \u2502\n\u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502   \u2502  \u2502 AUDIT                                                         \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502 - Log to audit trail:                                        \u2502   \u2502   \u2502\n\u2502   \u2502  \u2502   { user: \"alice\", tool: \"github/create_issue\", time: ... }  \u2502   \u2502   \u2502\n\u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   4. TOOL ROUTER                                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Parse tool ID: \"github/create_issue\"                             \u2502   \u2502\n\u2502   \u2502  - Extract backend: \"github\"                                         \u2502   \u2502\n\u2502   \u2502  - Extract tool name: \"create_issue\"                                \u2502   \u2502\n\u2502   \u2502  - Lookup backend in registry                                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   5. BACKEND (GitHub MCP)                                                    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Backend type: MCP subprocess                                      \u2502   \u2502\n\u2502   \u2502  - Command: npx @modelcontextprotocol/server-github                 \u2502   \u2502\n\u2502   \u2502  - Forward MCP call to subprocess                                    \u2502   \u2502\n\u2502   \u2502  - Wait for response                                                 \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   6. EXTERNAL SERVICE (GitHub API)                                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - GitHub MCP server calls GitHub API                               \u2502   \u2502\n\u2502   \u2502  - POST https://api.github.com/repos/company/project/issues        \u2502   \u2502\n\u2502   \u2502  - Response: { \"number\": 456, \"url\": \"...\" }                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   7. RESPONSE FLOW (reverse through middleware)                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  - Audit: Log success                                                \u2502   \u2502\n\u2502   \u2502  - Rate limit: (no action)                                          \u2502   \u2502\n\u2502   \u2502  - Auth: (no action)                                                \u2502   \u2502\n\u2502   \u2502  - Logging: Log \"Completed req-123 in 1.2s, status: success\"        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                     \u2502                                        \u2502\n\u2502                                     \u25bc                                        \u2502\n\u2502   8. CLIENT RESPONSE                                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  HTTP/1.1 200 OK                                                     \u2502   \u2502\n\u2502   \u2502  Content-Type: text/event-stream                                    \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  event: message                                                      \u2502   \u2502\n\u2502   \u2502  data: {                                                             \u2502   \u2502\n\u2502   \u2502    \"jsonrpc\": \"2.0\",                                                \u2502   \u2502\n\u2502   \u2502    \"result\": {                                                      \u2502   \u2502\n\u2502   \u2502      \"content\": [{                                                  \u2502   \u2502\n\u2502   \u2502        \"type\": \"text\",                                              \u2502   \u2502\n\u2502   \u2502        \"text\": \"Created issue #456\"                                 \u2502   \u2502\n\u2502   \u2502      }],                                                            \u2502   \u2502\n\u2502   \u2502      \"metadata\": {                                                  \u2502   \u2502\n\u2502   \u2502        \"issue_number\": 456,                                         \u2502   \u2502\n\u2502   \u2502        \"url\": \"https://github.com/company/project/issues/456\"      \u2502   \u2502\n\u2502   \u2502      }                                                              \u2502   \u2502\n\u2502   \u2502    },                                                               \u2502   \u2502\n\u2502   \u2502    \"id\": \"req-123\"                                                  \u2502   \u2502\n\u2502   \u2502  }                                                                   \u2502   \u2502\n\u2502   \u2502                                                                       \u2502   \u2502\n\u2502   \u2502  event: done                                                         \u2502   \u2502\n\u2502   \u2502  data: {}                                                            \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comparative-analysis","title":"Comparative Analysis","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#your-tool-libraries-vs-industry-patterns","title":"Your Tool Libraries vs. Industry Patterns","text":"Your Pattern Industry Standard Alignment toolindex.Searcher interface Register-on-init pattern Excellent Build-tag gating HashiCorp conditional compilation Same approach Adapter layer Clean Architecture boundaries Textbook Progressive disclosure Apple API design principles Ahead of most"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#comparison-with-other-go-mcp-servers","title":"Comparison with Other Go MCP Servers","text":"Project Transport Plugin System Your Advantage Official go-sdk stdio, SSE None Your tool* libraries mark3labs/mcp-go stdio, SSE Basic Your progressive disclosure viant/mcp stdio None Your modular architecture metatools-mcp stdio (SSE planned) Build-tag + interfaces Full stack orchestration <p>Unique value: No other Go MCP server has layered tool libraries with progressive disclosure, BM25 search, and code execution.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#references","title":"References","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#go-plugin-patterns","title":"Go Plugin Patterns","text":"<ul> <li>HashiCorp go-plugin - RPC-based plugin system</li> <li>Register-on-Init Pattern</li> <li>Interface Extension Pattern</li> <li>Clean Architecture with Plugins</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-implementations","title":"MCP Implementations","text":"<ul> <li>Official MCP Go SDK</li> <li>mark3labs/mcp-go</li> <li>viant/mcp</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-libraries","title":"Configuration Libraries","text":"<ul> <li>Koanf - Lighter Viper alternative</li> <li>Cobra - CLI framework</li> <li>Dependency Injection Patterns</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#api-design","title":"API Design","text":"<ul> <li>Progressive Disclosure</li> <li>Apple WWDC22: API Design</li> </ul>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-validation","title":"Architecture Validation","text":"<p>This section documents validation of the proposed architecture against industry best practices and real-world implementations, gathered from multiple research sources (Exa, Firecrawl, GitHub, Context7).</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#plugin-architecture-validation","title":"Plugin Architecture Validation \u2713","text":"<p>Sources: cekrem.github.io, blog.devcoffee.me, skoredin.pro, caffeinatedcoder.medium.com, reintech.io</p> <p>Our proposed architecture aligns with established Go plugin patterns:</p> Pattern Our Implementation Industry Validation Dependency Inversion ToolProvider interface abstracts concrete implementations \"High-level modules depend only on abstractions (interfaces)\" - Clean Architecture Interface-Driven Design <code>handlers/interfaces.go</code> defines stable contracts \"Define stable, simple core interfaces\" - Go best practices Plugin Registry ToolProviderRegistry with Register/Get methods \"Central hub for registering plugins with unique names\" - Plugin Registry pattern Plugin Factories Factory functions for backend creation \"A function that returns a new instance of a plugin\" - Factory pattern Graceful Shutdown Context-based cancellation propagation \"Critical feature for supporting context cancellation\" - Production patterns <p>RPC-Based Plugin Pattern (HashiCorp): Our Backend interface supports both in-process and RPC-based plugins, aligning with the industry-recommended approach for fault tolerance.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#middleware-chain-validation","title":"Middleware Chain Validation \u2713","text":"<p>Sources: go-chi/chi (21.7k\u2b50), grpc-ecosystem/go-grpc-middleware (6.7k\u2b50)</p> <p>The chi router's <code>chain.go</code> demonstrates the exact pattern we're proposing:</p> <pre><code>// From go-chi/chi - validates our decorator pattern\nfunc chain(middlewares []func(http.Handler) http.Handler, endpoint http.Handler) http.Handler {\n    if len(middlewares) == 0 {\n        return endpoint\n    }\n    h := middlewares[len(middlewares)-1](endpoint)\n    for i := len(middlewares) - 2; i &gt;= 0; i-- {\n        h = middlewares[i](h)\n    }\n    return h\n}\n</code></pre> <p>grpc-ecosystem interceptor categories match our proposed middleware types: - <code>auth/</code> \u2192 Our Auth middleware - <code>logging/</code> \u2192 Our Logging middleware - <code>ratelimit/</code> \u2192 Our RateLimit middleware - <code>recovery/</code> \u2192 Our Recovery/error handling - <code>retry/</code> \u2192 Our Circuit breaker patterns - <code>timeout/</code> \u2192 Our Timeout middleware</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#transport-layer-validation","title":"Transport Layer Validation \u2713","text":"<p>Sources: FreeCodeCamp, go-zero.dev, goa.design, Centrifugo</p> <p>SSE Implementation Requirements (validated): <pre><code>// Required headers for SSE - confirmed across all sources\nw.Header().Set(\"Content-Type\", \"text/event-stream\")\nw.Header().Set(\"Cache-Control\", \"no-cache\")\nw.Header().Set(\"Connection\", \"keep-alive\")\n</code></pre></p> <p>Multi-Transport Architecture Patterns: | Transport | Use Case | Our Support | |-----------|----------|-------------| | HTTP/REST | Request-response APIs | \u2713 Proposed | | SSE | Server-to-client streaming | \u2713 Proposed | | WebSocket | Bidirectional real-time | \u2713 Proposed | | gRPC | High-performance RPC | \u2713 Proposed | | stdio | Local MCP clients | \u2713 Current |</p> <p>Centrifugo WebSocket Scaling Patterns: Validates our approach of using shared state (Redis) for HA deployments with multiple transport instances.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-server-ecosystem-validation","title":"MCP Server Ecosystem Validation \u2713","text":"<p>Sources: viant/mcp, mcp-golang, go-mcp (Reddit), bytesizego.com, dev.to</p> <p>Active Go MCP implementations confirm the viability of our approach:</p> Project Stars Approach Notes viant/mcp Active Interface-based Validates our pattern mcp-golang Active Framework approach Similar extensibility goals mark3labs/mcp-go Popular Simple MCP Basic implementation <p>Key insight: No existing Go MCP server offers the combination of: - Multi-transport support (stdio + HTTP/SSE) - Pluggable tool providers - Configurable search strategies - Multi-backend aggregation - Middleware chain</p> <p>This confirms metatools-mcp's unique positioning in the ecosystem.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#configuration-library-validation","title":"Configuration Library Validation \u2713","text":"<p>Sources: Context7 library research, GitHub documentation</p> Library Reputation Code Snippets Recommendation Koanf High 23 \u2713 \"Cleaner, lighter alternative to Viper\" Cobra High 1,126+ \u2713 \"Powerful CLI with subcommands\" <p>This validates our choice of Koanf + Cobra over Viper for configuration management.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#validation-summary","title":"Validation Summary","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  ARCHITECTURE VALIDATION MATRIX                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Component              \u2502 Pattern Validated  \u2502 Source Quality    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Plugin Registry        \u2502 \u2713 Industry standard\u2502 High (multiple)   \u2502\n\u2502 Middleware Chain       \u2502 \u2713 go-chi pattern   \u2502 High (21.7k\u2b50)    \u2502\n\u2502 Transport Abstraction  \u2502 \u2713 Multi-impl refs  \u2502 High (docs + OSS) \u2502\n\u2502 SSE Implementation     \u2502 \u2713 Standard headers \u2502 High (RFC 6455)   \u2502\n\u2502 Backend Interface      \u2502 \u2713 DIP/Clean Arch   \u2502 High (canonical)  \u2502\n\u2502 Config Framework       \u2502 \u2713 Koanf + Cobra    \u2502 High (Context7)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Conclusion: The proposed architecture follows established best practices and patterns validated across multiple high-quality sources. The design is sustainable, maintainable, and aligned with the Go ecosystem's conventions.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-phases","title":"Implementation Phases","text":"<p>A detailed phased implementation plan has been created to break this proposal into manageable chunks. See implementation-phases.md for:</p> <ul> <li>Phase 1: CLI Framework &amp; Configuration (~2 weeks) - Cobra + Koanf foundation</li> <li>Phase 2: Transport Layer Abstraction (~2 weeks) - Stdio + SSE transports</li> <li>Phase 3: Tool Provider Registry (~1 week) - Plug-and-play tool registration</li> <li>Phase 4: Backend Registry (~2 weeks) - Multi-source tool aggregation</li> <li>Phase 5: Middleware Chain (~2 weeks) - Cross-cutting concerns</li> </ul> <p>MVP (Phases 1-3): ~5 weeks Full Implementation: ~9 weeks</p> <p>Each phase includes: - Detailed directory structure changes - Interface definitions with Go code - Implementation tasks with code examples - Verification criteria checklist - Migration notes for backward compatibility</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#component-library-analysis","title":"Component Library Analysis","text":"<p>A comprehensive analysis of the metatools component library ecosystem has been performed. See component-library-analysis.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#library-ecosystem-7-libraries","title":"Library Ecosystem (7 libraries)","text":"Library Version Purpose Changes Needed toolmodel v0.1.2 Core data models Add HTTP/gRPC backend kinds toolindex v0.1.8 Tool registry Add ListTools, OnChange tooldocs v0.1.10 Documentation Add BulkRegisterDocs toolrun v0.1.9 Execution Add HTTPExecutor, GRPCExecutor, ExecutionHook toolcode v0.1.10 Code execution Add EngineRegistry toolsearch v0.1.9 BM25 search No changes (already pluggable) toolruntime v0.1.10 Sandbox runtime Minor config additions"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-findings","title":"Key Findings","text":"<ol> <li>All changes are additive - No breaking changes to existing interfaces</li> <li>toolsearch is exemplary - Already implements pluggable pattern via <code>Searcher</code> interface</li> <li>toolrun needs most work - Core execution layer requires new executor interfaces</li> <li>Error taxonomy needed - Consistent error types across all libraries</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#dependency-graph","title":"Dependency Graph","text":"<pre><code>metatools-mcp\n    \u251c\u2500\u2500 toolcode \u2500\u2500\u252c\u2500\u2500 toolrun \u2500\u2500\u252c\u2500\u2500 toolindex \u2500\u2500 toolmodel \u2500\u2500 mcp-go-sdk\n    \u2502              \u2502             \u2502\n    \u2502              \u251c\u2500\u2500 tooldocs \u2500\u2524\n    \u2502              \u2502             \u2502\n    \u2514\u2500\u2500 toolruntime \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                   toolsearch (optional, implements toolindex.Searcher)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-tenancy-extension","title":"Multi-Tenancy Extension","text":"<p>A comprehensive multi-tenancy design has been created as an extension to this architecture. See multi-tenancy.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#core-concepts","title":"Core Concepts","text":"Concept Description Pluggable Tenant Resolution JWT, API Key, Header, or custom resolvers Tenant-Aware Middleware Rate limiting, tool filtering, audit per tenant Tenant-Scoped Registries Isolated tool/backend views per tenant Configuration Hierarchy Defaults \u2192 Tier \u2192 Tenant overrides Isolation Strategies Shared, Namespace, or Process isolation"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture","title":"Architecture","text":"<pre><code>Request \u2192 Tenant Resolver \u2192 Tenant Middleware Chain \u2192 Tenant-Scoped Registry \u2192 Execution\n              \u2502                     \u2502                        \u2502\n              \u25bc                     \u25bc                        \u25bc\n         TenantContext      Rate Limit + Filter     Filtered Tools/Backends\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-interfaces","title":"Key Interfaces","text":"<pre><code>// Pluggable tenant identification\ntype TenantResolver interface {\n    Resolve(ctx context.Context, req *Request) (*TenantContext, error)\n}\n\n// Tenant configuration overrides\ntype TenantConfig struct {\n    AllowedTools    []string\n    DeniedTools     []string\n    AllowedBackends []string\n    RateLimits      *RateLimitConfig\n    Quotas          *QuotaConfig\n    Features        map[string]bool\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-priority","title":"Implementation Priority","text":"Phase Focus Duration Phase 1 Core multi-tenancy (Tenant, TenantContext, resolvers) 2 weeks Phase 2 Tenant-aware middleware (rate limit, filter, audit) 1 week Phase 3 Tenant storage (memory, Postgres implementations) 1 week Phase 4 Advanced features (scoped registries, isolation strategies) 2 weeks"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-point-catalog","title":"Extension Point Catalog","text":"<p>Comprehensive architecture analysis has revealed that the metatools ecosystem is already 85%+ pluggable. The following 13 extension points exist across the component libraries, ready for configuration and exposure.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#critical-finding","title":"Critical Finding","text":"<p>The architecture is NOT a monolith to be refactored. It is a mature, layered, pluggable architecture that needs: - Exposure - Make internal extension points accessible via configuration - Configuration - Add CLI + config layer (Cobra + Koanf) - Documentation - Catalog the 13 extension points with examples - Examples - Show how to extend each interface</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#extension-points-by-library","title":"Extension Points by Library","text":"# Interface Library Purpose Pluggability 1 <code>SchemaValidator</code> toolmodel JSON Schema validation \u2705 Interface-based 2 <code>Searcher</code> toolindex Tool search strategy \u2705 Interface-based 3 <code>BackendSelector</code> toolindex Multi-backend selection \u2705 Function-based 4 <code>Store</code> tooldocs Documentation storage \u2705 Interface-based 5 <code>ToolResolver</code> tooldocs Tool resolution for docs \u2705 Function-based 6 <code>Runner</code> toolrun Tool execution \u2705 Interface-based 7 <code>MCPExecutor</code> toolrun MCP backend executor \u2705 Interface-based 8 <code>ProviderExecutor</code> toolrun Provider backend executor \u2705 Interface-based 9 <code>LocalRegistry</code> toolrun Local handler lookup \u2705 Interface-based 10 <code>Backend</code> toolruntime Sandbox isolation backend \u2705 Interface-based 11 <code>ToolGateway</code> toolruntime Sandbox tool access \u2705 Interface-based 12 <code>Logger</code> toolcode Execution logging \u2705 Interface-based 13 <code>Engine</code> toolcode Language-specific execution \u2705 Interface-based"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#interface-definitions","title":"Interface Definitions","text":"<pre><code>// 1. SchemaValidator - JSON Schema validation strategy\ntype SchemaValidator interface {\n    ValidateSchema(schema map[string]any) error\n    ValidateInput(schema map[string]any, input map[string]any) error\n}\n\n// 2. Searcher - Tool search strategy (toolsearch.BM25Searcher implements this)\ntype Searcher interface {\n    Search(query string, limit int) ([]SearchResult, error)\n    Close() error\n}\n\n// 3. BackendSelector - Multi-backend selection policy\ntype BackendSelector func(tool Tool, backends []ToolBackend) ToolBackend\n\n// 4. Store - Documentation storage\ntype Store interface {\n    DescribeTool(id string, level DetailLevel) (ToolDoc, error)\n    ListExamples(id string, max int) ([]ToolExample, error)\n    RegisterDoc(id string, entry DocEntry) error\n}\n\n// 5. ToolResolver - Tool resolution for documentation\ntype ToolResolver func(id string) (*toolmodel.Tool, error)\n\n// 6. Runner - Tool execution orchestration\ntype Runner interface {\n    Run(ctx context.Context, toolID string, args map[string]any) (RunResult, error)\n    RunStream(ctx context.Context, toolID string, args map[string]any) (&lt;-chan StreamEvent, error)\n    RunChain(ctx context.Context, steps []ChainStep) (RunResult, []StepResult, error)\n}\n\n// 7. MCPExecutor - MCP backend execution\ntype MCPExecutor interface {\n    CallTool(ctx context.Context, server, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, server, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// 8. ProviderExecutor - Provider backend execution\ntype ProviderExecutor interface {\n    CallTool(ctx context.Context, provider, tool string, args map[string]any) (any, error)\n    CallToolStream(ctx context.Context, provider, tool string, args map[string]any) (&lt;-chan StreamEvent, error)\n}\n\n// 9. LocalRegistry - Local handler lookup\ntype LocalRegistry interface {\n    Get(name string) (LocalHandler, bool)\n}\n\n// 10. Backend - Sandbox isolation backend (10 implementations exist)\ntype Backend interface {\n    Name() string\n    Execute(ctx context.Context, req ExecuteRequest) (ExecuteResult, error)\n    Capabilities() BackendCapabilities\n    Close() error\n}\n\n// 11. ToolGateway - Tool access from sandboxed code\ntype ToolGateway interface {\n    SearchTools(ctx context.Context, query string, limit int) ([]SearchResult, error)\n    ListNamespaces(ctx context.Context) ([]string, error)\n    DescribeTool(ctx context.Context, id string, level DetailLevel) (ToolDoc, error)\n    ListToolExamples(ctx context.Context, id string, max int) ([]ToolExample, error)\n    RunTool(ctx context.Context, toolID string, args map[string]any) (any, error)\n    RunChain(ctx context.Context, steps []ChainStep) (any, []StepResult, error)\n}\n\n// 12. Logger - Execution logging\ntype Logger interface {\n    Info(msg string, fields ...any)\n    Error(msg string, fields ...any)\n    Debug(msg string, fields ...any)\n}\n\n// 13. Engine - Language-specific code execution\ntype Engine interface {\n    Name() string\n    Execute(ctx context.Context, code string, gateway ToolGateway) (any, error)\n    Capabilities() EngineCapabilities\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#existing-implementations","title":"Existing Implementations","text":"Interface Built-in Implementations <code>SchemaValidator</code> <code>DefaultValidator</code> (jsonschema-go) <code>Searcher</code> <code>BM25Searcher</code> (toolsearch, uses Bleve) <code>BackendSelector</code> <code>DefaultBackendSelector</code> (local &gt; provider &gt; mcp) <code>Store</code> <code>InMemoryStore</code> <code>Runner</code> <code>DefaultRunner</code> <code>Backend</code> 10 implementations: unsafe, docker, containerd, kubernetes, firecracker, kata, gvisor, wasm, temporal, remote <code>ToolGateway</code> <code>toolcodeengine.WrapTools()</code> adapter <code>Engine</code> Language-specific engines (JS, Python, etc.)"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-diagram","title":"Architecture Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         METATOOLS PLUGGABLE ARCHITECTURE                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         MCP Protocol Layer                                  \u2502 \u2502\n\u2502  \u2502              Transport: Stdio (current) | SSE | WebSocket                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                     \u2502                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                         metatools-mcp Server                                \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502 \u2502\n\u2502  \u2502  \u2502  Handlers   \u2502  \u2502  Adapters   \u2502  \u2502   Config    \u2502  \u2502    Middleware       \u2502\u2502 \u2502\n\u2502  \u2502  \u2502  (MCP ops)  \u2502  \u2502  (bridge)   \u2502  \u2502  (YAML/env) \u2502  \u2502  (auth/rate/log)   \u2502\u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502            \u2502                \u2502                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    Component Library Layer                                   \u2502 \u2502\n\u2502  \u2502                                                                              \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502 \u2502\n\u2502  \u2502   \u2502  toolcode    \u2502\u2500\u2500\u2500\u25b6\u2502   toolrun    \u2502\u2500\u2500\u2500\u25b6\u2502  toolindex   \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502  [13:Engine] \u2502    \u2502  [6-9:Exec]  \u2502    \u2502  [2-3:Search]\u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502  [12:Logger] \u2502    \u2502              \u2502    \u2502              \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502 \u2502\n\u2502  \u2502          \u2502                                       \u2502                          \u2502 \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502 \u2502\n\u2502  \u2502   \u2502 toolruntime  \u2502    \u2502   tooldocs   \u2502    \u2502  toolmodel   \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502 [10:Backend] \u2502    \u2502  [4-5:Store] \u2502    \u2502 [1:Validator]\u2502                  \u2502 \u2502\n\u2502  \u2502   \u2502 [11:Gateway] \u2502    \u2502              \u2502    \u2502              \u2502                  \u2502 \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502 \u2502\n\u2502  \u2502                                                                              \u2502 \u2502\n\u2502  \u2502              toolsearch (optional, implements Searcher #2)                  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    Sandbox/Runtime Layer (10 backends)                      \u2502 \u2502\n\u2502  \u2502   unsafe | docker | containerd | k8s | firecracker | kata | gvisor | wasm  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#revised-implementation-timeline","title":"Revised Implementation Timeline","text":"<p>Based on the architecture discovery, the implementation timeline has been reduced from 9 weeks to 6-7 weeks because the core pluggable architecture already exists.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#updated-phase-summary","title":"Updated Phase Summary","text":"Phase Focus Duration Rationale Phase 1 CLI + Config 2 weeks Add Cobra CLI and Koanf configuration to expose existing extension points Phase 2 Transport Layer 1-2 weeks Transport interface exists conceptually, needs explicit abstraction Phase 3 Public APIs 1 week Export internal packages, document extension points, provide examples Phase 4 Backend Integration 2 weeks Complete Docker/WASM integration, backend registry configuration Total 6-7 weeks 25% reduction from original 9-week estimate"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-insight","title":"Key Insight","text":"<p>The original proposal assumed significant refactoring work. The architecture discovery revealed:</p> <ol> <li>13 extension points already exist as Go interfaces</li> <li>10 sandbox backends already implemented (docker, k8s, wasm, etc.)</li> <li>Multi-backend per tool already supported with <code>BackendSelector</code></li> <li>Progressive disclosure already implemented (summary/schema/full)</li> <li>Security profiles already exist (dev/standard/hardened)</li> </ol> <p>The work is primarily configuration and exposure, not architecture redesign.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#phase-1-detailed-plan-cli-config","title":"Phase 1 Detailed Plan (CLI + Config)","text":"<p>Goal: Make the 13 extension points configurable via YAML and CLI flags.</p> <pre><code># config.yaml - Complete configuration schema\nserver:\n  transport: stdio  # stdio | sse | websocket\n  port: 8080        # For HTTP transports\n\n# Extension Point #2: Searcher\nsearch:\n  strategy: bm25    # bm25 | simple | semantic\n  config:\n    name_boost: 3.0\n    tags_boost: 2.0\n\n# Extension Point #3: BackendSelector\nbackends:\n  selector: default  # default | latency | cost | custom\n  priority: [local, provider, mcp]\n\n# Extension Point #10: Runtime Backend\nruntime:\n  backend: docker    # unsafe | docker | k8s | wasm | gvisor\n  profile: standard  # dev | standard | hardened\n\n# Extension Point #12: Logger\nlogging:\n  level: info\n  format: json\n</code></pre> <p>CLI Commands: <pre><code>metatools serve --transport=stdio                    # Default MCP mode\nmetatools serve --transport=sse --port=8080          # HTTP/SSE mode\nmetatools serve --config=/path/to/config.yaml        # Full configuration\nmetatools list-tools                                 # List registered tools\nmetatools describe &lt;tool-id&gt;                         # Show tool documentation\n</code></pre></p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-evaluation","title":"Architecture Evaluation","text":"<p>A comprehensive evaluation against championship-level implementations has been performed. See architecture-evaluation.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#championship-implementations-analyzed","title":"Championship Implementations Analyzed","text":"Project Stars Key Patterns Tencent WeKnora 12,566 Multi-tenant RAG, layered architecture go-kratos/blades 700 Tool interfaces, middleware chain Official MCP Go SDK - Reference implementation patterns Google ADK for Go - A2A protocol, multi-agent fastmcp 22,398 Rapid MCP server development"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#current-position-85-championship-level","title":"Current Position: 85% Championship Level","text":"Category Score Status Core Architecture 95% \u2705 Excellent Pluggability 90% \u2705 13 extension points Security 95% \u2705 10 backends, 3 profiles Observability 40% \u26a0\ufe0f Needs OpenTelemetry Semantic Search 60% \u26a0\ufe0f BM25 only Protocol Coverage 70% \u26a0\ufe0f Missing resources/prompts"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#recommended-new-libraries","title":"Recommended New Libraries","text":"Library Purpose Priority toolobserve OpenTelemetry tracing + metrics High toolsemantic Vector-based semantic search Medium toolresource MCP Resources support Medium toolgateway Auth, rate limit, analytics proxy Medium"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#path-to-championship","title":"Path to Championship","text":"<ol> <li>Observability (toolobserve) - 2 weeks</li> <li>Semantic search (toolsemantic) - 2 weeks</li> <li>MCP Resources (toolresource) - 2 weeks</li> <li>Gateway/Proxy (toolgateway) - 2 weeks</li> </ol> <p>Total to 95%+ championship level: ~8 weeks</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#protocol-agnostic-tools","title":"Protocol-Agnostic Tools","text":"<p>A comprehensive proposal for protocol-agnostic tool exposure and composable toolsets has been created. See protocol-agnostic-tools.md for:</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#key-capabilities","title":"Key Capabilities","text":"Capability Description Protocol-agnostic interface Canonical tool representation independent of source or destination protocol Bidirectional adapters Convert tools between MCP, OpenAI, Anthropic, LangChain formats Toolset composition Create curated tool collections from multiple sources Multi-transport exposure Serve toolsets via MCP, direct client interfaces, REST, or A2A"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-new-libraries","title":"Proposed New Libraries","text":"Library Purpose tooladapter Canonical tool abstraction with protocol adapters toolset Composable tool collections with access control"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#adapter-support-matrix","title":"Adapter Support Matrix","text":"Protocol Import Export Notes MCP \u2705 \u2705 Full JSON Schema support OpenAI \u2705 \u2705 Includes strict mode Anthropic \u2705 \u2705 input_schema mapping LangChain \u2705 \u2705 Zod schema conversion OpenAPI \u2705 - Operation extraction"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#toolset-composition-pattern","title":"Toolset Composition Pattern","text":"<pre><code>// Create customer-specific toolset from multiple sources\ncustomerSet, _ := toolset.NewBuilder(\"customer-acme\").\n    FromRegistry(registry).\n    WithTools(\n        \"mcp.support.create_ticket\",\n        \"mcp.docs.search\",\n        \"openai.functions.analyze\",\n    ).\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedTenants: []string{\"acme-corp\"},\n    }).\n    Build()\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#implementation-timeline","title":"Implementation Timeline","text":"<ul> <li>Phase 1: Core adapter library (2 weeks)</li> <li>Phase 2: Toolset composition (2 weeks)</li> <li>Phase 3: Multi-transport exposure (2 weeks)</li> </ul> <p>Total: ~6 weeks</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-strategy","title":"Versioning Strategy","text":"<p>Critical Finding: Tool versioning causes 60% of production agent failures. Backward compatibility is the foundation of agent ecosystem stability.</p> <p>A comprehensive versioning strategy is essential for fast rollforward, safe rollback, and multi-version coexistence.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-layers","title":"Versioning Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        VERSIONING ARCHITECTURE                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                               \u2502\n\u2502  Layer 1: MCP PROTOCOL VERSION                                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Version negotiation during initialization                                \u2502 \u2502\n\u2502  \u2502 Current: 2025-11-25 | Supported: [2024-11-05, 2025-03-26, 2025-06-18]  \u2502 \u2502\n\u2502  \u2502 \u2192 Server advertises supported versions                                   \u2502 \u2502\n\u2502  \u2502 \u2192 Client selects compatible version                                      \u2502 \u2502\n\u2502  \u2502 \u2192 Single version used for session                                        \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 2: TOOL SCHEMA VERSION                                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Per-tool semantic versioning (MAJOR.MINOR.PATCH)                        \u2502 \u2502\n\u2502  \u2502 \u2192 MAJOR: Breaking input/output schema changes                           \u2502 \u2502\n\u2502  \u2502 \u2192 MINOR: New optional parameters, backward-compatible                   \u2502 \u2502\n\u2502  \u2502 \u2192 PATCH: Bug fixes, documentation updates                                \u2502 \u2502\n\u2502  \u2502 Multiple versions can be active simultaneously                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 3: BACKEND VERSION                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 External API versions (OpenAI v1/v2, GitHub REST/GraphQL)               \u2502 \u2502\n\u2502  \u2502 \u2192 Version-specific adapters                                              \u2502 \u2502\n\u2502  \u2502 \u2192 Automatic version detection                                            \u2502 \u2502\n\u2502  \u2502 \u2192 Graceful degradation                                                   \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 4: CONFIGURATION VERSION                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Config file schema versioning                                            \u2502 \u2502\n\u2502  \u2502 \u2192 Version field at config root                                           \u2502 \u2502\n\u2502  \u2502 \u2192 Migration scripts for version upgrades                                 \u2502 \u2502\n\u2502  \u2502 \u2192 Validation against versioned schema                                    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2502  Layer 5: DEPLOYMENT VERSION                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Blue/green, canary deployment support                                    \u2502 \u2502\n\u2502  \u2502 \u2192 Multiple server versions running simultaneously                       \u2502 \u2502\n\u2502  \u2502 \u2192 Traffic splitting by version                                          \u2502 \u2502\n\u2502  \u2502 \u2192 Instant rollback capability                                           \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-protocol-version-negotiation","title":"MCP Protocol Version Negotiation","text":"<pre><code>// toolversion/protocol.go\n\n// ProtocolVersions lists supported MCP specification versions\nvar ProtocolVersions = []string{\n    \"2025-11-25\",  // Latest (default)\n    \"2025-06-18\",  // OAuth 2.1 authorization\n    \"2025-03-26\",  // Batching (later removed)\n    \"2024-11-05\",  // Initial stable release\n}\n\n// VersionNegotiator handles protocol version selection\ntype VersionNegotiator struct {\n    supported []string\n    preferred string\n}\n\nfunc (n *VersionNegotiator) Negotiate(clientVersions []string) (string, error) {\n    // Find best matching version\n    for _, preferred := range n.supported {\n        for _, client := range clientVersions {\n            if preferred == client {\n                return preferred, nil\n            }\n        }\n    }\n    return \"\", ErrNoCompatibleVersion\n}\n\n// Server initialization with version negotiation\nfunc (s *Server) Initialize(ctx context.Context, req *mcp.InitializeRequest) (*mcp.InitializeResult, error) {\n    version, err := s.negotiator.Negotiate(req.ProtocolVersions)\n    if err != nil {\n        return nil, err\n    }\n\n    s.activeVersion = version\n\n    return &amp;mcp.InitializeResult{\n        ProtocolVersion: version,\n        ServerInfo: mcp.ServerInfo{\n            Name:    \"metatools-mcp\",\n            Version: s.serverVersion,\n        },\n        Capabilities: s.capabilitiesForVersion(version),\n    }, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#tool-schema-versioning","title":"Tool Schema Versioning","text":"<pre><code>// toolversion/tool.go\n\n// VersionedTool represents a tool with semantic versioning\ntype VersionedTool struct {\n    toolmodel.Tool\n\n    Version       semver.Version    // e.g., 2.1.0\n    MinVersion    semver.Version    // Minimum compatible version\n    Deprecated    bool\n    DeprecatedMsg string\n    Sunset        time.Time         // When this version will be removed\n}\n\n// ToolVersionRegistry manages multiple versions of tools\ntype ToolVersionRegistry struct {\n    tools map[string]map[semver.Version]*VersionedTool  // name -&gt; version -&gt; tool\n    mu    sync.RWMutex\n}\n\n// Register adds a versioned tool\nfunc (r *ToolVersionRegistry) Register(tool *VersionedTool) error {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n\n    name := tool.Name()\n    if r.tools[name] == nil {\n        r.tools[name] = make(map[semver.Version]*VersionedTool)\n    }\n\n    r.tools[name][tool.Version] = tool\n    return nil\n}\n\n// Resolve finds the best matching tool version\nfunc (r *ToolVersionRegistry) Resolve(name string, constraint string) (*VersionedTool, error) {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    versions, ok := r.tools[name]\n    if !ok {\n        return nil, ErrToolNotFound\n    }\n\n    // Parse constraint (e.g., \"&gt;=1.0.0 &lt;2.0.0\", \"^1.2.3\", \"~1.2.0\")\n    c, err := semver.NewConstraint(constraint)\n    if err != nil {\n        // No constraint = latest stable\n        return r.latestStable(name)\n    }\n\n    // Find best matching version\n    var best *VersionedTool\n    for ver, tool := range versions {\n        if c.Check(&amp;ver) &amp;&amp; !tool.Deprecated {\n            if best == nil || ver.GreaterThan(&amp;best.Version) {\n                best = tool\n            }\n        }\n    }\n\n    if best == nil {\n        return nil, ErrNoCompatibleVersion\n    }\n    return best, nil\n}\n\n// ListVersions returns all versions of a tool\nfunc (r *ToolVersionRegistry) ListVersions(name string) []VersionInfo {\n    r.mu.RLock()\n    defer r.mu.RUnlock()\n\n    var versions []VersionInfo\n    for ver, tool := range r.tools[name] {\n        versions = append(versions, VersionInfo{\n            Version:    ver,\n            Deprecated: tool.Deprecated,\n            Sunset:     tool.Sunset,\n        })\n    }\n\n    sort.Slice(versions, func(i, j int) bool {\n        return versions[i].Version.GreaterThan(&amp;versions[j].Version)\n    })\n\n    return versions\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#schema-evolution-compatibility","title":"Schema Evolution &amp; Compatibility","text":"<pre><code>// toolversion/schema.go\n\n// CompatibilityMode defines schema evolution rules\ntype CompatibilityMode string\n\nconst (\n    // BACKWARD: New schema can read old data\n    CompatibilityBackward CompatibilityMode = \"BACKWARD\"\n    // FORWARD: Old schema can read new data\n    CompatibilityForward CompatibilityMode = \"FORWARD\"\n    // FULL: Both backward and forward compatible\n    CompatibilityFull CompatibilityMode = \"FULL\"\n    // NONE: No compatibility guarantees\n    CompatibilityNone CompatibilityMode = \"NONE\"\n)\n\n// SchemaEvolutionRules defines allowed changes per compatibility mode\nvar SchemaEvolutionRules = map[CompatibilityMode]EvolutionRules{\n    CompatibilityBackward: {\n        AllowAddOptionalField:    true,\n        AllowRemoveOptionalField: false,\n        AllowAddRequiredField:    false,  // Breaks old clients\n        AllowRemoveRequiredField: true,   // Old clients still work\n        AllowFieldTypeWidening:   true,   // int \u2192 long\n        AllowFieldTypeNarrowing:  false,\n    },\n    CompatibilityForward: {\n        AllowAddOptionalField:    false,  // Old readers can't handle\n        AllowRemoveOptionalField: true,\n        AllowAddRequiredField:    true,\n        AllowRemoveRequiredField: false,\n        AllowFieldTypeWidening:   false,\n        AllowFieldTypeNarrowing:  true,\n    },\n    CompatibilityFull: {\n        AllowAddOptionalField:    true,   // Only safe change\n        AllowRemoveOptionalField: false,\n        AllowAddRequiredField:    false,\n        AllowRemoveRequiredField: false,\n        AllowFieldTypeWidening:   false,\n        AllowFieldTypeNarrowing:  false,\n    },\n}\n\n// SchemaValidator checks if schema change is compatible\ntype SchemaValidator struct {\n    mode CompatibilityMode\n}\n\nfunc (v *SchemaValidator) ValidateChange(old, new *jsonschema.Schema) error {\n    rules := SchemaEvolutionRules[v.mode]\n    changes := v.detectChanges(old, new)\n\n    for _, change := range changes {\n        if !rules.IsAllowed(change) {\n            return &amp;CompatibilityError{\n                Change: change,\n                Mode:   v.mode,\n            }\n        }\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#version-aware-tool-resolution","title":"Version-Aware Tool Resolution","text":"<pre><code>// toolversion/resolver.go\n\n// VersionedToolRequest specifies version constraints\ntype VersionedToolRequest struct {\n    Name           string\n    VersionSpec    string  // Semver constraint: \"^1.0.0\", \"&gt;=2.0.0\", \"latest\"\n    PreferStable   bool\n    AllowPrerelease bool\n}\n\n// Resolver determines which tool version to use\ntype Resolver struct {\n    registry *ToolVersionRegistry\n    cache    Cache\n    metrics  VersionMetrics\n}\n\nfunc (r *Resolver) Resolve(ctx context.Context, req VersionedToolRequest) (*VersionedTool, error) {\n    // Check cache first\n    cacheKey := fmt.Sprintf(\"resolve:%s:%s\", req.Name, req.VersionSpec)\n    if cached, ok := r.cache.Get(ctx, cacheKey); ok {\n        return cached.(*VersionedTool), nil\n    }\n\n    var tool *VersionedTool\n    var err error\n\n    switch req.VersionSpec {\n    case \"\", \"latest\":\n        tool, err = r.registry.Resolve(req.Name, \"*\")\n    default:\n        tool, err = r.registry.Resolve(req.Name, req.VersionSpec)\n    }\n\n    if err != nil {\n        return nil, err\n    }\n\n    // Warn if using deprecated version\n    if tool.Deprecated {\n        r.metrics.DeprecatedToolUsage.Inc(labels{\n            \"tool\":    req.Name,\n            \"version\": tool.Version.String(),\n        })\n        log.Warn(\"Using deprecated tool version\",\n            \"tool\", req.Name,\n            \"version\", tool.Version,\n            \"message\", tool.DeprecatedMsg,\n            \"sunset\", tool.Sunset,\n        )\n    }\n\n    r.cache.Set(ctx, cacheKey, tool, 5*time.Minute)\n    return tool, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-version-deployment","title":"Multi-Version Deployment","text":"<pre><code>// toolversion/deployment.go\n\n// DeploymentVersion represents a running server version\ntype DeploymentVersion struct {\n    ServerVersion string\n    GitCommit     string\n    BuildTime     time.Time\n    Features      []string\n}\n\n// VersionRouter routes requests to appropriate server versions\ntype VersionRouter struct {\n    versions map[string]*ServerInstance\n    weights  map[string]int  // Traffic percentage\n}\n\n// Route selects server version based on routing rules\nfunc (r *VersionRouter) Route(ctx context.Context, req *Request) (*ServerInstance, error) {\n    // Check for explicit version header\n    if ver := req.Header.Get(\"X-Tool-Version\"); ver != \"\" {\n        if instance, ok := r.versions[ver]; ok {\n            return instance, nil\n        }\n    }\n\n    // Check for client-specified version preference\n    if pref := ctx.Value(versionPreferenceKey); pref != nil {\n        if instance, ok := r.versions[pref.(string)]; ok {\n            return instance, nil\n        }\n    }\n\n    // Weighted random selection (for canary deployments)\n    return r.weightedSelect(), nil\n}\n\n// DeploymentManager handles version lifecycle\ntype DeploymentManager struct {\n    router   *VersionRouter\n    registry *ToolVersionRegistry\n}\n\n// Canary starts a canary deployment\nfunc (m *DeploymentManager) Canary(newVersion string, percentage int) error {\n    m.router.weights[newVersion] = percentage\n    m.router.weights[\"stable\"] = 100 - percentage\n    return nil\n}\n\n// Promote makes a version the new stable\nfunc (m *DeploymentManager) Promote(version string) error {\n    m.router.weights = map[string]int{version: 100}\n    return nil\n}\n\n// Rollback reverts to previous stable version\nfunc (m *DeploymentManager) Rollback() error {\n    // Instant traffic shift to previous stable\n    return m.Promote(m.previousStable)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#version-configuration","title":"Version Configuration","text":"<pre><code># metatools.yaml\nversion: \"1.0.0\"  # Config schema version\n\nserver:\n  version: \"2.3.1\"\n\nprotocol:\n  supported_versions:\n    - \"2025-11-25\"\n    - \"2025-06-18\"\n    - \"2024-11-05\"\n  default_version: \"2025-11-25\"\n\ntools:\n  versioning:\n    enabled: true\n    compatibility_mode: BACKWARD  # BACKWARD, FORWARD, FULL, NONE\n\n    # Per-tool version configuration\n    versions:\n      github/create_issue:\n        - version: \"2.0.0\"\n          status: stable\n        - version: \"1.5.0\"\n          status: deprecated\n          sunset: \"2026-06-01\"\n          message: \"Use v2.0.0 - improved error handling\"\n        - version: \"1.0.0\"\n          status: sunset  # Will be removed\n\n    # Version resolution rules\n    resolution:\n      prefer_stable: true\n      allow_prerelease: false\n      default_constraint: \"^\"  # Caret = compatible with major version\n\ndeployment:\n  strategy: canary  # blue_green, canary, rolling\n\n  canary:\n    initial_percentage: 5\n    increment: 10\n    interval: 5m\n    rollback_threshold:\n      error_rate: 0.05\n      latency_p99: 2s\n\n  versions:\n    stable: \"2.3.0\"\n    canary: \"2.3.1\"\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#mcp-tool-registration-with-versioning","title":"MCP Tool Registration with Versioning","text":"<pre><code>// Expose versioned tools via MCP\nfunc (s *Server) listTools(ctx context.Context) ([]mcp.Tool, error) {\n    var tools []mcp.Tool\n\n    for _, vt := range s.versionRegistry.AllLatestStable() {\n        tool := vt.Tool.ToMCP()\n\n        // Add version metadata as annotations\n        tool.Annotations = map[string]any{\n            \"version\":      vt.Version.String(),\n            \"min_version\":  vt.MinVersion.String(),\n            \"deprecated\":   vt.Deprecated,\n            \"sunset\":       vt.Sunset,\n        }\n\n        // Version in description for AI visibility\n        if vt.Deprecated {\n            tool.Description = fmt.Sprintf(\"[DEPRECATED: %s] %s\",\n                vt.DeprecatedMsg, tool.Description)\n        }\n\n        tools = append(tools, tool)\n    }\n\n    return tools, nil\n}\n\n// Handle tool calls with version resolution\nfunc (s *Server) callTool(ctx context.Context, req *mcp.CallToolRequest) (*mcp.CallToolResult, error) {\n    // Extract version from request (if specified)\n    versionSpec := \"latest\"\n    if v, ok := req.Arguments[\"_version\"].(string); ok {\n        versionSpec = v\n        delete(req.Arguments, \"_version\")  // Remove meta-argument\n    }\n\n    // Resolve tool version\n    tool, err := s.resolver.Resolve(ctx, VersionedToolRequest{\n        Name:        req.Name,\n        VersionSpec: versionSpec,\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    // Execute with resolved version\n    return tool.Execute(ctx, req.Arguments)\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#versioning-best-practices","title":"Versioning Best Practices","text":"Rule Rationale Never break existing function signatures Old clients must continue working Add optional parameters, never remove required ones Backward compatibility Don't delete safety rules or constraints Maintain security guarantees Deprecate before removing Give users migration time Version from day one Adding versioning later is exponentially harder Announce breaking changes in MAJOR Clear semantic meaning Maintain audit trails for version changes Compliance and debugging"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#proposed-library-toolversion","title":"Proposed Library: <code>toolversion</code>","text":"<pre><code>toolversion/\n\u251c\u2500\u2500 protocol.go        # MCP protocol version negotiation\n\u251c\u2500\u2500 semver.go          # Semantic version parsing and comparison\n\u251c\u2500\u2500 registry.go        # Multi-version tool registry\n\u251c\u2500\u2500 resolver.go        # Version constraint resolution\n\u251c\u2500\u2500 schema.go          # Schema evolution validation\n\u251c\u2500\u2500 compatibility.go   # Compatibility mode enforcement\n\u251c\u2500\u2500 deployment.go      # Blue/green, canary deployment support\n\u251c\u2500\u2500 migration.go       # Version migration helpers\n\u2514\u2500\u2500 metrics.go         # Version usage metrics\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#multi-language-extensibility","title":"Multi-Language Extensibility","text":"<p>Key Insight: The pluggable architecture is not limited to Go implementations. Any component defined by an interface can be implemented in any programming language through standardized interface contracts.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#architecture-principle","title":"Architecture Principle","text":"<p>All extension points in this architecture (Transport, Searcher, Cache, Backend, etc.) are defined as Go interfaces. These interfaces can be implemented in any language using:</p> <ol> <li>gRPC + Protocol Buffers (recommended) - Battle-tested, used by HashiCorp Terraform/Vault</li> <li>WebAssembly Component Model - Sandboxed, portable, no network overhead</li> <li>JSON-RPC over stdio - Simple, any executable works</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#use-cases","title":"Use Cases","text":"Component Preferred Language Rationale Embedder Python Rich ML ecosystem (PyTorch, sentence-transformers) VectorIndex Rust SIMD performance, memory safety Reranker Python Hugging Face cross-encoders KnowledgeGraph Python/Java Neo4j, NetworkX bindings Custom Adapter TypeScript Existing MCP servers, quick prototypes"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#interface-contracts-via-protocol-buffers","title":"Interface Contracts via Protocol Buffers","text":"<p>All Go interfaces are documented as Protocol Buffer service definitions, enabling automatic SDK generation for Python, Rust, TypeScript, Java, and more.</p> <pre><code>// Example: Embedder interface as protobuf\nservice Embedder {\n  rpc Embed(EmbedRequest) returns (EmbedResponse);\n  rpc EmbedBatch(EmbedBatchRequest) returns (EmbedBatchResponse);\n  rpc Info(InfoRequest) returns (EmbedderInfo);\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#full-specification","title":"Full Specification","text":"<p>See ROADMAP.md Section 8: Multi-Language Extensibility for: - Complete gRPC plugin architecture with HashiCorp go-plugin patterns - WebAssembly Interface Types (WIT) definitions - JSON-RPC fallback for simple plugins - SDK generation for Python, Rust, TypeScript - Configuration examples for multi-language plugins</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#open-questions","title":"Open Questions","text":"<ol> <li>ToolProvider interface - Does the proposed interface feel right for plug-and-play tools?</li> <li>Middleware chain - Useful now, or defer until needed?</li> <li>Backend configuration - YAML-driven or code-only for now?</li> <li>Semantic search - Priority for vector/embedding-based search strategy?</li> <li>Multi-tenancy - Which isolation strategy (shared, namespace, process) is primary target?</li> <li>Versioning compatibility mode - Should BACKWARD be the default, or FULL for maximum safety?</li> <li>MCP protocol versions - How far back should we support? (2024-11-05 is the oldest stable)</li> <li>Tool version in tool names - Should version be part of tool name (<code>github/create_issue@2</code>) or metadata?</li> <li>Breaking change policy - What's the minimum deprecation window before sunset?</li> <li>Multi-language plugins - Should gRPC be the primary contract mechanism, or prioritize WASM for sandboxing?</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/pluggable-architecture/#changelog","title":"Changelog","text":"Date Change 2026-01-27 Initial draft 2026-01-27 Added Multi-Backend Architecture section with diagrams 2026-01-27 Expanded Middleware Chain section with pluggable design 2026-01-27 Added comprehensive Transport Layer section with all protocols 2026-01-27 Added End-to-End Examples section with 5 real-world scenarios 2026-01-27 Added Architecture Validation section with industry pattern verification 2026-01-27 Created detailed Implementation Phases document (see implementation-phases.md) 2026-01-27 Added Component Library Analysis for all 7 tool* libraries (see component-library-analysis.md) 2026-01-28 Added Multi-Tenancy Extension for pluggable tenant isolation (see multi-tenancy.md) 2026-01-28 Added Extension Point Catalog documenting 13 existing pluggable interfaces across all component libraries 2026-01-28 Added Revised Implementation Timeline (6-7 weeks, 25% reduction from original 9-week estimate) 2026-01-28 Key finding: Architecture is already 85%+ pluggable - needs exposure and configuration, not redesign 2026-01-28 Added Architecture Evaluation comparing against 5 championship-level implementations 2026-01-28 Identified 4 potential new libraries: toolobserve, toolsemantic, toolresource, toolgateway 2026-01-28 Added Protocol-Agnostic Tools section with 2 new proposed libraries: tooladapter, toolset 2026-01-28 Created comprehensive proposal for composable toolsets and protocol adapters (see protocol-agnostic-tools.md) 2026-01-28 Added Cache Layer as extension point #6 with pluggable backends (memory, Redis, SQLite, layered) 2026-01-28 Proposed new library: <code>toolcache</code> for cross-component caching with invalidation strategies 2026-01-28 Added section 7: Additional Cross-Cutting Concerns with comprehensive enterprise patterns 2026-01-28 Documented 12 cross-cutting concerns: cache, circuit breaker, retry, bulkhead, health checks, secrets, config reload, feature flags, audit trail, backpressure, timeout, tracing 2026-01-28 Proposed 6 new libraries for cross-cutting concerns: toolresilience, toolhealth, toolsecrets, toolflags, toolaudit, toolpressure 2026-01-28 Added comprehensive Versioning Strategy section (section 19) 2026-01-28 Documented 5 versioning layers: MCP protocol, tool schema, backend, configuration, deployment 2026-01-28 Added schema evolution with BACKWARD/FORWARD/FULL compatibility modes 2026-01-28 Added blue/green and canary deployment support for multi-version coexistence 2026-01-28 Proposed new library: <code>toolversion</code> for semantic versioning and version negotiation 2026-01-28 Created master ROADMAP.md consolidating all proposals into 4 work streams and 17-week timeline 2026-01-28 Total library inventory: 7 existing + 14 proposed = 21 libraries for enterprise-ready platform 2026-01-28 Added Section 20: Multi-Language Extensibility - gRPC/WASM/JSON-RPC plugin contracts for Python, Rust, TypeScript"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/","title":"Protocol-Agnostic Tools and Composable Toolsets","text":"<p>Status: Draft Last Updated: 2026-01-28 Authors: Architecture Team Related: Master Roadmap (Stream B: Protocol Layer), Pluggable Architecture</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Executive Summary</li> <li>Problem Statement</li> <li>Goals and Non-Goals</li> <li>Research Findings</li> <li>Proposed Architecture</li> <li>Tool Abstraction Layer</li> <li>Protocol Adapters</li> <li>Composable Toolsets</li> <li>Integration with Existing Libraries</li> <li>Implementation Roadmap</li> <li>Appendix: Industry Patterns</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#executive-summary","title":"Executive Summary","text":"<p>This proposal extends metatools-mcp's pluggable architecture to support protocol-agnostic tool exposure and composable toolsets. Rather than limiting tool consumption to the MCP protocol, we introduce an adaptability layer that enables tools from any source (MCP backends, custom providers, local implementations) to be exposed through multiple transport protocols and consumed by various AI agent frameworks.</p> <p>Key capabilities: - Protocol-agnostic tool interface - Canonical tool representation independent of source or destination protocol - Bidirectional adapters - Convert tools between MCP, OpenAI, Anthropic, LangChain, and other formats - Toolset composition - Create curated tool collections from multiple sources - Multi-transport exposure - Serve toolsets via MCP, direct client interfaces, REST, or A2A</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#problem-statement","title":"Problem Statement","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#current-limitations","title":"Current Limitations","text":"<ol> <li> <p>MCP-Only Exposure: metatools-mcp currently exposes tools exclusively through the MCP protocol. Organizations with mature AI environments using different tool calling conventions (OpenAI function calling, Anthropic tool use, LangChain tools) cannot directly consume metatools without MCP integration.</p> </li> <li> <p>Fixed Tool Collections: All registered tools are exposed as a single collection. There's no mechanism to create curated toolsets for different use cases (development vs production, team A vs team B, customer-specific).</p> </li> <li> <p>One-Way Conversion: Tools flow from backends \u2192 MCP \u2192 clients. There's no standardized way to import tools from external sources (OpenAPI specs, LangChain tools, OpenAI functions) into the metatools ecosystem.</p> </li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#industry-context","title":"Industry Context","text":"<p>Research reveals a fragmented landscape of tool formats:</p> Provider Format Key Differences MCP <code>Tool</code> with <code>inputSchema</code> Rich JSON Schema, supports resources/prompts OpenAI <code>function</code> with <code>parameters</code> Strict mode available, simpler schema Anthropic <code>tool</code> with <code>input_schema</code> Similar to MCP but different field names LangChain <code>StructuredTool</code> Python/JS-centric, Zod schemas A2A Agent-defined Inter-agent tool delegation <p>The Mastra framework demonstrated that proper tool format conversion reduces error rates from 15% to 3% across providers.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#goals-and-non-goals","title":"Goals and Non-Goals","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#goals","title":"Goals","text":"<ol> <li>Protocol Independence: Tools can be consumed without MCP protocol dependency</li> <li>Format Preservation: Tool semantics survive conversion without information loss</li> <li>Bidirectional Flow: Import tools from external sources, export to any format</li> <li>Composability: Create, manage, and expose custom tool collections</li> <li>Backward Compatibility: Existing MCP-based workflows remain unchanged</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#non-goals","title":"Non-Goals","text":"<ol> <li>Runtime Protocol Bridging: We're not building a universal protocol translator</li> <li>Tool Implementation: Adapters convert metadata, not execution logic</li> <li>Full A2A Implementation: Agent orchestration is out of scope</li> <li>Schema Validation Engine: We rely on existing validation libraries</li> </ol>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#research-findings","title":"Research Findings","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-1-unified-tool-abstraction-toolregistry-paper","title":"Pattern 1: Unified Tool Abstraction (ToolRegistry Paper)","text":"<p>The ArXiv paper \"Unified Tool Integration for LLMs\" establishes a three-layer architecture:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Layer 3: API Compatibility              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502 OpenAI  \u2502  \u2502Anthropic\u2502  \u2502LangChain\u2502  \u2502   MCP   \u2502   \u2502\n\u2502   \u2502 Format  \u2502  \u2502 Format  \u2502  \u2502 Format  \u2502  \u2502 Format  \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502            \u2502            \u2502            \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                           \u2502                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Layer 2: Protocol Adapters              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  MCP    \u2502  \u2502 OpenAPI \u2502  \u2502LangChain\u2502  \u2502 Custom  \u2502   \u2502\n\u2502   \u2502 Adapter \u2502  \u2502 Adapter \u2502  \u2502 Adapter \u2502  \u2502 Adapter \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u2502            \u2502            \u2502            \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                           \u2502                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Layer 1: Unified Abstraction            \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502                    \u2502 Canonical Tool\u2502                    \u2502\n\u2502                    \u2502  Abstraction  \u2502                    \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Insight: The canonical tool representation stores the superset of all schema information, enabling lossless conversion between formats.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-2-langchain-mcp-adapter","title":"Pattern 2: LangChain MCP Adapter","text":"<p>LangChain's <code>langchainjs-mcp-adapters</code> demonstrates practical conversion:</p> <pre><code>// MCP Tool \u2192 LangChain DynamicStructuredTool\nexport async function loadMcpTools(\n  serverName: string,\n  client: Client,\n): Promise&lt;StructuredToolInterface[]&gt; {\n  const toolsResponse = await client.listTools();\n  return toolsResponse.tools.map((tool: MCPTool) =&gt; {\n    return new DynamicStructuredTool({\n      name: `${serverName}_${tool.name}`,\n      description: tool.description || \"\",\n      schema: tool.inputSchema,  // Direct schema pass-through\n      func: callTool.bind(null, serverName, tool.name, client)\n    });\n  });\n}\n</code></pre> <p>Key Insight: Namespacing (<code>serverName_toolName</code>) prevents collisions when aggregating tools from multiple sources.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-3-multi-language-tool-declaration-llm-functions","title":"Pattern 3: Multi-Language Tool Declaration (llm-functions)","text":"<p>The <code>llm-functions</code> library shows format-agnostic tool declaration:</p> <pre><code># Bash: Comment annotations\n# @describe Search the web\n# @option --query! The search query\n# @option --num_results=10 Number of results\nsearch_web() { ... }\n</code></pre> <pre><code>// JavaScript: JSDoc\n/**\n * @typedef {Object} Args\n * @property {string} query - The search query\n * @property {number} [num_results=10] - Number of results\n */\n</code></pre> <pre><code># Python: Type hints + docstrings\ndef search_web(query: str, num_results: int = 10):\n    \"\"\"Search the web.\n\n    Args:\n        query: The search query\n        num_results: Number of results (default: 10)\n    \"\"\"\n</code></pre> <p>Key Insight: All three declarations compile to identical JSON Schema, proving format-agnostic tool definitions are achievable.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#pattern-4-tool-rag-for-large-registries","title":"Pattern 4: Tool RAG for Large Registries","text":"<p>For registries with 50+ tools, semantic search dramatically improves tool selection:</p> Approach Accuracy (50 tools) Accuracy (500 tools) Keyword matching 65% 23% BM25 (current) 78% 45% Vector embeddings 89% 72% Hybrid (BM25 + vector) 94% 81% <p>Anthropic's RAG-MCP implementation showed 13% \u2192 43% accuracy improvement using Tool RAG.</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#proposed-architecture","title":"Proposed Architecture","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#new-library-tooladapter","title":"New Library: <code>tooladapter</code>","text":"<p>A dedicated library for protocol-agnostic tool handling:</p> <pre><code>tooladapter/\n\u251c\u2500\u2500 canonical.go      # Canonical tool representation\n\u251c\u2500\u2500 adapter.go        # Adapter interface\n\u251c\u2500\u2500 adapters/\n\u2502   \u251c\u2500\u2500 mcp.go        # MCP \u2194 Canonical\n\u2502   \u251c\u2500\u2500 openai.go     # OpenAI \u2194 Canonical\n\u2502   \u251c\u2500\u2500 anthropic.go  # Anthropic \u2194 Canonical\n\u2502   \u251c\u2500\u2500 langchain.go  # LangChain \u2194 Canonical\n\u2502   \u2514\u2500\u2500 openapi.go    # OpenAPI \u2194 Canonical\n\u251c\u2500\u2500 schema/\n\u2502   \u251c\u2500\u2500 convert.go    # JSON Schema version conversion\n\u2502   \u2514\u2500\u2500 validate.go   # Schema validation\n\u2514\u2500\u2500 registry.go       # Adapter registry\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#new-library-toolset","title":"New Library: <code>toolset</code>","text":"<p>Composable tool collections:</p> <pre><code>toolset/\n\u251c\u2500\u2500 set.go            # Toolset definition\n\u251c\u2500\u2500 builder.go        # Fluent toolset construction\n\u251c\u2500\u2500 filter.go         # Tool filtering predicates\n\u251c\u2500\u2500 policy.go         # Access control policies\n\u2514\u2500\u2500 expose.go         # Multi-protocol exposure\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        metatools-mcp Server                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502    MCP      \u2502  \u2502   Direct    \u2502  \u2502    REST     \u2502  \u2502    A2A     \u2502  \u2502\n\u2502  \u2502  Transport  \u2502  \u2502   Client    \u2502  \u2502     API     \u2502  \u2502  Protocol  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502         \u2502                \u2502                \u2502               \u2502          \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                          \u2502    toolset      \u2502                         \u2502\n\u2502                          \u2502   Composer      \u2502                         \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502         \u2502                         \u2502                         \u2502        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   Toolset   \u2502  \u2502        Toolset              \u2502  \u2502   Toolset    \u2502 \u2502\n\u2502  \u2502  \"dev-ops\"  \u2502  \u2502      \"customer-x\"           \u2502  \u2502    \"prod\"    \u2502 \u2502\n\u2502  \u2502 [A,C,E,F]   \u2502  \u2502       [B,D,F]               \u2502  \u2502   [A,B,D]    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502         \u2502                         \u2502                         \u2502        \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                          \u2502   tooladapter   \u2502                         \u2502\n\u2502                          \u2502   (Canonical)   \u2502                         \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                   \u2502                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510 \u2502\n\u2502 \u2502 MCP  \u2502    \u2502  OpenAI  \u2502   \u2502  Anthropic \u2502  \u2502LangChain \u2502  \u2502 OpenAPI\u2502 \u2502\n\u2502 \u2502Adapter\u2502   \u2502  Adapter \u2502   \u2502   Adapter  \u2502  \u2502 Adapter  \u2502  \u2502 Adapter\u2502 \u2502\n\u2502 \u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2518 \u2502\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2524\n\u2502    \u2502              \u2502               \u2502               \u2502              \u2502   \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510 \u2502\n\u2502 \u2502 MCP  \u2502    \u2502 External \u2502   \u2502  External  \u2502  \u2502 External \u2502  \u2502  REST  \u2502 \u2502\n\u2502 \u2502Server\u2502    \u2502  OpenAI  \u2502   \u2502  Anthropic \u2502  \u2502LangChain \u2502  \u2502  APIs  \u2502 \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  Tools   \u2502   \u2502   Tools    \u2502  \u2502  Tools   \u2502  \u2502        \u2502 \u2502\n\u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#tool-abstraction-layer","title":"Tool Abstraction Layer","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#canonical-tool-interface","title":"Canonical Tool Interface","text":"<pre><code>// tooladapter/canonical.go\n\n// CanonicalTool is the protocol-agnostic tool representation\ntype CanonicalTool struct {\n    // Identity\n    ID          string            // Globally unique identifier\n    Namespace   string            // Source namespace (e.g., \"mcp.github\", \"openai.functions\")\n    Name        string            // Tool name within namespace\n    Version     string            // Semantic version\n\n    // Metadata\n    Description string            // Human-readable description\n    Category    string            // Tool category for grouping\n    Tags        []string          // Searchable tags\n\n    // Schema (superset of all protocol schemas)\n    InputSchema  *JSONSchema      // Full JSON Schema for inputs\n    OutputSchema *JSONSchema      // Optional output schema\n\n    // Execution\n    Handler     ToolHandler       // Execution function\n    Timeout     time.Duration     // Execution timeout\n\n    // Source tracking\n    SourceFormat string           // Original format (mcp, openai, anthropic, etc.)\n    SourceMeta   map[string]any   // Protocol-specific metadata preserved\n\n    // Access control\n    RequiredScopes []string       // OAuth scopes or permissions required\n}\n\n// JSONSchema represents a full JSON Schema with all features\ntype JSONSchema struct {\n    Type        string                 `json:\"type\"`\n    Properties  map[string]*JSONSchema `json:\"properties,omitempty\"`\n    Required    []string               `json:\"required,omitempty\"`\n    Items       *JSONSchema            `json:\"items,omitempty\"`\n    Description string                 `json:\"description,omitempty\"`\n\n    // Extended schema features (preserved during conversion)\n    Enum        []any                  `json:\"enum,omitempty\"`\n    Const       any                    `json:\"const,omitempty\"`\n    Default     any                    `json:\"default,omitempty\"`\n    Minimum     *float64               `json:\"minimum,omitempty\"`\n    Maximum     *float64               `json:\"maximum,omitempty\"`\n    MinLength   *int                   `json:\"minLength,omitempty\"`\n    MaxLength   *int                   `json:\"maxLength,omitempty\"`\n    Pattern     string                 `json:\"pattern,omitempty\"`\n    Format      string                 `json:\"format,omitempty\"`\n\n    // JSON Schema draft compatibility\n    Ref         string                 `json:\"$ref,omitempty\"`\n    Defs        map[string]*JSONSchema `json:\"$defs,omitempty\"`\n}\n\n// ToolHandler executes the tool\ntype ToolHandler func(ctx context.Context, input map[string]any) (any, error)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#adapter-interface","title":"Adapter Interface","text":"<pre><code>// tooladapter/adapter.go\n\n// Adapter converts between canonical and protocol-specific formats\ntype Adapter interface {\n    // Name returns the adapter identifier (e.g., \"mcp\", \"openai\")\n    Name() string\n\n    // ToCanonical converts protocol-specific tool to canonical form\n    ToCanonical(raw any) (*CanonicalTool, error)\n\n    // FromCanonical converts canonical tool to protocol-specific form\n    FromCanonical(tool *CanonicalTool) (any, error)\n\n    // SupportsFeature checks if adapter supports a schema feature\n    SupportsFeature(feature SchemaFeature) bool\n}\n\n// SchemaFeature represents JSON Schema features that may not be universally supported\ntype SchemaFeature int\n\nconst (\n    FeatureNestedObjects SchemaFeature = iota\n    FeatureArrays\n    FeatureEnums\n    FeaturePatternValidation\n    FeatureRefDefinitions\n    FeatureNullable\n    FeatureAnyOf\n    FeatureOneOf\n)\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#protocol-adapters","title":"Protocol Adapters","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#mcp-adapter","title":"MCP Adapter","text":"<pre><code>// tooladapter/adapters/mcp.go\n\ntype MCPAdapter struct{}\n\nfunc (a *MCPAdapter) Name() string { return \"mcp\" }\n\nfunc (a *MCPAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    mcpTool, ok := raw.(*mcp.Tool)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *mcp.Tool, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"mcp.%s\", mcpTool.Name),\n        Namespace:   \"mcp\",\n        Name:        mcpTool.Name,\n        Description: mcpTool.Description,\n        InputSchema: convertMCPSchema(mcpTool.InputSchema),\n        SourceFormat: \"mcp\",\n        SourceMeta: map[string]any{\n            \"annotations\": mcpTool.Annotations,\n        },\n    }, nil\n}\n\nfunc (a *MCPAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    return &amp;mcp.Tool{\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertToMCPSchema(tool.InputSchema),\n    }, nil\n}\n\nfunc (a *MCPAdapter) SupportsFeature(f SchemaFeature) bool {\n    // MCP supports full JSON Schema\n    return true\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#openai-adapter","title":"OpenAI Adapter","text":"<pre><code>// tooladapter/adapters/openai.go\n\ntype OpenAIAdapter struct {\n    StrictMode bool // Enable OpenAI's strict schema mode\n}\n\nfunc (a *OpenAIAdapter) Name() string { return \"openai\" }\n\nfunc (a *OpenAIAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    fn, ok := raw.(*OpenAIFunction)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *OpenAIFunction, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"openai.%s\", fn.Name),\n        Namespace:   \"openai\",\n        Name:        fn.Name,\n        Description: fn.Description,\n        InputSchema: convertOpenAIParameters(fn.Parameters),\n        SourceFormat: \"openai\",\n        SourceMeta: map[string]any{\n            \"strict\": fn.Strict,\n        },\n    }, nil\n}\n\nfunc (a *OpenAIAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    params := convertToOpenAIParameters(tool.InputSchema, a.StrictMode)\n\n    return &amp;OpenAIFunction{\n        Name:        tool.Name,\n        Description: tool.Description,\n        Parameters:  params,\n        Strict:      a.StrictMode,\n    }, nil\n}\n\nfunc (a *OpenAIAdapter) SupportsFeature(f SchemaFeature) bool {\n    switch f {\n    case FeatureRefDefinitions:\n        return false // OpenAI doesn't support $ref\n    case FeaturePatternValidation:\n        return a.StrictMode // Only in strict mode\n    default:\n        return true\n    }\n}\n\n// OpenAI function format\ntype OpenAIFunction struct {\n    Name        string         `json:\"name\"`\n    Description string         `json:\"description,omitempty\"`\n    Parameters  map[string]any `json:\"parameters\"`\n    Strict      bool           `json:\"strict,omitempty\"`\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#anthropic-adapter","title":"Anthropic Adapter","text":"<pre><code>// tooladapter/adapters/anthropic.go\n\ntype AnthropicAdapter struct{}\n\nfunc (a *AnthropicAdapter) Name() string { return \"anthropic\" }\n\nfunc (a *AnthropicAdapter) ToCanonical(raw any) (*CanonicalTool, error) {\n    tool, ok := raw.(*AnthropicTool)\n    if !ok {\n        return nil, fmt.Errorf(\"expected *AnthropicTool, got %T\", raw)\n    }\n\n    return &amp;CanonicalTool{\n        ID:          fmt.Sprintf(\"anthropic.%s\", tool.Name),\n        Namespace:   \"anthropic\",\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertAnthropicSchema(tool.InputSchema),\n        SourceFormat: \"anthropic\",\n    }, nil\n}\n\nfunc (a *AnthropicAdapter) FromCanonical(tool *CanonicalTool) (any, error) {\n    return &amp;AnthropicTool{\n        Name:        tool.Name,\n        Description: tool.Description,\n        InputSchema: convertToAnthropicSchema(tool.InputSchema),\n    }, nil\n}\n\n// AnthropicTool matches Anthropic's tool format\ntype AnthropicTool struct {\n    Name        string         `json:\"name\"`\n    Description string         `json:\"description,omitempty\"`\n    InputSchema map[string]any `json:\"input_schema\"`\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#schema-conversion-utilities","title":"Schema Conversion Utilities","text":"<pre><code>// tooladapter/schema/convert.go\n\n// StripUnsupportedFeatures removes schema features not supported by target\nfunc StripUnsupportedFeatures(schema *JSONSchema, adapter Adapter) *JSONSchema {\n    result := schema.DeepCopy()\n\n    if !adapter.SupportsFeature(FeatureRefDefinitions) {\n        result = resolveRefs(result)\n    }\n\n    if !adapter.SupportsFeature(FeaturePatternValidation) {\n        clearPatterns(result)\n    }\n\n    if !adapter.SupportsFeature(FeatureAnyOf) {\n        result = flattenAnyOf(result)\n    }\n\n    return result\n}\n\n// PreserveSemantics records stripped features for potential restoration\nfunc PreserveSemantics(original, stripped *JSONSchema) map[string]any {\n    return map[string]any{\n        \"original_features\": detectFeatures(original),\n        \"stripped_features\": detectStrippedFeatures(original, stripped),\n    }\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#composable-toolsets","title":"Composable Toolsets","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolset-definition","title":"Toolset Definition","text":"<pre><code>// toolset/set.go\n\n// Toolset represents a curated collection of tools\ntype Toolset struct {\n    ID          string                 // Unique identifier\n    Name        string                 // Human-readable name\n    Description string                 // Purpose description\n\n    // Tool selection\n    Tools       []*tooladapter.CanonicalTool\n\n    // Metadata\n    Tags        []string               // Searchable tags\n    Owner       string                 // Owner/tenant ID\n    CreatedAt   time.Time\n    UpdatedAt   time.Time\n\n    // Access control\n    Policy      *AccessPolicy\n}\n\n// AccessPolicy controls who can use the toolset\ntype AccessPolicy struct {\n    AllowedTenants []string           // Tenant IDs that can access\n    AllowedRoles   []string           // Role-based access\n    RateLimit      *RateLimitConfig   // Optional rate limiting\n    AuditLog       bool               // Enable audit logging\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#fluent-builder","title":"Fluent Builder","text":"<pre><code>// toolset/builder.go\n\n// Builder provides fluent toolset construction\ntype Builder struct {\n    set      *Toolset\n    registry *tooladapter.Registry\n    filters  []FilterFunc\n}\n\n// NewBuilder creates a new toolset builder\nfunc NewBuilder(name string) *Builder {\n    return &amp;Builder{\n        set: &amp;Toolset{\n            ID:   uuid.New().String(),\n            Name: name,\n        },\n    }\n}\n\n// FromRegistry loads tools from an adapter registry\nfunc (b *Builder) FromRegistry(reg *tooladapter.Registry) *Builder {\n    b.registry = reg\n    return b\n}\n\n// WithNamespace includes tools from a specific namespace\nfunc (b *Builder) WithNamespace(ns string) *Builder {\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return t.Namespace == ns\n    })\n    return b\n}\n\n// WithTags includes tools with any of the specified tags\nfunc (b *Builder) WithTags(tags ...string) *Builder {\n    tagSet := make(map[string]bool)\n    for _, t := range tags {\n        tagSet[t] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        for _, tag := range t.Tags {\n            if tagSet[tag] {\n                return true\n            }\n        }\n        return false\n    })\n    return b\n}\n\n// WithTools includes specific tools by ID\nfunc (b *Builder) WithTools(ids ...string) *Builder {\n    idSet := make(map[string]bool)\n    for _, id := range ids {\n        idSet[id] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return idSet[t.ID]\n    })\n    return b\n}\n\n// WithCategory includes tools from a category\nfunc (b *Builder) WithCategory(cat string) *Builder {\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return t.Category == cat\n    })\n    return b\n}\n\n// ExcludeTools removes specific tools by ID\nfunc (b *Builder) ExcludeTools(ids ...string) *Builder {\n    idSet := make(map[string]bool)\n    for _, id := range ids {\n        idSet[id] = true\n    }\n    b.filters = append(b.filters, func(t *tooladapter.CanonicalTool) bool {\n        return !idSet[t.ID]\n    })\n    return b\n}\n\n// WithPolicy sets access control policy\nfunc (b *Builder) WithPolicy(p *AccessPolicy) *Builder {\n    b.set.Policy = p\n    return b\n}\n\n// Build creates the toolset\nfunc (b *Builder) Build() (*Toolset, error) {\n    if b.registry == nil {\n        return nil, errors.New(\"registry required\")\n    }\n\n    allTools := b.registry.All()\n    for _, tool := range allTools {\n        include := true\n        for _, filter := range b.filters {\n            if !filter(tool) {\n                include = false\n                break\n            }\n        }\n        if include {\n            b.set.Tools = append(b.set.Tools, tool)\n        }\n    }\n\n    b.set.CreatedAt = time.Now()\n    b.set.UpdatedAt = time.Now()\n\n    return b.set, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#usage-examples","title":"Usage Examples","text":"<pre><code>// Example: Creating a DevOps toolset\ndevOpsSet, _ := toolset.NewBuilder(\"devops-tools\").\n    FromRegistry(registry).\n    WithNamespace(\"mcp.github\").\n    WithNamespace(\"mcp.kubernetes\").\n    WithTags(\"ci-cd\", \"deployment\", \"monitoring\").\n    ExcludeTools(\"mcp.github.delete_repo\"). // Too dangerous\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedRoles: []string{\"devops\", \"sre\"},\n        AuditLog:     true,\n    }).\n    Build()\n\n// Example: Customer-specific toolset\ncustomerSet, _ := toolset.NewBuilder(\"customer-acme\").\n    FromRegistry(registry).\n    WithTools(\n        \"mcp.support.create_ticket\",\n        \"mcp.docs.search\",\n        \"mcp.billing.get_invoice\",\n    ).\n    WithPolicy(&amp;toolset.AccessPolicy{\n        AllowedTenants: []string{\"acme-corp\"},\n        RateLimit: &amp;toolset.RateLimitConfig{\n            RequestsPerMinute: 60,\n        },\n    }).\n    Build()\n\n// Example: Production-safe toolset (no destructive operations)\nprodSet, _ := toolset.NewBuilder(\"production\").\n    FromRegistry(registry).\n    WithCategory(\"read-only\").\n    WithTags(\"safe\", \"idempotent\").\n    Build()\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#integration-with-existing-libraries","title":"Integration with Existing Libraries","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolindex-integration","title":"toolindex Integration","text":"<p>The tooladapter library integrates with toolindex for tool discovery:</p> <pre><code>// tooladapter/registry.go\n\n// Registry manages tools from multiple sources\ntype Registry struct {\n    index    toolindex.Index\n    adapters map[string]Adapter\n    tools    map[string]*CanonicalTool\n}\n\n// RegisterAdapter adds a protocol adapter\nfunc (r *Registry) RegisterAdapter(adapter Adapter) {\n    r.adapters[adapter.Name()] = adapter\n}\n\n// Import loads tools from an external source\nfunc (r *Registry) Import(format string, tools []any) error {\n    adapter, ok := r.adapters[format]\n    if !ok {\n        return fmt.Errorf(\"unknown format: %s\", format)\n    }\n\n    for _, raw := range tools {\n        canonical, err := adapter.ToCanonical(raw)\n        if err != nil {\n            return err\n        }\n\n        r.tools[canonical.ID] = canonical\n\n        // Register with toolindex for discovery\n        r.index.Register(convertToIndexTool(canonical))\n    }\n\n    return nil\n}\n\n// Export converts tools to a specific format\nfunc (r *Registry) Export(format string, toolIDs []string) ([]any, error) {\n    adapter, ok := r.adapters[format]\n    if !ok {\n        return nil, fmt.Errorf(\"unknown format: %s\", format)\n    }\n\n    var result []any\n    for _, id := range toolIDs {\n        tool, ok := r.tools[id]\n        if !ok {\n            continue\n        }\n\n        exported, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, exported)\n    }\n\n    return result, nil\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolmodel-integration","title":"toolmodel Integration","text":"<p>CanonicalTool embeds and extends toolmodel.Tool:</p> <pre><code>// tooladapter/canonical.go\n\n// CanonicalTool extends toolmodel.Tool with adapter metadata\ntype CanonicalTool struct {\n    toolmodel.Tool // Embed base tool\n\n    // Adapter-specific extensions\n    SourceFormat string\n    SourceMeta   map[string]any\n    OutputSchema *JSONSchema\n}\n\n// ToToolModel converts to base toolmodel.Tool\nfunc (c *CanonicalTool) ToToolModel() *toolmodel.Tool {\n    return &amp;c.Tool\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#toolrun-integration","title":"toolrun Integration","text":"<p>Toolsets can be exposed through toolrun for execution:</p> <pre><code>// toolset/expose.go\n\n// ExposeViaMCP creates an MCP-compatible tool list from a toolset\nfunc (ts *Toolset) ExposeViaMCP(adapter *adapters.MCPAdapter) ([]*mcp.Tool, error) {\n    var result []*mcp.Tool\n    for _, tool := range ts.Tools {\n        mcpTool, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, mcpTool.(*mcp.Tool))\n    }\n    return result, nil\n}\n\n// ExposeViaOpenAI creates OpenAI function definitions from a toolset\nfunc (ts *Toolset) ExposeViaOpenAI(adapter *adapters.OpenAIAdapter) ([]*OpenAIFunction, error) {\n    var result []*OpenAIFunction\n    for _, tool := range ts.Tools {\n        fn, err := adapter.FromCanonical(tool)\n        if err != nil {\n            return nil, err\n        }\n        result = append(result, fn.(*OpenAIFunction))\n    }\n    return result, nil\n}\n\n// CreateRunner creates a toolrun.Runner scoped to the toolset\nfunc (ts *Toolset) CreateRunner(baseRunner *toolrun.Runner) *toolrun.Runner {\n    // Create a filtered view of the runner that only exposes toolset tools\n    toolIDs := make(map[string]bool)\n    for _, t := range ts.Tools {\n        toolIDs[t.ID] = true\n    }\n\n    return baseRunner.WithFilter(func(tool *toolmodel.Tool) bool {\n        return toolIDs[tool.ID()]\n    })\n}\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#implementation-roadmap","title":"Implementation Roadmap","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-1-core-adapter-library-2-weeks","title":"Phase 1: Core Adapter Library (2 weeks)","text":"<p>Week 1: Foundation - [ ] Create <code>tooladapter</code> module structure - [ ] Implement <code>CanonicalTool</code> and <code>JSONSchema</code> types - [ ] Implement <code>Adapter</code> interface - [ ] Create MCP adapter (bidirectional)</p> <p>Week 2: Additional Adapters - [ ] OpenAI adapter with strict mode support - [ ] Anthropic adapter - [ ] Schema conversion utilities - [ ] Unit tests for all adapters</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-2-toolset-composition-2-weeks","title":"Phase 2: Toolset Composition (2 weeks)","text":"<p>Week 3: Toolset Core - [ ] Create <code>toolset</code> module structure - [ ] Implement <code>Toolset</code> type with metadata - [ ] Implement fluent <code>Builder</code> pattern - [ ] Implement filter predicates</p> <p>Week 4: Integration - [ ] Integrate with <code>toolindex</code> for discovery - [ ] Integrate with <code>toolrun</code> for execution - [ ] Add access control policies - [ ] Integration tests</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#phase-3-multi-transport-exposure-2-weeks","title":"Phase 3: Multi-Transport Exposure (2 weeks)","text":"<p>Week 5: Transport Adapters - [ ] MCP transport (existing, enhanced) - [ ] Direct client interface (Go library) - [ ] REST API transport</p> <p>Week 6: Production Readiness - [ ] Rate limiting integration - [ ] Audit logging - [ ] Documentation - [ ] Example applications</p>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#dependency-graph","title":"Dependency Graph","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Phase 3: Transports                    \u2502\n\u2502            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502            \u2502   MCP   \u2502  REST   \u2502 Direct  \u2502                \u2502\n\u2502            \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                 \u2502         \u2502         \u2502                     \u2502\n\u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502                                \u2502                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Phase 2: Toolsets                      \u2502\n\u2502                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502                       \u2502     toolset     \u2502                 \u2502\n\u2502                       \u2502   (composer)    \u2502                 \u2502\n\u2502                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                \u2502                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Phase 1: Adapters                      \u2502\n\u2502                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502                       \u2502   tooladapter   \u2502                 \u2502\n\u2502                       \u2502   (canonical)   \u2502                 \u2502\n\u2502                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                \u2502                          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502    \u2502           \u2502               \u2502               \u2502       \u2502  \u2502\n\u2502 \u250c\u2500\u2500\u2534\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502\n\u2502 \u2502 MCP \u2502  \u2502 OpenAI   \u2502  \u2502 Anthropic  \u2502  \u2502 OpenAPI  \u2502   \u2502  \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#appendix-industry-patterns","title":"Appendix: Industry Patterns","text":""},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#a-tool-format-comparison","title":"A. Tool Format Comparison","text":"Field MCP OpenAI Anthropic LangChain Name <code>name</code> <code>name</code> <code>name</code> <code>name</code> Description <code>description</code> <code>description</code> <code>description</code> <code>description</code> Parameters <code>inputSchema</code> <code>parameters</code> <code>input_schema</code> <code>schema</code> Schema Type JSON Schema JSON Schema JSON Schema Zod/JSON Schema Strict Mode N/A <code>strict: true</code> N/A N/A Return Type Content array String/Object Content array Any"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#b-schema-feature-support-matrix","title":"B. Schema Feature Support Matrix","text":"Feature MCP OpenAI OpenAI Strict Anthropic Nested objects \u2705 \u2705 \u2705 \u2705 Arrays \u2705 \u2705 \u2705 \u2705 Enums \u2705 \u2705 \u2705 \u2705 Pattern validation \u2705 \u26a0\ufe0f \u2705 \u2705 $ref definitions \u2705 \u274c \u274c \u274c anyOf/oneOf \u2705 \u26a0\ufe0f \u26a0\ufe0f \u2705 Nullable \u2705 \u2705 \u2705 \u2705 Default values \u2705 \u2705 \u274c \u2705"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#c-error-rate-comparison-mastra-research","title":"C. Error Rate Comparison (Mastra Research)","text":"Scenario No Adapter With Adapter Improvement Simple tools 8% 1% 87.5% Complex schemas 23% 4% 82.6% Cross-provider 31% 5% 83.9% Overall 15% 3% 80%"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#d-related-projects","title":"D. Related Projects","text":"Project Stars Approach Limitations LangChain MCP Adapters ~2k MCP \u2192 LangChain One-way, JS only llm-functions 704 Multi-language declaration No runtime registry kani 598 Python @ai_function Python only Mastra ~500 Compatibility layer TypeScript only"},{"location":"library-docs-from-repos/metatools-mcp/proposals/protocol-agnostic-tools/#changelog","title":"Changelog","text":"Date Change 2026-01-28 Initial draft based on architecture research"}]}