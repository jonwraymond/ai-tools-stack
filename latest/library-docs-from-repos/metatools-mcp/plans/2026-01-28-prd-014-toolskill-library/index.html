<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Unified documentation for toolmodel, toolindex, tooldocs, toolrun, toolcode, toolruntime, toolsearch, and metatools-mcp."><link href=https://jonwraymond.github.io/ai-tools-stack/latest/library-docs-from-repos/metatools-mcp/plans/2026-01-28-prd-014-toolskill-library/ rel=canonical><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.28"><title>PRD-014: toolskill Library Implementation Plan - AI Tools Stack</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Space Grotesk";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../../../stylesheets/extra.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=amber> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prd-014-toolskill-library-implementation-plan class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title="AI Tools Stack" class="md-header__button md-logo" aria-label="AI Tools Stack" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AI Tools Stack </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> PRD-014: toolskill Library Implementation Plan </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81 1.42-1.42M1 13h3v-2H1m12 9h-2v3h2"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jonwraymond/ai-tools-stack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> jonwraymond/ai-tools-stack </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../../architecture/overview/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../../../components/toolmodel/ class=md-tabs__link> Components </a> </li> <li class=md-tabs__item> <a href=../../../../operations/ci-and-versioning/ class=md-tabs__link> Operations </a> </li> <li class=md-tabs__item> <a href=../../../toolmodel/ class=md-tabs__link> Library Docs (from repos) </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="AI Tools Stack" class="md-nav__button md-logo" aria-label="AI Tools Stack" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AI Tools Stack </label> <div class=md-nav__source> <a href=https://github.com/jonwraymond/ai-tools-stack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> jonwraymond/ai-tools-stack </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../architecture/overview/ class=md-nav__link> <span class=md-ellipsis> Stack Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../../architecture/progressive-disclosure/ class=md-nav__link> <span class=md-ellipsis> Progressive Disclosure </span> </a> </li> <li class=md-nav__item> <a href=../../../../architecture/pluggable-architecture/ class=md-nav__link> <span class=md-ellipsis> Pluggable Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../../architecture/why-go/ class=md-nav__link> <span class=md-ellipsis> Why Go </span> </a> </li> <li class=md-nav__item> <a href=../../../../architecture/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes Index </span> </a> </li> <li class=md-nav__item> <a href=../../../../architecture/user-journeys/ class=md-nav__link> <span class=md-ellipsis> User Journeys Index </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../components/toolmodel/ class=md-nav__link> <span class=md-ellipsis> toolmodel </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/tooladapter/ class=md-nav__link> <span class=md-ellipsis> tooladapter </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolset/ class=md-nav__link> <span class=md-ellipsis> toolset </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolindex/ class=md-nav__link> <span class=md-ellipsis> toolindex </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/tooldocs/ class=md-nav__link> <span class=md-ellipsis> tooldocs </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolrun/ class=md-nav__link> <span class=md-ellipsis> toolrun </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolcode/ class=md-nav__link> <span class=md-ellipsis> toolcode </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolruntime/ class=md-nav__link> <span class=md-ellipsis> toolruntime </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolsearch/ class=md-nav__link> <span class=md-ellipsis> toolsearch </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolobserve/ class=md-nav__link> <span class=md-ellipsis> toolobserve </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolcache/ class=md-nav__link> <span class=md-ellipsis> toolcache </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolsemantic/ class=md-nav__link> <span class=md-ellipsis> toolsemantic </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/toolskill/ class=md-nav__link> <span class=md-ellipsis> toolskill </span> </a> </li> <li class=md-nav__item> <a href=../../../../components/metatools-mcp/ class=md-nav__link> <span class=md-ellipsis> metatools-mcp </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../operations/ci-and-versioning/ class=md-nav__link> <span class=md-ellipsis> CI and Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../../../operations/stack-changelog/ class=md-nav__link> <span class=md-ellipsis> Stack Changelog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Library Docs (from repos) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Library Docs (from repos) </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> toolmodel </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> toolmodel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolmodel/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolmodel/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> tooladapter </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> tooladapter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tooladapter/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../tooladapter/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../tooladapter/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> toolset </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> toolset </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolset/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolset/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolset/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> toolindex </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> toolindex </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolindex/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../toolindex/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> tooldocs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> tooldocs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tooldocs/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../tooldocs/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> toolrun </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> toolrun </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolrun/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../toolrun/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> toolcode </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> toolcode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolcode/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcode/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> toolruntime </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> toolruntime </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolruntime/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolruntime/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_9> <label class=md-nav__link for=__nav_5_9 id=__nav_5_9_label tabindex=0> <span class=md-ellipsis> toolsearch </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_9_label aria-expanded=false> <label class=md-nav__title for=__nav_5_9> <span class="md-nav__icon md-icon"></span> toolsearch </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolsearch/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsearch/api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_10> <label class=md-nav__link for=__nav_5_10 id=__nav_5_10_label tabindex=0> <span class=md-ellipsis> toolobserve </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_10> <span class="md-nav__icon md-icon"></span> toolobserve </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolobserve/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolobserve/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolobserve/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_11> <label class=md-nav__link for=__nav_5_11 id=__nav_5_11_label tabindex=0> <span class=md-ellipsis> toolcache </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_11_label aria-expanded=false> <label class=md-nav__title for=__nav_5_11> <span class="md-nav__icon md-icon"></span> toolcache </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolcache/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcache/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolcache/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> toolsemantic </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> toolsemantic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolsemantic/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsemantic/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolsemantic/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_13> <label class=md-nav__link for=__nav_5_13 id=__nav_5_13_label tabindex=0> <span class=md-ellipsis> toolskill </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_13_label aria-expanded=false> <label class=md-nav__title for=__nav_5_13> <span class="md-nav__icon md-icon"></span> toolskill </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../toolskill/ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../toolskill/design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../../toolskill/user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_14> <label class=md-nav__link for=__nav_5_14 id=__nav_5_14_label tabindex=0> <span class=md-ellipsis> metatools-mcp </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_5_14> <span class="md-nav__icon md-icon"></span> metatools-mcp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../design-notes/ class=md-nav__link> <span class=md-ellipsis> Design Notes </span> </a> </li> <li class=md-nav__item> <a href=../../user-journey/ class=md-nav__link> <span class=md-ellipsis> User Journey </span> </a> </li> <li class=md-nav__item> <a href=../../api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../plan-of-record/ class=md-nav__link> <span class=md-ellipsis> Plan of Record </span> </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_14_10> <label class=md-nav__link for=__nav_5_14_10 id=__nav_5_14_10_label tabindex=0> <span class=md-ellipsis> Proposals </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_14_10_label aria-expanded=false> <label class=md-nav__title for=__nav_5_14_10> <span class="md-nav__icon md-icon"></span> Proposals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../proposals/pluggable-architecture/ class=md-nav__link> <span class=md-ellipsis> Pluggable Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/implementation-phases/ class=md-nav__link> <span class=md-ellipsis> Implementation Phases </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/component-library-analysis/ class=md-nav__link> <span class=md-ellipsis> Component Library Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/architecture-evaluation/ class=md-nav__link> <span class=md-ellipsis> Architecture Evaluation </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/multi-tenancy/ class=md-nav__link> <span class=md-ellipsis> Multi-Tenancy </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/protocol-agnostic-tools/ class=md-nav__link> <span class=md-ellipsis> Protocol-Agnostic Tools </span> </a> </li> <li class=md-nav__item> <a href=../../proposals/mcp-spec-alignment/ class=md-nav__link> <span class=md-ellipsis> MCP Spec Alignment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#task-1-core-types-and-skill-interface class=md-nav__link> <span class=md-ellipsis> Task 1: Core Types and Skill Interface </span> </a> </li> <li class=md-nav__item> <a href=#task-2-skillmd-parser class=md-nav__link> <span class=md-ellipsis> Task 2: SKILL.md Parser </span> </a> </li> <li class=md-nav__item> <a href=#task-3-skill-registry class=md-nav__link> <span class=md-ellipsis> Task 3: Skill Registry </span> </a> </li> <li class=md-nav__item> <a href=#task-4-skill-builder-and-composition class=md-nav__link> <span class=md-ellipsis> Task 4: Skill Builder and Composition </span> </a> </li> <li class=md-nav__item> <a href=#task-5-skill-runtime class=md-nav__link> <span class=md-ellipsis> Task 5: Skill Runtime </span> </a> </li> <li class=md-nav__item> <a href=#task-6-discovery-and-integration class=md-nav__link> <span class=md-ellipsis> Task 6: Discovery and Integration </span> </a> </li> <li class=md-nav__item> <a href=#verification-checklist class=md-nav__link> <span class=md-ellipsis> Verification Checklist </span> </a> </li> <li class=md-nav__item> <a href=#definition-of-done class=md-nav__link> <span class=md-ellipsis> Definition of Done </span> </a> </li> <li class=md-nav__item> <a href=#architecture-notes class=md-nav__link> <span class=md-ellipsis> Architecture Notes </span> </a> <nav class=md-nav aria-label="Architecture Notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#abstraction-hierarchy class=md-nav__link> <span class=md-ellipsis> Abstraction Hierarchy </span> </a> </li> <li class=md-nav__item> <a href=#skillmd-standard class=md-nav__link> <span class=md-ellipsis> SKILL.md Standard </span> </a> </li> <li class=md-nav__item> <a href=#integration-points class=md-nav__link> <span class=md-ellipsis> Integration Points </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=prd-014-toolskill-library-implementation-plan>PRD-014: toolskill Library Implementation Plan<a class=headerlink href=#prd-014-toolskill-library-implementation-plan title="Permanent link">&para;</a></h1> <blockquote> <p><strong>For Claude:</strong> REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.</p> </blockquote> <p><strong>Goal:</strong> Implement agent skills support with SKILL.md parsing, skill registry, composition DSL, and runtime execution.</p> <p><strong>Architecture:</strong> The toolskill library provides higher-level agent behaviors that compose tools into reusable workflows. Skills sit above tools in the abstraction hierarchy - while tools are atomic operations, skills orchestrate multiple tools with workflow logic (research-and-summarize, debug-and-fix, deploy-with-validation).</p> <p><strong>Tech Stack:</strong> Go 1.21+, yaml.v3 (frontmatter), goldmark (markdown), semver</p> <p><strong>Dependencies:</strong> toolset (tool access), toolrun (execution), toolobserve (optional tracing)</p> <hr> <h2 id=task-1-core-types-and-skill-interface>Task 1: Core Types and Skill Interface<a class=headerlink href=#task-1-core-types-and-skill-interface title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/skill.go</code> - Create: <code>toolskill/manifest.go</code> - Test: <code>toolskill/skill_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/skill_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillManifest_Validate</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>tests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>name</span><span class=w>    </span><span class=kt>string</span>
<span class=w>        </span><span class=nx>manifest</span><span class=w> </span><span class=nx>SkillManifest</span>
<span class=w>        </span><span class=nx>wantErr</span><span class=w> </span><span class=kt>bool</span>
<span class=w>    </span><span class=p>}{</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;valid manifest&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>                </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when researching tools in the codebase&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Tags</span><span class=p>:</span><span class=w>        </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;discovery&quot;</span><span class=p>},</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;missing ID&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when researching&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;missing name&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>                </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when researching&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;invalid version&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>                </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;not-semver&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when researching&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;description must start with Use when&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>                </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Researches tools&quot;</span><span class=p>,</span><span class=w> </span><span class=c1>// Missing &quot;Use when&quot;</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tests</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>t</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>manifest</span><span class=p>.</span><span class=nx>Validate</span><span class=p>()</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>wantErr</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>})</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillInput_Get</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>input</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span>
<span class=w>        </span><span class=s>&quot;topic&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;kubernetes&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s>&quot;depth&quot;</span><span class=p>:</span><span class=w>  </span><span class=mi>3</span><span class=p>,</span>
<span class=w>        </span><span class=s>&quot;tags&quot;</span><span class=p>:</span><span class=w>   </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;container&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;orchestration&quot;</span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// String retrieval</span>
<span class=w>    </span><span class=nx>topic</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>input</span><span class=p>.</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;topic&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;kubernetes&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>topic</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Int retrieval</span>
<span class=w>    </span><span class=nx>depth</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>input</span><span class=p>.</span><span class=nx>GetInt</span><span class=p>(</span><span class=s>&quot;depth&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=nx>depth</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Missing key</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>input</span><span class=p>.</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;missing&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>False</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillOutput_Success</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>output</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewSkillOutput</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>        </span><span class=s>&quot;summary&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Found 5 tools&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s>&quot;tools&quot;</span><span class=p>:</span><span class=w>   </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;tool1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool2&quot;</span><span class=p>},</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Nil</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Found 5 tools&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Result</span><span class=p>[</span><span class=s>&quot;summary&quot;</span><span class=p>])</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillOutput_Failure</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>output</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewSkillOutputError</span><span class=p>(</span><span class=nx>ErrSkillExecutionFailed</span><span class=p>,</span><span class=w> </span><span class=s>&quot;step 3 timed out&quot;</span><span class=p>)</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>False</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NotNil</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>ErrorMessage</span><span class=p>,</span><span class=w> </span><span class=s>&quot;step 3 timed out&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Mock skill for testing</span>
<span class=kd>type</span><span class=w> </span><span class=nx>mockSkill</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>id</span><span class=w>       </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>name</span><span class=w>     </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>version</span><span class=w>  </span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span>
<span class=w>    </span><span class=nx>manifest</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=nx>tools</span><span class=w>    </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>steps</span><span class=w>    </span><span class=p>[]</span><span class=nx>StepDefinition</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>ID</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w>                    </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w>                  </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>name</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Version</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span><span class=w>      </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>version</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Manifest</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span><span class=w>      </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>manifest</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>RequiredTools</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w>       </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>tools</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Steps</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>StepDefinition</span><span class=w>       </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>steps</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>NewSkillOutput</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;executed&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>}),</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillInterface</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ver</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockSkill</span><span class=p>{</span>
<span class=w>        </span><span class=nx>id</span><span class=p>:</span><span class=w>      </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>name</span><span class=p>:</span><span class=w>    </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>version</span><span class=p>:</span><span class=w> </span><span class=nx>ver</span><span class=p>,</span>
<span class=w>        </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>            </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when testing skill interface&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>tools</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;search_tools&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe_tool&quot;</span><span class=p>},</span>
<span class=w>        </span><span class=nx>steps</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=nx>StepDefinition</span><span class=p>{</span>
<span class=w>            </span><span class=p>{</span><span class=nx>ID</span><span class=p>:</span><span class=w> </span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Search&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>Tool</span><span class=p>:</span><span class=w> </span><span class=s>&quot;search_tools&quot;</span><span class=p>},</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Verify interface compliance</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=nx>Skill</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>skill</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>ID</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Version</span><span class=p>().</span><span class=nx>String</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>RequiredTools</span><span class=p>(),</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Execute</span>
<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;test&quot;</span><span class=p>})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestSkill</code> Expected: FAIL with "package toolskill is not in std"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/skill.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;errors&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=w>    </span><span class=s>&quot;strings&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=p>)</span>

<span class=c1>// Errors</span>
<span class=kd>var</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=nx>ErrSkillNotFound</span><span class=w>        </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;skill not found&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>ErrSkillExecutionFailed</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;skill execution failed&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>ErrInvalidManifest</span><span class=w>      </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;invalid skill manifest&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>ErrMissingTool</span><span class=w>          </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;required tool not available&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>ErrStepFailed</span><span class=w>           </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;step execution failed&quot;</span><span class=p>)</span>
<span class=p>)</span>

<span class=c1>// Skill defines the interface for reusable agent behaviors.</span>
<span class=c1>// Skills orchestrate multiple tools into workflows.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Skill</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Identity</span>
<span class=w>    </span><span class=nx>ID</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>Version</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span>

<span class=w>    </span><span class=c1>// Manifest for discovery/advertisement</span>
<span class=w>    </span><span class=nx>Manifest</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span>

<span class=w>    </span><span class=c1>// Execution</span>
<span class=w>    </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Introspection</span>
<span class=w>    </span><span class=nx>RequiredTools</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>Steps</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>StepDefinition</span>
<span class=p>}</span>

<span class=c1>// SkillInput represents input parameters for skill execution.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillInput</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span>

<span class=c1>// GetString retrieves a string value from input.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=nx>GetString</span><span class=p>(</span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>i</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>false</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>s</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>v</span><span class=p>.(</span><span class=kt>string</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span>
<span class=p>}</span>

<span class=c1>// GetInt retrieves an int value from input.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=nx>GetInt</span><span class=p>(</span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>i</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=kc>false</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>v</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=kt>int</span><span class=p>:</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>n</span><span class=p>,</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=kt>int64</span><span class=p>:</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=nx>n</span><span class=p>),</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=kt>float64</span><span class=p>:</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=nx>n</span><span class=p>),</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>default</span><span class=p>:</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=kc>false</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// GetBool retrieves a bool value from input.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>i</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=nx>GetBool</span><span class=p>(</span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>bool</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>i</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>v</span><span class=p>.(</span><span class=kt>bool</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span>
<span class=p>}</span>

<span class=c1>// SkillOutput represents the result of skill execution.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillOutput</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Success</span><span class=w>      </span><span class=kt>bool</span><span class=w>           </span><span class=s>`json:&quot;success&quot;`</span>
<span class=w>    </span><span class=nx>Result</span><span class=w>       </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`json:&quot;result,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Error</span><span class=w>        </span><span class=kt>error</span><span class=w>          </span><span class=s>`json:&quot;-&quot;`</span>
<span class=w>    </span><span class=nx>ErrorMessage</span><span class=w> </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;error,omitempty&quot;`</span>

<span class=w>    </span><span class=c1>// Execution metadata</span>
<span class=w>    </span><span class=nx>StepsCompleted</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;stepsCompleted,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Duration</span><span class=w>       </span><span class=kt>int64</span><span class=w>    </span><span class=s>`json:&quot;durationMs,omitempty&quot;`</span>
<span class=p>}</span>

<span class=c1>// NewSkillOutput creates a successful output.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewSkillOutput</span><span class=p>(</span><span class=nx>result</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>SkillOutput</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>        </span><span class=nx>Success</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Result</span><span class=p>:</span><span class=w>  </span><span class=nx>result</span><span class=p>,</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// NewSkillOutputError creates a failed output.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewSkillOutputError</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>,</span><span class=w> </span><span class=nx>message</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>SkillOutput</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>        </span><span class=nx>Success</span><span class=p>:</span><span class=w>      </span><span class=kc>false</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Error</span><span class=p>:</span><span class=w>        </span><span class=nx>err</span><span class=p>,</span>
<span class=w>        </span><span class=nx>ErrorMessage</span><span class=p>:</span><span class=w> </span><span class=nx>message</span><span class=p>,</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// StepDefinition defines a single step within a skill.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>StepDefinition</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ID</span><span class=w>           </span><span class=kt>string</span><span class=w>                           </span><span class=s>`json:&quot;id&quot;`</span>
<span class=w>    </span><span class=nx>Name</span><span class=w>         </span><span class=kt>string</span><span class=w>                           </span><span class=s>`json:&quot;name&quot;`</span>
<span class=w>    </span><span class=nx>Tool</span><span class=w>         </span><span class=kt>string</span><span class=w>                           </span><span class=s>`json:&quot;tool&quot;`</span>
<span class=w>    </span><span class=nx>InputMapper</span><span class=w>  </span><span class=kd>func</span><span class=p>(</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w>           </span><span class=s>`json:&quot;-&quot;`</span>
<span class=w>    </span><span class=nx>OutputMapper</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w>                    </span><span class=s>`json:&quot;-&quot;`</span>
<span class=w>    </span><span class=nx>Condition</span><span class=w>    </span><span class=kd>func</span><span class=p>(</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w>          </span><span class=s>`json:&quot;-&quot;`</span>
<span class=w>    </span><span class=nx>OnError</span><span class=w>      </span><span class=nx>ErrorHandler</span><span class=w>                     </span><span class=s>`json:&quot;-&quot;`</span>
<span class=w>    </span><span class=nx>Timeout</span><span class=w>      </span><span class=kt>int64</span><span class=w>                            </span><span class=s>`json:&quot;timeoutMs,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Optional</span><span class=w>     </span><span class=kt>bool</span><span class=w>                             </span><span class=s>`json:&quot;optional,omitempty&quot;`</span>
<span class=p>}</span>

<span class=c1>// ErrorHandler defines how to handle step errors.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ErrorHandler</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>

<span class=c1>// SkillContext provides execution context to steps.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillContext</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Input</span><span class=w>    </span><span class=nx>SkillInput</span><span class=w>     </span><span class=c1>// Original skill input</span>
<span class=w>    </span><span class=nx>Results</span><span class=w>  </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=c1>// Results from previous steps</span>
<span class=w>    </span><span class=nx>Metadata</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=c1>// Execution metadata</span>
<span class=w>    </span><span class=nx>StepID</span><span class=w>   </span><span class=kt>string</span><span class=w>         </span><span class=c1>// Current step ID</span>
<span class=p>}</span>

<span class=c1>// Get retrieves a value from results.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=nx>Get</span><span class=p>(</span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>any</span><span class=p>,</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Results</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span>
<span class=p>}</span>

<span class=c1>// Set stores a value in results.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=nx>Set</span><span class=p>(</span><span class=nx>key</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Results</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>c</span><span class=p>.</span><span class=nx>Results</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>c</span><span class=p>.</span><span class=nx>Results</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>value</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/manifest.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=w>    </span><span class=s>&quot;strings&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=p>)</span>

<span class=c1>// SkillManifest describes skill capabilities for discovery.</span>
<span class=c1>// Aligned with A2A (Agent-to-Agent) protocol.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillManifest</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ID</span><span class=w>          </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;id&quot; yaml:&quot;id&quot;`</span>
<span class=w>    </span><span class=nx>Name</span><span class=w>        </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;name&quot; yaml:&quot;name&quot;`</span>
<span class=w>    </span><span class=nx>Version</span><span class=w>     </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;version&quot; yaml:&quot;version&quot;`</span>
<span class=w>    </span><span class=nx>Description</span><span class=w> </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;description&quot; yaml:&quot;description&quot;`</span>
<span class=w>    </span><span class=nx>InputSchema</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`json:&quot;inputSchema,omitempty&quot; yaml:&quot;inputSchema,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>OutputSchema</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`json:&quot;outputSchema,omitempty&quot; yaml:&quot;outputSchema,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Tags</span><span class=w>        </span><span class=p>[]</span><span class=kt>string</span><span class=w>       </span><span class=s>`json:&quot;tags,omitempty&quot; yaml:&quot;tags,omitempty&quot;`</span>

<span class=w>    </span><span class=c1>// Dependencies</span>
<span class=w>    </span><span class=nx>RequiredTools</span><span class=w>  </span><span class=p>[]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;requiredTools,omitempty&quot; yaml:&quot;requiredTools,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>RequiredSkills</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;requiredSkills,omitempty&quot; yaml:&quot;requiredSkills,omitempty&quot;`</span>

<span class=w>    </span><span class=c1>// Execution hints</span>
<span class=w>    </span><span class=nx>EstimatedSteps</span><span class=w> </span><span class=kt>int</span><span class=w>  </span><span class=s>`json:&quot;estimatedSteps,omitempty&quot; yaml:&quot;estimatedSteps,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Idempotent</span><span class=w>     </span><span class=kt>bool</span><span class=w> </span><span class=s>`json:&quot;idempotent,omitempty&quot; yaml:&quot;idempotent,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>SupportsPause</span><span class=w>  </span><span class=kt>bool</span><span class=w> </span><span class=s>`json:&quot;supportsPause,omitempty&quot; yaml:&quot;supportsPause,omitempty&quot;`</span>

<span class=w>    </span><span class=c1>// Metadata</span>
<span class=w>    </span><span class=nx>Author</span><span class=w>  </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;author,omitempty&quot; yaml:&quot;author,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>License</span><span class=w> </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;license,omitempty&quot; yaml:&quot;license,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Extra</span><span class=w>   </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`json:&quot;metadata,omitempty&quot; yaml:&quot;metadata,omitempty&quot;`</span>
<span class=p>}</span>

<span class=c1>// Validate checks if the manifest is valid.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span><span class=p>)</span><span class=w> </span><span class=nx>Validate</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>ID</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: ID is required&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: Name is required&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Version</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: Version is required&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewVersion</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nx>Version</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: invalid version %q: %v&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Version</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Description</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: Description is required&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// Per SKILL.md standard, description should start with &quot;Use when&quot;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>strings</span><span class=p>.</span><span class=nx>HasPrefix</span><span class=p>(</span><span class=nx>strings</span><span class=p>.</span><span class=nx>ToLower</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nx>Description</span><span class=p>),</span><span class=w> </span><span class=s>&quot;use when&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: Description must start with &#39;Use when&#39; per SKILL.md standard&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrInvalidManifest</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// SemVer returns the parsed semantic version.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span><span class=p>)</span><span class=w> </span><span class=nx>SemVer</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewVersion</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nx>Version</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// ToJSON serializes the manifest to JSON.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span><span class=p>)</span><span class=w> </span><span class=nx>ToJSON</span><span class=p>()</span><span class=w> </span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>MarshalIndent</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;  &quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// ManifestFromJSON deserializes a manifest from JSON.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>ManifestFromJSON</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillManifest</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>m</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;failed to parse manifest: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>m</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestSkill</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add core types and Skill interface</span>

<span class=s>- Add Skill interface with ID, Name, Version, Manifest, Execute</span>
<span class=s>- Add SkillManifest type with A2A-aligned fields</span>
<span class=s>- Add SkillInput/SkillOutput types with helpers</span>
<span class=s>- Add StepDefinition for workflow steps</span>
<span class=s>- Add SkillContext for execution context</span>
<span class=s>- Validate manifest per SKILL.md standard (description starts with &quot;Use when&quot;)</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=task-2-skillmd-parser>Task 2: SKILL.md Parser<a class=headerlink href=#task-2-skillmd-parser title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/skillmd/parser.go</code> - Test: <code>toolskill/skillmd/parser_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/skillmd/parser_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>skillmd</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_Parse</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: research-tool</span>
<span class=s>description: Use when researching tools in a codebase</span>
<span class=s>metadata:</span>
<span class=s>  author: metatools</span>
<span class=s>  version: &quot;1.0.0&quot;</span>
<span class=s>---</span>

<span class=s># Research Tool</span>

<span class=s>## Overview</span>

<span class=s>Discovers and analyzes tools in a codebase.</span>

<span class=s>## When to Use</span>

<span class=s>- When exploring unfamiliar codebases</span>
<span class=s>- When looking for specific tool capabilities</span>

<span class=s>## How It Works</span>

<span class=s>1. Search for tools matching query</span>
<span class=s>2. Get detailed documentation</span>
<span class=s>3. Summarize findings</span>
<span class=s>`</span>

<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-tool&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Use when researching tools in a codebase&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Description</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;metatools&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>[</span><span class=s>&quot;author&quot;</span><span class=p>])</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>[</span><span class=s>&quot;version&quot;</span><span class=p>])</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Overview</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Discovers and analyzes&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>WhenToUse</span><span class=p>,</span><span class=w> </span><span class=s>&quot;exploring unfamiliar&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>HowItWorks</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Search for tools&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_ParseMinimal</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: simple-skill</span>
<span class=s>description: Use when doing simple things</span>
<span class=s>---</span>

<span class=s># Simple Skill</span>

<span class=s>Basic skill content.</span>
<span class=s>`</span>

<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;simple-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Use when doing simple things&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Description</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Empty</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_ParseMissingFrontmatter</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`# No Frontmatter</span>

<span class=s>Just markdown content.</span>
<span class=s>`</span>

<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;frontmatter&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_ParseMissingName</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>description: Use when testing</span>
<span class=s>---</span>

<span class=s># Test</span>
<span class=s>`</span>

<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_ParseMissingDescription</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: test-skill</span>
<span class=s>---</span>

<span class=s># Test</span>
<span class=s>`</span>

<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>))</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;description&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestParser_Validate</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span>

<span class=w>    </span><span class=nx>tests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>name</span><span class=w>    </span><span class=kt>string</span>
<span class=w>        </span><span class=nx>skill</span><span class=w>   </span><span class=o>*</span><span class=nx>SkillMD</span>
<span class=w>        </span><span class=nx>wantErr</span><span class=w> </span><span class=kt>bool</span>
<span class=w>    </span><span class=p>}{</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;valid skill&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>skill</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillMD</span><span class=p>{</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;valid-skill&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when testing validation&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;invalid name with spaces&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>skill</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillMD</span><span class=p>{</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;invalid skill name&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when testing&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nx>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;description not starting with Use when&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>skill</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillMD</span><span class=p>{</span>
<span class=w>                </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;skill&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Does something cool&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>            </span><span class=nx>wantErr</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tt</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tests</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>t</span><span class=p>.</span><span class=nx>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>errs</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>parser</span><span class=p>.</span><span class=nx>Validate</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>skill</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>tt</span><span class=p>.</span><span class=nx>wantErr</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NotEmpty</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>errs</span><span class=p>)</span>
<span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Empty</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>errs</span><span class=p>)</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>})</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillMD_ToManifest</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillMD</span><span class=p>{</span>
<span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when testing manifest conversion&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Metadata</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2.0.0&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s>&quot;author&quot;</span><span class=p>:</span><span class=w>  </span><span class=s>&quot;test&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>manifest</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>ToManifest</span><span class=p>()</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifest</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;test-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifest</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;2.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifest</span><span class=p>.</span><span class=nx>Version</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Use when testing manifest conversion&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifest</span><span class=p>.</span><span class=nx>Description</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;test&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifest</span><span class=p>.</span><span class=nx>Author</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v ./skillmd/...</code> Expected: FAIL with "package toolskill/skillmd is not in std"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/skillmd/parser.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>skillmd</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;bytes&quot;</span>
<span class=w>    </span><span class=s>&quot;errors&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=w>    </span><span class=s>&quot;os&quot;</span>
<span class=w>    </span><span class=s>&quot;regexp&quot;</span>
<span class=w>    </span><span class=s>&quot;strings&quot;</span>

<span class=w>    </span><span class=s>&quot;gopkg.in/yaml.v3&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/yourusername/toolskill&quot;</span>
<span class=p>)</span>

<span class=c1>// SkillMD represents a parsed SKILL.md file.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillMD</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// YAML Frontmatter (required)</span>
<span class=w>    </span><span class=nx>Name</span><span class=w>        </span><span class=kt>string</span><span class=w>         </span><span class=s>`yaml:&quot;name&quot;`</span>
<span class=w>    </span><span class=nx>Description</span><span class=w> </span><span class=kt>string</span><span class=w>         </span><span class=s>`yaml:&quot;description&quot;`</span>
<span class=w>    </span><span class=nx>License</span><span class=w>     </span><span class=kt>string</span><span class=w>         </span><span class=s>`yaml:&quot;license,omitempty&quot;`</span>
<span class=w>    </span><span class=nx>Metadata</span><span class=w>    </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`yaml:&quot;metadata,omitempty&quot;`</span>

<span class=w>    </span><span class=c1>// Parsed Content</span>
<span class=w>    </span><span class=nx>Content</span><span class=w>    </span><span class=kt>string</span><span class=w>            </span><span class=c1>// Raw markdown content (after frontmatter)</span>
<span class=w>    </span><span class=nx>Overview</span><span class=w>   </span><span class=kt>string</span><span class=w>            </span><span class=c1>// Extracted ## Overview section</span>
<span class=w>    </span><span class=nx>WhenToUse</span><span class=w>  </span><span class=kt>string</span><span class=w>            </span><span class=c1>// Extracted ## When to Use section</span>
<span class=w>    </span><span class=nx>HowItWorks</span><span class=w> </span><span class=kt>string</span><span class=w>            </span><span class=c1>// Extracted ## How It Works section</span>
<span class=w>    </span><span class=nx>Sections</span><span class=w>   </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=c1>// All other sections</span>
<span class=p>}</span>

<span class=c1>// ToManifest converts SkillMD to a SkillManifest.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>SkillMD</span><span class=p>)</span><span class=w> </span><span class=nx>ToManifest</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>toolskill</span><span class=p>.</span><span class=nx>SkillManifest</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>version</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span>
<span class=w>    </span><span class=nx>author</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>&quot;&quot;</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Metadata</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>[</span><span class=s>&quot;version&quot;</span><span class=p>].(</span><span class=kt>string</span><span class=p>);</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>version</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>v</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>[</span><span class=s>&quot;author&quot;</span><span class=p>].(</span><span class=kt>string</span><span class=p>);</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>author</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>a</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>toolskill</span><span class=p>.</span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=nx>version</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Description</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Author</span><span class=p>:</span><span class=w>      </span><span class=nx>author</span><span class=p>,</span>
<span class=w>        </span><span class=nx>License</span><span class=p>:</span><span class=w>     </span><span class=nx>s</span><span class=p>.</span><span class=nx>License</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Extra</span><span class=p>:</span><span class=w>       </span><span class=nx>s</span><span class=p>.</span><span class=nx>Metadata</span><span class=p>,</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// ValidationError represents a validation issue.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ValidationError</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Field</span><span class=w>   </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>Message</span><span class=w> </span><span class=kt>string</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>e</span><span class=w> </span><span class=nx>ValidationError</span><span class=p>)</span><span class=w> </span><span class=nx>Error</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;%s: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>Field</span><span class=p>,</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Parser reads and parses SKILL.md files.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Parser</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// strictMode enforces all validations</span>
<span class=w>    </span><span class=nx>strictMode</span><span class=w> </span><span class=kt>bool</span>
<span class=p>}</span>

<span class=c1>// NewParser creates a new SKILL.md parser.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewParser</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Parser</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Parser</span><span class=p>{</span><span class=nx>strictMode</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// NewLenientParser creates a parser that allows some validation failures.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewLenientParser</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Parser</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Parser</span><span class=p>{</span><span class=nx>strictMode</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Parse reads and parses a SKILL.md file from path.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>Parser</span><span class=p>)</span><span class=w> </span><span class=nx>Parse</span><span class=p>(</span><span class=nx>path</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>ReadFile</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;failed to read skill file: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>ParseBytes</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// ParseBytes parses SKILL.md content from bytes.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>Parser</span><span class=p>)</span><span class=w> </span><span class=nx>ParseBytes</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Split frontmatter from content</span>
<span class=w>    </span><span class=nx>frontmatter</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>splitFrontmatter</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Parse YAML frontmatter</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=nx>SkillMD</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>yaml</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>(</span><span class=nx>frontmatter</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>skill</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;failed to parse frontmatter: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Validate required fields</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;skill name is required in frontmatter&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Description</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;skill description is required in frontmatter&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Store raw content</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Content</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>string</span><span class=p>(</span><span class=nx>content</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Extract standard sections</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Sections</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>extractSections</span><span class=p>(</span><span class=nx>content</span><span class=p>)</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Overview</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Sections</span><span class=p>[</span><span class=s>&quot;overview&quot;</span><span class=p>]</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.</span><span class=nx>WhenToUse</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Sections</span><span class=p>[</span><span class=s>&quot;when to use&quot;</span><span class=p>]</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.</span><span class=nx>HowItWorks</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Sections</span><span class=p>[</span><span class=s>&quot;how it works&quot;</span><span class=p>]</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// Validate checks a SkillMD for issues.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>Parser</span><span class=p>)</span><span class=w> </span><span class=nx>Validate</span><span class=p>(</span><span class=nx>skill</span><span class=w> </span><span class=o>*</span><span class=nx>SkillMD</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>ValidationError</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>errs</span><span class=w> </span><span class=p>[]</span><span class=nx>ValidationError</span>

<span class=w>    </span><span class=c1>// Name must be lowercase with hyphens only</span>
<span class=w>    </span><span class=nx>namePattern</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>regexp</span><span class=p>.</span><span class=nx>MustCompile</span><span class=p>(</span><span class=s>`^[a-z][a-z0-9-]*[a-z0-9]$|^[a-z]$`</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>namePattern</span><span class=p>.</span><span class=nx>MatchString</span><span class=p>(</span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>errs</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>errs</span><span class=p>,</span><span class=w> </span><span class=nx>ValidationError</span><span class=p>{</span>
<span class=w>            </span><span class=nx>Field</span><span class=p>:</span><span class=w>   </span><span class=s>&quot;name&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Message</span><span class=p>:</span><span class=w> </span><span class=s>&quot;must be lowercase with hyphens (e.g., &#39;my-skill&#39;)&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>})</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Description must start with &quot;Use when&quot;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>strings</span><span class=p>.</span><span class=nx>HasPrefix</span><span class=p>(</span><span class=nx>strings</span><span class=p>.</span><span class=nx>ToLower</span><span class=p>(</span><span class=nx>skill</span><span class=p>.</span><span class=nx>Description</span><span class=p>),</span><span class=w> </span><span class=s>&quot;use when&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>errs</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>errs</span><span class=p>,</span><span class=w> </span><span class=nx>ValidationError</span><span class=p>{</span>
<span class=w>            </span><span class=nx>Field</span><span class=p>:</span><span class=w>   </span><span class=s>&quot;description&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Message</span><span class=p>:</span><span class=w> </span><span class=s>&quot;must start with &#39;Use when&#39; per SKILL.md standard&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>})</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>errs</span>
<span class=p>}</span>

<span class=c1>// splitFrontmatter separates YAML frontmatter from markdown content.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>splitFrontmatter</span><span class=p>(</span><span class=nx>data</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>delimiter</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;---&quot;</span>

<span class=w>    </span><span class=c1>// Must start with ---</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>HasPrefix</span><span class=p>(</span><span class=nx>data</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>delimiter</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;SKILL.md must start with YAML frontmatter (---)&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Find closing ---</span>
<span class=w>    </span><span class=nx>rest</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>data</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=nx>delimiter</span><span class=p>):]</span>
<span class=w>    </span><span class=nx>idx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Index</span><span class=p>(</span><span class=nx>rest</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&quot;\n&quot;</span><span class=o>+</span><span class=nx>delimiter</span><span class=p>))</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>idx</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;SKILL.md frontmatter not closed (missing ---)&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>frontmatter</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>rest</span><span class=p>[:</span><span class=nx>idx</span><span class=p>]</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>rest</span><span class=p>[</span><span class=nx>idx</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=nx>delimiter</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=w> </span><span class=c1>// Skip newline + ---</span>

<span class=w>    </span><span class=c1>// Skip leading newlines from content</span>
<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>bytes</span><span class=p>.</span><span class=nx>TrimLeft</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=s>&quot;\n&quot;</span><span class=p>)</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>frontmatter</span><span class=p>,</span><span class=w> </span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// extractSections parses markdown content into named sections.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>extractSections</span><span class=p>(</span><span class=nx>content</span><span class=w> </span><span class=p>[]</span><span class=kt>byte</span><span class=p>)</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sections</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span>
<span class=w>    </span><span class=nx>lines</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>Split</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=s>&quot;\n&quot;</span><span class=p>)</span>

<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>currentSection</span><span class=w> </span><span class=kt>string</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>currentContent</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>line</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>lines</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// Check for ## heading</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>HasPrefix</span><span class=p>(</span><span class=nx>line</span><span class=p>,</span><span class=w> </span><span class=s>&quot;## &quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=c1>// Save previous section</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>currentSection</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>sections</span><span class=p>[</span><span class=nx>strings</span><span class=p>.</span><span class=nx>ToLower</span><span class=p>(</span><span class=nx>currentSection</span><span class=p>)]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>TrimSpace</span><span class=p>(</span><span class=nx>currentContent</span><span class=p>.</span><span class=nx>String</span><span class=p>())</span>
<span class=w>            </span><span class=p>}</span>

<span class=w>            </span><span class=c1>// Start new section</span>
<span class=w>            </span><span class=nx>currentSection</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>TrimPrefix</span><span class=p>(</span><span class=nx>line</span><span class=p>,</span><span class=w> </span><span class=s>&quot;## &quot;</span><span class=p>)</span>
<span class=w>            </span><span class=nx>currentContent</span><span class=p>.</span><span class=nx>Reset</span><span class=p>()</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>currentSection</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>currentContent</span><span class=p>.</span><span class=nx>WriteString</span><span class=p>(</span><span class=nx>line</span><span class=p>)</span>
<span class=w>            </span><span class=nx>currentContent</span><span class=p>.</span><span class=nx>WriteString</span><span class=p>(</span><span class=s>&quot;\n&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Save last section</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>currentSection</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>sections</span><span class=p>[</span><span class=nx>strings</span><span class=p>.</span><span class=nx>ToLower</span><span class=p>(</span><span class=nx>currentSection</span><span class=p>)]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nx>TrimSpace</span><span class=p>(</span><span class=nx>currentContent</span><span class=p>.</span><span class=nx>String</span><span class=p>())</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sections</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v ./skillmd/...</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/skillmd/
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add SKILL.md parser</span>

<span class=s>- Add SkillMD type representing parsed SKILL.md files</span>
<span class=s>- Add Parser with Parse and ParseBytes methods</span>
<span class=s>- Extract YAML frontmatter (name, description, metadata)</span>
<span class=s>- Extract standard sections (Overview, When to Use, How It Works)</span>
<span class=s>- Add validation for SKILL.md standard compliance</span>
<span class=s>- Add ToManifest conversion helper</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=task-3-skill-registry>Task 3: Skill Registry<a class=headerlink href=#task-3-skill-registry title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/registry.go</code> - Test: <code>toolskill/registry_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/registry_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=kd>func</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>version</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>tags</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>mockSkill</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ver</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewVersion</span><span class=p>(</span><span class=nx>version</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockSkill</span><span class=p>{</span>
<span class=w>        </span><span class=nx>id</span><span class=p>:</span><span class=w>      </span><span class=nx>id</span><span class=p>,</span>
<span class=w>        </span><span class=nx>name</span><span class=p>:</span><span class=w>    </span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>version</span><span class=p>:</span><span class=w> </span><span class=nx>ver</span><span class=p>,</span>
<span class=w>        </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>            </span><span class=nx>ID</span><span class=p>:</span><span class=w>          </span><span class=nx>id</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=nx>name</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Version</span><span class=p>:</span><span class=w>     </span><span class=nx>version</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Use when testing &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>name</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Tags</span><span class=p>:</span><span class=w>        </span><span class=nx>tags</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_Register</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;research-v1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;discovery&quot;</span><span class=p>})</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Verify registration</span>
<span class=w>    </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Get</span><span class=p>(</span><span class=s>&quot;research-v1&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-v1&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>ID</span><span class=p>())</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_RegisterDuplicate</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;research-v1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Duplicate registration should fail</span>
<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>ErrorIs</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillAlreadyRegistered</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_Get</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;my-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;my-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>

<span class=w>    </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Get</span><span class=p>(</span><span class=s>&quot;my-skill&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;my-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>ID</span><span class=p>())</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_GetNotFound</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Get</span><span class=p>(</span><span class=s>&quot;nonexistent&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>ErrorIs</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_GetByName</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=c1>// Register multiple versions</span>
<span class=w>    </span><span class=nx>v1</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;research-v1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>v2</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;research-v2&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;2.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>v3</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;research-v3&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;3.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>

<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>v1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>v2</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>v3</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Get latest (no constraint)</span>
<span class=w>    </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>GetByName</span><span class=p>(</span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;3.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>Version</span><span class=p>().</span><span class=nx>String</span><span class=p>())</span>

<span class=w>    </span><span class=c1>// Get with constraint</span>
<span class=w>    </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>GetByName</span><span class=p>(</span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&gt;=1.0.0 &lt;2.0.0&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>Version</span><span class=p>().</span><span class=nx>String</span><span class=p>())</span>

<span class=w>    </span><span class=c1>// Get with ^2 constraint</span>
<span class=w>    </span><span class=nx>got</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>GetByName</span><span class=p>(</span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;^2.0.0&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;2.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>got</span><span class=p>.</span><span class=nx>Version</span><span class=p>().</span><span class=nx>String</span><span class=p>())</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_GetByNameNotFound</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>GetByName</span><span class=p>(</span><span class=s>&quot;nonexistent&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>ErrorIs</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_List</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>s1</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;skill-a&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill-a&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>s2</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;skill-b&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill-b&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>

<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s2</span><span class=p>)</span>

<span class=w>    </span><span class=nx>manifests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>List</span><span class=p>()</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>

<span class=w>    </span><span class=nx>ids</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>manifests</span><span class=p>))</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>manifests</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ids</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>ID</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ids</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill-a&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ids</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill-b&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_ListByTag</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>s1</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;search-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;discovery&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search&quot;</span><span class=p>})</span>
<span class=w>    </span><span class=nx>s2</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;code-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;code-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;code&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;execution&quot;</span><span class=p>})</span>
<span class=w>    </span><span class=nx>s3</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;explore-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;explore-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;discovery&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;exploration&quot;</span><span class=p>})</span>

<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s2</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s3</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Filter by tag</span>
<span class=w>    </span><span class=nx>results</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>ListByTag</span><span class=p>(</span><span class=s>&quot;discovery&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>results</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>

<span class=w>    </span><span class=nx>results</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>ListByTag</span><span class=p>(</span><span class=s>&quot;code&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>results</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;code-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>results</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>ID</span><span class=p>)</span>

<span class=w>    </span><span class=nx>results</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>ListByTag</span><span class=p>(</span><span class=s>&quot;nonexistent&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>results</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_Unregister</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;to-remove&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;to-remove&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Unregister</span><span class=p>(</span><span class=s>&quot;to-remove&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Get</span><span class=p>(</span><span class=s>&quot;to-remove&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>ErrorIs</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_UnregisterNotFound</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Unregister</span><span class=p>(</span><span class=s>&quot;nonexistent&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>ErrorIs</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRegistry_Advertise</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>s1</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>newTestSkill</span><span class=p>(</span><span class=s>&quot;public-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;public-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>s1</span><span class=p>)</span>

<span class=w>    </span><span class=nx>manifests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nx>Advertise</span><span class=p>()</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;public-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>manifests</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>ID</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestRegistry</code> Expected: FAIL with "undefined: NewRegistry"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/registry.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;errors&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=w>    </span><span class=s>&quot;sort&quot;</span>
<span class=w>    </span><span class=s>&quot;sync&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=p>)</span>

<span class=kd>var</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=nx>ErrSkillAlreadyRegistered</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;skill already registered&quot;</span><span class=p>)</span>
<span class=p>)</span>

<span class=c1>// SkillRegistry manages skill discovery and lookup.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillRegistry</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>
<span class=w>    </span><span class=nx>Get</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>GetByName</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>versionConstraint</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>List</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=nx>ListByTag</span><span class=p>(</span><span class=nx>tag</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=nx>Unregister</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>

<span class=w>    </span><span class=c1>// Discovery for A2A</span>
<span class=w>    </span><span class=nx>Advertise</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span>
<span class=p>}</span>

<span class=c1>// Registry is the default implementation of SkillRegistry.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Registry</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>mu</span><span class=w>     </span><span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span>
<span class=w>    </span><span class=nx>skills</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>Skill</span><span class=w> </span><span class=c1>// id -&gt; skill</span>
<span class=w>    </span><span class=nx>byName</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=nx>Skill</span><span class=w> </span><span class=c1>// name -&gt; skills (multiple versions)</span>
<span class=p>}</span>

<span class=c1>// NewRegistry creates a new skill registry.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Registry</span><span class=p>{</span>
<span class=w>        </span><span class=nx>skills</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>Skill</span><span class=p>),</span>
<span class=w>        </span><span class=nx>byName</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=nx>Skill</span><span class=p>),</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Register adds a skill to the registry.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Lock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Unlock</span><span class=p>()</span>

<span class=w>    </span><span class=nx>id</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>ID</span><span class=p>()</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>exists</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>[</span><span class=nx>id</span><span class=p>];</span><span class=w> </span><span class=nx>exists</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillAlreadyRegistered</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>skill</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>()]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>()],</span><span class=w> </span><span class=nx>skill</span><span class=p>)</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// Get retrieves a skill by ID.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>Get</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// GetByName retrieves a skill by name with optional version constraint.</span>
<span class=c1>// If constraint is empty, returns the latest version.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>GetByName</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>versionConstraint</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>skills</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: no skill named %q&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// No constraint - return latest</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>versionConstraint</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>latestVersion</span><span class=p>(</span><span class=nx>skills</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Parse constraint</span>
<span class=w>    </span><span class=nx>constraint</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewConstraint</span><span class=p>(</span><span class=nx>versionConstraint</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid version constraint: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Find matching versions</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>matching</span><span class=w> </span><span class=p>[]</span><span class=nx>Skill</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>skills</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>constraint</span><span class=p>.</span><span class=nx>Check</span><span class=p>(</span><span class=nx>s</span><span class=p>.</span><span class=nx>Version</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>matching</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>matching</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>matching</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: no skill %q matching constraint %q&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>versionConstraint</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>latestVersion</span><span class=p>(</span><span class=nx>matching</span><span class=p>),</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// latestVersion returns the skill with highest version.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>latestVersion</span><span class=p>(</span><span class=nx>skills</span><span class=w> </span><span class=p>[]</span><span class=nx>Skill</span><span class=p>)</span><span class=w> </span><span class=nx>Skill</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>skills</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>skills</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>sorted</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>skills</span><span class=p>))</span>
<span class=w>    </span><span class=nb>copy</span><span class=p>(</span><span class=nx>sorted</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=p>)</span>

<span class=w>    </span><span class=nx>sort</span><span class=p>.</span><span class=nx>Slice</span><span class=p>(</span><span class=nx>sorted</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>sorted</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>Version</span><span class=p>().</span><span class=nx>GreaterThan</span><span class=p>(</span><span class=nx>sorted</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>Version</span><span class=p>())</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sorted</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
<span class=p>}</span>

<span class=c1>// List returns all registered skill manifests.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>List</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=nx>manifests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=nx>SkillManifest</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>))</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>manifests</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>skill</span><span class=p>.</span><span class=nx>Manifest</span><span class=p>())</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Sort by ID for deterministic order</span>
<span class=w>    </span><span class=nx>sort</span><span class=p>.</span><span class=nx>Slice</span><span class=p>(</span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>manifests</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>ID</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nx>manifests</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>ID</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>manifests</span>
<span class=p>}</span>

<span class=c1>// ListByTag returns skills that have the specified tag.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>ListByTag</span><span class=p>(</span><span class=nx>tag</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>manifests</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>m</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Manifest</span><span class=p>()</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Tags</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>t</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>tag</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>manifests</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>m</span><span class=p>)</span>
<span class=w>                </span><span class=k>break</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>sort</span><span class=p>.</span><span class=nx>Slice</span><span class=p>(</span><span class=nx>manifests</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>j</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>manifests</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>ID</span><span class=w> </span><span class=p>&lt;</span><span class=w> </span><span class=nx>manifests</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>ID</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>manifests</span>
<span class=p>}</span>

<span class=c1>// Unregister removes a skill from the registry.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>Unregister</span><span class=p>(</span><span class=nx>id</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Lock</span><span class=p>()</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Unlock</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrSkillNotFound</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nb>delete</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>id</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Remove from byName</span>
<span class=w>    </span><span class=nx>name</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skills</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>skills</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>ID</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>id</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>skills</span><span class=p>[:</span><span class=nx>i</span><span class=p>],</span><span class=w> </span><span class=nx>skills</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span>
<span class=w>            </span><span class=k>break</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>[</span><span class=nx>name</span><span class=p>])</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nb>delete</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>byName</span><span class=p>,</span><span class=w> </span><span class=nx>name</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// Advertise returns manifests for A2A discovery.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Registry</span><span class=p>)</span><span class=w> </span><span class=nx>Advertise</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>SkillManifest</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>List</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestRegistry</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/registry.go<span class=w> </span>toolskill/registry_test.go
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add skill registry with version resolution</span>

<span class=s>- Add SkillRegistry interface for skill management</span>
<span class=s>- Add Registry implementation with thread-safe operations</span>
<span class=s>- Support version constraints via semver</span>
<span class=s>- Add GetByName with constraint resolution (^2.0.0, &gt;=1.0.0 &lt;2.0.0)</span>
<span class=s>- Add ListByTag for tag-based filtering</span>
<span class=s>- Add Advertise for A2A protocol discovery</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=task-4-skill-builder-and-composition>Task 4: Skill Builder and Composition<a class=headerlink href=#task-4-skill-builder-and-composition title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/builder.go</code> - Test: <code>toolskill/builder_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/builder_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_Basic</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;research-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when researching topics&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithTags</span><span class=p>(</span><span class=s>&quot;research&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;discovery&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>ID</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Name</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Version</span><span class=p>().</span><span class=nx>String</span><span class=p>())</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Use when researching topics&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Manifest</span><span class=p>().</span><span class=nx>Description</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Manifest</span><span class=p>().</span><span class=nx>Tags</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_WithSteps</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;multi-step&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when doing multi-step work&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;search&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search_tools&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>query</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Input</span><span class=p>.</span><span class=nx>GetString</span><span class=p>(</span><span class=s>&quot;query&quot;</span><span class=p>)</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>query</span><span class=p>}</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;describe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe_tool&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=c1>// Get first result from search</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;tool&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;result&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>(),</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>()[</span><span class=mi>0</span><span class=p>].</span><span class=nx>ID</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>()[</span><span class=mi>1</span><span class=p>].</span><span class=nx>ID</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_RequiredTools</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;tool-user&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when using tools&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>RequireTools</span><span class=p>(</span><span class=s>&quot;search_tools&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe_tool&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;run_tool&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>tools</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>RequiredTools</span><span class=p>()</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>tools</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>tools</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search_tools&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_Conditional</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;conditional-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing conditions&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;maybe-run&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;some_tool&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithCondition</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>enabled</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Input</span><span class=p>.</span><span class=nx>GetBool</span><span class=p>(</span><span class=s>&quot;enabled&quot;</span><span class=p>)</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=nx>enabled</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>(),</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NotNil</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>()[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Condition</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_ValidationFailure</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;name&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_MissingVersion</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;test-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;version&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_MissingDescription</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;test-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>.</span><span class=nx>Error</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;description&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestBuilder_InputOutputSchema</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>inputSchema</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>        </span><span class=s>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;object&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=s>&quot;properties&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;string&quot;</span><span class=p>},</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=s>&quot;required&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;query&quot;</span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;schema-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing schemas&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithInputSchema</span><span class=p>(</span><span class=nx>inputSchema</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>inputSchema</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Manifest</span><span class=p>().</span><span class=nx>InputSchema</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestCompositeSkill_Execute</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Create a simple skill with two steps</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;test-execution&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing execution&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;from&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;step1&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Execute - will fail because no runtime, but structure should be valid</span>
<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span><span class=s>&quot;test&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>})</span>

<span class=w>    </span><span class=c1>// Without a configured runtime, execution returns error</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Nil</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestBuilder</code> Expected: FAIL with "undefined: NewBuilder"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/builder.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/Masterminds/semver/v3&quot;</span>
<span class=p>)</span>

<span class=c1>// Builder provides a fluent API for building skills.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Builder</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>name</span><span class=w>          </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>version</span><span class=w>       </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>description</span><span class=w>   </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>tags</span><span class=w>          </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>requiredTools</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>inputSchema</span><span class=w>   </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span>
<span class=w>    </span><span class=nx>outputSchema</span><span class=w>  </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span>
<span class=w>    </span><span class=nx>steps</span><span class=w>         </span><span class=p>[]</span><span class=nx>StepDefinition</span>
<span class=w>    </span><span class=nx>idempotent</span><span class=w>    </span><span class=kt>bool</span>
<span class=w>    </span><span class=nx>supportsPause</span><span class=w> </span><span class=kt>bool</span>
<span class=w>    </span><span class=nx>author</span><span class=w>        </span><span class=kt>string</span>
<span class=p>}</span>

<span class=c1>// NewBuilder creates a new skill builder.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Builder</span><span class=p>{</span>
<span class=w>        </span><span class=nx>name</span><span class=p>:</span><span class=w>          </span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>tags</span><span class=p>:</span><span class=w>          </span><span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
<span class=w>        </span><span class=nx>requiredTools</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
<span class=w>        </span><span class=nx>steps</span><span class=p>:</span><span class=w>         </span><span class=p>[]</span><span class=nx>StepDefinition</span><span class=p>{},</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// WithVersion sets the skill version.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithVersion</span><span class=p>(</span><span class=nx>version</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>version</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>version</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// WithDescription sets the skill description.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithDescription</span><span class=p>(</span><span class=nx>desc</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>description</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>desc</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// WithTags adds tags to the skill.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithTags</span><span class=p>(</span><span class=nx>tags</span><span class=w> </span><span class=o>...</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>tags</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>tags</span><span class=p>,</span><span class=w> </span><span class=nx>tags</span><span class=o>...</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// RequireTools specifies tools this skill depends on.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>RequireTools</span><span class=p>(</span><span class=nx>tools</span><span class=w> </span><span class=o>...</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>requiredTools</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>requiredTools</span><span class=p>,</span><span class=w> </span><span class=nx>tools</span><span class=o>...</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// WithInputSchema sets the input JSON schema.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithInputSchema</span><span class=p>(</span><span class=nx>schema</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>inputSchema</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>schema</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// WithOutputSchema sets the output JSON schema.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithOutputSchema</span><span class=p>(</span><span class=nx>schema</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>outputSchema</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>schema</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// WithAuthor sets the skill author.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>WithAuthor</span><span class=p>(</span><span class=nx>author</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>author</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>author</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// Idempotent marks the skill as idempotent.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>Idempotent</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>idempotent</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// SupportsPause marks the skill as supporting pause/resume.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>SupportsPause</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>supportsPause</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>b</span>
<span class=p>}</span>

<span class=c1>// Step begins defining a new step.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>Step</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>StepBuilder</span><span class=p>{</span>
<span class=w>        </span><span class=nx>parent</span><span class=p>:</span><span class=w> </span><span class=nx>b</span><span class=p>,</span>
<span class=w>        </span><span class=nx>step</span><span class=p>:</span><span class=w> </span><span class=nx>StepDefinition</span><span class=p>{</span>
<span class=w>            </span><span class=nx>ID</span><span class=p>:</span><span class=w>   </span><span class=nx>id</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w> </span><span class=nx>id</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Tool</span><span class=p>:</span><span class=w> </span><span class=nx>tool</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Build creates the skill from the builder configuration.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>b</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=p>)</span><span class=w> </span><span class=nx>Build</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Validation</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>name</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;skill name is required&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>version</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;skill version is required&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>description</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;skill description is required&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>ver</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>semver</span><span class=p>.</span><span class=nx>NewVersion</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>version</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid version: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Collect tool names from steps</span>
<span class=w>    </span><span class=nx>toolSet</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>bool</span><span class=p>)</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>requiredTools</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>toolSet</span><span class=p>[</span><span class=nx>tool</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>b</span><span class=p>.</span><span class=nx>steps</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>Tool</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>toolSet</span><span class=p>[</span><span class=nx>step</span><span class=p>.</span><span class=nx>Tool</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>tools</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>toolSet</span><span class=p>))</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>toolSet</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>tools</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>tools</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>manifest</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillManifest</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ID</span><span class=p>:</span><span class=w>             </span><span class=nx>b</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>           </span><span class=nx>b</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Version</span><span class=p>:</span><span class=w>        </span><span class=nx>b</span><span class=p>.</span><span class=nx>version</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Description</span><span class=p>:</span><span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>description</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Tags</span><span class=p>:</span><span class=w>           </span><span class=nx>b</span><span class=p>.</span><span class=nx>tags</span><span class=p>,</span>
<span class=w>        </span><span class=nx>RequiredTools</span><span class=p>:</span><span class=w>  </span><span class=nx>tools</span><span class=p>,</span>
<span class=w>        </span><span class=nx>InputSchema</span><span class=p>:</span><span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>inputSchema</span><span class=p>,</span>
<span class=w>        </span><span class=nx>OutputSchema</span><span class=p>:</span><span class=w>   </span><span class=nx>b</span><span class=p>.</span><span class=nx>outputSchema</span><span class=p>,</span>
<span class=w>        </span><span class=nx>EstimatedSteps</span><span class=p>:</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>steps</span><span class=p>),</span>
<span class=w>        </span><span class=nx>Idempotent</span><span class=p>:</span><span class=w>     </span><span class=nx>b</span><span class=p>.</span><span class=nx>idempotent</span><span class=p>,</span>
<span class=w>        </span><span class=nx>SupportsPause</span><span class=p>:</span><span class=w>  </span><span class=nx>b</span><span class=p>.</span><span class=nx>supportsPause</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Author</span><span class=p>:</span><span class=w>         </span><span class=nx>b</span><span class=p>.</span><span class=nx>author</span><span class=p>,</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>CompositeSkill</span><span class=p>{</span>
<span class=w>        </span><span class=nx>id</span><span class=p>:</span><span class=w>       </span><span class=nx>b</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>name</span><span class=p>:</span><span class=w>     </span><span class=nx>b</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
<span class=w>        </span><span class=nx>version</span><span class=p>:</span><span class=w>  </span><span class=nx>ver</span><span class=p>,</span>
<span class=w>        </span><span class=nx>manifest</span><span class=p>:</span><span class=w> </span><span class=nx>manifest</span><span class=p>,</span>
<span class=w>        </span><span class=nx>steps</span><span class=p>:</span><span class=w>    </span><span class=nx>b</span><span class=p>.</span><span class=nx>steps</span><span class=p>,</span>
<span class=w>        </span><span class=nx>tools</span><span class=p>:</span><span class=w>    </span><span class=nx>tools</span><span class=p>,</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// StepBuilder builds individual steps.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>StepBuilder</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>parent</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span>
<span class=w>    </span><span class=nx>step</span><span class=w>   </span><span class=nx>StepDefinition</span>
<span class=p>}</span>

<span class=c1>// WithName sets the step display name.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>WithName</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>name</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// WithInputMapper sets how to transform skill context to tool input.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=nx>mapper</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>InputMapper</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>mapper</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// WithOutputMapper sets how to transform tool output.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>WithOutputMapper</span><span class=p>(</span><span class=nx>mapper</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>OutputMapper</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>mapper</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// WithCondition sets a condition for step execution.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>WithCondition</span><span class=p>(</span><span class=nx>cond</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>Condition</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>cond</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// WithTimeout sets step timeout in milliseconds.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>WithTimeout</span><span class=p>(</span><span class=nx>ms</span><span class=w> </span><span class=kt>int64</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>Timeout</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>ms</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// Optional marks the step as optional (continue on failure).</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>Optional</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>Optional</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// OnError sets the error handler.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>OnError</span><span class=p>(</span><span class=nx>handler</span><span class=w> </span><span class=nx>ErrorHandler</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>.</span><span class=nx>OnError</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>handler</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span>
<span class=p>}</span>

<span class=c1>// Done finishes step configuration and returns to the builder.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>sb</span><span class=w> </span><span class=o>*</span><span class=nx>StepBuilder</span><span class=p>)</span><span class=w> </span><span class=nx>Done</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Builder</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>sb</span><span class=p>.</span><span class=nx>parent</span><span class=p>.</span><span class=nx>steps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>sb</span><span class=p>.</span><span class=nx>parent</span><span class=p>.</span><span class=nx>steps</span><span class=p>,</span><span class=w> </span><span class=nx>sb</span><span class=p>.</span><span class=nx>step</span><span class=p>)</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>sb</span><span class=p>.</span><span class=nx>parent</span>
<span class=p>}</span>

<span class=c1>// CompositeSkill is a skill built from steps.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>CompositeSkill</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>id</span><span class=w>       </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>name</span><span class=w>     </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>version</span><span class=w>  </span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span>
<span class=w>    </span><span class=nx>manifest</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span>
<span class=w>    </span><span class=nx>steps</span><span class=w>    </span><span class=p>[]</span><span class=nx>StepDefinition</span>
<span class=w>    </span><span class=nx>tools</span><span class=w>    </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>runtime</span><span class=w>  </span><span class=nx>SkillRuntime</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>ID</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w>               </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>id</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w>             </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>name</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Version</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>semver</span><span class=p>.</span><span class=nx>Version</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>version</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Manifest</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>SkillManifest</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>manifest</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>RequiredTools</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>tools</span><span class=w> </span><span class=p>}</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Steps</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=nx>StepDefinition</span><span class=w>  </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>steps</span><span class=w> </span><span class=p>}</span>

<span class=c1>// SetRuntime configures the runtime for execution.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>SetRuntime</span><span class=p>(</span><span class=nx>rt</span><span class=w> </span><span class=nx>SkillRuntime</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>s</span><span class=p>.</span><span class=nx>runtime</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>rt</span>
<span class=p>}</span>

<span class=c1>// Execute runs the skill with the given input.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>)</span><span class=w> </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>runtime</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;skill runtime not configured&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestBuilder</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/builder.go<span class=w> </span>toolskill/builder_test.go
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add fluent builder for skill composition</span>

<span class=s>- Add Builder with fluent API for skill creation</span>
<span class=s>- Add StepBuilder for defining workflow steps</span>
<span class=s>- Support input/output mappers for data transformation</span>
<span class=s>- Support conditional step execution</span>
<span class=s>- Support step timeouts and optional steps</span>
<span class=s>- Add CompositeSkill implementation</span>
<span class=s>- Extract required tools from steps automatically</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=task-5-skill-runtime>Task 5: Skill Runtime<a class=headerlink href=#task-5-skill-runtime title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/runtime.go</code> - Test: <code>toolskill/runtime_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/runtime_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;errors&quot;</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>
<span class=w>    </span><span class=s>&quot;time&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=c1>// mockToolExecutor simulates tool execution</span>
<span class=kd>type</span><span class=w> </span><span class=nx>mockToolExecutor</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>results</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span>
<span class=w>    </span><span class=nx>errors</span><span class=w>  </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>error</span>
<span class=w>    </span><span class=nx>calls</span><span class=w>   </span><span class=p>[]</span><span class=kt>string</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=o>*</span><span class=nx>mockToolExecutor</span><span class=p>)</span><span class=w> </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>any</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>m</span><span class=p>.</span><span class=nx>calls</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nx>calls</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>errors</span><span class=p>[</span><span class=nx>tool</span><span class=p>];</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>result</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>results</span><span class=p>[</span><span class=nx>tool</span><span class=p>];</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>result</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;tool&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>tool</span><span class=p>,</span><span class=w> </span><span class=s>&quot;executed&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_Execute</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{</span>
<span class=w>        </span><span class=nx>results</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;search_tools&quot;</span><span class=p>:</span><span class=w>  </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;tools&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;tool1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool2&quot;</span><span class=p>}},</span>
<span class=w>            </span><span class=s>&quot;describe_tool&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;description&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;A test tool&quot;</span><span class=p>},</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>,</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;test-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing runtime&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;search&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search_tools&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Input</span><span class=p>[</span><span class=s>&quot;query&quot;</span><span class=p>]}</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;describe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe_tool&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithInputMapper</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;tool&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;test&quot;</span><span class=p>})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=s>&quot;search&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe&quot;</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Verify tools were called in order</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;search_tools&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;describe_tool&quot;</span><span class=p>},</span><span class=w> </span><span class=nx>executor</span><span class=p>.</span><span class=nx>calls</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_ConditionalStep</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{}</span>

<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>,</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;conditional&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing conditions&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;always&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;maybe&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool2&quot;</span><span class=p>).</span>
<span class=w>            </span><span class=nx>WithCondition</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>SkillContext</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Input</span><span class=p>[</span><span class=s>&quot;enabled&quot;</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>true</span>
<span class=w>            </span><span class=p>}).</span>
<span class=w>            </span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;final&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool3&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=c1>// With condition false</span>
<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span><span class=s>&quot;enabled&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;tool1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool3&quot;</span><span class=p>},</span><span class=w> </span><span class=nx>executor</span><span class=p>.</span><span class=nx>calls</span><span class=p>)</span><span class=w> </span><span class=c1>// tool2 skipped</span>

<span class=w>    </span><span class=c1>// With condition true</span>
<span class=w>    </span><span class=nx>executor</span><span class=p>.</span><span class=nx>calls</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{</span><span class=s>&quot;enabled&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&quot;tool1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool2&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool3&quot;</span><span class=p>},</span><span class=w> </span><span class=nx>executor</span><span class=p>.</span><span class=nx>calls</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_StepFailure</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{</span>
<span class=w>        </span><span class=nx>errors</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>error</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;failing_tool&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;tool failed&quot;</span><span class=p>),</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>,</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;failing-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing failures&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;good_tool&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step2&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;failing_tool&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step3&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;another_tool&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{})</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>False</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=c1>// Only step1 completed</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>ErrorMessage</span><span class=p>,</span><span class=w> </span><span class=s>&quot;failing_tool&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_OptionalStep</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{</span>
<span class=w>        </span><span class=nx>errors</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>error</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;optional_tool&quot;</span><span class=p>:</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>New</span><span class=p>(</span><span class=s>&quot;optional failed&quot;</span><span class=p>),</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>,</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;optional-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing optional steps&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step2&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;optional_tool&quot;</span><span class=p>).</span><span class=nx>Optional</span><span class=p>().</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step3&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool3&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=c1>// Should succeed despite optional step failure</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=s>&quot;step1&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span><span class=p>,</span><span class=w> </span><span class=s>&quot;step3&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_Timeout</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{}</span>

<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span>
<span class=w>        </span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w>   </span><span class=nx>executor</span><span class=p>,</span>
<span class=w>        </span><span class=nx>DefaultTimeout</span><span class=p>:</span><span class=w> </span><span class=mi>50</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>,</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=c1>// Create context that will timeout</span>
<span class=w>    </span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=mi>10</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>cancel</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;timeout-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing timeouts&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=c1>// Simulate slow execution by waiting</span>
<span class=w>    </span><span class=nx>time</span><span class=p>.</span><span class=nx>Sleep</span><span class=p>(</span><span class=mi>20</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>

<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{})</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>DeadlineExceeded</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>errors</span><span class=p>.</span><span class=nx>Is</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Canceled</span><span class=p>))</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_GetStatus</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{}</span>
<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;status-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing status&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=c1>// Start async execution</span>
<span class=w>    </span><span class=nx>execID</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ExecuteAsync</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Check status (may be running or completed)</span>
<span class=w>    </span><span class=nx>status</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>GetStatus</span><span class=p>(</span><span class=nx>execID</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>execID</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;status-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nx>SkillID</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestRuntime_Cancel</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{}</span>
<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;cancel-skill&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing cancellation&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>execID</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ExecuteAsync</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>{})</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Cancel</span><span class=p>(</span><span class=nx>execID</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestRuntime</code> Expected: FAIL with "undefined: NewRuntime"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/runtime.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=w>    </span><span class=s>&quot;sync&quot;</span>
<span class=w>    </span><span class=s>&quot;sync/atomic&quot;</span>
<span class=w>    </span><span class=s>&quot;time&quot;</span>
<span class=p>)</span>

<span class=c1>// ExecutionID uniquely identifies a skill execution.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ExecutionID</span><span class=w> </span><span class=kt>string</span>

<span class=c1>// ExecutionState represents the state of skill execution.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ExecutionState</span><span class=w> </span><span class=kt>string</span>

<span class=kd>const</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=nx>StatePending</span><span class=w>   </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;pending&quot;</span>
<span class=w>    </span><span class=nx>StateRunning</span><span class=w>   </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;running&quot;</span>
<span class=w>    </span><span class=nx>StatePaused</span><span class=w>    </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;paused&quot;</span>
<span class=w>    </span><span class=nx>StateCompleted</span><span class=w> </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;completed&quot;</span>
<span class=w>    </span><span class=nx>StateFailed</span><span class=w>    </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;failed&quot;</span>
<span class=w>    </span><span class=nx>StateCancelled</span><span class=w> </span><span class=nx>ExecutionState</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&quot;cancelled&quot;</span>
<span class=p>)</span>

<span class=c1>// ToolExecutor executes individual tools.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ToolExecutor</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>any</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// SkillRuntime executes skills.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillRuntime</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>ExecuteAsync</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ExecutionID</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>GetStatus</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>ExecutionStatus</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span>
<span class=w>    </span><span class=nx>Pause</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>
<span class=w>    </span><span class=nx>Resume</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>
<span class=w>    </span><span class=nx>Cancel</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span>
<span class=p>}</span>

<span class=c1>// ExecutionStatus tracks skill execution progress.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>ExecutionStatus</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ID</span><span class=w>             </span><span class=nx>ExecutionID</span>
<span class=w>    </span><span class=nx>SkillID</span><span class=w>        </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>State</span><span class=w>          </span><span class=nx>ExecutionState</span>
<span class=w>    </span><span class=nx>CurrentStep</span><span class=w>    </span><span class=kt>string</span>
<span class=w>    </span><span class=nx>CompletedSteps</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span>
<span class=w>    </span><span class=nx>Progress</span><span class=w>       </span><span class=kt>float64</span>
<span class=w>    </span><span class=nx>StartedAt</span><span class=w>      </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
<span class=w>    </span><span class=nx>CompletedAt</span><span class=w>    </span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
<span class=w>    </span><span class=nx>Error</span><span class=w>          </span><span class=kt>error</span>
<span class=p>}</span>

<span class=c1>// RuntimeConfig configures the skill runtime.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>RuntimeConfig</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>ToolExecutor</span><span class=w>   </span><span class=nx>ToolExecutor</span>
<span class=w>    </span><span class=nx>DefaultTimeout</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
<span class=w>    </span><span class=nx>MaxConcurrent</span><span class=w>  </span><span class=kt>int</span>
<span class=p>}</span>

<span class=c1>// Runtime is the default SkillRuntime implementation.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Runtime</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>executor</span><span class=w>       </span><span class=nx>ToolExecutor</span>
<span class=w>    </span><span class=nx>defaultTimeout</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
<span class=w>    </span><span class=nx>maxConcurrent</span><span class=w>  </span><span class=kt>int</span>

<span class=w>    </span><span class=nx>mu</span><span class=w>         </span><span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span>
<span class=w>    </span><span class=nx>executions</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=nx>ExecutionID</span><span class=p>]</span><span class=o>*</span><span class=nx>execution</span>
<span class=w>    </span><span class=nx>nextID</span><span class=w>     </span><span class=nx>atomic</span><span class=p>.</span><span class=nx>Uint64</span>
<span class=p>}</span>

<span class=kd>type</span><span class=w> </span><span class=nx>execution</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>id</span><span class=w>        </span><span class=nx>ExecutionID</span>
<span class=w>    </span><span class=nx>skill</span><span class=w>     </span><span class=nx>Skill</span>
<span class=w>    </span><span class=nx>input</span><span class=w>     </span><span class=nx>SkillInput</span>
<span class=w>    </span><span class=nx>status</span><span class=w>    </span><span class=o>*</span><span class=nx>ExecutionStatus</span>
<span class=w>    </span><span class=nx>cancel</span><span class=w>    </span><span class=nx>context</span><span class=p>.</span><span class=nx>CancelFunc</span>
<span class=w>    </span><span class=nx>done</span><span class=w>      </span><span class=kd>chan</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span>
<span class=w>    </span><span class=nx>output</span><span class=w>    </span><span class=o>*</span><span class=nx>SkillOutput</span>
<span class=w>    </span><span class=nx>err</span><span class=w>       </span><span class=kt>error</span>
<span class=p>}</span>

<span class=c1>// NewRuntime creates a new skill runtime.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>cfg</span><span class=w> </span><span class=nx>RuntimeConfig</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>DefaultTimeout</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>DefaultTimeout</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MaxConcurrent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MaxConcurrent</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>10</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Runtime</span><span class=p>{</span>
<span class=w>        </span><span class=nx>executor</span><span class=p>:</span><span class=w>       </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>ToolExecutor</span><span class=p>,</span>
<span class=w>        </span><span class=nx>defaultTimeout</span><span class=p>:</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>DefaultTimeout</span><span class=p>,</span>
<span class=w>        </span><span class=nx>maxConcurrent</span><span class=p>:</span><span class=w>  </span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MaxConcurrent</span><span class=p>,</span>
<span class=w>        </span><span class=nx>executions</span><span class=p>:</span><span class=w>     </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=nx>ExecutionID</span><span class=p>]</span><span class=o>*</span><span class=nx>execution</span><span class=p>),</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Execute runs a skill synchronously.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Check context before starting</span>
<span class=w>    </span><span class=k>select</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Done</span><span class=p>():</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Err</span><span class=p>()</span>
<span class=w>    </span><span class=k>default</span><span class=p>:</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>execCtx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillContext</span><span class=p>{</span>
<span class=w>        </span><span class=nx>Input</span><span class=p>:</span><span class=w>    </span><span class=nx>input</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Results</span><span class=p>:</span><span class=w>  </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>),</span>
<span class=w>        </span><span class=nx>Metadata</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>),</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>steps</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>skill</span><span class=p>.</span><span class=nx>Steps</span><span class=p>()</span>
<span class=w>    </span><span class=nx>completed</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>steps</span><span class=p>))</span>
<span class=w>    </span><span class=nx>startTime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>()</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>steps</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// Check context</span>
<span class=w>        </span><span class=k>select</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Done</span><span class=p>():</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>                </span><span class=nx>Success</span><span class=p>:</span><span class=w>        </span><span class=kc>false</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Error</span><span class=p>:</span><span class=w>          </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Err</span><span class=p>(),</span>
<span class=w>                </span><span class=nx>ErrorMessage</span><span class=p>:</span><span class=w>   </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Err</span><span class=p>().</span><span class=nx>Error</span><span class=p>(),</span>
<span class=w>                </span><span class=nx>StepsCompleted</span><span class=p>:</span><span class=w> </span><span class=nx>completed</span><span class=p>,</span>
<span class=w>                </span><span class=nx>Duration</span><span class=p>:</span><span class=w>       </span><span class=nx>time</span><span class=p>.</span><span class=nx>Since</span><span class=p>(</span><span class=nx>startTime</span><span class=p>).</span><span class=nx>Milliseconds</span><span class=p>(),</span>
<span class=w>            </span><span class=p>},</span><span class=w> </span><span class=nx>ctx</span><span class=p>.</span><span class=nx>Err</span><span class=p>()</span>
<span class=w>        </span><span class=k>default</span><span class=p>:</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=nx>execCtx</span><span class=p>.</span><span class=nx>StepID</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>ID</span>

<span class=w>        </span><span class=c1>// Check condition</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>Condition</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>!</span><span class=nx>step</span><span class=p>.</span><span class=nx>Condition</span><span class=p>(</span><span class=o>*</span><span class=nx>execCtx</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=w> </span><span class=c1>// Skip this step</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=c1>// Prepare input</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=nx>toolInput</span><span class=w> </span><span class=kt>any</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>InputMapper</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>toolInput</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>InputMapper</span><span class=p>(</span><span class=o>*</span><span class=nx>execCtx</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>toolInput</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>input</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=c1>// Execute tool</span>
<span class=w>        </span><span class=nx>result</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>executor</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>Tool</span><span class=p>,</span><span class=w> </span><span class=nx>toolInput</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>Optional</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=c1>// Continue on optional step failure</span>
<span class=w>                </span><span class=k>continue</span>
<span class=w>            </span><span class=p>}</span>

<span class=w>            </span><span class=c1>// Handle error</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>OnError</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>if</span><span class=w> </span><span class=nx>handlerErr</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>OnError</span><span class=p>(</span><span class=o>*</span><span class=nx>execCtx</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>);</span><span class=w> </span><span class=nx>handlerErr</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>                        </span><span class=nx>Success</span><span class=p>:</span><span class=w>        </span><span class=kc>false</span><span class=p>,</span>
<span class=w>                        </span><span class=nx>Error</span><span class=p>:</span><span class=w>          </span><span class=nx>handlerErr</span><span class=p>,</span>
<span class=w>                        </span><span class=nx>ErrorMessage</span><span class=p>:</span><span class=w>   </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;step %s failed: %v&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>),</span>
<span class=w>                        </span><span class=nx>StepsCompleted</span><span class=p>:</span><span class=w> </span><span class=nx>completed</span><span class=p>,</span>
<span class=w>                        </span><span class=nx>Duration</span><span class=p>:</span><span class=w>       </span><span class=nx>time</span><span class=p>.</span><span class=nx>Since</span><span class=p>(</span><span class=nx>startTime</span><span class=p>).</span><span class=nx>Milliseconds</span><span class=p>(),</span>
<span class=w>                    </span><span class=p>},</span><span class=w> </span><span class=nx>handlerErr</span>
<span class=w>                </span><span class=p>}</span>
<span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>                    </span><span class=nx>Success</span><span class=p>:</span><span class=w>        </span><span class=kc>false</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>Error</span><span class=p>:</span><span class=w>          </span><span class=nx>err</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>ErrorMessage</span><span class=p>:</span><span class=w>   </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;step %s (%s) failed: %v&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>Tool</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>),</span>
<span class=w>                    </span><span class=nx>StepsCompleted</span><span class=p>:</span><span class=w> </span><span class=nx>completed</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>Duration</span><span class=p>:</span><span class=w>       </span><span class=nx>time</span><span class=p>.</span><span class=nx>Since</span><span class=p>(</span><span class=nx>startTime</span><span class=p>).</span><span class=nx>Milliseconds</span><span class=p>(),</span>
<span class=w>                </span><span class=p>},</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;%w: %v&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>ErrStepFailed</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=c1>// Transform output if mapper provided</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>OutputMapper</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>result</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>OutputMapper</span><span class=p>(</span><span class=nx>result</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=c1>// Store result</span>
<span class=w>        </span><span class=nx>execCtx</span><span class=p>.</span><span class=nx>Results</span><span class=p>[</span><span class=nx>step</span><span class=p>.</span><span class=nx>ID</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>result</span>
<span class=w>        </span><span class=nx>completed</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>completed</span><span class=p>,</span><span class=w> </span><span class=nx>step</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillOutput</span><span class=p>{</span>
<span class=w>        </span><span class=nx>Success</span><span class=p>:</span><span class=w>        </span><span class=kc>true</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Result</span><span class=p>:</span><span class=w>         </span><span class=nx>execCtx</span><span class=p>.</span><span class=nx>Results</span><span class=p>,</span>
<span class=w>        </span><span class=nx>StepsCompleted</span><span class=p>:</span><span class=w> </span><span class=nx>completed</span><span class=p>,</span>
<span class=w>        </span><span class=nx>Duration</span><span class=p>:</span><span class=w>       </span><span class=nx>time</span><span class=p>.</span><span class=nx>Since</span><span class=p>(</span><span class=nx>startTime</span><span class=p>).</span><span class=nx>Milliseconds</span><span class=p>(),</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// ExecuteAsync runs a skill asynchronously.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>ExecuteAsync</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=w> </span><span class=nx>Skill</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>ExecutionID</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>id</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;exec-%d&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>nextID</span><span class=p>.</span><span class=nx>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)))</span>

<span class=w>    </span><span class=nx>execCtx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>WithCancel</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>

<span class=w>    </span><span class=nx>exec</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>execution</span><span class=p>{</span>
<span class=w>        </span><span class=nx>id</span><span class=p>:</span><span class=w>     </span><span class=nx>id</span><span class=p>,</span>
<span class=w>        </span><span class=nx>skill</span><span class=p>:</span><span class=w>  </span><span class=nx>skill</span><span class=p>,</span>
<span class=w>        </span><span class=nx>input</span><span class=p>:</span><span class=w>  </span><span class=nx>input</span><span class=p>,</span>
<span class=w>        </span><span class=nx>cancel</span><span class=p>:</span><span class=w> </span><span class=nx>cancel</span><span class=p>,</span>
<span class=w>        </span><span class=nx>done</span><span class=p>:</span><span class=w>   </span><span class=nb>make</span><span class=p>(</span><span class=kd>chan</span><span class=w> </span><span class=kd>struct</span><span class=p>{}),</span>
<span class=w>        </span><span class=nx>status</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>ExecutionStatus</span><span class=p>{</span>
<span class=w>            </span><span class=nx>ID</span><span class=p>:</span><span class=w>        </span><span class=nx>id</span><span class=p>,</span>
<span class=w>            </span><span class=nx>SkillID</span><span class=p>:</span><span class=w>   </span><span class=nx>skill</span><span class=p>.</span><span class=nx>ID</span><span class=p>(),</span>
<span class=w>            </span><span class=nx>State</span><span class=p>:</span><span class=w>     </span><span class=nx>StatePending</span><span class=p>,</span>
<span class=w>            </span><span class=nx>StartedAt</span><span class=p>:</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>(),</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Lock</span><span class=p>()</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>executions</span><span class=p>[</span><span class=nx>id</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>exec</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>Unlock</span><span class=p>()</span>

<span class=w>    </span><span class=k>go</span><span class=w> </span><span class=kd>func</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>defer</span><span class=w> </span><span class=nb>close</span><span class=p>(</span><span class=nx>exec</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span>

<span class=w>        </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>State</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>StateRunning</span>
<span class=w>        </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>execCtx</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=p>)</span>

<span class=w>        </span><span class=nx>exec</span><span class=p>.</span><span class=nx>output</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>output</span>
<span class=w>        </span><span class=nx>exec</span><span class=p>.</span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>err</span>

<span class=w>        </span><span class=nx>now</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Now</span><span class=p>()</span>
<span class=w>        </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>CompletedAt</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>now</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>State</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>StateFailed</span>
<span class=w>            </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>Error</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>err</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>State</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>StateCompleted</span>
<span class=w>            </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>CompletedSteps</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>StepsCompleted</span>
<span class=w>            </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>Progress</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mf>1.0</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}()</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>id</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// GetStatus retrieves execution status.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>GetStatus</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>ExecutionStatus</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=nx>exec</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>executions</span><span class=p>[</span><span class=nx>execID</span><span class=p>]</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;execution not found: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>execID</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// Pause pauses execution (not yet implemented).</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>Pause</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;pause not yet implemented&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Resume resumes execution (not yet implemented).</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>Resume</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;resume not yet implemented&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Cancel cancels an execution.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>r</span><span class=w> </span><span class=o>*</span><span class=nx>Runtime</span><span class=p>)</span><span class=w> </span><span class=nx>Cancel</span><span class=p>(</span><span class=nx>execID</span><span class=w> </span><span class=nx>ExecutionID</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RLock</span><span class=p>()</span>
<span class=w>    </span><span class=nx>exec</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>r</span><span class=p>.</span><span class=nx>executions</span><span class=p>[</span><span class=nx>execID</span><span class=p>]</span>
<span class=w>    </span><span class=nx>r</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nx>RUnlock</span><span class=p>()</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;execution not found: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>execID</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>exec</span><span class=p>.</span><span class=nx>cancel</span><span class=p>()</span>
<span class=w>    </span><span class=nx>exec</span><span class=p>.</span><span class=nx>status</span><span class=p>.</span><span class=nx>State</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>StateCancelled</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run TestRuntime</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/runtime.go<span class=w> </span>toolskill/runtime_test.go
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add skill runtime with step execution</span>

<span class=s>- Add SkillRuntime interface for skill execution</span>
<span class=s>- Add Runtime implementation with sync/async execution</span>
<span class=s>- Execute steps sequentially with context propagation</span>
<span class=s>- Support conditional steps via Condition function</span>
<span class=s>- Support optional steps that continue on failure</span>
<span class=s>- Add input/output mappers for data transformation</span>
<span class=s>- Track execution status with progress updates</span>
<span class=s>- Support cancellation via context</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=task-6-discovery-and-integration>Task 6: Discovery and Integration<a class=headerlink href=#task-6-discovery-and-integration title="Permanent link">&para;</a></h2> <p><strong>Files:</strong> - Create: <code>toolskill/discovery.go</code> - Create: <code>toolskill/provider.go</code> - Test: <code>toolskill/discovery_test.go</code></p> <p><strong>Step 1: Write the failing test</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/discovery_test.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;os&quot;</span>
<span class=w>    </span><span class=s>&quot;path/filepath&quot;</span>
<span class=w>    </span><span class=s>&quot;testing&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/assert&quot;</span>
<span class=w>    </span><span class=s>&quot;github.com/stretchr/testify/require&quot;</span>
<span class=p>)</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestDiscovery_ScanDirectory</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Create temp directory with skill files</span>
<span class=w>    </span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirTemp</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills-test&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>RemoveAll</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Create skill directory structure</span>
<span class=w>    </span><span class=nx>skill1Dir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-skill&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirAll</span><span class=p>(</span><span class=nx>skill1Dir</span><span class=p>,</span><span class=w> </span><span class=mo>0755</span><span class=p>))</span>

<span class=w>    </span><span class=nx>skill1Content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: research-skill</span>
<span class=s>description: Use when researching topics</span>
<span class=s>metadata:</span>
<span class=s>  version: &quot;1.0.0&quot;</span>
<span class=s>---</span>

<span class=s># Research Skill</span>

<span class=s>## Overview</span>
<span class=s>Helps research topics.</span>
<span class=s>`</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>WriteFile</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>skill1Dir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;SKILL.md&quot;</span><span class=p>),</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>skill1Content</span><span class=p>),</span><span class=w> </span><span class=mo>0644</span><span class=p>))</span>

<span class=w>    </span><span class=nx>skill2Dir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;debug-skill&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirAll</span><span class=p>(</span><span class=nx>skill2Dir</span><span class=p>,</span><span class=w> </span><span class=mo>0755</span><span class=p>))</span>

<span class=w>    </span><span class=nx>skill2Content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: debug-skill</span>
<span class=s>description: Use when debugging issues</span>
<span class=s>metadata:</span>
<span class=s>  version: &quot;2.0.0&quot;</span>
<span class=s>---</span>

<span class=s># Debug Skill</span>

<span class=s>## Overview</span>
<span class=s>Helps debug code.</span>
<span class=s>`</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>WriteFile</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>skill2Dir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;SKILL.md&quot;</span><span class=p>),</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>skill2Content</span><span class=p>),</span><span class=w> </span><span class=mo>0644</span><span class=p>))</span>

<span class=w>    </span><span class=c1>// Scan directory</span>
<span class=w>    </span><span class=nx>discovery</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewDiscovery</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>discovery</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Verify skills were found</span>
<span class=w>    </span><span class=nx>names</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>skills</span><span class=p>))</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>skills</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>names</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>Name</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>names</span><span class=p>,</span><span class=w> </span><span class=s>&quot;research-skill&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>names</span><span class=p>,</span><span class=w> </span><span class=s>&quot;debug-skill&quot;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestDiscovery_ScanDirectoryNested</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirTemp</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills-nested&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>RemoveAll</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Create nested structure</span>
<span class=w>    </span><span class=nx>nestedDir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;category&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;subcategory&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;my-skill&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirAll</span><span class=p>(</span><span class=nx>nestedDir</span><span class=p>,</span><span class=w> </span><span class=mo>0755</span><span class=p>))</span>

<span class=w>    </span><span class=nx>content</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=s>`---</span>
<span class=s>name: nested-skill</span>
<span class=s>description: Use when testing nested discovery</span>
<span class=s>---</span>

<span class=s># Nested Skill</span>
<span class=s>`</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>WriteFile</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>nestedDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;SKILL.md&quot;</span><span class=p>),</span><span class=w> </span><span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>content</span><span class=p>),</span><span class=w> </span><span class=mo>0644</span><span class=p>))</span>

<span class=w>    </span><span class=nx>discovery</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewDiscovery</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>discovery</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;nested-skill&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Name</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestDiscovery_ScanEmptyDirectory</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>tmpDir</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>MkdirTemp</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills-empty&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>RemoveAll</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>

<span class=w>    </span><span class=nx>discovery</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewDiscovery</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>discovery</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>tmpDir</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestDiscovery_ScanNonexistentDirectory</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>discovery</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewDiscovery</span><span class=p>()</span>
<span class=w>    </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>discovery</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=s>&quot;/nonexistent/path&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Error</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillToolProvider_Tools</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>registry</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill1</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;research&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when researching&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithInputSchema</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>            </span><span class=s>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;object&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=s>&quot;properties&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span>
<span class=w>                </span><span class=s>&quot;query&quot;</span><span class=p>:</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;string&quot;</span><span class=p>},</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>}).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>skill2</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;debug&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when debugging&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>

<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>registry</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill1</span><span class=p>)</span>
<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>registry</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill2</span><span class=p>)</span>

<span class=w>    </span><span class=nx>provider</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewSkillToolProvider</span><span class=p>(</span><span class=nx>registry</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span>
<span class=w>    </span><span class=nx>tools</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>provider</span><span class=p>.</span><span class=nx>Tools</span><span class=p>()</span>

<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Len</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>tools</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Verify tool naming convention</span>
<span class=w>    </span><span class=nx>names</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>tools</span><span class=p>))</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tools</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>names</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>tool</span><span class=p>.</span><span class=nx>Name</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>names</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill:research&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>names</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skill:debug&quot;</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Verify description prefix</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>tools</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>assert</span><span class=p>.</span><span class=nx>Contains</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=p>.</span><span class=nx>Description</span><span class=p>,</span><span class=w> </span><span class=s>&quot;[SKILL]&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=kd>func</span><span class=w> </span><span class=nx>TestSkillToolProvider_Handle</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>registry</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRegistry</span><span class=p>()</span>
<span class=w>    </span><span class=nx>executor</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>mockToolExecutor</span><span class=p>{}</span>
<span class=w>    </span><span class=nx>runtime</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewRuntime</span><span class=p>(</span><span class=nx>RuntimeConfig</span><span class=p>{</span><span class=nx>ToolExecutor</span><span class=p>:</span><span class=w> </span><span class=nx>executor</span><span class=p>})</span>

<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewBuilder</span><span class=p>(</span><span class=s>&quot;test-handle&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithVersion</span><span class=p>(</span><span class=s>&quot;1.0.0&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>WithDescription</span><span class=p>(</span><span class=s>&quot;Use when testing handle&quot;</span><span class=p>).</span>
<span class=w>        </span><span class=nx>Step</span><span class=p>(</span><span class=s>&quot;step1&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;tool1&quot;</span><span class=p>).</span><span class=nx>Done</span><span class=p>().</span>
<span class=w>        </span><span class=nx>Build</span><span class=p>()</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>.(</span><span class=o>*</span><span class=nx>CompositeSkill</span><span class=p>).</span><span class=nx>SetRuntime</span><span class=p>(</span><span class=nx>runtime</span><span class=p>)</span>

<span class=w>    </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>registry</span><span class=p>.</span><span class=nx>Register</span><span class=p>(</span><span class=nx>skill</span><span class=p>)</span>

<span class=w>    </span><span class=nx>provider</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>NewSkillToolProvider</span><span class=p>(</span><span class=nx>registry</span><span class=p>,</span><span class=w> </span><span class=nx>runtime</span><span class=p>)</span>

<span class=w>    </span><span class=c1>// Handle skill execution</span>
<span class=w>    </span><span class=nx>result</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>provider</span><span class=p>.</span><span class=nx>Handle</span><span class=p>(</span><span class=s>&quot;skill:test-handle&quot;</span><span class=p>,</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&quot;input&quot;</span><span class=p>:</span><span class=w> </span><span class=s>&quot;value&quot;</span><span class=p>})</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>

<span class=w>    </span><span class=nx>output</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>result</span><span class=p>.(</span><span class=o>*</span><span class=nx>SkillOutput</span><span class=p>)</span>
<span class=w>    </span><span class=nx>require</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=p>)</span>
<span class=w>    </span><span class=nx>assert</span><span class=p>.</span><span class=nx>True</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>output</span><span class=p>.</span><span class=nx>Success</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 2: Run test to verify it fails</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run "TestDiscovery|TestSkillToolProvider"</code> Expected: FAIL with "undefined: NewDiscovery"</p> <p><strong>Step 3: Write minimal implementation</strong></p> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/discovery.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;os&quot;</span>
<span class=w>    </span><span class=s>&quot;path/filepath&quot;</span>

<span class=w>    </span><span class=s>&quot;github.com/yourusername/toolskill/skillmd&quot;</span>
<span class=p>)</span>

<span class=c1>// Discovery finds skills in standard locations.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Discovery</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>parser</span><span class=w> </span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>Parser</span>
<span class=p>}</span>

<span class=c1>// NewDiscovery creates a new skill discovery instance.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewDiscovery</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>Discovery</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Discovery</span><span class=p>{</span>
<span class=w>        </span><span class=nx>parser</span><span class=p>:</span><span class=w> </span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>NewParser</span><span class=p>(),</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// ScanDirectory finds all SKILL.md files in a directory tree.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>Discovery</span><span class=p>)</span><span class=w> </span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>root</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>([]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>skills</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span>

<span class=w>    </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>WalkDir</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>path</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>entry</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>DirEntry</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>entry</span><span class=p>.</span><span class=nx>IsDir</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>entry</span><span class=p>.</span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;SKILL.md&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>parser</span><span class=p>.</span><span class=nx>Parse</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=c1>// Log warning but continue scanning</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>            </span><span class=nx>skills</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>skill</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=p>})</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// ScanUserSkills scans ~/.claude/skills/ for user-defined skills.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>Discovery</span><span class=p>)</span><span class=w> </span><span class=nx>ScanUserSkills</span><span class=p>()</span><span class=w> </span><span class=p>([]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>homeDir</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>UserHomeDir</span><span class=p>()</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>err</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Check both possible locations</span>
<span class=w>    </span><span class=nx>paths</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
<span class=w>        </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>homeDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;.claude&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills&quot;</span><span class=p>),</span>
<span class=w>        </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>homeDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;.config&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;claude&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills&quot;</span><span class=p>),</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>allSkills</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>path</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>paths</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Stat</span><span class=p>(</span><span class=nx>path</span><span class=p>);</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>IsNotExist</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=nx>skills</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>path</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=nx>allSkills</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>allSkills</span><span class=p>,</span><span class=w> </span><span class=nx>skills</span><span class=o>...</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>allSkills</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=p>}</span>

<span class=c1>// ScanProjectSkills scans .claude/skills/ in a project root.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>Discovery</span><span class=p>)</span><span class=w> </span><span class=nx>ScanProjectSkills</span><span class=p>(</span><span class=nx>projectRoot</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>([]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skillsDir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>projectRoot</span><span class=p>,</span><span class=w> </span><span class=s>&quot;.claude&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Stat</span><span class=p>(</span><span class=nx>skillsDir</span><span class=p>);</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>IsNotExist</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>skillsDir</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// ScanPluginSkills scans a plugin directory for skills.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>d</span><span class=w> </span><span class=o>*</span><span class=nx>Discovery</span><span class=p>)</span><span class=w> </span><span class=nx>ScanPluginSkills</span><span class=p>(</span><span class=nx>pluginDir</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>([]</span><span class=o>*</span><span class=nx>skillmd</span><span class=p>.</span><span class=nx>SkillMD</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>skillsDir</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>filepath</span><span class=p>.</span><span class=nx>Join</span><span class=p>(</span><span class=nx>pluginDir</span><span class=p>,</span><span class=w> </span><span class=s>&quot;skills&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>Stat</span><span class=p>(</span><span class=nx>skillsDir</span><span class=p>);</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>IsNotExist</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>d</span><span class=p>.</span><span class=nx>ScanDirectory</span><span class=p>(</span><span class=nx>skillsDir</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// toolskill/provider.go</span>
<span class=kn>package</span><span class=w> </span><span class=nx>toolskill</span>

<span class=kn>import</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=s>&quot;context&quot;</span>
<span class=w>    </span><span class=s>&quot;encoding/json&quot;</span>
<span class=w>    </span><span class=s>&quot;fmt&quot;</span>
<span class=p>)</span>

<span class=c1>// Tool represents an MCP tool definition.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>Tool</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>Name</span><span class=w>        </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;name&quot;`</span>
<span class=w>    </span><span class=nx>Description</span><span class=w> </span><span class=kt>string</span><span class=w>         </span><span class=s>`json:&quot;description&quot;`</span>
<span class=w>    </span><span class=nx>InputSchema</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=w> </span><span class=s>`json:&quot;inputSchema,omitempty&quot;`</span>
<span class=p>}</span>

<span class=c1>// SkillToolProvider exposes skills as MCP tools.</span>
<span class=kd>type</span><span class=w> </span><span class=nx>SkillToolProvider</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>registry</span><span class=w> </span><span class=nx>SkillRegistry</span>
<span class=w>    </span><span class=nx>runtime</span><span class=w>  </span><span class=nx>SkillRuntime</span>
<span class=p>}</span>

<span class=c1>// NewSkillToolProvider creates a provider that exposes skills as tools.</span>
<span class=kd>func</span><span class=w> </span><span class=nx>NewSkillToolProvider</span><span class=p>(</span><span class=nx>registry</span><span class=w> </span><span class=nx>SkillRegistry</span><span class=p>,</span><span class=w> </span><span class=nx>runtime</span><span class=w> </span><span class=nx>SkillRuntime</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=nx>SkillToolProvider</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>SkillToolProvider</span><span class=p>{</span>
<span class=w>        </span><span class=nx>registry</span><span class=p>:</span><span class=w> </span><span class=nx>registry</span><span class=p>,</span>
<span class=w>        </span><span class=nx>runtime</span><span class=p>:</span><span class=w>  </span><span class=nx>runtime</span><span class=p>,</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Tools returns all skills as MCP tool definitions.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SkillToolProvider</span><span class=p>)</span><span class=w> </span><span class=nx>Tools</span><span class=p>()</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Tool</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>manifests</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>List</span><span class=p>()</span>
<span class=w>    </span><span class=nx>tools</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>([]</span><span class=o>*</span><span class=nx>Tool</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>manifests</span><span class=p>))</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>manifests</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>tool</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Tool</span><span class=p>{</span>
<span class=w>            </span><span class=nx>Name</span><span class=p>:</span><span class=w>        </span><span class=s>&quot;skill:&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
<span class=w>            </span><span class=nx>Description</span><span class=p>:</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Sprintf</span><span class=p>(</span><span class=s>&quot;[SKILL] %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>Description</span><span class=p>),</span>
<span class=w>            </span><span class=nx>InputSchema</span><span class=p>:</span><span class=w> </span><span class=nx>m</span><span class=p>.</span><span class=nx>InputSchema</span><span class=p>,</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=nx>tools</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>tools</span><span class=p>,</span><span class=w> </span><span class=nx>tool</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>tools</span>
<span class=p>}</span>

<span class=c1>// Handle executes a skill via its tool name.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SkillToolProvider</span><span class=p>)</span><span class=w> </span><span class=nx>Handle</span><span class=p>(</span><span class=nx>toolName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=w> </span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>any</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Extract skill name from tool name (remove &quot;skill:&quot; prefix)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>toolName</span><span class=p>)</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>6</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>toolName</span><span class=p>[:</span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s>&quot;skill:&quot;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid skill tool name: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>toolName</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>skillName</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>toolName</span><span class=p>[</span><span class=mi>6</span><span class=p>:]</span>

<span class=w>    </span><span class=c1>// Get skill from registry</span>
<span class=w>    </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>registry</span><span class=p>.</span><span class=nx>GetByName</span><span class=p>(</span><span class=nx>skillName</span><span class=p>,</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;skill not found: %s&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>skillName</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Convert input to SkillInput</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>skillInput</span><span class=w> </span><span class=nx>SkillInput</span>
<span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=nx>v</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>input</span><span class=p>.(</span><span class=kd>type</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>:</span>
<span class=w>        </span><span class=nx>skillInput</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>v</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>:</span>
<span class=w>        </span><span class=nx>skillInput</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>SkillInput</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>RawMessage</span><span class=p>:</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>json</span><span class=p>.</span><span class=nx>Unmarshal</span><span class=p>(</span><span class=nx>v</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>skillInput</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;invalid input: %w&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=k>default</span><span class=p>:</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;unsupported input type: %T&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>input</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Execute skill</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>runtime</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nx>Errorf</span><span class=p>(</span><span class=s>&quot;runtime not configured&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Execute</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Background</span><span class=p>(),</span><span class=w> </span><span class=nx>skill</span><span class=p>,</span><span class=w> </span><span class=nx>skillInput</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Name returns the provider name.</span>
<span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>p</span><span class=w> </span><span class=o>*</span><span class=nx>SkillToolProvider</span><span class=p>)</span><span class=w> </span><span class=nx>Name</span><span class=p>()</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&quot;skills&quot;</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Step 4: Run test to verify it passes</strong></p> <p>Run: <code>cd toolskill &amp;&amp; go test -v -run "TestDiscovery|TestSkillToolProvider"</code> Expected: PASS</p> <p><strong>Step 5: Commit</strong></p> <div class=highlight><pre><span></span><code>git<span class=w> </span>add<span class=w> </span>toolskill/discovery.go<span class=w> </span>toolskill/provider.go<span class=w> </span>toolskill/discovery_test.go
git<span class=w> </span>commit<span class=w> </span>-m<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span><span class=s>&lt;&lt;&#39;EOF&#39;</span>
<span class=s>feat(toolskill): add discovery and MCP tool provider</span>

<span class=s>- Add Discovery for finding SKILL.md files in directories</span>
<span class=s>- Support user skills (~/.claude/skills/)</span>
<span class=s>- Support project skills (.claude/skills/)</span>
<span class=s>- Support plugin skills (plugins/*/skills/)</span>
<span class=s>- Add SkillToolProvider exposing skills as MCP tools</span>
<span class=s>- Use skill: prefix for tool naming convention</span>
<span class=s>- Add [SKILL] prefix to descriptions for visibility</span>

<span class=s>Co-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;</span>
<span class=s>EOF</span>
<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=verification-checklist>Verification Checklist<a class=headerlink href=#verification-checklist title="Permanent link">&para;</a></h2> <p>Before marking this PRD complete, verify:</p> <ul> <li>[ ] All tests pass: <code>go test ./toolskill/...</code></li> <li>[ ] Code coverage &gt; 80%: <code>go test -cover ./toolskill/...</code></li> <li>[ ] No lint errors: <code>golangci-lint run ./toolskill/...</code></li> <li>[ ] Examples compile: <code>go build ./toolskill/examples/...</code></li> <li>[ ] Integration with toolset works</li> <li>[ ] SKILL.md parsing handles edge cases</li> <li>[ ] Registry thread-safety verified</li> <li>[ ] Runtime handles cancellation properly</li> </ul> <h2 id=definition-of-done>Definition of Done<a class=headerlink href=#definition-of-done title="Permanent link">&para;</a></h2> <ol> <li><strong>Core Types</strong> - Skill interface, SkillManifest, SkillInput/Output defined</li> <li><strong>SKILL.md Parser</strong> - Parses standard format with frontmatter extraction</li> <li><strong>Registry</strong> - Thread-safe registration with version constraint resolution</li> <li><strong>Builder</strong> - Fluent API for skill composition with steps</li> <li><strong>Runtime</strong> - Executes skills with conditional steps and error handling</li> <li><strong>Discovery</strong> - Scans standard locations for SKILL.md files</li> <li><strong>Provider</strong> - Exposes skills as MCP tools with skill: prefix</li> <li><strong>Documentation</strong> - README.md with examples</li> </ol> <h2 id=architecture-notes>Architecture Notes<a class=headerlink href=#architecture-notes title="Permanent link">&para;</a></h2> <h3 id=abstraction-hierarchy>Abstraction Hierarchy<a class=headerlink href=#abstraction-hierarchy title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>Agents  Skills  Toolsets  Tools
</code></pre></div> <p>Skills orchestrate multiple tools into higher-level behaviors. The <code>skill:</code> prefix distinguishes skill tools from regular tools in MCP listings.</p> <h3 id=skillmd-standard>SKILL.md Standard<a class=headerlink href=#skillmd-standard title="Permanent link">&para;</a></h3> <p>The toolskill library implements the Agent Skills Open Standard: - YAML frontmatter with name and description (required) - Description must start with "Use when" for discovery optimization - Markdown body with Overview, When to Use, How It Works sections</p> <h3 id=integration-points>Integration Points<a class=headerlink href=#integration-points title="Permanent link">&para;</a></h3> <ul> <li><strong>toolset</strong>: Skills use toolsets for filtered tool access</li> <li><strong>toolrun</strong>: Runtime delegates to toolrun for execution</li> <li><strong>toolobserve</strong>: Optional tracing integration via middleware</li> <li><strong>toolversion</strong>: Manifest includes version for compatibility</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.fe8b6f2b.min.js></script> <script src=https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js></script> <script src=../../../../js/mermaid-init.js></script> </body> </html>