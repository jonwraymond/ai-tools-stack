# Component: tooladapter
# Multi-format protocol conversion

direction: right

vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 0
  }
  adapter-fill: "#d69e2e"
  format-fill: "#6b46c1"
  canonical-fill: "#38a169"
}

classes: {
  container: {
    style: {
      border-radius: 12
      shadow: true
      font-size: 14
      bold: true
    }
  }
  adapter-node: {
    style: {
      fill: ${adapter-fill}
      stroke: "#b7791f"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  format-node: {
    style: {
      fill: ${format-fill}
      stroke: "#553c9a"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  canonical-node: {
    style: {
      fill: ${canonical-fill}
      stroke: "#276749"
      stroke-width: 2
      font-color: "#fff"
    }
  }
  to-flow: {
    style: {
      stroke: "#3182ce"
      stroke-width: 2
    }
  }
  from-flow: {
    style: {
      stroke: "#38a169"
      stroke-width: 2
      stroke-dash: 3
    }
  }
}

# Title
title: "tooladapter - Protocol Layer" {
  shape: text
  near: top-center
  style: {
    font-size: 28
    bold: true
    font-color: "#1a365d"
  }
}

# External Formats
formats: "ðŸ”Œ External Formats" {
  class: container
  style: {
    fill: "#faf5ff"
    stroke: ${format-fill}
  }

  mcp: "MCP\nModel Context Protocol" {
    shape: hexagon
    class: format-node
  }

  openai: "OpenAI\nFunction Calling" {
    shape: hexagon
    class: format-node
  }

  anthropic: "Anthropic\nTool Use" {
    shape: hexagon
    class: format-node
  }

  langchain: "LangChain\nTool Format" {
    shape: hexagon
    class: format-node
  }
}

# Core Component
core: "ðŸ”„ tooladapter" {
  class: container
  style: {
    fill: "#fffff0"
    stroke: ${adapter-fill}
    stroke-width: 3
  }

  to_canonical: "ToCanonical()\nIngest Format" {
    shape: step
    class: adapter-node
  }

  from_canonical: "FromCanonical()\nExport Format" {
    shape: step
    class: adapter-node
  }
}

# Canonical Model
canonical: "ðŸŽ¯ Canonical Model" {
  class: container
  style: {
    fill: "#f0fff4"
    stroke: ${canonical-fill}
  }

  tool: "toolmodel.Tool\nUnified Schema" {
    shape: cylinder
    class: canonical-node
  }
}

# Consumers
consumers: "ðŸ“¤ Consumers" {
  class: container
  style: {
    fill: "#ebf8ff"
    stroke: "#3182ce"
  }

  toolset: "toolset\nComposition" {
    shape: package
    style: {
      fill: "#3182ce"
      stroke: "#2c5282"
      font-color: "#fff"
    }
  }

  toolrun: "toolrun\nExecution" {
    shape: step
    style: {
      fill: "#3182ce"
      stroke: "#2c5282"
      font-color: "#fff"
    }
  }
}

# Connections - To Canonical
formats.mcp -> core.to_canonical: "parse" {
  class: to-flow
}
formats.openai -> core.to_canonical: "parse" {
  class: to-flow
}
formats.anthropic -> core.to_canonical: "parse" {
  class: to-flow
}
formats.langchain -> core.to_canonical: "parse" {
  class: to-flow
}

core.to_canonical -> canonical.tool: "normalize" {
  class: to-flow
}

# Connections - From Canonical
canonical.tool -> core.from_canonical: "convert" {
  class: from-flow
}

core.from_canonical -> formats.mcp: "export" {
  class: from-flow
}
core.from_canonical -> formats.openai: "export" {
  class: from-flow
}
core.from_canonical -> formats.anthropic: "export" {
  class: from-flow
}

canonical.tool -> consumers.toolset: "uses" {
  style.stroke: "#718096"
  style.stroke-width: 2
}
canonical.tool -> consumers.toolrun: "uses" {
  style.stroke: "#718096"
  style.stroke-width: 2
}

# Note
note: |md
  ## Format Support

  - **MCP**: Full bidirectional
  - **OpenAI**: Function calling
  - **Anthropic**: Tool use format
  - **LangChain**: Tool interface
| {
  near: bottom-right
  style: {
    fill: "#f7fafc"
    stroke: "#e2e8f0"
    font-size: 10
    border-radius: 8
  }
}
